<html lang="zh-CN" data-theme="light" class="translated-ltr"><head><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/pine-script-docs/static/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>概念/策略</title><meta name="og:title" content="Concepts / Strategies"><meta name="twitter:title" content="Concepts / Strategies"><meta name="description" content="Everything you need to know about Pine Script™."><meta name="og:description" content="Everything you need to know about Pine Script™."><meta name="twitter:description" content="Everything you need to know about Pine Script™."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png"><meta name="twitter:image" content="/pine-script-docs/meta-image.png"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="../../concepts/strategies/"><meta name="twitter:url" content="../../concepts/strategies/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="../../concepts/strategies/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="stylesheet" href="/pine-script-docs/_astro/index.jN9AZoBe.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.C8b720yZ.css"><script type="module" src="/pine-script-docs/_astro/hoisted.D4iEV6y6.js" data-astro-exec=""></script><style type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://www.gstatic.com/_/translate_http/_/ss/k=translate_http.tr.26tY-h6gH9w.L.W.O/am=GAY/d=0/rs=AN8SPfrev-A3NvrBP0gNq8zXCqKY7IcBLA/m=el_main_css"></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16px" height="16px" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02Zm-3.95-.3a7.91 7.91 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8V4Zm0 9v2h1v-2H8Zm6-3V9h-2v1h2ZM3 9v1h2V9H3Zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm4.2-6-.7-.7-1.4 1.4.7.7L12.7 6ZM5 13.7l-.7-.7 1.4-1.4.7.7L5 13.7Zm7.7-.7-.7.7-1.4-1.4.7-.7 1.4 1.4ZM4.3 6l.7-.7 1.4 1.4-.7.7L4.3 6Zm3 17 14-14 .8.7L8 23.7l-.7-.7Zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9Z"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh="">    <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="关闭菜单" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="主导航" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="打开导航菜单" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="主页按钮" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><svg width="188" height="44" viewBox="0 0 188 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001ZM32.4978 22.1105L27.1641 25.5207L19.7195 19.2258C19.1767 18.7669 18.4312 18.6305 17.7611 18.8676L13.8245 20.2602L21.9253 9.59841L32.4978 22.1105Z" fill="currentColor"></path>
<path d="M33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="currentColor"></path>
<path d="M59.56 13.96C63.016 13.96 65.536 16.456 65.536 19.696C65.536 22.936 63.016 25.432 59.56 25.432H57.376V31H53.896V13.96H59.56ZM59.512 22.168C61.096 22.168 62.152 21.088 62.152 19.696C62.152 18.304 61.096 17.224 59.512 17.224H57.376V22.168H59.512ZM70.8636 14.944C70.8636 16.096 69.9276 17.032 68.7516 17.032C67.6236 17.032 66.6636 16.096 66.6636 14.944C66.6636 13.792 67.6236 12.856 68.7516 12.856C69.9276 12.856 70.8636 13.792 70.8636 14.944ZM67.1196 31V19H70.4076V31H67.1196ZM73.0849 31V19H76.3729V20.368C76.9969 19.408 78.2449 18.736 79.8049 18.736C82.7089 18.736 84.4369 20.848 84.4369 23.968V31H81.1489V24.52C81.1489 22.792 80.4049 21.736 79.0369 21.736C77.5249 21.736 76.3729 22.84 76.3729 25.144V31H73.0849ZM86.2041 25C86.2041 21.448 88.8681 18.736 92.5161 18.736C95.6601 18.736 98.4201 20.752 98.4201 24.64C98.4201 24.928 98.4201 25.264 98.3721 25.768H89.3961C89.5881 27.376 91.0041 28.264 92.5881 28.264C94.0761 28.264 95.1561 27.568 95.6841 26.752L98.1321 28.576C97.0281 30.184 95.0841 31.264 92.5641 31.264C88.9881 31.264 86.2041 28.792 86.2041 25ZM92.4201 21.448C91.1961 21.448 89.8281 22.072 89.5161 23.536H95.1321C94.8441 22.12 93.6441 21.448 92.4201 21.448ZM104.412 28.24L107.076 26.008C107.916 27.28 109.38 28.024 110.772 28.024C112.14 28.024 113.052 27.352 113.052 26.368C113.052 25.408 112.356 24.736 110.676 24.16L109.236 23.656C106.5 22.696 105.036 21.112 105.036 18.784C105.036 15.568 107.484 13.672 110.796 13.672C112.884 13.672 114.708 14.392 116.172 16.024L113.868 18.4C113.052 17.416 111.996 16.936 110.82 16.936C109.644 16.936 108.54 17.44 108.54 18.448C108.54 19.48 109.38 19.936 111.18 20.584L112.548 21.088C115.044 22 116.604 23.584 116.604 26.152C116.58 29.2 114.156 31.288 110.628 31.288C107.916 31.288 105.636 30.112 104.412 28.24ZM129.859 27.808C128.827 29.872 126.667 31.264 124.171 31.264C120.619 31.264 117.811 28.624 117.811 25C117.811 21.376 120.619 18.736 124.171 18.736C126.667 18.736 128.827 20.128 129.859 22.192L127.003 23.728C126.523 22.624 125.491 21.808 124.171 21.808C122.443 21.808 121.123 23.152 121.123 25C121.123 26.848 122.443 28.192 124.171 28.192C125.491 28.192 126.523 27.376 127.003 26.272L129.859 27.808ZM131.482 31V19H134.77V20.92C135.178 19.744 136.402 18.856 137.746 18.856C138.082 18.856 138.442 18.88 138.85 19V22.336C138.346 22.168 137.89 22.072 137.362 22.072C135.802 22.072 134.77 23.296 134.77 25.264V31H131.482ZM144.215 14.944C144.215 16.096 143.279 17.032 142.103 17.032C140.975 17.032 140.015 16.096 140.015 14.944C140.015 13.792 140.975 12.856 142.103 12.856C143.279 12.856 144.215 13.792 144.215 14.944ZM140.471 31V19H143.759V31H140.471ZM146.436 36.016V19H149.724V20.344C150.276 19.576 151.548 18.736 153.204 18.736C156.396 18.736 158.844 21.592 158.844 25C158.844 28.408 156.396 31.264 153.204 31.264C151.548 31.264 150.276 30.424 149.724 29.656V36.016H146.436ZM155.508 25C155.508 23.128 154.284 21.736 152.484 21.736C150.684 21.736 149.46 23.128 149.46 25C149.46 26.872 150.684 28.264 152.484 28.264C154.284 28.264 155.508 26.872 155.508 25ZM168.407 30.88C167.879 31.048 167.231 31.144 166.319 31.144C163.775 31.144 161.735 29.728 161.735 26.8V21.88H159.311V19H161.735V15.664H165.023V19H168.407V21.88H165.023V26.152C165.023 27.616 165.647 28.192 167.063 28.192C167.591 28.192 168.023 28.12 168.407 27.976V30.88ZM177.626 22.648V13.96H179.978L181.874 16.888L183.746 13.96H186.122V22.648H183.698V18.184L181.874 20.968L180.026 18.136V22.648H177.626ZM171.386 22.648V16.456H169.058V13.96H176.258V16.456H173.93V22.648H171.386Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="搜索文档" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0Zm-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="重置" data-search-clear="" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除</font></font></button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="关闭" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索结果</font></font></div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp="">    </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true" style="display:none"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="关闭图片预览" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94 5.53 4.47Z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="返回文档主页。" data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户手册</font></font></span>  </a>  <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <a href="/pine-script-docs/concepts/alerts" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></a> <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <span class="current-item" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></span> </div>     </div> <div id="slot-container" data-astro-cid-xgirumru="">  <h1 id="strategies" class="md-heading"><a href="#strategies"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<h2 id="introduction" class="md-heading"><a href="#introduction"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 策略模拟历史和实时数据上的交易执行，以促进交易系统的回溯测试和前向测试。它们包含许多与 Pine Script™ 指标相同的功能，同时提供下达、修改和取消假设订单并分析结果的能力。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当脚本使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数进行声明时，它将获得对</font></font><code dir="auto">strategy.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命名空间的访问权限，在该命名空间中它可以调用函数和变量来模拟订单并访问基本策略信息。此外，脚本将在“策略测试器”选项卡中外部显示信息和模拟结果。</font></font></p>
<h2 id="a-simple-strategy-example" class="md-heading"><a href="#a-simple-strategy-example"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个简单的策略</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下脚本是一个简单的策略，模拟在两个移动平均线交叉时进入多头或空头仓位：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="gs"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;two&nbsp;moving&nbsp;averages&nbsp;with&nbsp;different&nbsp;le</span><span class="mtk9">ngths.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">fastMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">slowMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Enter&nbsp;a&nbsp;long&nbsp;position&nbsp;when&nbsp;`fastMA`&nbsp;crosses&nbsp;ove</span><span class="mtk9">r&nbsp;`slowMA`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">fastMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">slowMA</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Enter&nbsp;a&nbsp;short&nbsp;position&nbsp;when&nbsp;`fastMA`&nbsp;crosses&nbsp;un</span><span class="mtk9">der&nbsp;`slowMA`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">fastMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">slowMA</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"sell"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;moving&nbsp;averages.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">fastMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Fast&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">slowMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Slow&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code dir="auto">strategy("test" overlay = true)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行声明该脚本是一个名为“测试”的策略，其视觉输出覆盖在主图表窗格上。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategies.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
是脚本用来模拟“买入”和“卖出”订单的命令。当脚本下订单时，它还会</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图表上绘制订单，并用箭头指示方向。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plot()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数用两种不同的颜色绘制移动平均线以供视觉参考。</font></font></li>
</ul>
<h2 id="applying-a-strategy-to-a-chart" class="md-heading"><a href="#applying-a-strategy-to-a-chart"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将策略应用于</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要测试策略，请将其应用于图表。您可以使用“指标和策略”对话框中的内置策略，也可以在 Pine 编辑器中编写自己的策略。单击“Pine 编辑器”选项卡中的“添加到图表”以将脚本应用于图表：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Applying-a-strategy-to-a-chart-1.sh7yATus_1iF3oX.webp" alt="图像" width="1018" height="196" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略脚本编译并应用到图表后，将在主图表窗格上绘制订单标记，并在下面的“策略测试器”选项卡中显示模拟的性能结果：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Applying-a-strategy-to-a-chart-2.DSJCJN56_Z2kfkPT.webp" alt="图像" width="1342" height="760" loading="lazy" decoding="async"></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，应用于非标准图表（</font></font><a href="https://www.tradingview.com/support/solutions/43000619436"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heikin Ashi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/support/solutions/43000502284"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renko</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/support/solutions/43000502273"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Line Break</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/support/solutions/43000502272"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kagi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/support/solutions/43000502276"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Point &amp; Figure</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/support/solutions/43000474007"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Range</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的策略结果不反映实际市场状况。策略脚本将在模拟过程中使用这些图表中的合成价格值，这些价格值通常与实际市场价格不一致，因此会产生不切实际的回测结果。因此，我们强烈建议使用标准图表类型进行策略回测。或者，在 Heikin Ashi 图表上，用户可以通过在策略属性中启用“使用标准 OHLC 填写订单”选项，使用实际价格模拟</font></font><a href="https://www.tradingview.com/support/solutions/43000628599"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></div></aside>
<h2 id="strategy-tester" class="md-heading"><a href="#strategy-tester"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试员</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有使用strategy()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数声明的脚本都可以使用策略测试器模块
</font><font style="vertical-align: inherit;">
。用户可以从图表下方的“策略测试器”选项卡访问此模块，在这里他们可以方便地可视化他们的策略并分析假设的绩效结果。</font></font></p>
<h3 id="overview" class="md-heading"><a href="#overview"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概述</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/support/solutions/43000681733"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略测试器的“概览”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡
</font><font style="vertical-align: inherit;">
显示了模拟交易序列中的基本绩效指标以及权益和回撤曲线，可让您快速查看策略绩效，而无需深入了解细节。本节中的图表</font><font style="vertical-align: inherit;">以初始值为中心的基线图形式显示策略的</font></font><a href="https://www.tradingview.com/support/solutions/43000681735"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权益曲线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以线图形式显示</font></font><a href="https://www.tradingview.com/support/solutions/43000681736"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">买入并持有的权益曲线，以直方图形式显示</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/support/solutions/43000681734"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回撤曲线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。用户可以使用图表下方的选项切换这些图并将其缩放为绝对值或百分比。</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Strategy-tester-Overview-1.Dl0kXpLm_Z2wYThl.webp" alt="图像" width="1342" height="764" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概览图使用两个刻度；左边是权益曲线，右边是回撤曲线。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当用户点击这些图上的某个点时，主图表视图将指向交易结束的点。</font></font></li>
</ul>
<h3 id="performance-summary" class="md-heading"><a href="#performance-summary"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绩效</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">摘要</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/support/solutions/43000681683"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块的“绩效摘要”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">卡全面概述了策略的绩效指标。它显示三列：一列用于所有交易，一列用于所有多头，一列用于所有空头，为交易者提供有关策略的多头、空头和整体模拟交易绩效的更详细见解。</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Strategy-tester-Performance-summary-1.DcoSYJi9_Zew5cK.webp" alt="图像" width="1342" height="768" loading="lazy" decoding="async"></p>
<h3 id="list-of-trades" class="md-heading"><a href="#list-of-trades"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">交易</font></span><font style="vertical-align: inherit;">清单</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/support/solutions/43000681737"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易清单选项</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卡</font><font style="vertical-align: inherit;">提供了对策略模拟交易的详细了解，其中包含基本信息，包括执行日期和时间、使用的订单类型（进入或退出）、交易的合约/股票/手/单位数量和价格，以及一些关键的交易绩效指标。</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Strategy-tester-List-of-trades-1.CqWLl3Uc_Tg2ti.webp" alt="图像" width="1342" height="768" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以通过点击此列表中的特定交易来查看图表上特定交易的时间。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过点击列表上方的“交易编号”字段，用户可以从第一笔交易开始按升序排列交易，或者从最后一笔交易开始按降序排列交易。</font></font></li>
</ul>
<h3 id="properties" class="md-heading"><a href="#properties"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特性</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性选项卡提供有关策略配置及其所应用数据集的详细信息。其中包括策略的日期范围、符号信息、脚本设置和策略属性。</font></font></p>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期范围</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 包括模拟交易的日期范围和总可用的回溯测试范围。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符号信息</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 包含符号名称和经纪人/交易所、图表的时间范围和类型、刻度大小、图表的点值和基础货币。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略输入</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 概述脚本设置中“输入”选项卡中提供的策略脚本中使用的各种参数和变量。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略属性</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 提供交易策略配置的概述。其中包括初始资本、基础货币、订单规模、保证金、金字塔式交易、佣金和滑点等基本详细信息。此外，本节还重点介绍了对策略计算行为所做的任何修改。</font></font></li>
</ul>
<p><img src="/pine-script-docs/_astro/Strategies-Strategy-tester-Properties-1.BJRt5efJ_DxF2g.webp" alt="图像" width="1328" height="304" loading="lazy" decoding="async"></p>
<h2 id="broker-emulator" class="md-heading"><a href="#broker-emulator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经纪商</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟器</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TradingView 使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经纪商模拟器</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来模拟交易策略的表现。与实际交易不同，模拟器严格使用可用的图表价格进行订单模拟。因此，模拟只能在收盘后进行历史交易，并且只能在新的价格波动时进行实时交易。有关此行为的更多信息，请参阅 Pine Script™
</font></font><a href="/pine-script-docs/language/execution-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于模拟器只能使用图表数据，因此它会对条形图内的价格变动做出假设。它使用条形图的开盘价、最高价和最低价来推断条形图内的活动，同时使用以下逻辑计算订单成交：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果最高价比最低价更接近开盘价，则假定价格在柱状图上按以下顺序移动：开盘价 → 最高价 → 最低价 → 收盘价。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果最低价比最高价更接近开盘价，则假定价格在柱状图上按以下顺序移动：开盘价 → 最低价 → 最高价 → 收盘价。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经纪商模拟器假设柱状图内的价格之间不存在差距，这意味着整个柱状图内的价格范围都可用于订单执行。但是，在执行固定价格订单（除市价订单外的所有订单）时，会考虑前一个柱状图收盘价与当前柱状图开盘价之间的差距。如果订单价格在两个柱状图之间的差距内交叉，则订单将在下一个柱状图开盘时执行，而不是在指定价格执行。</font></font></li>
</ul>
<p><img src="/pine-script-docs/_astro/Strategies-Broker-emulator-1.TOD5mNOt_1q8drI.webp" alt="图像" width="1306" height="528" loading="lazy" decoding="async"></p>
<h3 id="bar-magnifier" class="md-heading"><a href="#bar-magnifier"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放大镜</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级帐户持有者可以通过</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">策略 ()</font></a></font><code dir="auto">use_bar_magnifier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的参数
</font><font style="vertical-align: inherit;">
或脚本设置“属性”选项卡中的“使用条形放大器”输入来覆盖经纪商模拟器的条形图内假设。</font><a href="https://www.tradingview.com/support/solutions/43000669285"><font style="vertical-align: inherit;">条形放大器</font></a><font style="vertical-align: inherit;">
检查比图表时间范围小的数据，以获取有关条形图内价格行为的更详细信息，从而允许在模拟期间更精确地执行订单。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/support/solutions/43000669285"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示，以下脚本在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_time"><font style="vertical-align: inherit;">时间</font></a><font style="vertical-align: inherit;">
值与 交叉</font><font style="vertical-align: inherit;">时
在 处下达“买入”限价订单</font></font><code dir="auto">entryPrice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在 处下达“退出”限价订单</font><font style="vertical-align: inherit;">，并绘制两条水平线以可视化订单价格。该脚本还使用 突出显示背景以</font><font style="vertical-align: inherit;">指示策略下达订单的时间：</font></font><code dir="auto">exitPrice</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_time"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">orderTime</code><font style="vertical-align: inherit;"></font><code dir="auto">orderColor</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Broker-emulator-Bar-magnifier-1.coZBXeS5_Z73KL6.webp" alt="图像" width="1342" height="690" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1oa"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Bar&nbsp;Magnifier&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">use_bar_magnifier</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;UNIX&nbsp;timestamp&nbsp;to&nbsp;place&nbsp;the&nbsp;order&nbsp;at.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">orderTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">timestamp</span><span class="mtk13">(</span><span class="mtk29">"UTC"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2023</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">22</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">18</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`color.orange`&nbsp;when&nbsp;`time`&nbsp;crosses&nbsp;the&nbsp;`o</span><span class="mtk9">rderTime`,&nbsp;false&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">orderColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Entry&nbsp;and&nbsp;exit&nbsp;prices.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPrice</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.25</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Entry&nbsp;and&nbsp;exit&nbsp;lines.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitLine</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.cross</span><span class="mtk13">(</span><span class="mtk11">time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">orderTime</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;new&nbsp;entry&nbsp;and&nbsp;exit&nbsp;lines.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">entryLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">exitLine</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;order&nbsp;highlight&nbsp;color.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">orderColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Place&nbsp;limit&nbsp;orders&nbsp;at&nbsp;the&nbsp;`entryPrice`&nbsp;and&nbsp;`exi</span><span class="mtk9">tPrice`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryPrice</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"Exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPrice</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;lines&nbsp;while&nbsp;the&nbsp;position&nbsp;is&nbsp;open.</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">entryLine</span><span class="mtk1">.</span><span class="mtk15">set_x2</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">exitLine</span><span class="mtk1">.</span><span class="mtk15">set_x2</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">orderColor</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们在上图中看到的，经纪商模拟器假设，在“买入”订单成交的柱状图上，柱状图内价格从开盘价变为高点，然后从高点变为低点，然后从低点变为收盘价，这意味着模拟器假设“退出”订单无法在同一柱状图上成交。然而，</font></font><code dir="auto">use_bar_magnifier = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在声明语句中包含这些内容后，我们看到了不同的情况：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Broker-emulator-Bar-magnifier-2.BNRDP6RA_1rU9cu.webp" alt="图像" width="1342" height="688" loading="lazy" decoding="async"></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以请求的最大内部条形图数量为 200,000。由于此限制，某些历史较长的符号可能无法完全覆盖其起始图表条形图，这意味着这些条形图上的模拟交易不会受到条形图放大器的影响。</font></font></p></div></aside>
<h2 id="orders-and-entries" class="md-heading"><a href="#orders-and-entries"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像在现实生活中的交易一样，Pine 策略使用订​​单来管理仓位。在这种情况下，订单</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟市场行为的命令，交易</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单成交后的结果。因此，要使用 Pine 进入或退出仓位，用户必须创建带有参数的订单，以指定其行为方式。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了更深入地了解订单如何运作以及它们如何成为交易，让我们编写一个简单的策略脚本：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="3qf"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;strategy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;text&nbsp;passed&nbsp;to&nbsp;`txt`&nbsp;when&nbsp;called.&nbsp;</span></span><br><span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">txt</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk18">=</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_lower_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;true&nbsp;on&nbsp;every&nbsp;20th&nbsp;bar</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">longCondition</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk29">"Long&nbsp;entry&nbsp;order&nbsp;created"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Long&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk16">strategy.close_all</span><span class="mtk13">()</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此脚本中，我们定义了一个，</font></font><code dir="auto">longCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只要 可</font></font><code dir="auto">bar_index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被 20 整除，即每 20 个条形图，该条件即为真。该策略在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if结构中使用此条件，使用</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategies.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
模拟入场订单，
</font><font style="vertical-align: inherit;">
并使用用户定义函数在入场价格处绘制标签
</font></font><code dir="auto">debugLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。该脚本从全局范围调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose_all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategies.close_all()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来模拟平仓任何未平仓头寸的市场订单。让我们看看将脚本添加到图表后会发生什么：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-1.CX7qCrxg_Z2raUd5.webp" alt="图像" width="1342" height="678" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表上的蓝色箭头表示入场位置，紫色箭头标记策略平仓的位置。请注意，标签位于实际入场点之前，而不是出现在同一条柱上 - 这是实际的订单。默认情况下，Pine 策略会等待下一个可用的价格刻度再执行订单，因为在同一刻度上执行订单是不现实的。此外，它们会在每个历史柱的收盘时重新计算，这意味着在这种情况下，下一个可以执行订单的刻度是下一个柱的开盘价。因此，默认情况下，所有订单都会延迟一个图表柱。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要注意的是，尽管脚本从全局范围调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose_all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.close_all()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
，强制在每个柱状图上执行，但如果策略未模拟未平仓头寸，则函数调用不会执行任何操作。如果有未平仓头寸，该命令会发出市价单来平仓，并在下一个可用的报价时执行。例如，当
</font></font><code dir="auto">longCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱状图 20 上的值为真时，策略会下达入场订单，在下一个报价时（即柱状图 21 的开盘价）执行。一旦脚本在该柱状图收盘时重新计算其值，该函数会下达平仓订单，并在柱状图 22 的开盘价执行。</font></font></p>
<h3 id="order-types" class="md-heading"><a href="#order-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 策略允许用户根据自己的特定需求模拟不同的订单类型。主要类型包括</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">市价单</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限价单</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">止损单</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">止损限价单</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<h4 id="market-orders" class="md-heading"><a href="#market-orders"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">市价</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">市价单是最基本的订单类型。它们指示一种策略，即无论价格如何，尽快买入或卖出证券。因此，它们总是在下一个可用的价格点执行。默认情况下，所有</font></font><code dir="auto">strategy.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成订单的功能都会专门生成市价单。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下脚本在</font></font><code dir="auto">bar_index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
能被 整除时模拟多头市场订单。否则，在</font><font style="vertical-align: inherit;">能被 整除</font></font><code dir="auto">2 * cycleLength</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时模拟空头市场订单</font><font style="vertical-align: inherit;">，从而形成每条柱状图交替进行多头和空头交易的策略</font><font style="vertical-align: inherit;">：</font></font><code dir="auto">bar_index</code><font style="vertical-align: inherit;"></font><code dir="auto">cycleLength</code><font style="vertical-align: inherit;"></font><code dir="auto">cycleLength</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-types-1.XLQDthDF_Z1YB5yU.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2dq"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Market&nbsp;order&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Number&nbsp;of&nbsp;bars&nbsp;between&nbsp;long&nbsp;and&nbsp;short&nbsp;entries.</span></span><br><span><span class="mtk33">cycleLength</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Cycle&nbsp;length"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;text&nbsp;passed&nbsp;to&nbsp;`txt`&nbsp;when&nbsp;called.</span></span><br><span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_lower_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`true`&nbsp;every&nbsp;`2&nbsp;*&nbsp;cycleLength`&nbsp;bars.</span></span><br><span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">cycleLength</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`true`&nbsp;every&nbsp;`cycleLength`&nbsp;bars.</span></span><br><span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">cycleLength</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;a&nbsp;long&nbsp;market&nbsp;order&nbsp;with&nbsp;a&nbsp;`color.gree</span><span class="mtk9">n`&nbsp;label&nbsp;on&nbsp;`longCondition`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk29">"Long&nbsp;market&nbsp;order&nbsp;created"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Long&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Otherwise,&nbsp;generate&nbsp;a&nbsp;short&nbsp;market&nbsp;order&nbsp;with&nbsp;a</span><span class="mtk9">&nbsp;`color.red`&nbsp;label&nbsp;on&nbsp;`shortCondition`.</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk29">"Short&nbsp;market&nbsp;order&nbsp;created"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Short&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br></code></div>
<h4 id="limit-orders" class="md-heading"><a href="#limit-orders"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限价</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限价订单命令策略以特定价格或更优价格（多头订单低于指定价格，空头订单高于指定价格）进入头寸。当当前市场价格优于订单命令的
</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数时，订单将立即执行，而无需等待市场价格达到限价水平。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要在脚本中模拟限价订单，请使用参数将价格值传递给订单下达命令</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。以下示例在收盘价低于 100 个条形图之前 800 个刻度的位置下达限价订单
</font></font><code dir="auto">last_bar_index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-types-2.Ma_eheTS_1mD31p.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="bc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Limit&nbsp;order&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;text&nbsp;passed&nbsp;to&nbsp;`txt`&nbsp;and&nbsp;a&nbsp;horizontal&nbsp;li</span><span class="mtk9">ne&nbsp;at&nbsp;`price`&nbsp;when&nbsp;called.</span></span><br><span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_lower_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_dashed</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;a&nbsp;long&nbsp;limit&nbsp;order&nbsp;with&nbsp;a&nbsp;label&nbsp;and&nbsp;li</span><span class="mtk9">ne&nbsp;100&nbsp;bars&nbsp;before&nbsp;the&nbsp;`last_bar_index`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">800</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">limitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long&nbsp;Limit&nbsp;order&nbsp;created"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，脚本在交易前几条柱状图上放置标签并开始绘制线条。只要价格高于该</font></font><code dir="auto">limitPrice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值，订单就无法成交。一旦市场价格达到限制，策略就会在柱状图中间执行交易。如果我们将设置为
</font><em><font style="vertical-align: inherit;">高于</font></em><font style="vertical-align: inherit;">柱状图收盘</font></font><code dir="auto">limitPrice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价 800 个刻度，而不是</font><em><font style="vertical-align: inherit;">低于</font></em><font style="vertical-align: inherit;">，订单将立即成交，因为价格已经处于更佳值：</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-types-3.D5qNWPW8_Ad7IE.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5yc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Limit&nbsp;order&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;text&nbsp;passed&nbsp;to&nbsp;`txt`&nbsp;and&nbsp;a&nbsp;horizontal&nbsp;li</span><span class="mtk9">ne&nbsp;at&nbsp;`price`&nbsp;when&nbsp;called.</span></span><br><span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_lower_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_dashed</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;a&nbsp;long&nbsp;limit&nbsp;order&nbsp;with&nbsp;a&nbsp;label&nbsp;and&nbsp;li</span><span class="mtk9">ne&nbsp;100&nbsp;bars&nbsp;before&nbsp;the&nbsp;`last_bar_index`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">800</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">limitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long&nbsp;Limit&nbsp;order&nbsp;created"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk13">)</span></span><br></code></div>
<h4 id="stop-and-stop-limit-orders" class="md-heading"><a href="#stop-and-stop-limit-orders"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">止损和止损限价</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">止损单命令策略在价格达到指定</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价格或更差值（多头订单高于指定值，空头订单低于指定值）后模拟另一笔订单。它们本质上与限价单相反。当当前市场价格低于参数时</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，策略将触发后续订单，而无需等待当前价格达到止损水平。如果订单下单命令包含参数</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则后续订单将是指定值的限价单。否则，它将是市价单。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的脚本在</font></font><code dir="auto">close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 条柱线上方 800 个刻度处下达止损订单。在此示例中，当市场价格</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下单后几条柱线​​与价格交叉时，该策略进入多头仓位。请注意，下单时的初始价格优于传递给 的价格</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。等效限价订单将在以下图表柱线中成交：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-types-4.BpjXSFRL_ZCMq1X.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4qo"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Stop&nbsp;order&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;text&nbsp;passed&nbsp;to&nbsp;`txt`&nbsp;when&nbsp;called&nbsp;and&nbsp;sho</span><span class="mtk9">ws&nbsp;the&nbsp;`price`&nbsp;level&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_lower_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_dotted</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_dashed</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;a&nbsp;long&nbsp;stop&nbsp;order&nbsp;with&nbsp;a&nbsp;label&nbsp;and&nbsp;lin</span><span class="mtk9">es&nbsp;100&nbsp;bars&nbsp;before&nbsp;the&nbsp;last&nbsp;bar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">800</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">stopPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long&nbsp;Stop&nbsp;order&nbsp;created"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopPrice</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数的订单下达命令会生成止损限价订单。此订单类型等待价格越过止损水平，然后以指定</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价格下达限价订单。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们修改之前的脚本来模拟和可视化止损限价订单。在此示例中，我们使用</font></font><code dir="auto">low</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 条柱之前的值作为
</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入场命令中的价格。此脚本还显示标签和价格水平，以指示策略何时越过</font></font><code dir="auto">stopPrice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即策略何时激活限价订单。请注意市场价格最初如何达到限价水平，但策略不会模拟交易，因为价格必须越过 才能在</font></font><code dir="auto">stopPrice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下达待执行限价订单</font></font><code dir="auto">limitPrice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-types-5.CduO1Nxw_2mnPeh.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3sw"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Stop-Limit&nbsp;order&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;text&nbsp;passed&nbsp;to&nbsp;`txt`&nbsp;when&nbsp;called&nbsp;and&nbsp;sho</span><span class="mtk9">ws&nbsp;the&nbsp;`price`&nbsp;level&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineWidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_lower_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_dotted</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineWidth</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_dashed</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineWidth</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopPrice</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;a&nbsp;long&nbsp;stop-limit&nbsp;order&nbsp;with&nbsp;a&nbsp;label&nbsp;a</span><span class="mtk9">nd&nbsp;lines&nbsp;100&nbsp;bars&nbsp;before&nbsp;the&nbsp;last&nbsp;bar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopPrice</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">800</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">limitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">stopPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long&nbsp;Stop-Limit&nbsp;order&nbsp;created"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;line&nbsp;and&nbsp;label&nbsp;once&nbsp;the&nbsp;strategy&nbsp;activat</span><span class="mtk9">es&nbsp;the&nbsp;limit&nbsp;order.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopPrice</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">limitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Limit&nbsp;order&nbsp;activated"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br></code></div>
<h3 id="order-placement-commands" class="md-heading"><a href="#order-placement-commands"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下单</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 策略具有多种功能来模拟下单，称为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单下单命令</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。每个命令都有独特的用途，并且行为与其他命令不同。</font></font></p>
<h4 id="strategyentry" class="md-heading"><a href="#strategyentry"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.entry()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令模拟入场订单。默认情况下，策略在调用此函数时会下达市价单，但使用和参数</font><font style="vertical-align: inherit;">时，它们也可以创建止损单、限价单和止损限价单</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了简化开仓操作，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
具有几种独特的行为。其中一种行为是，此命令可以反转未平仓市场仓位，而无需额外的函数调用。当使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下达的订单成交时，该函数将自动计算策略平仓所需的金额，并</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
默认以相反方向交易合约/股份/手数/单位。例如，如果策略在strategy.long
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dlong"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方向</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有 15 股未平仓仓位
，并调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()在</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dshort"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.short</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方向
下达市价订单
</font><font style="vertical-align: inherit;">
，则策略下达订单将交易的金额为 15 股加上</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新的空头订单。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例演示了一种仅使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用来下达入场订单的策略。它</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每100条线创建一个价值为15股的多头市场订单，每25条线创建一个价值为5股的空头市场订单
</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。脚本分别用蓝色和红色突出显示背景中的</font></font><code dir="auto">buyCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><code dir="auto">sellCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-1.DcjzabKe_Z1NSxPj.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4t2"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Entry&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;25th&nbsp;bar&nbsp;except&nbsp;for&nbsp;those&nbsp;that</span><span class="mtk9">&nbsp;are&nbsp;divisible&nbsp;by&nbsp;100.</span></span><br><span><span class="mtk33">sellCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">15</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">sellCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"sell"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">sellCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如上图所示，订单标记显示该策略在每次订单执行时交易 20 股，而不是 15 股和 5 股。由于
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()会自动反转仓位，除非通过</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dallow_entry_in"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.risk.allow_entry_in()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数
另有规定，否则
</font><font style="vertical-align: inherit;">
它会在改变方向时将未平仓头寸规模（多头入场为 15 股）添加到新订单规模（空头入场为 5 股），从而导致交易数量为 20 股。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，在上面的例子中，尽管</font></font><code dir="auto">sellCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在另一个 之前出现了三次</font></font><code dir="auto">buyCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但策略只在第一次出现时下达“卖出”订单。strategy.entry
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令的另一个独特行为是它受脚本的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">金字塔</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置的影响。金字塔指定策略可以在同一方向填写的连续订单数。其默认值为 1，这意味着策略只允许在任一方向上填写一个连续订单。用户可以通过</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">strategy()</font></a></font><code dir="auto">pyramiding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数调用
的参数
</font><font style="vertical-align: inherit;">
或脚本设置“属性”选项卡中的“金字塔”输入来设置策略金字塔值。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们添加</font></font><code dir="auto">pyramiding = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到我们之前的脚本的声明语句中，该策略将允许在同一方向进行最多三笔连续的交易，这意味着它可以在每次出现以下情况时模拟新的市场订单</font></font><code dir="auto">sellCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-2.zCHoGtrD_Z1roH1b.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<h4 id="strategyorder" class="md-heading"><a href="#strategyorder"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.order()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令模拟基本订单。与大多数包含内部逻辑以简化与策略接口的订单下达命令不同，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用指定的参数而不考虑大多数其他策略设置。通过
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下达的订单
可以开立新仓位并修改或关闭现有仓位。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下脚本仅使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用来创建和修改条目。该策略模拟每100条15个单位的多头市场订单，然后每25条模拟三个5个单位的空头订单。脚本突出显示背景蓝色和红色，以指示策略何时模拟“买入”和“卖出”订单：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-3.DSecmQ5U_Zz9mM4.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5a6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Order&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk33">buyCond</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;25th&nbsp;bar&nbsp;except&nbsp;for&nbsp;those&nbsp;that</span><span class="mtk9">&nbsp;are&nbsp;divisible&nbsp;by&nbsp;100.</span></span><br><span><span class="mtk33">sellCond</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCond</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCond</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">15</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Enter&nbsp;a&nbsp;long&nbsp;position&nbsp;of&nbsp;15&nbsp;units.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">sellCond</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"sell"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Exit&nbsp;5&nbsp;units&nbsp;from&nbsp;the&nbsp;long&nbsp;position.</span></span><br><span><span></span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">buyCond</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">sellCond</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此特定策略永远不会模拟空头仓位，因为与
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不会自动反转仓位。使用此命令时，产生的市场仓位是当前市场仓位和已成交订单数量的净和。在策略完成15个单位的“买入”订单后，它会执行三个“卖出”订单，每个订单将未平仓头寸减少5个单位，即15-5*3=0。
如上一</font><a href="/pine-script-docs/concepts/strategies#strategy-entry"><font style="vertical-align: inherit;">节</font></a><font style="vertical-align: inherit;">中所示，
使用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，同一脚本的行为会有所不同。</font></font><a href="/pine-script-docs/concepts/strategies#strategy-entry"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<h4 id="strategyexit" class="md-heading"><a href="#strategyexit"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.exit()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"></font><code dir="auto">loss</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令模拟退出订单。它的独特之处在于它允许策略退出市场头寸或通过、</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><code dir="auto">profit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和参数</font><font style="vertical-align: inherit;">以止损、止盈和追踪止损订单的形式形成多个退出订单</font></font><code dir="auto">trail_*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令的最基本用途
</font><font style="vertical-align: inherit;">
是创建策略因亏损过多（止损）、赚取足够的钱（获利）或两者兼而有之（括号）而退出头寸的级别。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令的止损和止盈功能与两个参数相关。函数的</font></font><code dir="auto">loss</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">profit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参数将止损和止盈值指定为距入场订单价格的定义刻度数，而其</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数提供具体的止损和止盈价格值。函数调用中的绝对参数优先于相对参数。如果
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用包含</font></font><code dir="auto">profit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，则命令将优先考虑该</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值并忽略该</font></font><code dir="auto">profit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。同样，它只会</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在函数调用包含
</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">loss</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数时考虑该值。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管与strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令</font><font style="vertical-align: inherit;">中的参数共享相同的名称
，但</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的工作方式不同。在第一种情况下，在命令中使用</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将创建一个止损限价订单，该订单在超过止损价后会开立限价订单。在第二种情况下，该命令将创建一个单独的限价和止损订单以退出未平仓头寸。</font></font></p></div></aside>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的所有
带有参数</font><font style="vertical-align: inherit;">的退出订单都
</font></font><code dir="auto">from_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与相应的入场订单绑定</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；当没有与
</font></font><code dir="auto">from_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID关联的未平仓市场头寸或活动入场订单时，策略无法模拟退出订单。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下策略每 100 条通过
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry( )下达“买入”进场订单，并通过</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令
下达止损和止盈订单
</font><font style="vertical-align: inherit;">
。请注意，脚本调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
两次。“exit1”命令引用“买入1”进场订单，“exit2”引用“买入”订单。该策略将仅模拟来自“exit2”的退出订单，因为“exit1”引用了不存在的订单ID：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-4.C3m9MCQf_ZyDV7k.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="7fc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Exit&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Stop-loss&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Take-profit&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;upon&nbsp;`buyCondition`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.99</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.01</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"buy1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Does&nbsp;nothing.&nbsp;"buy1"&nbsp;order&nbsp;doesn't&nbsp;exist.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stopLoss`&nbsp;and&nbsp;`takeProfit`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;pr</span><span class="mtk9">ice&nbsp;touches&nbsp;either,&nbsp;i.e.,&nbsp;when&nbsp;the&nbsp;strategy&nbsp;simula</span><span class="mtk9">tes&nbsp;an&nbsp;exit.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfit</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个退出命令的限价单和止损单不一定以指定价格成交。策略可以以更优惠的价格成交限价单，以更差的价格成交止损单，具体取决于经纪商模拟器可用的值范围。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果用户在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;">strategy.exit()</font></a></font><code dir="auto">from_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中没有提供参数
</font><font style="vertical-align: inherit;">
，该函数将为每个打开的条目创建退出订单。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此示例中，该策略创建“buy1”和“buy2”入场订单，并
每 100 条柱状图调用</font><font style="vertical-align: inherit;">
不带参数的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.exit()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">from_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。从图表上的订单标记可以看出，一旦市场价格达到</font></font><code dir="auto">stopLoss</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或</font></font><code dir="auto">takeProfit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，该策略就会为“buy1”和“buy2”入场订单填写退出订单：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-4a.B5VHq-B1_Z2pnJVr.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3c6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Exit&nbsp;all&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Stop-loss&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Take-profit&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;upon&nbsp;`buyCondition`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.99</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.01</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Places&nbsp;orders&nbsp;to&nbsp;exit&nbsp;all&nbsp;open&nbsp;entries.</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stopLoss`&nbsp;and&nbsp;`takeProfit`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;pr</span><span class="mtk9">ice&nbsp;touches&nbsp;either,&nbsp;i.e.,&nbsp;when&nbsp;the&nbsp;strategy&nbsp;simula</span><span class="mtk9">tes&nbsp;an&nbsp;exit.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfit</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略可以多次从同一个入场ID退出，这样便于形成多层级退出策略。执行多个退出命令时，每个订单的数量必须是交易数量的一部分，总和不超过未平仓头寸。如果函数的小于</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前市场头寸的大小，策略将模拟部分退出。如果该值超过</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未平仓头寸数量，它将减少订单，因为它无法填充比未平仓头寸更多的合约/股/手/单位。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的示例中，我们修改了之前的“退出演示”脚本，以模拟每次进入时的两个止损和止盈订单。该策略下达一个</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两股的“买入”订单、一个一股的“退出 1”止损和止盈订单以及</font><font style="vertical-align: inherit;">一个三股的</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“退出 2”止损和止盈订单：</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-5.WJU0XPdU_11c8yK.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="11d"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Multiple&nbsp;exit&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Stop-loss&nbsp;price&nbsp;for&nbsp;"exit1"&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Stop-loss&nbsp;price&nbsp;for&nbsp;"exit2"&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Take-profit&nbsp;price&nbsp;for&nbsp;"exit1"&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Take-profit&nbsp;price&nbsp;for&nbsp;"exit2"&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;upon&nbsp;`buyCondition`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.99</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.98</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.01</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.02</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stopLoss1`&nbsp;and&nbsp;`takeProfit1`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;</span><span class="mtk9">price&nbsp;touches&nbsp;either.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stopLoss2`&nbsp;and&nbsp;`takeProfit2`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;</span><span class="mtk9">price&nbsp;touches&nbsp;either.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit2</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLoss1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SL1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLoss2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SL2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfit1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfit2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从图表上的订单标记可以看出，尽管指定的</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值超过了交易量，但该策略仍执行了“exit2”订单。脚本没有使用此数量，而是减少了订单大小以匹配剩余的仓位。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用生成的所有订单都
</font><font style="vertical-align: inherit;">
属于同一个
</font></font><a href="/pine-script-docs/concepts/strategies#strategy-ocareduce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.oca.reduce</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组，这意味着当任一订单完成时，该策略会减少所有其他订单以匹配未平仓头寸。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值得注意的是，此命令生成的订单会保留一部分未平仓市场仓位以供退出。strategy.exit
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
无法下订单退出已由另一个退出命令保留的一部分仓位。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下脚本模拟了 100 条柱状图之前 20 股的“买入”市价单，其中“限价”和“止损”订单分别为 19 股和 20 股。如我们在图表上看到的，该策略首先执行了“止损”订单。但是，交易量只有一股。由于脚本首先下达了“限价”订单，因此该策略保留其</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（19 股）以平仓，只留下一股由“止损”订单平仓：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-5a.CVJyBloz_1r0nNp.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1gy"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Reserved&nbsp;exit&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;"stop"&nbsp;exit&nbsp;order&nbsp;price.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;"limit"&nbsp;exit&nbsp;order&nbsp;price</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;100&nbsp;bars&nbsp;before&nbsp;the&nbsp;`last_bar_index`.</span></span><br><span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.99</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.01</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"limit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">19</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Limit&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的另一个主要特性
</font><font style="vertical-align: inherit;">
是它可以创建</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追踪止损</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即每当价格朝着有利方向移动到更佳值时，追踪市价指定数量的止损订单。这些订单包含两个部分：激活水平和追踪偏移量。激活水平是市价必须跨越的值才能激活追踪止损计算，通过参数以刻度表示，</font></font><code dir="auto">trail_points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或通过参数以价格值表示</font></font><code dir="auto">trail_price</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果退出调用包含两个参数，则参数</font></font><code dir="auto">trail_price</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优先。追踪偏移量是止损将跟随市价的距离，通过参数以刻度表示</font></font><code dir="auto">trail_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。为了使
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建和激活追踪止损，函数调用必须包含
</font></font><code dir="auto">trail_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">trail_price</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code dir="auto">trail_points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例展示了移动止损的实际操作，并直观地展示了其行为。该策略模拟在图表上最后一根柱线前 100 个柱线的柱线上设置多头进场订单，然后在下一个柱线上设置移动止损。该脚本有两个输入：一个控制激活水平偏移（即激活止损所需的超过进场价格的金额），另一个控制移动偏移（即当市场价格朝着期望方向移动到更佳值时，要跟随的距离）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表上的绿色虚线显示市场价格必须跨越的水平才能触发追踪止损订单。价格越过该水平后，脚本会绘制一条蓝线来表示追踪止损。当价格上涨至新高值时（这对策略有利，因为这意味着头寸的价值正在增加），止损也会上升以保持</font></font><code dir="auto">trailingStopOffset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与当前价格相差一个刻度的距离。当价格下跌或未达到新高点时，止损值保持不变。最终，价格跌破止损，触发退出：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-5b.BprhxxcZ_1ujAyE.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2rn"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Trailing&nbsp;stop&nbsp;order&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Offset&nbsp;used&nbsp;to&nbsp;determine&nbsp;how&nbsp;far&nbsp;above&nbsp;the&nbsp;entry&nbsp;</span><span class="mtk9">price&nbsp;(in&nbsp;ticks)&nbsp;the&nbsp;activation&nbsp;level&nbsp;will&nbsp;be&nbsp;loca</span><span class="mtk9">ted.&nbsp;</span></span><br><span><span class="mtk33">activationLevelOffset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input</span><span class="mtk13">(</span><span class="mtk12">1000</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Activation&nbsp;Level&nbsp;Offset&nbsp;(in&nbsp;ticks)"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Offset&nbsp;used&nbsp;to&nbsp;determine&nbsp;how&nbsp;far&nbsp;below&nbsp;the&nbsp;high&nbsp;p</span><span class="mtk9">rice&nbsp;(in&nbsp;ticks)&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;will&nbsp;trail&nbsp;the&nbsp;c</span><span class="mtk9">hart.</span></span><br><span><span class="mtk33">trailingStopOffset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input</span><span class="mtk13">(</span><span class="mtk12">2000</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Trailing&nbsp;Stop&nbsp;Offset&nbsp;(in&nbsp;ticks)"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;text&nbsp;passed&nbsp;to&nbsp;`txt`&nbsp;when&nbsp;called&nbsp;and&nbsp;sho</span><span class="mtk9">ws&nbsp;the&nbsp;`price`&nbsp;level&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">hasLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_lower_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">hasLine</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_dashed</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;price&nbsp;at&nbsp;which&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;activation&nbsp;l</span><span class="mtk9">evel&nbsp;is&nbsp;located.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailPriceActivationLevel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;price&nbsp;at&nbsp;which&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;itself&nbsp;is&nbsp;lo</span><span class="mtk9">cated.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailingStop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Caclulates&nbsp;the&nbsp;value&nbsp;that&nbsp;Trailing&nbsp;Stop&nbsp;would&nbsp;hav</span><span class="mtk9">e&nbsp;if&nbsp;it&nbsp;were&nbsp;active&nbsp;at&nbsp;the&nbsp;moment.</span></span><br><span><span class="mtk33">theoreticalStopPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailingStopOffset</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;a&nbsp;long&nbsp;market&nbsp;order&nbsp;to&nbsp;enter&nbsp;100&nbsp;bars&nbsp;</span><span class="mtk9">before&nbsp;the&nbsp;last&nbsp;bar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;a&nbsp;trailing&nbsp;stop&nbsp;99&nbsp;bars&nbsp;before&nbsp;the&nbsp;las</span><span class="mtk9">t&nbsp;bar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">99</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">trailPriceActivationLevel</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">activationLevelOffset</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Trailing&nbsp;Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">from_entry</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">trail_price</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailPriceActivationLevel</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">trail_offset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailingStopOffset</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">trailPriceActivationLevel</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Trailing&nbsp;Stop&nbsp;Activation&nbsp;Level"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Visualize&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;mechanic&nbsp;in&nbsp;action.</span></span><br><span><span class="mtk9">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;open&nbsp;trade,&nbsp;check&nbsp;whether&nbsp;the&nbsp;Ac</span><span class="mtk9">tivation&nbsp;Level&nbsp;has&nbsp;been&nbsp;achieved.</span></span><br><span><span class="mtk9">//&nbsp;If&nbsp;it&nbsp;has&nbsp;been&nbsp;achieved,&nbsp;track&nbsp;the&nbsp;trailing&nbsp;sto</span><span class="mtk9">p&nbsp;by&nbsp;assigning&nbsp;its&nbsp;value&nbsp;to&nbsp;a&nbsp;variable.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.opentrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">trailingStop</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailPriceActivationLevel</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">trailPriceActivationLevel</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Activation&nbsp;level&nbsp;crossed"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">trailingStop</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">theoreticalStopPrice</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">trailingStop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Trailing&nbsp;Stop&nbsp;Activated"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">theoreticalStopPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailingStop</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">trailingStop</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">theoreticalStopPrice</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Visualize&nbsp;the&nbsp;movement&nbsp;of&nbsp;the&nbsp;trailing&nbsp;stop.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">trailingStop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Trailing&nbsp;Stop"</span><span class="mtk13">)</span></span><br></code></div>
<h4 id="strategyclose-and-strategyclose_all" class="md-heading"><a href="#strategyclose-and-strategyclose_all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`strategy.close()` 和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`strategy.close_all()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些命令使用市场订单模拟退出头寸。这些函数在被调用时关闭交易，而不是在特定价格关闭交易。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的例子演示了一个简单的策略，即每 50 个条形图通过
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()下达一次“买入”订单，然后在 25 个条形图之后使用</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.close()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以市价订单关闭
</font><font style="vertical-align: inherit;">
：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-6.C8naMrYK_ZahHab.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="7d6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Close&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;50th&nbsp;bar.</span></span><br><span><span class="mtk33">buyCond</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;25th&nbsp;bar&nbsp;except&nbsp;for&nbsp;those&nbsp;that</span><span class="mtk9">&nbsp;are&nbsp;divisible&nbsp;by&nbsp;50.</span></span><br><span><span class="mtk33">sellCond</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCond</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCond</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">sellCond</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.close</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">buyCond</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">sellCond</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与大多数其他下单命令不同，</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose"><font style="vertical-align: inherit;">strategy.close()</font></a></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的参数
</font><font style="vertical-align: inherit;">
引用要关闭的现有条目 ID。如果指定的条目 ID</font><font style="vertical-align: inherit;">不存在，则该命令不会执行订单。如果一个仓位由多个具有相同 ID 的条目组成，则该命令将同时退出所有条目。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">id</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示，以下脚本每 25 条柱线下达一次“买入”订单。该脚本每 100 条柱线关闭一次所有“买入”条目。我们</font></font><code dir="auto">pyramiding = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
声明语句中包含了允许策略在同一方向模拟最多三个订单的内容：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-7.BnXt0DwI_2ljg1Q.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="60n"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Multiple&nbsp;close&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk33">sellCond</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;25th&nbsp;bar&nbsp;except&nbsp;for&nbsp;those&nbsp;that</span><span class="mtk9">&nbsp;are&nbsp;divisible&nbsp;by&nbsp;100.</span></span><br><span><span class="mtk33">buyCond</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">sellCond</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCond</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">sellCond</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.close</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">buyCond</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">sellCond</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于脚本具有多个具有不同 ID 的条目的情况，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose_all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.close_all()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令会派上用场，因为它会关闭所有条目，而不管它们的 ID 是什么。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的脚本根据未平仓交易的数量依次下达“A”、“B”和“C”个入场订单，然后通过单个市场订单关闭所有订单：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-8.CRIv7OvG_1rGwwH.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2il"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Close&nbsp;multiple&nbsp;ID&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">switch</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.opentrades</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"A"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"B"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"C"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">3</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.close_all</span><span class="mtk13">()</span></span><br></code></div>
<h4 id="strategycancel-and-strategycancel_all" class="md-heading"><a href="#strategycancel-and-strategycancel_all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`strategy.cancel()` 和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`strategy.cancel_all()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些命令允许策略取消挂单，即
</font><font style="vertical-align: inherit;">
当使用</font><font style="vertical-align: inherit;">或参数时由</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的挂单。</font></font><code dir="auto">limit</code><font style="vertical-align: inherit;"></font><code dir="auto">stop</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下策略模拟了在 100 条柱线之前低于收盘价 500 个点的“买入”限价订单，然后在下一柱线取消订单。脚本在 处绘制一条水平线，并将</font></font><code dir="auto">limitPrice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景颜色设为绿色和橙色，分别表示限价订单的下达和取消时间。我们可以看到，一旦市场价格超过 ，什么也没有发生，</font></font><code dir="auto">limitPrice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为策略已经取消了订单：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-9.4WRZcmod_TgLp6.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1a2"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Cancel&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Draws&nbsp;a&nbsp;horizontal&nbsp;line&nbsp;at&nbsp;the&nbsp;`limit`&nbsp;price&nbsp;of&nbsp;t</span><span class="mtk9">he&nbsp;"buy"&nbsp;order.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`color.green`&nbsp;when&nbsp;the&nbsp;strategy&nbsp;places&nbsp;th</span><span class="mtk9">e&nbsp;"buy"&nbsp;order,&nbsp;`color.orange`&nbsp;when&nbsp;it&nbsp;cancels&nbsp;the&nbsp;</span><span class="mtk9">order.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limitLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">99</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.cancel</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">bgColor</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.close()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一样，</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dcancel"><font style="vertical-align: inherit;">strategy.cancel()</font></a></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的参数
</font><font style="vertical-align: inherit;">
引用现有条目的ID。如果参数</font><font style="vertical-align: inherit;">引用不存在的ID，此命令将不执行任何操作。当有多个具有相同ID的挂单时，此命令将一次性取消所有挂单。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dcancel"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">id</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此示例中，我们修改了之前的脚本，从 100 条线开始，在三个连续的线下“买入”限价订单。该策略在</font></font><code dir="auto">bar_index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">距离最近的线 97 条线后取消所有订单，导致当价格跨越任何一条线时，它什么也不做：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-10.BdK1xjss_Z1VR5ov.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="67j"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Multiple&nbsp;cancel&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Draws&nbsp;a&nbsp;horizontal&nbsp;line&nbsp;at&nbsp;the&nbsp;`limit`&nbsp;price&nbsp;of&nbsp;t</span><span class="mtk9">he&nbsp;"buy"&nbsp;order.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`color.green`&nbsp;when&nbsp;the&nbsp;strategy&nbsp;places&nbsp;th</span><span class="mtk9">e&nbsp;"buy"&nbsp;order,&nbsp;`color.orange`&nbsp;when&nbsp;it&nbsp;cancels&nbsp;the&nbsp;</span><span class="mtk9">order.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">98</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limitLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">97</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.cancel</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">bgColor</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font></font><code dir="auto">pyramiding = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在脚本的声明语句中添加了允许三个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
订单执行的语句。或者，脚本可以使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现相同的输出
，因为它对</font></font><code dir="auto">pyramiding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置不敏感。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要注意的是，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dcancel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.cancel()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dcancel_all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.cancel_all()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都
无法取消</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">市场</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单，因为策略会在下一个报价时立即执行这些订单。策略无法在订单成交后取消订单。要平仓，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.close()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose_all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.close_all()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例模拟了 100 条柱之前的“买入”市场订单，然后尝试在下一条柱上取消所有挂单。由于该策略已经填写了“买入”订单，因此
在此情况下， </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dcancel_all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.cancel_all()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令不会执行任何操作，因为没有要取消的挂单：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Orders-and-entries-Order-placement-commands-11.C3U1GI3M_DIxpi.webp" alt="图像" width="1342" height="544" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5lr"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Cancel&nbsp;market&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`color.green`&nbsp;when&nbsp;the&nbsp;strategy&nbsp;places&nbsp;th</span><span class="mtk9">e&nbsp;"buy"&nbsp;order,&nbsp;`color.orange`&nbsp;when&nbsp;it&nbsp;tries&nbsp;to&nbsp;can</span><span class="mtk9">cel.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">99</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.cancel_all</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">bgColor</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="position-sizing" class="md-heading"><a href="#position-sizing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">头寸</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规模</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 策略有两种方式来控制模拟交易的规模：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">使用strategy（）</font></a><font style="vertical-align: inherit;">函数中的
</font></font><code dir="auto">default_qty_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和参数</font><font style="vertical-align: inherit;">为所有订单设置默认的固定数量类型和值
</font><font style="vertical-align: inherit;">
，该函数还会在脚本设置的“属性”选项卡中设置默认值。</font></font><code dir="auto">default_qty_value</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;">调用strategy.entry()</font></a></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时
</font><font style="vertical-align: inherit;">指定参数</font><font style="vertical-align: inherit;">。当用户向函数提供此参数时，脚本将忽略策略的默认数量值和类型。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例模拟</font></font><code dir="auto">longAmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code dir="auto">low</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价格等于价值时“买入”订单，以及</font><font style="vertical-align: inherit;">当</font><font style="vertical-align: inherit;">价格等于价值时</font></font><code dir="auto">lowest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“卖出”订单</font><font style="vertical-align: inherit;">：</font></font><code dir="auto">shortAmount</code><font style="vertical-align: inherit;"></font><code dir="auto">high</code><font style="vertical-align: inherit;"></font><code dir="auto">highest</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Position-sizing-1.CpMYvl8Y_ZCp8n6.webp" alt="图像" width="1342" height="740" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3gf"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Buy&nbsp;low,&nbsp;sell&nbsp;high"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.cash</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5000</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">longAmount</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">4.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long&nbsp;Amount"</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortAmount</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Short&nbsp;Amount"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.lowest</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">longAmount</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Sell"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortAmount</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，在上面的例子中，尽管我们在声明语句中指定了
</font></font><code dir="auto">default_qty_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">default_qty_value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，但脚本不会将这些默认值用于模拟订单。相反，它将它们的大小设置为</font></font><code dir="auto">longAmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">shortAmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单位。如果我们希望脚本使用默认类型和值，我们必须</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用中删除规范：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Position-sizing-2.BNMrWxCG_Z1eMhKJ.webp" alt="图像" width="1342" height="740" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="tr"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Buy&nbsp;low,&nbsp;sell&nbsp;high"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.cash</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5000</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.lowest</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Sell"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="closing-a-market-position" class="md-heading"><a href="#closing-a-market-position"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平仓</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">​</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管可以模拟从
</font><a href="/pine-script-docs/concepts/strategies#strategy-tester"><font style="vertical-align: inherit;">策略测试器</font></a><font style="vertical-align: inherit;">模块的
</font></font><a href="/pine-script-docs/concepts/strategies#list-of-trades"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易列表</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡中显示的特定进场订单退出，但所有订单都按照 FIFO（先进先出）规则链接。如果用户未指定</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;">策略.exit()</font></a><font style="vertical-align: inherit;">调用
的参数
</font><font style="vertical-align: inherit;">
，则策略将从打开它的第一个进场订单开始退出未平仓市场头寸。</font></font><a href="/pine-script-docs/concepts/strategies#strategy-tester"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">from_entry</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例按顺序模拟两个订单：按最后 100 个柱的市场价格执行“Buy1”，一旦头寸规模与“Buy1”的规模匹配，则执行“Buy2”。该策略仅在 为</font></font><code dir="auto">positionSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15 个单位时下达退出订单。该脚本不
</font></font><code dir="auto">from_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategies.exit()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令提供参数，因此该策略每次调用该函数时都会为所有未平仓头寸下达退出订单，从第一个开始。它
</font></font><code dir="auto">positionSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在单独的窗格中绘制 以供视觉参考：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Closing-a-market-position-1.CG44yAVx_1GNd4G.webp" alt="图像" width="1342" height="686" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="7m2"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Exit&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">15</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"bracket"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">profit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Position&nbsp;Size"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_histogram</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font></font><code dir="auto">pyramiding = 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在脚本的声明语句中加入了允许它模拟同一方向的两个连续订单。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们想在“Buy1”之前退出“Buy2”。让我们看看，如果我们指示策略在执行两个订单时先关闭“Buy2”，然后再关闭“Buy1”，会发生什么情况：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Closing-a-market-position-2.tTsJ7OdZ_Z2rHJes.webp" alt="图像" width="1342" height="518" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="38e"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Exit&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">15</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.close</span><span class="mtk13">(</span><span class="mtk29">"Buy2"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"bracket"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Buy1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">profit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Position&nbsp;Size"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_histogram</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们在策略测试器的“交易列表”选项卡中看到的那样，它不是使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.close()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭“Buy2”头寸，而是先关闭“Buy1”的数量，即关闭订单数量的一半，然后关闭“Buy2”头寸的一半，因为经纪商模拟器默认遵循FIFO规则。用户可以通过</font></font><code dir="auto">close_entries_rule = "ANY"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数中指定来更改此行为。</font></font></p>
<h2 id="oca-groups" class="md-heading"><a href="#oca-groups"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OCA</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">团体</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一取消全 (OCA) 组允许策略在执行订单放置命令时完全或部分取消其他订单，包括
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，具体</font></font><code dir="auto">oca_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取决于</font></font><code dir="auto">oca_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户在函数调用中提供的。</font></font></p>
<h3 id="strategyocacancel" class="md-heading"><a href="#strategyocacancel"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.oca.取消`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy%7Bdot%7Doca%7Bdot%7Dcancel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategies.oca.cancel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OCA类型
</font></font><code dir="auto">oca_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在组中的订单填写或部分填写后</font><font style="vertical-align: inherit;">
取消所有相同的订单。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，以下策略在</font></font><code dir="auto">ma1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交叉
时执行订单</font></font><code dir="auto">ma2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。当
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dposition_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.position_size</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为0时，它会在</font><font style="vertical-align: inherit;">柱线的
</font></font><code dir="auto">high</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和上放置多头和空头止损订单。否则，它会调用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose_all"><font style="vertical-align: inherit;">strategy.close_all()</font></a><font style="vertical-align: inherit;">
以市价单关闭所有未平仓头寸。根据价格行为，策略可能会在发出平仓订单之前完成两个订单。此外，如果经纪商模拟器的intrabar假设支持它，则两个订单可能会在同一根柱线上完成。
在这种情况下， </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose_all"><font style="vertical-align: inherit;">strategy.close_all()</font></a><font style="vertical-align: inherit;">
命令不执行任何操作，因为脚本在执行完两个订单之前无法调用该操作：</font></font><code dir="auto">low</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose_all"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose_all"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-OCA-groups-Strategy-oca-cancel-1.B4pkrsRw_1KFx5x.webp" alt="图像" width="1816" height="550" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6eu"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"OCA&nbsp;Cancel&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.cross</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.close_all</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Fast&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Slow&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了消除策略在平仓订单之前执行多头和空头订单的情况，我们可以指示它在执行一个订单后取消另一个订单。在此示例中，我们将</font></font><code dir="auto">oca_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令的设置为“Entry”，并将其设置</font></font><code dir="auto">oca_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code dir="auto">strategy.oca.cancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-OCA-groups-Strategy-oca-cancel-2.Pw0HBDfm_ZLEEMG.webp" alt="图像" width="1816" height="550" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6et"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"OCA&nbsp;Cancel&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.cross</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_name</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Entry"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.oca.cancel</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_name</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Entry"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.oca.cancel</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.close_all</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Fast&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Slow&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="strategyocareduce" class="md-heading"><a href="#strategyocareduce"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.oca.reduce`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strategy.oca.reduce
 OCA 类型不会取消订单。相反，它</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy%7Bdot%7Doca%7Bdot%7Dreduce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每次新订单成交时按已平仓合约/股份/手数/单位数
减少订单规模</font></font><code dir="auto">oca_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这对于退出策略特别有用。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例演示了尝试只做多头的退出策略，该策略为每个新入场点生成止损订单和两个止盈订单。在两个移动平均线交叉时，它使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟一个“多头”入场订单，
其中a为6个单位，然后使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;">strategy.order()</font></a><font style="vertical-align: inherit;">分别
在</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">和和价格</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟6、3和3个单位的止损/限价订单
</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">stop</code><font style="vertical-align: inherit;"></font><code dir="auto">limit1</code><font style="vertical-align: inherit;"></font><code dir="auto">limit2</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将策略添加到图表后，我们发现它无法按预期工作。此脚本的问题是，
与</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;">strategy.exit()不同， </font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.order()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
默认情况下不属于OCA组
</font><font style="vertical-align: inherit;">。由于我们没有明确将订单分配给OCA组，因此该策略在填写订单时不会取消或减少订单，这意味着可以交易比未平仓头寸更多的数量并反转方向：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-OCA-groups-Strategy-oca-reduce-1.B8XPX6-M_ZmN4JH.webp" alt="图像" width="1818" height="830" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2zq"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Multiple&nbsp;TP&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.99</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.01</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.02</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Limit&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Limit&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Limit&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Limit&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使我们的策略按预期发挥作用，我们必须指示它减少其他止损/止盈订单的单位数量，以使它们不超过剩余未平仓头寸的规模。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的例子中，我们将</font></font><code dir="auto">oca_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出策略中每笔订单的设置为“Bracket”，并将设置</font></font><code dir="auto">oca_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy%7Bdot%7Doca%7Bdot%7Dreduce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.oca.reduce</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些设置告诉策略在执行其中一个订单时，</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将“Bracket”组中订单的价值减少</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已成交的订单，以防止交易过多的单位并导致逆转：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-OCA-groups-Strategy-oca-reduce-2.C2FZumhg_1kQ60w.webp" alt="图像" width="1818" height="664" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2zj"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Multiple&nbsp;TP&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.99</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.01</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.02</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_name</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bracket"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.oca.reduce</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Limit&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_name</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bracket"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.oca.reduce</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Limit&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_name</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bracket"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.oca.reduce</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Limit&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Limit&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“限价 2”订单的 改为 6，而不是 3，因为该策略在执行“限价 1”订单时会将其值降低 3。保留</font></font><code dir="auto">qty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 的值会导致其在执行第一个限价订单后降至 0 并且永远不会执行。</font></font></li>
</ul>
<h3 id="strategyocanone" class="md-heading"><a href="#strategyocanone"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.oca.none`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy%7Bdot%7Doca%7Bdot%7Dnone"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strategy.oca.none</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OCA类型
</font><font style="vertical-align: inherit;">
指定订单独立于任何 OCA 组执行。此值是</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;">Strategy.order()</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;">Strategy.entry()</font></a></font><code dir="auto">oca_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单下单命令的
默认值</font><font style="vertical-align: inherit;">
。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果两个订单放置命令具有相同</font></font><code dir="auto">oca_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但不同的
</font></font><code dir="auto">oca_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，则该策略将它们视为来自两个不同的组。即，OCA 组不能组合
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy%7Bdot%7Doca%7Bdot%7Dcancel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.oca.cancel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy%7Bdot%7Doca%7Bdot%7Dreduce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.oca.reduce</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy%7Bdot%7Doca%7Bdot%7Dnone"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.oca.none</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
OCA 类型。</font></font></p></div></aside>
<h2 id="currency" class="md-heading"><a href="#currency"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">货币</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 策略可以使用与其计算工具不同的基础货币。用户可以通过</font><font style="vertical-align: inherit;">在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">strategy()</font></a></font><code dir="auto">currency.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数中包含一个变量作为
参数来指定模拟账户的基础货币</font><font style="vertical-align: inherit;">
，这将改变脚本的
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Daccount_currency"><font style="vertical-align: inherit;">strategy.account_currency</font></a><font style="vertical-align: inherit;">
值。strategy的默认值为</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">这意味着脚本使用图表上工具的基础货币。</font></font><code dir="auto">currency</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Daccount_currency"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">currency</code><font style="vertical-align: inherit;"></font><code dir="auto">currency.NONE</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当策略脚本使用指定的基础货币时，它会将模拟利润乘以前一交易日的 FX_IDC 汇率。例如，以下策略在最后 500 个图表条上设置一个标准手（100,000 单位）的入场订单，并以 1 点作为盈利目标和止损，然后在单独的窗格中绘制净利润以及符号的倒置每日收盘价。我们已将基础货币设置为</font></font><code dir="auto">currency.EUR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。当我们将此脚本添加到 FX_IDC:EURUSD 时，两个图表对齐，确认该策略使用此符号的前一天汇率进行计算：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Currency-1.BIrX-27H_1pt4ls.webp" alt="图像" width="1820" height="718" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="83"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Currency&nbsp;Test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">currency</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">currency.EUR</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"LE"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">100000</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"LX"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"LE"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">profit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">math.abs</span><span class="mtk13">(</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk11">strategy.netprofit</span><span class="mtk13">))</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"1&nbsp;Point&nbsp;profit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">request.security</span><span class="mtk13">(</span><span class="mtk11">syminfo.tickerid</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">)[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Previous&nbsp;day's&nbsp;inverted&nbsp;price"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当交易时间范围高于每日时，该策略将使用收盘前一个交易日的收盘价来计算历史柱的交叉汇率。例如，在每周时间范围内，它将根据前一个星期四的收盘价计算交叉汇率，但该策略仍将使用实时柱的每日收盘价。</font></font></li>
</ul>
<h2 id="altering-calculation-behavior" class="md-heading"><a href="#altering-calculation-behavior"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变计算</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行为</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略将针对图表上的所有历史条形图执行，然后在有新数据可用时自动继续实时计算。默认情况下，策略脚本仅对每个已确认的条形图计算一次。我们可以通过更改strategy
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数的参数或单击脚本“属性”选项卡中“重新计算”部分的复选框来更改此行为。</font></font></p>
<h3 id="calc_on_every_tick" class="md-heading"><a href="#calc_on_every_tick"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`每次计时计算`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><code dir="auto">calc_on_every_tick</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是控制实时数据计算行为的可选设置。启用此参数后，脚本将在每个新的价格变动时重新计算其值。默认情况下，其值为 false，这意味着脚本仅在确认条形图后执行计算。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用此计算行为在前向测试时可能特别有用，因为它有助于实现精细的实时策略模拟。但是，需要注意的是，此行为会导致实时模拟和历史模拟之间的数据差异，因为历史条形图不包含报价信息。用户应谨慎使用此设置，因为数据差异可能会导致策略重新绘制其历史记录。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下脚本将在每次</font></font><code dir="auto">close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
达到</font><font style="vertical-align: inherit;">输入的</font></font><code dir="auto">highest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或值时模拟新订单</font><font style="vertical-align: inherit;">。由于
</font><font style="vertical-align: inherit;">在策略声明中启用了 ，因此脚本将在编译后在每个新的实时价格变动时模拟新订单：</font></font><code dir="auto">lowest</code><font style="vertical-align: inherit;"></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font><code dir="auto">calc_on_every_tick</code><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="qu"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Donchian&nbsp;Channel&nbsp;Break"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">calc_on_every_tick</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">15</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.lowest</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowest</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Sell"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;starting&nbsp;time&nbsp;for&nbsp;real-time&nbsp;bars.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">realTimeStart</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">timenow</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;the&nbsp;background&nbsp;of&nbsp;real-time&nbsp;bars.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">time_close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">realTimeStart</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">highest</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Highest"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">lowest</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lowest"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本</font></font><code dir="auto">pyramiding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在声明中使用了值 20，这允许该策略最多模拟同一方向的 20 笔交易。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了直观地区分哪些条形图被策略处理为实时条形图，脚本会为自上次编译以来的所有条形图的背景添加
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将脚本应用到图表并让其根据一些实时条形图进行计算后，我们可能会看到如下输出：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Altering-calculation-behavior-Calc-on-every-tick-1.BX0Fex4v_2vXWeQ.webp" alt="图像" width="1820" height="842" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本在条件有效的每个新的实时报价上下达“买入”订单，导致每条柱状图有多个订单。但是，不熟悉此行为的用户可能会惊讶地发现，在重新编译脚本后，策略的输出发生了变化，因为之前执行实时计算的柱状图现在是历史柱状图，不包含报价信息：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Altering-calculation-behavior-Calc-on-every-tick-2.CEEZdx06_1CeGHx.webp" alt="图像" width="1820" height="842" loading="lazy" decoding="async"></p>
<h3 id="calc_on_order_fills" class="md-heading"><a href="#calc_on_order_fills"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`calc_on_order_fills`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可选</font></font><code dir="auto">calc_on_order_fills</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置在模拟订单填写后立即重新计算策略，这允许脚本使用更精细的价格并下达额外订单，而无需等待确认条形图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用此设置可以为脚本提供额外的数据，否则这些数据直到条形图关闭后才可用，例如未确认条形图上模拟位置的当前平均价格。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例显示了一个启用了的简单策略，
</font></font><code dir="auto">calc_on_order_fills</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dposition_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.position_size</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为0时，该策略模拟“买入”订单。脚本使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dposition_avg_price"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.position_avg_price</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来计算</font></font><code dir="auto">stopLoss</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和，</font></font><code dir="auto">takeProfit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在价格与它们交叉时模拟“退出”订单，无论条形图是否得到确认。因此，一旦触发退出，策略就会重新计算并下达新的入场订单，因为strategy.position_size
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dposition_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
等于0。策略在退出发生后下达订单，并在退出后的下一个报价时执行订单，这将是条形图的OHLC值之一，取决于模拟的条形图内运动：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Altering-calculation-behavior-Calc-on-order-fills-1.TfUCX8p2_7gwAM.webp" alt="图像" width="1820" height="842" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1aj"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Intrabar&nbsp;exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">calc_on_order_fills</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopSize</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">5.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SL&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100.0</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">profitSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">5.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100.0</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopSize</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">profitSize</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"Exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭后</font></font><code dir="auto">calc_on_order_fills</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，相同的策略在触发退出订单后只会进入一个条形图。首先，中间条形图退出，但没有进入订单。然后，策略将在条形图关闭后模拟进入订单，并在下一个价格变动（即下一个条形图开盘时）执行。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要注意的是，启用该选项</font></font><code dir="auto">calc_on_order_fills</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会产生不切实际的策略结果，因为经纪商模拟器可能会假设在实时交易时不可能的订单价格。用户必须谨慎使用此设置，并仔细考虑其脚本中的逻辑。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例模拟了脚本加载到图表上时，在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">last_bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的 25 条柱状窗口内，每次新订单填写和柱状图确认后的“买入”订单
。启用此设置后，策略会模拟每条柱状图四次入场，因为模拟器认为每条柱状图有四个刻度（开盘价、最高价、最低价、收盘价），这是不切实际的行为，因为订单通常不可能在柱状图的确切最高价或最低价填写：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Altering-calculation-behavior-Calc-on-order-fills-2.vGEDeBsL_1sBc2Q.webp" alt="图像" width="1818" height="506" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5dk"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"buy&nbsp;on&nbsp;every&nbsp;fill"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">calc_on_order_fills</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="process_orders_on_close" class="md-heading"><a href="#process_orders_on_close"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`关闭时处理订单`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认策略行为在每根柱线收盘时模拟订单，这意味着最早执行订单并执行策略计算和警报的机会是在下一根柱线开盘时。交易者可以通过启用设置来更改此行为，以使用每根柱线的收盘价来处理策略</font></font><code dir="auto">process_orders_on_close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种行为在回测手动策略时最为有用，在这种策略中，交易者在收盘前退出头寸，或者在非 24x7 市场中的算法交易者设置盘后交易能力的情况下，收盘后发出的警报仍然有希望在第二天之前完成。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至关重要的是要意识到，
</font></font><code dir="auto">process_orders_on_close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实时交易环境中使用策略可能会导致重新绘制策略，因为当市场收盘时仍然会发出收盘警报，并且订单可能要到下一个市场开盘才能完成。</font></font></li>
</ul>
<h2 id="simulating-trading-costs" class="md-heading"><a href="#simulating-trading-costs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟交易</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成本</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使策略绩效报告包含相关且有意义的数据，交易者应努力在策略结果中考虑潜在的实际成本。忽略这一点可能会让交易者对策略绩效产生不切实际的看法，并破坏测试结果的可信度。如果不对与交易相关的潜在成本进行建模，交易者可能会高估策略的历史盈利能力，从而可能导致实时交易中做出次优决策。Pine Script™ 策略包括用于在绩效结果中模拟交易成本的输入和参数。</font></font></p>
<h3 id="commission" class="md-heading"><a href="#commission"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委员会</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">佣金是指经纪商/交易所在执行交易时收取的费用。根据经纪商/交易所的不同，有些经纪商/交易所可能按每笔交易或合约/股票/手/单位收取固定费用，而有些经纪商/交易所可能按交易总额的一定百分比收取费用。用户可以通过在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">strategy()</font></a><font style="vertical-align: inherit;">函数
中
包含</font></font><code dir="auto">commission_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和参数</font><font style="vertical-align: inherit;">
或在策略设置的“属性”选项卡中设置“佣金”输入来设置其策略的佣金属性。</font></font><code dir="auto">commission_value</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"></font><code dir="auto">close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下脚本是一个简单的策略，当等于该</font></font><code dir="auto">highest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值除以该值时</font><font style="vertical-align: inherit;">，模拟 2% 股权的“多头”仓位</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并在等于该值时关闭交易</font></font><code dir="auto">lowest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Simulating-trading-costs-Commission-1.XUDZaoNR_2iKnnJ.webp" alt="图像" width="1342" height="726" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3df"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Commission&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.percent_of_equity</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.lowest</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">switch</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.close</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">highest</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">lowest</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查策略测试器中的结果后，我们发现该策略在测试范围内实现了 17.61% 的正资产增长率。但是，回测结果并未考虑经纪商/交易所可能收取的费用。让我们看看当我们在策略模拟中对每笔交易都收取少量佣金时，这些结果会发生什么变化。在此示例中，我们
在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">strategy()</font></a><font style="vertical-align: inherit;">声明中
包含了</font></font><code dir="auto">commission_type = strategy.commission.percent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font><font style="vertical-align: inherit;">
，这意味着它将模拟对所有已执行订单收取 1% 的佣金：</font></font><code dir="auto">commission_value = 1</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Simulating-trading-costs-Commission-2.DAdgHUnC_4hzO7.webp" alt="图像" width="1342" height="726" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1eu"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Commission&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.percent_of_equity</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">commission_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.commission.percent</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">commission_value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.lowest</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">switch</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.close</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">highest</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">lowest</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从上面的例子中我们可以看出，在回测中应用 1% 的佣金后，该策略模拟的净利润显著减少（仅为 1.42%），且权益曲线波动性更大，最大回撤也更大，突显了佣金模拟对策略测试结果的影响。</font></font></p>
<h3 id="slippage-and-unfilled-limits" class="md-heading"><a href="#slippage-and-unfilled-limits"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">滑点和未完成</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限额</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实际交易中，由于波动性、流动性、订单规模和其他市场因素，经纪商/交易所执行订单的价格可能与交易者预期的价格略有不同，这会对策略的表现产生重大影响。经纪商/交易所执行交易的预期价格与实际价格之间的差异就是我们所说的滑点。滑点是动态的、不可预测的，因此无法精确模拟。但是，在回测或正向测试期间将少量滑点计入每笔交易中可能有助于使结果更符合实际情况。用户可以在策略结果中对滑点进行建模，大小为固定的刻度数，方法是
</font></font><code dir="auto">slippage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
声明中包含一个参数，或在策略设置的“属性”选项卡中设置“滑点”输入。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例演示了滑点模拟如何影响策略测试中市价单的成交价格。以下脚本在市场价格高于 EMA（EMA 上涨时）时下达 2% 权益的“买入”市价单，并在价格跌破 EMA（EMA 下跌时）时平仓。我们已将</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">策略 ()</font></a></font><code dir="auto">slippage = 20</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数包含在内
</font><font style="vertical-align: inherit;">
，该函数声明每个模拟订单的价格将按交易方向滑落 20 个刻度。该脚本使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dopentrades%7Bdot%7Dentry_bar_index"><font style="vertical-align: inherit;">策略 (strategy.opentrades.entry_bar_index()</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dexit_bar_index"><font style="vertical-align: inherit;">策略 (strategy.closedtrades.exit_bar_index())</font></a><font style="vertical-align: inherit;">
来获取</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">，并利用它们来获取
</font><font style="vertical-align: inherit;">订单的。当条形索引位于时</font><font style="vertical-align: inherit;">，
</font><font style="vertical-align: inherit;">是
</font><font style="vertical-align: inherit;">第一个
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dopentrades%7Bdot%7Dentry_price"><font style="vertical-align: inherit;">策略 (strategy.opentrades.entry_price())</font></a><font style="vertical-align: inherit;">
值。在是</font><font style="vertical-align: inherit;">来自上次平仓交易的</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dexit_price"><font style="vertical-align: inherit;">策略 (strategy.closedtrades.exit_price())</font></a><font style="vertical-align: inherit;">
值。该脚本绘制了预期成交价格以及滑点后的模拟成交价格，以直观地比较差异：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dopentrades%7Bdot%7Dentry_bar_index"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dexit_bar_index"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">entryIndex</code><font style="vertical-align: inherit;"></font><code dir="auto">exitIndex</code><font style="vertical-align: inherit;"></font><code dir="auto">fillPrice</code><font style="vertical-align: inherit;"></font><code dir="auto">entryIndex</code><font style="vertical-align: inherit;"></font><code dir="auto">fillPrice</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dopentrades%7Bdot%7Dentry_price"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">exitIndex</code><font style="vertical-align: inherit;"></font><code dir="auto">fillPrice</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dexit_price"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Simulating-trading-costs-Slippage-and-unfilled-limits-1.viLUaTPh_Z17uYCF.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="ie"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Slippage&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">slippage</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">default_qty_value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.percent_of_equity</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Exponential&nbsp;moving&nbsp;average&nbsp;with&nbsp;an&nbsp;input&nbsp;`length`</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`true`&nbsp;when&nbsp;`ma`&nbsp;has&nbsp;increased&nbsp;and&nbsp;`close</span><span class="mtk9">`&nbsp;is&nbsp;greater&nbsp;than&nbsp;it,&nbsp;`false`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`true`&nbsp;when&nbsp;`ma`&nbsp;has&nbsp;decreased&nbsp;and&nbsp;`close</span><span class="mtk9">`&nbsp;is&nbsp;less&nbsp;than&nbsp;it,&nbsp;`false`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Enter&nbsp;a&nbsp;long&nbsp;market&nbsp;position&nbsp;on&nbsp;`longCondition`</span><span class="mtk9">,&nbsp;close&nbsp;the&nbsp;position&nbsp;on&nbsp;`shortCondition`.&nbsp;</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.close</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`bar_index`&nbsp;of&nbsp;the&nbsp;position's&nbsp;entry&nbsp;order&nbsp;fil</span><span class="mtk9">l.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.opentrades.entry_bar_index</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`bar_index`&nbsp;of&nbsp;the&nbsp;position's&nbsp;close&nbsp;order&nbsp;fil</span><span class="mtk9">l.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitIndex</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.closedtrades.exit_bar_index</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;fill&nbsp;price&nbsp;simulated&nbsp;by&nbsp;the&nbsp;strategy.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">fillPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">entryIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.opentrades.entry_price</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">exitIndex</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.closedtrades.exit_price</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;expected&nbsp;fill&nbsp;price&nbsp;of&nbsp;the&nbsp;open&nbsp;market&nbsp;positi</span><span class="mtk9">on.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">expectedPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">fillPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">expectedColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">filledColor</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryIndex</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">expectedColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">filledColor</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitIndex</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">expectedColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">filledColor</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">fillPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Expected&nbsp;fill&nbsp;price"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"—"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.absolute</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">expectedColor</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">fillPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Fill&nbsp;price&nbsp;after&nbsp;slippage"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"—"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.absolute</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">filledColor</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于该策略对所有订单执行应用恒定滑点，因此有些订单可能会在模拟中超出蜡烛范围执行。因此用户应谨慎使用此设置，因为过多的模拟滑点可能会产生不切实际的更差测试结果。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些交易者可能认为，他们可以通过使用限价单来避免滑点的不利影响，因为与市价单不同，限价单不能以低于指定值的价格执行。然而，根据现实市场的情况，即使市场价格达到订单价格，限价单也可能无法成交，因为只有当证券具有足够的流动性和围绕该值的价格行为时，限价单才能成交。为了在回测中考虑未成交订单的可能性，用户可以
</font></font><code dir="auto">backtest_fill_limits_assumption</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在声明语句中指定值，或使用“属性”选项卡中的“验证限价单价格”输入来指示策略仅在价格超过订单价格一定数量的刻度后才成交限价单。</font></font></p>
<p><font style="vertical-align: inherit;"></font><code dir="auto">hlcc4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例在</font><font style="vertical-align: inherit;">为过去柱线的值</font></font><code dir="auto">high</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">且</font><font style="vertical-align: inherit;">
没有待处理条目时</font><font style="vertical-align: inherit;">，在柱线 下达 2% 权益的限价订单
。当</font><font style="vertical-align: inherit;">为值时，该策略将平仓并取消所有订单</font><font style="vertical-align: inherit;">。每次触发订单时，策略都会在 处绘制一条水平线，并</font><font style="vertical-align: inherit;">在每个柱线上更新该水平线，直到平仓或取消订单：</font></font><code dir="auto">highest</code><font style="vertical-align: inherit;"></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font><code dir="auto">low</code><font style="vertical-align: inherit;"></font><code dir="auto">lowest</code><font style="vertical-align: inherit;"></font><code dir="auto">limitPrice</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Simulating-trading-costs-Slippage-and-unfilled-limits-2.izbF-BkC_2p4GEQ.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2i"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Verify&nbsp;price&nbsp;for&nbsp;limits&nbsp;example"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">default_qty_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.percent_of_equity</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">25</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Draws&nbsp;a&nbsp;line&nbsp;at&nbsp;the&nbsp;limit&nbsp;price&nbsp;of&nbsp;the&nbsp;most&nbsp;recen</span><span class="mtk9">t&nbsp;entry&nbsp;order.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highest&nbsp;high&nbsp;and&nbsp;lowest&nbsp;low</span></span><br><span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk33">lowest</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.lowest</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;an&nbsp;entry&nbsp;order&nbsp;and&nbsp;draw&nbsp;a&nbsp;new&nbsp;line&nbsp;when&nbsp;t</span><span class="mtk9">he&nbsp;the&nbsp;`high`&nbsp;equals&nbsp;the&nbsp;`highest`&nbsp;value&nbsp;and&nbsp;`limi</span><span class="mtk9">tLine`&nbsp;is&nbsp;`na`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">limitLine</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">hlcc4</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limitLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitPrice</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Close&nbsp;the&nbsp;open&nbsp;market&nbsp;position,&nbsp;cancel&nbsp;orders,&nbsp;</span><span class="mtk9">and&nbsp;set&nbsp;`limitLine`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;the&nbsp;`low`&nbsp;equals&nbsp;</span><span class="mtk9">the&nbsp;`lowest`&nbsp;value.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowest</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.cancel_all</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limitLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.close_all</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;`x2`&nbsp;value&nbsp;of&nbsp;`limitLine`&nbsp;if&nbsp;it&nbsp;isn'</span><span class="mtk9">t&nbsp;`na`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">limitLine</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limitLine</span><span class="mtk1">.</span><span class="mtk15">set_x2</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">highest</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Highest&nbsp;High"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">lowest</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lowest&nbsp;Low"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，脚本假定所有限价订单都保证成交。然而，在实际交易中情况往往并非如此。让我们在限价订单中添加价格验证，以解决可能未成交的订单。在此示例中，我们已将其包含
</font></font><code dir="auto">backtest_fill_limits_assumption = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy（）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数调用中。我们可以看到，使用限价验证会省略一些模拟订单成交并更改其他订单的时间，因为现在只有在价格突破限价三个刻度后，入场订单才能成交：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Simulating-trading-costs-Slippage-and-unfilled-limits-3.DDaLk5Eu_fLnmo.webp" alt="图像" width="1342" height="680" loading="lazy" decoding="async"></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值得注意的是，尽管限价验证改变了某些订单执行的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但策略会以相同的
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价格</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟这些订单。这种“时间扭曲”效果是一种折衷，可以保留已验证限价订单的价格，但它可能会导致策略在现实世界中不可能实现的时间模拟它们的执行。用户在分析策略结果时应谨慎使用此设置并了解其局限性。</font></font></p></div></aside>
<h2 id="risk-management" class="md-heading"><a href="#risk-management"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风险</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设计一个表现良好的策略是一项艰巨的任务，更不用说一个在广泛的市场中表现良好的策略了。大多数策略都是针对特定的市场模式/条件而设计的，当应用于其他数据时可能会产生无法控制的损失。因此，策略的风险管理质量对其表现至关重要。用户可以使用带有前缀的特殊命令在其策略脚本中设置风险管理标准</font></font><code dir="auto">strategy.risk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略可以以任意组合的方式纳入任意数量的风险管理标准。所有风险管理命令都会在每个报价和订单执行事件中执行，无论策略的计算行为如何变化。在脚本运行时无法禁用任何这些命令。无论风险规则位于何处，它都会始终适用于策略，除非用户从代码中删除调用。</font></font></p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dallow_entry_in"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略.风险.允许进入()</font></font></a></p>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令覆盖了strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令允许的市场方向
</font><font style="vertical-align: inherit;">
。当用户使用此函数指定交易方向（例如
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy%7Bdot%7Ddirection%7Bdot%7Dlong"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy.direction.long</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）时，策略将仅按该方向进行交易。但是，需要注意的是，如果脚本在有未平仓市场仓位的情况下调用相反方向的进入命令，则策略将模拟市场订单以退出该仓位。</font></font></p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_cons_loss_days"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略.风险.最大亏损天数()</font></font></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该命令会在策略模拟了规定数量的连续亏损的交易日后，取消所有挂单、平仓并停止所有额外的交易行为。</font></font></p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_drawdown"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略.风险.最大回撤()</font></font></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当策略的亏损达到函数调用中指定的金额后，此命令将取消所有挂单、平仓市场仓位并停止所有其他交易行为。</font></font></p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_intraday_filled_orders"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略.风险.最大日内成交订单（）</font></font></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令指定每个交易日（或如果时间范围高于每日，则每个图表条）的最大成交订单数。一旦策略执行了当天的最大订单数，它将取消所有待处理订单，关闭未平仓头寸，并暂停交易活动，直到当前交易时段结束。</font></font></p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_intraday_loss"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略.风险.最大日内损失()</font></font></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令控制策略每个交易日（或如果时间范围高于每日，则每个图表条）可承受的最大损失。当策略的损失达到此阈值时，它将取消所有挂单，关闭未平仓头寸，并停止所有交易活动，直到当前交易时段结束。</font></font></p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_position_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略.风险.最大仓位规模()</font></font></a></p>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令指定使用strategy.entry()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令时可能的最大持仓规模
</font><font style="vertical-align: inherit;">
。如果进入命令的数量导致市场持仓超过此阈值，则策略将减少订单数量，以使最终持仓不超过限制。</font></font></p>
<h2 id="margin" class="md-heading"><a href="#margin"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利润</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保证金是交易者必须在其账户中持有的市场头寸的最低百分比，作为从经纪商处获得和维持贷款的抵押品，以实现其所需的杠杆。strategy </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">()</font></a></font><code dir="auto">margin_long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明的和
</font></font><code dir="auto">margin_short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数
</font><font style="vertical-align: inherit;">
以及脚本设置“属性”选项卡中的“多头/空头头寸保证金”输入允许策略指定多头和空头头寸的保证金百分比。例如，如果交易者将多头头寸的保证金设置为 25%，则他们必须有足够的资金来支付 25% 的未平多头头寸。这个保证金百分比还意味着交易者可能会在交易中花费高达 400% 的股本。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果策略模拟的资金无法弥补保证金交易的损失，经纪商模拟器就会触发追加保证金通知，强制清算全部或部分头寸。模拟器清算的合约/股票/手数/单位的确切数量是弥补损失所需的四倍，以防止在后续交易中不断追加保证金。模拟器使用以下算法计算金额：</font></font></p>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算该仓位花费的资本金额：
</font></font><code dir="auto">Money Spent = Quantity * Entry Price</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算证券市场价值 (MVS)：
</font></font><code dir="auto">MVS = Position Size * Current Price</code></li>
<li><font style="vertical-align: inherit;"></font><code dir="auto">MVS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算开仓利润为和
</font><font style="vertical-align: inherit;">之间的差值</font></font><code dir="auto">Money Spent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果仓位为空头，我们将其乘以 -1。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算该策略的权益价值：
</font></font><code dir="auto">Equity = Initial Capital + Net Profit + Open Profit</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算保证金比率：</font></font><code dir="auto">Margin Ratio = Margin Percent / 100</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算保证金价值，即支付交易者部分头寸所需的现金：</font></font><code dir="auto">Margin = MVS * Margin Ratio</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算可用资金：</font></font><code dir="auto">Available Funds = Equity - Margin</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算交易者损失的总金额：
</font></font><code dir="auto">Loss = Available Funds / Margin Ratio</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算交易者需要清算多少合约/股票/手数/单位才能弥补损失。我们将此值截断为与当前符号的最小头寸大小相同的小数精度：</font></font><code dir="auto">Cover Amount = TRUNCATE(Loss / Current Price).</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算经纪商将清算多少单位来弥补损失：</font></font><code dir="auto">Margin Call = Cover Amount * 4</code></li>
</ol>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了详细检查此计算，让我们将内置的超级趋势策略添加到 1D 时间范围内的 NASDAQ：TSLA 图表中，并在策略设置的“属性”选项卡中将“订单规模”设置为股权的 300％，将“多头仓位保证金”设置为 25％：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Margin-1.D7HQz6iZ_Z2vIF4D.webp" alt="图像" width="2356" height="1200" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一次入场发生在 2010 年 9 月 16 日，当时股价为开盘价。该策略以 4.43 美元（入场价）买入 682,438 股（仓位规模）。然后，在 2010 年 9 月 23 日，当价格跌至 3.9（当前价格）时，模拟器通过追加保证金强制清算了 111,052 股。</font></font></p>
<div class="expressive-code not-content"><link rel="stylesheet" href="/pine-script-docs/_astro/ec.dtidy.css"><script type="module" src="/pine-script-docs/_astro/ec.8gcug.js" data-astro-exec=""></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text" tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Money spent: 682438 * 4.43 = 3023200.34</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">MVS: 682438 * 3.9 = 2661508.2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Open Profit: −361692.14</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Equity: 1000000 + 0 − 361692.14 = 638307.86</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Margin Ratio: 25 / 100 = 0.25</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Margin: 2661508.2 * 0.25 = 665377.05</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Available Funds: 638307.86 - 665377.05 = -27069.19</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Money Lost: -27069.19 / 0.25 = -108276.76</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Cover Amount: TRUNCATE(-108276.76 / 3.9) = TRUNCATE(-27763.27) = -27763</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Margin Call Size: -27763 * 4 = - 111052</span></div></div></code></pre></figure></div>
<h2 id="strategy-alerts" class="md-heading"><a href="#strategy-alerts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常规 Pine Script™ 指标有两种不同的机制来设置自定义警报条件：
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alertcondition()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数，它每个函数调用跟踪一个特定条件；
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alert()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数，它同时跟踪所有调用，但在调用次数、警报消息等方面提供了更大的灵活性。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 策略不适用于
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alertcondition()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用，但它们支持通过
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alert()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数生成自定义警报。除此之外，每个创建订单的函数还带有自己的内置警报功能，无需任何额外的代码即可实现。因此，任何使用订单下单命令的策略都可以在订单执行时发出警报。此类内置策略警报的精确机制在
</font><font style="vertical-align: inherit;">我们的用户手册中的</font><a href="/pine-script-docs/concepts/alerts"><font style="vertical-align: inherit;">警报页面的</font></a></font><a href="/pine-script-docs/concepts/alerts#order-fill-events"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单执行事件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分中进行了描述。</font></font><a href="/pine-script-docs/concepts/alerts"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当策略使用创建订单的功能和该</font></font><code dir="auto">alert()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
功能时，警报创建对话框会提供触发条件的选择：它可以在</font></font><code dir="auto">alert()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事件、订单填写事件或两者上触发。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于许多交易策略而言，触发条件与实时交易之间的延迟可能是一个关键的性能因素。默认情况下，策略脚本只能
</font><font style="vertical-align: inherit;">
在实时条形图收盘时
执行</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alert()函数调用，考虑使用</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_alert%7Bdot%7Dfreq_once_per_bar_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alert.freq_once_per_bar_close</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不管</font></font><code dir="auto">freq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中的参数是什么。用户还可以通过</font></font><code dir="auto">calc_on_every_tick = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategies()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用中包含或在创建警报之前在策略设置的“属性”选项卡中选择“每次报价时重新计算”选项来更改警报频率。但是，根据脚本的不同，这也可能对策略的行为产生不利影响，因此使用此方法时请谨慎并注意限制。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当向第三方发送警报以实现策略自动化时，我们建议使用订单执行警报而不是 alert
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数，因为它们不受相同限制；订单执行事件发出的警报会立即执行，不受脚本
</font></font><code dir="auto">calc_on_every_tick</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置的影响。用户可以通过编译器注释设置订单执行警报的默认消息</font></font><code dir="auto">@strategy_alert_message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此注释提供的文本将填充警报创建对话框中订单执行的“消息”字段。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下脚本显示了默认订单填充警报消息的简单示例。在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategy（）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
声明语句上方，它使用</font></font><code dir="auto">@strategy_alert_message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">占位
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来表示消息文本中的交易操作、头寸规模、股票代码和填充价格值：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="58b"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@strategy</span><span class="mtk9">_alert_message&nbsp;{{strategy.order.action}}&nbsp;{{strateg</span><span class="mtk9">y.position_size}}&nbsp;{{ticker}}&nbsp;@&nbsp;{{strategy.order.pr</span><span class="mtk9">ice}}</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Alert&nbsp;Message&nbsp;Demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">fastMa</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">slowMa</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">fastMa</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">slowMa</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">fastMa</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">slowMa</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"sell"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">fastMa</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Fast&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">slowMa</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Slow&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当用户从“条件”下拉选项卡中选择其名称时，此脚本将使用其默认消息填充警报创建对话框：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Strategy-alerts-1.BxOEoyCe_ZM3QoM.webp" alt="图像" width="902" height="578" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发警报后，策略将使用相应的值填充警报消息中的占位符。例如：</font></font></p>
<p><img src="/pine-script-docs/_astro/Strategies-Strategy-alerts-2.RsPPvOvM_1vSwtv.webp" alt="图像" width="634" height="360" loading="lazy" decoding="async"></p>
<h2 id="notes-on-testing-strategies" class="md-heading"><a href="#notes-on-testing-strategies"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">测试策略</font></span><font style="vertical-align: inherit;">说明</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易者通常会根据历史和实时市场情况测试和调整其策略，因为许多人认为分析结果可能会提供有价值的见解，了解策略的特征、潜在弱点以及未来的潜力。但是，交易者应始终注意模拟策略结果的偏差和局限性，尤其是在使用结果支持实时交易决策时。本节概述了与策略验证和调整相关的一些注意事项以及减轻其影响的可能解决方案。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然根据现有数据测试策略可能会为交易者提供有关策略质量的有用信息，但必须注意的是，过去和现在都不能保证未来。金融市场可能会迅速且不可预测地发生变化，这可能会导致策略遭受无法控制的损失。此外，模拟结果可能无法完全解释可能影响交易表现的其他现实因素。因此，我们建议交易者在评估回测和前向测试时彻底了解局限性和风险，并在验证过程中将它们视为“整体的一部分”，而不是仅仅基于结果做出决策。</font></font></p></div></aside>
<h3 id="backtesting-and-forward-testing" class="md-heading"><a href="#backtesting-and-forward-testing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回溯测试和前向</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回测是交易者用来评估交易策略或模型历史表现的一种技术，通过模拟和分析历史市场数据上交易策略或模型的过去结果；该技术假设，分析策略过去数据的结果可以洞悉其优势和劣势。在回测时，许多交易者会调整策略的参数，以期优化其结果。分析和优化历史结果可能有助于交易者更深入地了解策略。然而，交易者在根据优化的回测结果做出决策时，应始终了解风险和局限性。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了回溯测试之外，审慎的交易系统开发通常还涉及将实时分析作为前瞻性评估交易系统的工具。前瞻性测试旨在衡量策略在实时、真实市场条件下的表现，其中交易成本、滑点和流动性等因素会对其表现产生重大影响。前瞻性测试的明显优势在于不受某些类型偏差（例如前瞻偏差或“未来数据泄露”）的影响，但缺点是测试数据量有限。因此，它通常不是用于策略验证的独立解决方案，但它可以提供对策略在当前市场条件下表现的有用见解。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回溯测试和前向测试是同一枚硬币的两面，因为这两种方法都旨在验证策略的有效性并确定其优缺点。通过结合回溯测试和前向测试，交易者可能能够弥补一些限制，并更清楚地了解其策略的表现。然而，交易者需要净化他们的策略和评估过程，以确保洞察尽可能与现实相符。</font></font></p>
<h3 id="lookahead-bias" class="md-heading"><a href="#lookahead-bias"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前瞻性</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏见</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在回测某些策略时，一个典型的问题是，在评估过程中未来数据会泄漏到过去，即那些请求替代时间范围数据、使用重绘变量（例如
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timenow ）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或改变条形内订单填充计算行为的策略。这被称为前瞻偏差。由于未来实际上永远无法预先知道，这种偏差不仅是导致策略结果不切实际的常见原因，而且也是策略重绘的典型原因之一。交易者通常可以通过前向测试他们的系统来确认这种偏差，因为前瞻偏差不适用于当前条形图之外没有已知数据的实时数据。用户可以通过确保不使用将未来泄漏到过去的重绘变量、</font></font><code dir="auto">request.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数不包含
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge%7Bdot%7Dlookahead_on"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barmerge.lookahead_on</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而不偏移数据系列（如
我们关于</font><a href="/pine-script-docs/concepts/repainting"><font style="vertical-align: inherit;">重绘的</font></a><font style="vertical-align: inherit;">
页面的</font></font><a href="/pine-script-docs/concepts/repainting#future-leak-with-requestsecurity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分所述）以及它们使用现实的计算行为来消除策略中的这种偏差。</font></font><a href="/pine-script-docs/concepts/repainting"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<h3 id="selection-bias" class="md-heading"><a href="#selection-bias"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏差</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择偏差是许多交易者在测试其策略时遇到的一个常见问题。当交易者仅分析特定工具或时间范围的结果而忽略其他工具或时间范围的结果时，就会发生这种情况。这种偏差可能导致对策略稳健性的扭曲看法，从而影响交易决策和绩效优化。交易者可以通过在多个（最好是多样化的）符号和时间范围内评估其策略来减少选择偏差的影响，务必不要忽略其分析中的不良绩效结果或挑选测试范围。</font></font></p>
<h3 id="overfitting" class="md-heading"><a href="#overfitting"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过度拟合</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化回测时的一个常见陷阱是过度拟合（“曲线拟合”）的可能性，这种情况发生在策略针对特定数据量身定制但无法很好地推广到新的、未见过的数据时。一种广泛使用的有助于降低过度拟合可能性并促进更好推广的方法是将工具的数据分成两个或多个部分，以在用于优化的样本之外测试策略，也称为“样本内”（IS）和“样本外”（OOS）回测。在这种方法中，交易者使用 IS 数据进行策略优化，而 OOS 部分用于测试和评估 IS 优化后在新数据上的表现，而无需进一步优化。虽然这种方法和其他更强大的方法可以让人们一窥策略在优化后的表现，但交易者应该谨慎行事，因为未来本质上是不可知的。无论用于测试和优化的数据如何，任何交易策略都无法保证未来的表现。</font></font></p>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a href="/pine-script-docs/concepts/sessions" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前的</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow-back">  <use xlink:href="#ai:local:theme/arrow-back"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议  </font></font></h4> </a>  <a href="/pine-script-docs/concepts/tables" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  表格</font></font><svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本页</font></font></h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#strategies" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></li></a><a href="#introduction" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></li></a><a href="#a-simple-strategy-example" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个简单的策略示例</font></font></li></a><a href="#applying-a-strategy-to-a-chart" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将策略应用于图表</font></font></li></a><a href="#strategy-tester" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略测试员</font></font></li></a><a href="#overview" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概述</font></font></li></a><a href="#performance-summary" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绩效摘要</font></font></li></a><a href="#list-of-trades" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易清单</font></font></li></a><a href="#properties" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特性</font></font></li></a><a href="#broker-emulator" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经纪商模拟器</font></font></li></a><a href="#bar-magnifier" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形放大镜</font></font></li></a><a href="#orders-and-entries" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单和条目</font></font></li></a><a href="#order-types" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单类型</font></font></li></a><a href="#market-orders" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">市价订单</font></font></li></a><a href="#limit-orders" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限价订单</font></font></li></a><a href="#stop-and-stop-limit-orders" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">止损和止损限价订单</font></font></li></a><a href="#order-placement-commands" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下单指令</font></font></li></a><a href="#strategyentry" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.entry()`</font></font></li></a><a href="#strategyorder" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.order()`</font></font></li></a><a href="#strategyexit" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.exit()`</font></font></li></a><a href="#strategyclose-and-strategyclose_all" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`strategy.close()` 和 `strategy.close_all()`</font></font></li></a><a href="#strategycancel-and-strategycancel_all" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`strategy.cancel()` 和 `strategy.cancel_all()`</font></font></li></a><a href="#position-sizing" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">头寸规模</font></font></li></a><a href="#closing-a-market-position" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平仓</font></font></li></a><a href="#oca-groups" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OCA团体</font></font></li></a><a href="#strategyocacancel" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.oca.取消`</font></font></li></a><a href="#strategyocareduce" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.oca.reduce`</font></font></li></a><a href="#strategyocanone" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`策略.oca.none`</font></font></li></a><a href="#currency" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">货币</font></font></li></a><a href="#altering-calculation-behavior" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变计算行为</font></font></li></a><a href="#calc_on_every_tick" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`每次计时计算`</font></font></li></a><a href="#calc_on_order_fills" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`calc_on_order_fills`</font></font></li></a><a href="#process_orders_on_close" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`关闭时处理订单`</font></font></li></a><a href="#simulating-trading-costs" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟交易成本</font></font></li></a><a href="#commission" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委员会</font></font></li></a><a href="#slippage-and-unfilled-limits" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">滑点和未完成限额</font></font></li></a><a href="#risk-management" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风险管理</font></font></li></a><a href="#margin" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利润</font></font></li></a><a href="#strategy-alerts" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略警报</font></font></li></a><a href="#notes-on-testing-strategies" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试策略说明</font></font></li></a><a href="#backtesting-and-forward-testing" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回溯测试和前向测试</font></font></li></a><a href="#lookahead-bias" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前瞻性偏见</font></font></li></a><a href="#selection-bias" class="document-toc-link" data-astro-cid-oor6cujd="" aria-current="true"><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择偏差</font></font></li></a><a href="#overfitting" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过度拟合</font></font></li></a></ul><a class="back-top" href="#top" data-astro-cid-oor6cujd=""><svg width="16" height="16" viewBox="0 0 16 16" data-astro-cid-oor6cujd="" data-icon="theme/back-top">  <symbol id="ai:local:theme/back-top"><path fill="currentColor" fill-rule="evenodd" d="M6.25 12.5A2.75 2.75 0 0 0 9 9.75V4.56L6.78 6.78a.75.75 0 0 1-1.06-1.06l3.5-3.5a.75.75 0 0 1 1.06 0l3.5 3.5a.75.75 0 0 1-1.06 1.06L10.5 4.56v5.19a4.25 4.25 0 0 1-8.5 0v-1a.75.75 0 0 1 1.5 0v1a2.75 2.75 0 0 0 2.75 2.75Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/back-top"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回到顶部
</font></font></a></section></aside></div> </main> </div>            <script data-astro-rerun="" src="/pine-script-docs/static/pine-highlighter-v06.js" data-astro-exec=""></script><div id="goog-gt-tt" class="VIpgJd-yAWNEb-L7lbkb skiptranslate" style="border-radius: 12px; margin: 0 0 0 -23px; padding: 0; font-family: 'Google Sans', Arial, sans-serif;" data-id=""><div id="goog-gt-vt" class="VIpgJd-yAWNEb-hvhgNd"><div class=" VIpgJd-yAWNEb-hvhgNd-l4eHX-i3jM8c"><img src="https://fonts.gstatic.com/s/i/productlogos/translate/v14/24px.svg" width="24" height="24" alt=""></div><div class=" VIpgJd-yAWNEb-hvhgNd-k77Iif-i3jM8c"><div class="VIpgJd-yAWNEb-hvhgNd-IuizWc" dir="ltr">Original text</div><div id="goog-gt-original-text" class="VIpgJd-yAWNEb-nVMfcd-fmcmS VIpgJd-yAWNEb-hvhgNd-axAV1"></div></div><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid ltr"><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid-B7I4Od ltr" dir="ltr"><div class="VIpgJd-yAWNEb-hvhgNd-UTujCb">Rate this translation</div><div class="VIpgJd-yAWNEb-hvhgNd-eO9mKe">Your feedback will be used to help improve Google Translate</div></div><div class="VIpgJd-yAWNEb-hvhgNd-xgov5 ltr"><button id="goog-gt-thumbUpButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Good translation" aria-label="Good translation" aria-pressed="false"><span id="goog-gt-thumbUpIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7H2v13h16c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM7 18H4V9h3v9zm14-7l-3 7H9V8l4.34-4.34L12 9h9v2z"></path></svg></span><span id="goog-gt-thumbUpIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7v13h11c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM5 7H1v13h4V7z"></path></svg></span></button><button id="goog-gt-thumbDownButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Poor translation" aria-label="Poor translation" aria-pressed="false"><span id="goog-gt-thumbDownIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7h5V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zM17 6h3v9h-3V6zM3 13l3-7h9v10l-4.34 4.34L12 15H3v-2z"></path></svg></span><span id="goog-gt-thumbDownIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zm16 0h4V4h-4v13z"></path></svg></span></button></div></div><div id="goog-gt-votingHiddenPane" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><form id="goog-gt-votingForm" action="//translate.googleapis.com/translate_voting?client=te_lib" method="post" target="votingFrame" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><input type="text" name="sl" id="goog-gt-votingInputSrcLang"><input type="text" name="tl" id="goog-gt-votingInputTrgLang"><input type="text" name="query" id="goog-gt-votingInputSrcText"><input type="text" name="gtrans" id="goog-gt-votingInputTrgText"><input type="text" name="vote" id="goog-gt-votingInputVote"></form><iframe name="votingFrame" frameborder="0"></iframe></div></div></div> </body></html>