<html lang="zh-CN" data-theme="light" class="translated-ltr"><head><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/pine-script-docs/static/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>概念 / 线条和盒子</title><meta name="og:title" content="Concepts / Lines and boxes"><meta name="twitter:title" content="Concepts / Lines and boxes"><meta name="description" content="Everything you need to know about Pine Script™."><meta name="og:description" content="Everything you need to know about Pine Script™."><meta name="twitter:description" content="Everything you need to know about Pine Script™."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png"><meta name="twitter:image" content="/pine-script-docs/meta-image.png"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="../../concepts/lines-and-boxes/"><meta name="twitter:url" content="../../concepts/lines-and-boxes/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="../../concepts/lines-and-boxes/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="stylesheet" href="/pine-script-docs/_astro/index.jN9AZoBe.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.C8b720yZ.css"><script type="module" src="/pine-script-docs/_astro/hoisted.D4iEV6y6.js" data-astro-exec=""></script><style type="text/css" media="screen">.monaco-editor-tv-pine-dark { 
    .mtk1 { color: #ffffff; }
    .mtk2 { color: #131722; }
    .mtk3 { color: #cc6666; }
    .mtk4 { color: #9cdcfe; }
    .mtk5 { color: #ce9178; }
    .mtk6 { color: #d4d4d4; }
    .mtk7 { color: #b5cea8; }
    .mtk8 { color: #608b4e; }
    .mtk9 { color: #787b86; }
    .mtk10 { color: #569cd6; }
    .mtk11 { color: #f77c80; }
    .mtk12 { color: #f57f17; }
    .mtk13 { color: #dcdcdc; }
    .mtk14 { color: #808080; }
    .mtk15 { color: #3179f5; }
    .mtk16 { color: #5b9cf6; }
    .mtk17 { color: #ba68c8; }
    .mtk18 { color: #42bda8; }
    .mtk19 { color: #f44747; }
    .mtk20 { color: #c586c0; }
    .mtk21 { color: #a79873; }
    .mtk22 { color: #dd6a6f; }
    .mtk23 { color: #5bb498; }
    .mtk24 { color: #909090; }
    .mtk25 { color: #778899; }
    .mtk26 { color: #ff00ff; }
    .mtk27 { color: #b46695; }
    .mtk28 { color: #388e3c; }
    .mtk29 { color: #ff0000; }
    .mtk30 { color: #4f76ac; }
    .mtk31 { color: #3dc9b0; }
    .mtk32 { color: #74b0df; }
    .mtk33 { color: #d1d4dc; }
    .mtk34 { color: #4864aa; }
    .mtki { font-style: italic; }
    .mtkb { font-weight: bold; }
    .mtku { text-decoration: underline; text-underline-position: under; }
    .mtks { text-decoration: line-through; }
    .mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style>
<style type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://www.gstatic.com/_/translate_http/_/ss/k=translate_http.tr.26tY-h6gH9w.L.W.O/am=GAY/d=0/rs=AN8SPfrev-A3NvrBP0gNq8zXCqKY7IcBLA/m=el_main_css"></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16px" height="16px" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02Zm-3.95-.3a7.91 7.91 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8V4Zm0 9v2h1v-2H8Zm6-3V9h-2v1h2ZM3 9v1h2V9H3Zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm4.2-6-.7-.7-1.4 1.4.7.7L12.7 6ZM5 13.7l-.7-.7 1.4-1.4.7.7L5 13.7Zm7.7-.7-.7.7-1.4-1.4.7-.7 1.4 1.4ZM4.3 6l.7-.7 1.4 1.4-.7.7L4.3 6Zm3 17 14-14 .8.7L8 23.7l-.7-.7Zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9Z"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh="">    <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="关闭菜单" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="主导航" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="打开导航菜单" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="主页按钮" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><svg width="188" height="44" viewBox="0 0 188 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001ZM32.4978 22.1105L27.1641 25.5207L19.7195 19.2258C19.1767 18.7669 18.4312 18.6305 17.7611 18.8676L13.8245 20.2602L21.9253 9.59841L32.4978 22.1105Z" fill="currentColor"></path>
<path d="M33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="currentColor"></path>
<path d="M59.56 13.96C63.016 13.96 65.536 16.456 65.536 19.696C65.536 22.936 63.016 25.432 59.56 25.432H57.376V31H53.896V13.96H59.56ZM59.512 22.168C61.096 22.168 62.152 21.088 62.152 19.696C62.152 18.304 61.096 17.224 59.512 17.224H57.376V22.168H59.512ZM70.8636 14.944C70.8636 16.096 69.9276 17.032 68.7516 17.032C67.6236 17.032 66.6636 16.096 66.6636 14.944C66.6636 13.792 67.6236 12.856 68.7516 12.856C69.9276 12.856 70.8636 13.792 70.8636 14.944ZM67.1196 31V19H70.4076V31H67.1196ZM73.0849 31V19H76.3729V20.368C76.9969 19.408 78.2449 18.736 79.8049 18.736C82.7089 18.736 84.4369 20.848 84.4369 23.968V31H81.1489V24.52C81.1489 22.792 80.4049 21.736 79.0369 21.736C77.5249 21.736 76.3729 22.84 76.3729 25.144V31H73.0849ZM86.2041 25C86.2041 21.448 88.8681 18.736 92.5161 18.736C95.6601 18.736 98.4201 20.752 98.4201 24.64C98.4201 24.928 98.4201 25.264 98.3721 25.768H89.3961C89.5881 27.376 91.0041 28.264 92.5881 28.264C94.0761 28.264 95.1561 27.568 95.6841 26.752L98.1321 28.576C97.0281 30.184 95.0841 31.264 92.5641 31.264C88.9881 31.264 86.2041 28.792 86.2041 25ZM92.4201 21.448C91.1961 21.448 89.8281 22.072 89.5161 23.536H95.1321C94.8441 22.12 93.6441 21.448 92.4201 21.448ZM104.412 28.24L107.076 26.008C107.916 27.28 109.38 28.024 110.772 28.024C112.14 28.024 113.052 27.352 113.052 26.368C113.052 25.408 112.356 24.736 110.676 24.16L109.236 23.656C106.5 22.696 105.036 21.112 105.036 18.784C105.036 15.568 107.484 13.672 110.796 13.672C112.884 13.672 114.708 14.392 116.172 16.024L113.868 18.4C113.052 17.416 111.996 16.936 110.82 16.936C109.644 16.936 108.54 17.44 108.54 18.448C108.54 19.48 109.38 19.936 111.18 20.584L112.548 21.088C115.044 22 116.604 23.584 116.604 26.152C116.58 29.2 114.156 31.288 110.628 31.288C107.916 31.288 105.636 30.112 104.412 28.24ZM129.859 27.808C128.827 29.872 126.667 31.264 124.171 31.264C120.619 31.264 117.811 28.624 117.811 25C117.811 21.376 120.619 18.736 124.171 18.736C126.667 18.736 128.827 20.128 129.859 22.192L127.003 23.728C126.523 22.624 125.491 21.808 124.171 21.808C122.443 21.808 121.123 23.152 121.123 25C121.123 26.848 122.443 28.192 124.171 28.192C125.491 28.192 126.523 27.376 127.003 26.272L129.859 27.808ZM131.482 31V19H134.77V20.92C135.178 19.744 136.402 18.856 137.746 18.856C138.082 18.856 138.442 18.88 138.85 19V22.336C138.346 22.168 137.89 22.072 137.362 22.072C135.802 22.072 134.77 23.296 134.77 25.264V31H131.482ZM144.215 14.944C144.215 16.096 143.279 17.032 142.103 17.032C140.975 17.032 140.015 16.096 140.015 14.944C140.015 13.792 140.975 12.856 142.103 12.856C143.279 12.856 144.215 13.792 144.215 14.944ZM140.471 31V19H143.759V31H140.471ZM146.436 36.016V19H149.724V20.344C150.276 19.576 151.548 18.736 153.204 18.736C156.396 18.736 158.844 21.592 158.844 25C158.844 28.408 156.396 31.264 153.204 31.264C151.548 31.264 150.276 30.424 149.724 29.656V36.016H146.436ZM155.508 25C155.508 23.128 154.284 21.736 152.484 21.736C150.684 21.736 149.46 23.128 149.46 25C149.46 26.872 150.684 28.264 152.484 28.264C154.284 28.264 155.508 26.872 155.508 25ZM168.407 30.88C167.879 31.048 167.231 31.144 166.319 31.144C163.775 31.144 161.735 29.728 161.735 26.8V21.88H159.311V19H161.735V15.664H165.023V19H168.407V21.88H165.023V26.152C165.023 27.616 165.647 28.192 167.063 28.192C167.591 28.192 168.023 28.12 168.407 27.976V30.88ZM177.626 22.648V13.96H179.978L181.874 16.888L183.746 13.96H186.122V22.648H183.698V18.184L181.874 20.968L180.026 18.136V22.648H177.626ZM171.386 22.648V16.456H169.058V13.96H176.258V16.456H173.93V22.648H171.386Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="搜索文档" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0Zm-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="重置" data-search-clear="" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除</font></font></button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="关闭" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索结果</font></font></div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp="">    </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true" style="display:none"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="关闭图片预览" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94 5.53 4.47Z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="返回文档主页。" data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户手册</font></font></span>  </a>  <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <a href="/pine-script-docs/concepts/alerts" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></a> <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <span class="current-item" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></span> </div>     </div> <div id="slot-container" data-astro-cid-xgirumru="">  <h1 id="lines-and-boxes" class="md-heading"><a href="#lines-and-boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盒子</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<h2 id="introduction" class="md-heading"><a href="#introduction"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 可使用线、框和折线类型从代码中绘制线、框和其他几何图形
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;">这些</font></a><font style="vertical-align: inherit;">类型
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于
</font><font style="vertical-align: inherit;">
以编程方式在图表上绘制支撑位和阻力位、趋势线、价格范围和其他自定义图形。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><a href="/pine-script-docs/concepts/plots"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同，这些类型的灵活性使它们特别适合在图表上几乎任何可用点可视化当前计算的数据，而不管脚本在哪个图表栏上执行。</font></font></p>
<p><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
都是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，就像
</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/concepts/tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和其他</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特殊类型</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一样。脚本使用 ID 引用这些类型的对象，这些 ID 的作用类似于</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指针</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。与其他对象一样，
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ID 被限定为“系列”值，并且管理这些对象的所有函数都接受“系列”参数。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用我们在本页讨论的类型通常涉及
</font></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，尤其是在使用</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，这</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个
</font><font style="vertical-align: inherit;">
chart.point
实例</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。因此，我们建议您熟悉
</font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;">数组</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便在脚本中充分利用这些绘图类型。</font></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></div></aside>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本绘制的线条可以是垂直的、水平的或有角度的。方框始终是矩形。折线依次连接多个垂直、水平、有角度或弯曲的线段。尽管所有这些绘图类型都有不同的特点，但它们确实有一些共同点：</font></font></p>
<ul>
<li><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在图表上的任何可用位置具有坐标，包括最后一个图表条之后的未来时间的坐标。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些类型的对象可以使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实例来设置其坐标。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个对象的 x 坐标可以是条形索引或时间值，具体取决于其指定的</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个对象可以具有多个预定义线条样式之一。</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/loops"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以在循环</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围内调用管理这些对象的函数</font><font style="vertical-align: inherit;">，从而可以对其绘图进行迭代和条件控制。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以引用和显示在图表上的这些对象的数量是有限制的。单个脚本实例最多可以显示 500 条线、500 个框和 100 条折线。用户可以通过
</font><font style="vertical-align: inherit;">
脚本的
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">indicator()</font></a><font style="vertical-align: inherit;">
或
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">strategies()</font></a></font><code dir="auto">max_lines_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明语句的、</font></font><code dir="auto">max_boxes_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和参数指定每种类型允许的最大数量</font><font style="vertical-align: inherit;">
。如果未指定，则默认值为 ~50。与
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;">标签</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;">表格</font></a><font style="vertical-align: inherit;">
类型一样，线、框和折线使用</font><em><font style="vertical-align: inherit;">垃圾收集</font></em><font style="vertical-align: inherit;">
机制，当绘图总数超过脚本的限制时，该机制会删除图表上最旧的对象。</font></font><code dir="auto">max_polylines_count</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></li>
</ul>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 TradingView 图表上，一整套</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图工具</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许用户使用鼠标操作创建和修改绘图。虽然它们有时可能类似于使用 Pine Script™ 代码创建的绘图对象，但它们是
</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不相关的</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体。Pine 脚本无法与图表用户界面上的绘图工具交互，鼠标操作不会直接影响 Pine 绘图对象。</font></font></p></div></aside>
<h2 id="lines" class="md-heading"><a href="#lines"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间中的内置函数控制</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;">线</font></a></font><code dir="auto">line.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象的创建和管理
</font><font style="vertical-align: inherit;">
：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.new
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数创建一个新行。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code dir="auto">line.set_*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数修改线条属性。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code dir="auto">line.get_*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数从线实例中检索值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.copy
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数克隆一个线实例。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.delete
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数删除现有的线实例。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.all
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_line.all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
引用一个只读
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中包含脚本显示的所有线的 ID。数组的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
取决于</font></font><code dir="auto">max_lines_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategies()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
声明语句以及脚本绘制的线数。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以将</font><font style="vertical-align: inherit;">、、
 </font></font><code dir="auto">line.set_*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.copy </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy"><font style="vertical-align: inherit;">()</font></a><font style="vertical-align: inherit;">和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete"><font style="vertical-align: inherit;">line.delete()</font></a><font style="vertical-align: inherit;">
内置函数作为函数或</font><a href="/pine-script-docs/language/methods"><font style="vertical-align: inherit;">方法</font></a><font style="vertical-align: inherit;">调用。</font></font><code dir="auto">line.get_*()</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/methods"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<h3 id="creating-lines" class="md-heading"><a href="#creating-lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.new
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数创建一个新的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实例以显示在图表上。它具有以下签名：</font></font></p>
<div class="expressive-code not-content"><link rel="stylesheet" href="/pine-script-docs/_astro/ec.dtidy.css"><script type="module" src="/pine-script-docs/_astro/ec.8gcug.js" data-astro-exec=""></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text" tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">line.new(first_point, second_point, xloc, extend, color, style, width, force_overlay) → series line</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">line.new(x1, y1, x2, y2, xloc, extend, color, style, width, force_overlay) → series line</span></div></div></code></pre></figure></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此函数的第一个重载包含</font></font><code dir="auto">first_point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><code dir="auto">second_point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数。</font></font><code dir="auto">first_point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
，表示线条的起点， 是</font></font><code dir="auto">second_point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point ，表示线条的终点。该函数从这些</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表点</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
复制信息
</font><font style="vertical-align: inherit;">以确定线条的坐标。它是否使用和
</font><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">的</font></font><code dir="auto">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或字段</font><font style="vertical-align: inherit;">作为 x 坐标取决于函数的</font><font style="vertical-align: inherit;">值。</font></font><code dir="auto">time</code><font style="vertical-align: inherit;"></font><code dir="auto">first_point</code><font style="vertical-align: inherit;"></font><code dir="auto">second_point</code><font style="vertical-align: inherit;"></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个重载分别指定</font></font><code dir="auto">x1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">y1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">x2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">y2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，其中</font></font><code dir="auto">x1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">x2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值，表示线条的起始和终止 x 坐标，和</font></font><code dir="auto">y1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code dir="auto">y2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮点
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_float"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，表示 y 坐标。线条是否将
</font></font><code dir="auto">x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值视为条形索引或时间戳取决于</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数调用中的值。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个重载共享相同的附加参数：</font></font></p>
<p><code dir="auto">xloc</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制新线的 x 坐标是否使用条形索引或时间值。其默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用第一个重载时，使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;">xloc.bar_index</font></a></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
</font><font style="vertical-align: inherit;">
告诉函数使用</font><font style="vertical-align: inherit;">
和</font><font style="vertical-align: inherit;">的字段，而</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;">xloc.bar_time</font></a><font style="vertical-align: inherit;">的值
</font><font style="vertical-align: inherit;">
告诉函数使用</font><font style="vertical-align: inherit;">点的字段。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">index</code><font style="vertical-align: inherit;"></font><code dir="auto">first_point</code><font style="vertical-align: inherit;"></font><code dir="auto">second_point</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">time</code><font style="vertical-align: inherit;"></font></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用第二个重载时，</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;">xloc.bar_index</font></a></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
</font><font style="vertical-align: inherit;">
会提示函数将</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">参数视为条形索引值。使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;">xloc.bar_time</font></a><font style="vertical-align: inherit;">时，函数会将</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">视为时间值。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">x1</code><font style="vertical-align: inherit;"></font><code dir="auto">x2</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">x1</code><font style="vertical-align: inherit;"></font><code dir="auto">x2</code><font style="vertical-align: inherit;"></font></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当指定的 x 坐标表示</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形索引</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值时，需要注意允许的最小 x 坐标为
</font></font><code dir="auto">bar_index - 9999</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。对于更大的偏移量，可以使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">extend</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定所绘制的线是否会无限延伸到其定义的起始和结束坐标之外。它接受以下值之一：
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extend.left</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extend.right</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.both"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extend.both</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.none"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extend.none</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
（默认）。</font></font></p>
<p><code dir="auto">color</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定线条绘制的颜色。默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.blue"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">color.blue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">style</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定线条的样式，可以是本页
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#line-styles"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条样式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分列出的任何选项。默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_line.style_solid"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.style_solid</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">width</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制线的宽度（以像素为单位）。默认值为 1。</font></font></p>
<p><code dir="auto">force_overlay</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，绘图将显示在主图表窗格中，即使脚本占用单独的窗格也是如此。可选。默认值为</font></font><code dir="auto">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例演示了如何以最简单的形式绘制线条。此脚本
</font><font style="vertical-align: inherit;">
在每个图表条的水平中心绘制一条连接</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_open"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开盘价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘价的新垂直线：</font></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Lines-Creating-lines-1.B2RdyvXG_1Vqnm2.webp" alt="图像" width="1334" height="550" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4ja"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Creating&nbsp;lines&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;line.&nbsp;Cont</span><span class="mtk9">ains&nbsp;`index`&nbsp;and&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">firstPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line.&nbsp;Contai</span><span class="mtk9">ns&nbsp;`index`&nbsp;and&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">secondPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;basic&nbsp;line&nbsp;with&nbsp;a&nbsp;`width`&nbsp;of&nbsp;5&nbsp;connectin</span><span class="mtk9">g&nbsp;the&nbsp;`firstPoint`&nbsp;to&nbsp;the&nbsp;`secondPoint`.</span></span><br><span><span class="mtk9">//&nbsp;This&nbsp;line&nbsp;uses&nbsp;the&nbsp;`index`&nbsp;field&nbsp;from&nbsp;each&nbsp;poin</span><span class="mtk9">t&nbsp;for&nbsp;its&nbsp;x-coordinates.</span></span><br><span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">firstPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;the&nbsp;background&nbsp;on&nbsp;the&nbsp;unconfirmed&nbsp;bar.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isconfirmed</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Unconfirmed&nbsp;bar&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code dir="auto">firstPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">secondPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用相同的坐标，则脚本将不会</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线，因为它们之间没有要绘制的距离。但是，线 ID 仍然存在。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本将仅显示图表上大约最后 50 条线，因为它未</font></font><code dir="auto">max_lines_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数调用中指定。线条图将保留在图表上，直到使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.delete()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除
或被垃圾收集器移除。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本会在打开的图表条（即具有橙色背景突出显示的条）上</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新绘制</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条，直到关闭。 条关闭后，它将不再更新绘图。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看一个更复杂的例子。此脚本使用前一个条形图的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hl2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价格和当前条形图的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价
和</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_low"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来绘制一个扇形图，该扇形图具有用户指定的线条数，投射出以下图表条形图的一系列假设价格值。它
</font><font style="vertical-align: inherit;">
在</font><a href="/pine-script-docs/language/loops#for"><font style="vertical-align: inherit;">for循环中调用</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个条形图上创建</font><font style="vertical-align: inherit;">线条：</font></font><a href="/pine-script-docs/language/loops#for"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">linesPerBar</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Lines-Creating-lines-2.DqR4SD_f_2jEAVG.webp" alt="图像" width="1328" height="598" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6xc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Creating&nbsp;lines&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Simple&nbsp;projection&nbsp;fan"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_lines_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;fan&nbsp;lines&nbsp;drawn&nbsp;on&nbsp;each&nbsp;chart&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">linesPerBar</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Line&nbsp;drawings&nbsp;per&nbsp;bar"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;distance&nbsp;between&nbsp;each&nbsp;y&nbsp;point&nbsp;on&nbsp;the&nbsp;current&nbsp;</span><span class="mtk9">bar.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">step</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">linesPerBar</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;each&nbsp;line.&nbsp;Doe</span><span class="mtk9">s&nbsp;not&nbsp;contain&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">firstPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">])</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;end&nbsp;of&nbsp;each&nbsp;line.&nbsp;Does&nbsp;</span><span class="mtk9">not&nbsp;contain&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">secondPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">float</span><span class="mtk13">(</span><span class="mtk11">na</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;stepped&nbsp;y&nbsp;value&nbsp;on&nbsp;the&nbsp;current&nbsp;bar&nbsp;for&nbsp;`secon</span><span class="mtk9">dPoint.price`&nbsp;calculation,&nbsp;starting&nbsp;from&nbsp;the&nbsp;`low`</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">barValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span></span><br><span><span class="mtk9">//&nbsp;Loop&nbsp;to&nbsp;draw&nbsp;the&nbsp;fan.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">linesPerBar</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;`price`&nbsp;of&nbsp;the&nbsp;`secondPoint`&nbsp;using&nbsp;t</span><span class="mtk9">he&nbsp;difference&nbsp;between&nbsp;the&nbsp;`barValue`&nbsp;and&nbsp;`firstPoi</span><span class="mtk9">nt.price`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">barValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstPoint</span><span class="mtk1">.</span><span class="mtk33">price</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.aqua`&nbsp;when&nbsp;the&nbsp;line's&nbsp;slope&nbsp;is&nbsp;positive</span><span class="mtk9">,&nbsp;`color.fuchsia`&nbsp;otherwise.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;`lineColor`&nbsp;line&nbsp;connecting&nbsp;the&nbsp;`fir</span><span class="mtk9">stPoint`&nbsp;and&nbsp;`secondPoint`&nbsp;coordinates.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;This&nbsp;line&nbsp;uses&nbsp;the&nbsp;`index`&nbsp;field&nbsp;from&nbsp;each&nbsp;poin</span><span class="mtk9">t&nbsp;for&nbsp;its&nbsp;x-coordinates.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">firstPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;`step`&nbsp;to&nbsp;the&nbsp;`barValue`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk33">step</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;the&nbsp;background&nbsp;on&nbsp;the&nbsp;unconfirmed&nbsp;bar.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isconfirmed</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Unconfirmed&nbsp;bar&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经将其纳入了</font></font><code dir="auto">max_lines_count = 500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数调用，这意味着脚本在图表上保留最多 500 条线。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用都会从</font><font style="vertical-align: inherit;">和变量</font><font style="vertical-align: inherit;">
引用的</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point中</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息
</font><font style="vertical-align: inherit;">。因此，脚本可以在每次循环迭代中更改的</font><font style="vertical-align: inherit;">字段
</font><font style="vertical-align: inherit;">，而不会影响其他线中的 y 坐标。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">firstPoint</code><font style="vertical-align: inherit;"></font><code dir="auto">secondPoint</code><font style="vertical-align: inherit;"></font><code dir="auto">price</code><font style="vertical-align: inherit;"></font><code dir="auto">secondPoint</code><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="modifying-lines" class="md-heading"><a href="#modifying-lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间</font></font><code dir="auto">line.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含多个</font><font style="vertical-align: inherit;">修改
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;">线实例属性的</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setter</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数
：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_first_point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_first_point()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_second_point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_second_point()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别使用来自指定的信息</font><font style="vertical-align: inherit;">
更新线的起点和终点</font></font><code dir="auto">point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_x1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_x1()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_x2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_x2()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将线
的 x 坐标之一设置</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为新</font></font><code dir="auto">x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，该新值可以表示取决于线的属性的条形索引或时间值</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_y1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_y1()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_y2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_y2()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将线
的 y 坐标之一设置</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为新</font></font><code dir="auto">y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_xy1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_xy1()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_xy2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_xy2()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用新的值更新</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线的</font><font style="vertical-align: inherit;">
某个点</font><font style="vertical-align: inherit;">。</font></font><code dir="auto">x</code><font style="vertical-align: inherit;"></font><code dir="auto">y</code><font style="vertical-align: inherit;"></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_xloc"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_xloc()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置线</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的并用新的</font><font style="vertical-align: inherit;">和值</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新其 x 坐标</font><font style="vertical-align: inherit;">。</font></font><code dir="auto">x1</code><font style="vertical-align: inherit;"></font><code dir="auto">x2</code><font style="vertical-align: inherit;"></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_extend"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_extend()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置线</font></font><code dir="auto">extend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的属性</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_color"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_color()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更新</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线的</font></font><code dir="auto">color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_style"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_style()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
改变线条</font></font><code dir="auto">style</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的风格</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_width"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_width()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置线</font></font><code dir="auto">width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的宽度</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有 setter 函数都直接修改</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传入调用的行，不返回任何值。每个 setter 函数都接受“系列”参数，因为脚本可以在执行过程中更改行的属性。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例绘制了连接 a 的开盘价
</font></font><code dir="auto">timeframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和收盘价的线条。脚本使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关键字声明</font></font><code dir="auto">periodLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 变量，这些变量
仅在</font><em><font style="vertical-align: inherit;">第一个图表条上引用</font></em></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值（</font></font><code dir="auto">openPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">closePoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">，并在执行过程中为这些变量分配新值。在检测到 上
</font><font style="vertical-align: inherit;">
的</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change"><font style="vertical-align: inherit;">变化</font></a><font style="vertical-align: inherit;">后，它
使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_color"><font style="vertical-align: inherit;">line.set_color()</font></a><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">现有的，</font><font style="vertical-align: inherit;">使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now"><font style="vertical-align: inherit;">chart.point.now()</font></a><font style="vertical-align: inherit;">为和</font><font style="vertical-align: inherit;">创建新值</font><font style="vertical-align: inherit;">，然后</font><font style="vertical-align: inherit;">
使用这些点为分配一条</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;">新线</font></a><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">timeframe</code><font style="vertical-align: inherit;"></font><code dir="auto">color</code><font style="vertical-align: inherit;"></font><code dir="auto">periodLine</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_color"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">openPoint</code><font style="vertical-align: inherit;"></font><code dir="auto">closePoint</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">periodLine</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"></font><code dir="auto">periodLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在值不是
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他条形图上</font><font style="vertical-align: inherit;">，脚本会为 分配一个新的
</font><font style="vertical-align: inherit;">
chart.point </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">closePoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_second_point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_second_point()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_color"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.set_color()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为</font></font><a href="/pine-script-docs/language/methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来更新线条的属性：</font></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Lines-Modifying-lines-1.9MbH8maN_1T4Dvi.webp" alt="图像" width="1334" height="604" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4wl"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Modifying&nbsp;lines&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;size&nbsp;of&nbsp;each&nbsp;period.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeframe</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.timeframe</span><span class="mtk13">(</span><span class="mtk29">"D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Timeframe"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;line&nbsp;connecting&nbsp;the&nbsp;period's&nbsp;opening&nbsp;and&nbsp;closin</span><span class="mtk9">g&nbsp;prices.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">periodLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;first&nbsp;point&nbsp;of&nbsp;the&nbsp;line.&nbsp;Contains&nbsp;`time`&nbsp;and&nbsp;</span><span class="mtk9">`index`&nbsp;information.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk1">&nbsp;</span><span class="mtk33">openPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;closing&nbsp;point&nbsp;of&nbsp;the&nbsp;line.&nbsp;Contains&nbsp;`time`&nbsp;an</span><span class="mtk9">d&nbsp;`index`&nbsp;information.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk1">&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">timeframe.change</span><span class="mtk13">(</span><span class="mtk33">timeframe</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;final&nbsp;color&nbsp;of&nbsp;the&nbsp;`periodLine`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">finalColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">openPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">openPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.gray</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;current&nbsp;`periodLine`&nbsp;to</span><span class="mtk9">&nbsp;the&nbsp;`finalColor`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.set_color</span><span class="mtk13">(</span><span class="mtk33">periodLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">finalColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;new&nbsp;points&nbsp;to&nbsp;the&nbsp;`openPoint`&nbsp;and&nbsp;`close</span><span class="mtk9">Point`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">openPoint</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;a&nbsp;new&nbsp;line&nbsp;to&nbsp;the&nbsp;`periodLine`.&nbsp;Uses&nbsp;`ti</span><span class="mtk9">me`&nbsp;fields&nbsp;from&nbsp;the&nbsp;`openPoint`&nbsp;and&nbsp;`closePoint`&nbsp;a</span><span class="mtk9">s&nbsp;x-coordinates.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">periodLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">openPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_arrow_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">periodLine</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;a&nbsp;new&nbsp;point&nbsp;to&nbsp;the&nbsp;`closePoint`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;developing&nbsp;`periodLine`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">developingColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">openPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">openPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.gray</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;coordinates&nbsp;of&nbsp;the&nbsp;line's&nbsp;second&nbsp;poi</span><span class="mtk9">nt&nbsp;using&nbsp;the&nbsp;new&nbsp;`closePoint`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;`time`&nbsp;field&nbsp;from&nbsp;the&nbsp;point&nbsp;for&nbsp;its</span><span class="mtk9">&nbsp;new&nbsp;x-coordinate.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">periodLine</span><span class="mtk1">.</span><span class="mtk15">set_second_point</span><span class="mtk13">(</span><span class="mtk33">closePoint</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;line&nbsp;using&nbsp;the&nbsp;`develop</span><span class="mtk9">ingColor`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">periodLine</span><span class="mtk1">.</span><span class="mtk15">set_color</span><span class="mtk13">(</span><span class="mtk33">developingColor</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本示例中的每条线条图均使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_line.style_arrow_right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.style_arrow_right</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
样式。请参阅
下面的</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#line-styles"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条样式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分，了解所有可用样式设置的概述。</font></font></li>
</ul>
<h3 id="line-styles" class="md-heading"><a href="#line-styles"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">样式</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;">用户可以通过在line.new()</font></a><font style="vertical-align: inherit;">
或
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_style"><font style="vertical-align: inherit;">line.set_style()</font></a><font style="vertical-align: inherit;">
函数调用</font></font><code dir="auto">style</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中
</font><font style="vertical-align: inherit;">传递以下变量之一作为参数来控制脚本线条图的样式：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_style"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>

































<table><thead><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">争论</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></th></tr></thead><tbody><tr><td><code dir="auto">line.style_solid</code></td><td><img src="/pine-script-docs/_astro/LinesAndBoxes-LineStyles-solid.DhD1RUy8_12kPg2.webp" alt="线条样式_实线" width="744" height="652" loading="lazy" decoding="async"></td></tr><tr><td><code dir="auto">line.style_dotted</code></td><td><img src="/pine-script-docs/_astro/LinesAndBoxes-LineStyles-dotted.ChjUGoWk_Z25Ho6S.webp" alt="线条样式_点线" width="744" height="652" loading="lazy" decoding="async"></td></tr><tr><td><code dir="auto">line.style_dashed</code></td><td><img src="/pine-script-docs/_astro/LinesAndBoxes-LineStyles-dashed.RIt4NsM6_DFkrB.webp" alt="线条样式_虚线" width="744" height="652" loading="lazy" decoding="async"></td></tr><tr><td><code dir="auto">line.style_arrow_left</code></td><td><img src="/pine-script-docs/_astro/LinesAndBoxes-LineStyles-arrow_left.CASIwsfy_Z1JIiS0.webp" alt="线条样式_向左箭头" width="744" height="652" loading="lazy" decoding="async"></td></tr><tr><td><code dir="auto">line.style_arrow_right</code></td><td><img src="/pine-script-docs/_astro/LinesAndBoxes-LineStyles-arrow_right.Ch2Ohee9_C6Kmb.webp" alt="线条样式箭头向右" width="744" height="652" loading="lazy" decoding="async"></td></tr><tr><td><code dir="auto">line.style_arrow_both</code></td><td><img src="/pine-script-docs/_astro/LinesAndBoxes-LineStyles-arrow_both.CDMgsUYf_Z1hzmym.webp" alt="线条样式箭头两者" width="744" height="652" loading="lazy" decoding="async"></td></tr></tbody></table>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以使用这些变量中的任何一个作为其
</font></font><code dir="auto">line_style</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。请参阅
</font><font style="vertical-align: inherit;">本页的</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#creating-polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建折线部分。</font></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="reading-line-values" class="md-heading"><a href="#reading-line-values"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取线</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名</font></font><code dir="auto">line.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空间包含</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getter</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，允许脚本从
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对象中检索值以供进一步使用：</font></font></p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_x1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_x1()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_x2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_x2()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分别获取线条的第一和第二个 x 坐标</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。返回的值是否表示条形索引或时间值取决于线条的</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_y1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_y1()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_y2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_y2()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分别获取</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线的第一个和第二个 y 坐标。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_price"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_price()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索指定值处的
</font><font style="vertical-align: inherit;">
线的价格（y 坐标）</font></font><code dir="auto">x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，包括线起点和终点之外的条形索引。此函数仅与使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的线兼容。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的脚本在
价格</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rising"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上涨</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.falling"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下跌的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
形态开始形成时绘制一条新线</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关键字在第一个图表条上声明</font></font><code dir="auto">directionLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量。分配给的 ID 将</font></font><code dir="auto">directionLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在后续条上持续存在，直到</font></font><code dir="auto">newDirection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件发生，在这种情况下，脚本将为变量分配一条新线。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个柱状图上，脚本调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_y2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_y2()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_y1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_y1()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_x2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_x2()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_x1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_x1()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
getter 作为</font></font><a href="/pine-script-docs/language/methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来从当前检索值</font></font><code dir="auto">directionLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并计算其
值，并使用该值确定每个绘图和图的颜色。它使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_price"><font style="vertical-align: inherit;">line.get_price()</font></a><font style="vertical-align: inherit;">从其</font><font style="vertical-align: inherit;">第二个点
</font><em><font style="vertical-align: inherit;">以外</font></em></font><code dir="auto">slope</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索扩展值，</font><font style="vertical-align: inherit;">
并将它们</font><a href="/pine-script-docs/concepts/plots"><font style="vertical-align: inherit;">绘制</font></a><font style="vertical-align: inherit;">在图表上：</font></font><code dir="auto">directionLine</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_price"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/plots"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Lines-Reading-line-values-1.C9ypOdeZ_Gv53Q.webp" alt="图像" width="1276" height="562" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1qk"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Reading&nbsp;line&nbsp;values&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;for&nbsp;rising&nbsp;and&nbsp;falling&nbsp;calcula</span><span class="mtk9">tions.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;line&nbsp;that's&nbsp;drawn&nbsp;whenever&nbsp;`hlc3`&nbsp;starts&nbsp;rising</span><span class="mtk9">&nbsp;or&nbsp;falling&nbsp;over&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;`hlc3`&nbsp;is&nbsp;rising&nbsp;over&nbsp;`length`&nbsp;bar</span><span class="mtk9">s,&nbsp;`false`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">rising</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rising</span><span class="mtk13">(</span><span class="mtk11">hlc3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;`hlc3`&nbsp;is&nbsp;falling&nbsp;over&nbsp;`length`&nbsp;ba</span><span class="mtk9">rs,&nbsp;`false`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">falling</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.falling</span><span class="mtk13">(</span><span class="mtk11">hlc3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;a&nbsp;rising&nbsp;or&nbsp;falling&nbsp;pattern&nbsp;begins</span><span class="mtk9">,&nbsp;`false`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">newDirection</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">rising</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">rising</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">])</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">falling</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">falling</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">])</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;`directionLine`&nbsp;when&nbsp;`newDirection`&nbsp;</span><span class="mtk9">is&nbsp;`true`.&nbsp;The&nbsp;line&nbsp;uses&nbsp;the&nbsp;default&nbsp;`xloc.bar_ind</span><span class="mtk9">ex`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">newDirection</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">directionLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">hlc3</span><span class="mtk13">[</span><span class="mtk33">length</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">hlc3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;slope&nbsp;of&nbsp;the&nbsp;`directionLine`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">slope</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">directionLine</span><span class="mtk1">.</span><span class="mtk15">get_y2</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionLine</span><span class="mtk1">.</span><span class="mtk15">get_y1</span><span class="mtk13">())</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">directionLine</span><span class="mtk1">.</span><span class="mtk15">get_x2</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionLine</span><span class="mtk1">.</span><span class="mtk15">get_x1</span><span class="mtk13">())</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;value&nbsp;extrapolated&nbsp;from&nbsp;the&nbsp;`directionLine`&nbsp;a</span><span class="mtk9">t&nbsp;the&nbsp;`bar_index`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.get_price</span><span class="mtk13">(</span><span class="mtk33">directionLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.green`&nbsp;when&nbsp;the&nbsp;`slope`&nbsp;is&nbsp;positive,&nbsp;`c</span><span class="mtk9">olor.red`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">slopeColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">slope</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;`directionLine`.</span></span><br><span><span class="mtk33">directionLine</span><span class="mtk1">.</span><span class="mtk15">set_color</span><span class="mtk13">(</span><span class="mtk33">slopeColor</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`lineValue`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">lineValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Extrapolated&nbsp;value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">slopeColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例调用line.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的第二个重载
</font><font style="vertical-align: inherit;">
，该重载使用</font></font><code dir="auto">x1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">y1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">x2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">y2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数来定义线的起点和终点。</font></font><code dir="auto">x1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为
</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后面的条数，</font></font><code dir="auto">y1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为
</font><font style="vertical-align: inherit;">
该索引处的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlc3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hlc3</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">x2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。函数调用中的和</font></font><code dir="auto">y2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用当前条数的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlc3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hlc3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.get_price
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_price"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数调用将其</font></font><code dir="auto">directionLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视为无限延伸，而不管其</font></font><code dir="auto">extend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性如何。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本仅显示图表上的大约最后 50 行，但
推断值的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
涵盖了整个图表的历史记录。</font></font></li>
</ul>
<h3 id="cloning-lines" class="md-heading"><a href="#cloning-lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克隆</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy"><font style="vertical-align: inherit;">line.copy()</font></a></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数克隆一条线及其所有属性
</font><font style="vertical-align: inherit;">
。对复制的线实例的任何更改都不会影响原始线实例。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，此脚本每条柱形图在柱形图的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_open"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开盘价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处创建一条水平线
</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并将其分配给一个</font></font><code dir="auto">mainLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量。在所有其他柱形图上，它</font></font><code dir="auto">copiedLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.copy()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一条
并调用</font></font><code dir="auto">line.set_*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数来
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#modifying-lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其属性。如下所示，更改</font></font><code dir="auto">copiedLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不会</font></font><code dir="auto">mainLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以任何方式影响：</font></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Lines-Cloning-lines-1.C-hcIuCO_ZfTxYF.webp" alt="图像" width="1330" height="584" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="25c"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Cloning&nbsp;lines&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_lines_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;between&nbsp;each&nbsp;new&nbsp;mainLine&nbsp;assi</span><span class="mtk9">gnment.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;first&nbsp;`chart.point`&nbsp;used&nbsp;by&nbsp;the&nbsp;`mainLine`.&nbsp;C</span><span class="mtk9">ontains&nbsp;`index`&nbsp;and&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">firstPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;second&nbsp;`chart.point`&nbsp;used&nbsp;by&nbsp;the&nbsp;`mainLine`.&nbsp;</span><span class="mtk9">Does&nbsp;not&nbsp;contain&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">secondPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;horizontal&nbsp;line&nbsp;drawn&nbsp;at&nbsp;the&nbsp;`open`&nbsp;price&nbsp;once&nbsp;</span><span class="mtk9">every&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">mainLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;a&nbsp;new&nbsp;line&nbsp;to&nbsp;the&nbsp;`mainLine`&nbsp;that&nbsp;connec</span><span class="mtk9">ts&nbsp;the&nbsp;`firstPoint`&nbsp;to&nbsp;the&nbsp;`secondPoint`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;This&nbsp;line&nbsp;uses&nbsp;the&nbsp;`index`&nbsp;fields&nbsp;from&nbsp;both&nbsp;poi</span><span class="mtk9">nts&nbsp;as&nbsp;x-coordinates.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">mainLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">firstPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;copy&nbsp;of&nbsp;the&nbsp;`mainLine`.&nbsp;Changes&nbsp;to&nbsp;this&nbsp;line&nbsp;do</span><span class="mtk9">&nbsp;not&nbsp;affect&nbsp;the&nbsp;original.</span></span><br><span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">copiedLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.copy</span><span class="mtk13">(</span><span class="mtk33">mainLine</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;color,&nbsp;style,&nbsp;and&nbsp;second&nbsp;point&nbsp;of&nbsp;th</span><span class="mtk9">e&nbsp;`copiedLine`.</span></span><br><span><span class="mtk16">line.set_color</span><span class="mtk13">(</span><span class="mtk33">copiedLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk13">)</span></span><br><span><span class="mtk16">line.set_style</span><span class="mtk13">(</span><span class="mtk33">copiedLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_dotted</span><span class="mtk13">)</span></span><br><span><span class="mtk16">line.set_second_point</span><span class="mtk13">(</span><span class="mtk33">copiedLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"></font><code dir="auto">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的字段</font><font style="vertical-align: inherit;">是</font></font><code dir="auto">secondPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超出</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bar_index的条数。由于</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许的最大 x 坐标
</font><font style="vertical-align: inherit;">
为</font></font><code dir="auto">bar_index + 500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将输入</font></font><code dir="auto">maxval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的设置</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为 500。</font></font></li>
</ul>
<h3 id="deleting-lines" class="md-heading"><a href="#deleting-lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要删除脚本绘制的
</font><font style="vertical-align: inherit;">线条，请使用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.delete()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数。此函数会从脚本中删除线条实例，并将其绘制在图表上。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当人们只想在给定时间内保留图表上的特定数量的线条，或者在图表进展过程中有条件地删除绘图时，删除线条实例通常很方便。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，每当
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rsi"><font style="vertical-align: inherit;">RSI</font></a><font style="vertical-align: inherit;">
穿过其
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.ema"><font style="vertical-align: inherit;">EMA时，此脚本就会使用</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extend.right</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性绘制一条水平线
</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rsi"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.ema"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本将所有线路 ID 存储在一个</font></font><code dir="auto">lines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组
中，</font></font><a href="/pine-script-docs/language/arrays#using-an-array-as-aqueue"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并用作队列，</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">numberOfLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便仅显示图表上的
</font><font style="vertical-align: inherit;">最后一个线路 ID。当</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">数组</font></a><font style="vertical-align: inherit;">
的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
超过指定的值时</font><font style="vertical-align: inherit;">，脚本将使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift"><font style="vertical-align: inherit;">array.shift()删除数组中最旧的线路 ID，并使用</font></a><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete"><font style="vertical-align: inherit;">line.delete()</font></a><font style="vertical-align: inherit;">
将其删除
</font><font style="vertical-align: inherit;">：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">numberOfLines</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Lines-Deleting-lines-1.BO7dBacB_Z1bhgfD.webp" alt="图像" width="1280" height="562" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="cx"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;lines&nbsp;allowed&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18 mtkb">const</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">MAX_LINES_COUNT</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span></span><br><span><span></span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Deleting&nbsp;lines&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;cross&nbsp;levels"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_lines_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">MAX_LINES_COUNT</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;RSI.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsiLength</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;RSI's&nbsp;EMA.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">emaLength</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">28</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;average&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;lines&nbsp;to&nbsp;keep&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfLines</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lines&nbsp;on&nbsp;the&nbsp;chart"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">MAX_LINES_COUNT</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;containing&nbsp;the&nbsp;IDs&nbsp;of&nbsp;lines&nbsp;on&nbsp;the&nbsp;chart</span><span class="mtk9">.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">line</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">lines</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">line</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;`rsiLength`&nbsp;RSI&nbsp;of&nbsp;`close`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsiLength</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`maLength`&nbsp;EMA&nbsp;of&nbsp;the&nbsp;`rsi`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsiMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">emaLength</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.cross</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsiMA</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;horizontal&nbsp;line.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsiMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;horizontal&nbsp;line.&nbsp;Uses&nbsp;the&nbsp;default&nbsp;`x</span><span class="mtk9">loc.bar_index`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">newLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsiMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsiMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Push&nbsp;the&nbsp;`newLine`&nbsp;into&nbsp;the&nbsp;`lines`&nbsp;array.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">lines</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk33">newLine</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Delete&nbsp;the&nbsp;oldest&nbsp;line&nbsp;when&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;arr</span><span class="mtk9">ay&nbsp;exceeds&nbsp;the&nbsp;specified&nbsp;`numberOfLines`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.size</span><span class="mtk13">(</span><span class="mtk33">lines</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfLines</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.delete</span><span class="mtk13">(</span><span class="mtk33">lines</span><span class="mtk1">.</span><span class="mtk15">shift</span><span class="mtk13">())</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`rsi`&nbsp;and&nbsp;`rsiMA`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">40</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsiMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"EMA&nbsp;of&nbsp;RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">30</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们声明了一个</font></font><code dir="auto">MAX_LINES_COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有“const int”
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限定类型</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的变量，脚本将其用作</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">indicator()</font></a></font><code dir="auto">max_lines_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数
中的
</font><font style="vertical-align: inherit;">
，并将</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int"><font style="vertical-align: inherit;">input.int()</font></a><font style="vertical-align: inherit;">的
</font><font style="vertical-align: inherit;">
分配给该</font><font style="vertical-align: inherit;">变量。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">maxval</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">numberOfLines</code><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例使用line.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的第二个重载
</font><font style="vertical-align: inherit;">
，它独立指定</font></font><code dir="auto">x1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">y1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">x2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">y2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坐标。</font></font></li>
</ul>
<h3 id="filling-the-space-between-lines" class="md-heading"><a href="#filling-the-space-between-lines"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">填充行与行</font></span><font style="vertical-align: inherit;">之间的空间</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以通过使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.new"><font style="vertical-align: inherit;">linefill.new()</font></a><font style="vertical-align: inherit;">函数
创建
</font><font style="vertical-align: inherit;">
引用
两个</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;">线条图的</font></a><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;">linefill对象来</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个线条图之间的空间
。线条填充会使用</font><font style="vertical-align: inherit;">它们引用的</font><font style="vertical-align: inherit;">和ID</font><font style="vertical-align: inherit;">
中的属性自动确定其填充边界。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">line1</code><font style="vertical-align: inherit;"></font><code dir="auto">line2</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本计算一个简单的线性回归通道。在第一个图表条上，脚本声明</font></font><code dir="auto">basisLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><code dir="auto">upperLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">lowerLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量以引用通道的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ID，然后进行两次
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linefill.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用以创建
</font><font style="vertical-align: inherit;">
填充通道上部和下部的 linefill 对象。第一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linefill</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">basisLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">
之间的空间，第二个 linefill 填充</font><font style="vertical-align: inherit;">和</font></font><code dir="auto">upperLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之间的空间</font><font style="vertical-align: inherit;">。</font></font><code dir="auto">basisLine</code><font style="vertical-align: inherit;"></font><code dir="auto">lowerLine</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本会更新后续条形图中线条的坐标。但是，请注意，脚本永远不需要更新第一条形图中声明的线条填充。它们会根据指定线条的坐标自动更新填充区域：</font></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Filling-the-space-between-lines-1.BXRTQC1Z_ZJxot8.webp" alt="图像" width="1342" height="558" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="754"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Filling&nbsp;the&nbsp;space&nbsp;between&nbsp;lines&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Simple&nbsp;linreg&nbsp;channel"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;linear&nbsp;regression&nbsp;calcu</span><span class="mtk9">lation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;basis&nbsp;line&nbsp;of&nbsp;the&nbsp;regression&nbsp;channel.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">basisLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;channel's&nbsp;upper&nbsp;line.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">upperLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;channel's&nbsp;lower&nbsp;line.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowerLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">extend</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">extend.right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;linefill&nbsp;instance&nbsp;that&nbsp;fills&nbsp;the&nbsp;space&nbsp;between&nbsp;</span><span class="mtk9">the&nbsp;`basisLine`&nbsp;and&nbsp;`upperLine`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">linefill</span><span class="mtk1">&nbsp;</span><span class="mtk33">upperFill</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">linefill.new</span><span class="mtk13">(</span><span class="mtk33">basisLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">upperLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;linefill&nbsp;instance&nbsp;that&nbsp;fills&nbsp;the&nbsp;space&nbsp;between&nbsp;</span><span class="mtk9">the&nbsp;`basisLine`&nbsp;and&nbsp;`lowerLine`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">linefill</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowerFill</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">linefill.new</span><span class="mtk13">(</span><span class="mtk33">basisLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowerLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;`basisLine`&nbsp;coordinates&nbsp;with&nbsp;current</span><span class="mtk9">&nbsp;linear&nbsp;regression&nbsp;values.</span></span><br><span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">set_xy1</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.linreg</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">))</span></span><br><span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">set_xy2</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.linreg</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;channel's&nbsp;standard&nbsp;deviation.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stDev</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stDev</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.pow</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.get_price</span><span class="mtk13">(</span><span class="mtk33">basisLine</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk33">stDev</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sqrt</span><span class="mtk13">(</span><span class="mtk33">stDev</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;`upperLine`&nbsp;and&nbsp;`lowerLine`&nbsp;using&nbsp;th</span><span class="mtk9">e&nbsp;values&nbsp;from&nbsp;the&nbsp;`basisLine`&nbsp;and&nbsp;the&nbsp;`stDev`.</span></span><br><span><span class="mtk33">upperLine</span><span class="mtk1">.</span><span class="mtk15">set_xy1</span><span class="mtk13">(</span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">get_x1</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">get_y1</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">stDev</span><span class="mtk13">)</span></span><br><span><span class="mtk33">upperLine</span><span class="mtk1">.</span><span class="mtk15">set_xy2</span><span class="mtk13">(</span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">get_x2</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">get_y2</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">stDev</span><span class="mtk13">)</span></span><br><span><span class="mtk33">lowerLine</span><span class="mtk1">.</span><span class="mtk15">set_xy1</span><span class="mtk13">(</span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">get_x1</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">get_y1</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">stDev</span><span class="mtk13">)</span></span><br><span><span class="mtk33">lowerLine</span><span class="mtk1">.</span><span class="mtk15">set_xy2</span><span class="mtk13">(</span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">get_x2</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">basisLine</span><span class="mtk1">.</span><span class="mtk15">get_y2</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">stDev</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要了解有关
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线填充</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
类型的更多信息，请参阅</font><a href="/pine-script-docs/concepts/fills"><font style="vertical-align: inherit;">填充页面的</font></a></font><a href="/pine-script-docs/concepts/fills#line-fills"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
部分</font><font style="vertical-align: inherit;">。</font></font><a href="/pine-script-docs/concepts/fills"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<h2 id="boxes" class="md-heading"><a href="#boxes"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盒子</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间中的内置函数</font></font><code dir="auto">box.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建并管理
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对象：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.new
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数创建一个新盒子。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code dir="auto">box.set_*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数修改盒子的属性。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code dir="auto">box.get_*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数从框实例中检索值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.copy
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.copy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数克隆一个盒子实例。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.delete
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数删除一个盒子实例。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.all
</font><font style="vertical-align: inherit;">
变量引用一个只读
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">数组</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_box.all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中包含脚本显示的所有框的 ID。数组的
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size"><font style="vertical-align: inherit;">大小</font></a><font style="vertical-align: inherit;">
取决于</font><font style="vertical-align: inherit;">indicator
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">()</font></a><font style="vertical-align: inherit;">
或
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">strategies()</font></a><font style="vertical-align: inherit;">
声明语句以及脚本绘制的框数。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">max_boxes_count</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一样，用户可以调用</font></font><code dir="auto">box.set_*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、、</font></font><code dir="auto">box.get_*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.copy
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.copy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.delete()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
内置函数作为函数或</font></font><a href="/pine-script-docs/language/methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<h3 id="creating-boxes" class="md-heading"><a href="#creating-boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.new
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数创建一个新的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对象以显示在图表上。它具有以下签名：</font></font></p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text" tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">box.new(top_left, bottom_right, border_color, border_width, border_style, extend, xloc, bgcolor, text, text_size, text_color, text_halign, text_valign, text_wrap, text_font_family, force_overlay) → series box</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">box.new(left, top, right, bottom, border_color, border_width, border_style, extend, xloc, bgcolor, text, text_size, text_color, text_halign, text_valign, text_wrap, text_font_family, force_overlay) → series box</span></div></div></code></pre></figure></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此函数的第一个重载包括</font></font><code dir="auto">top_left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><code dir="auto">bottom_right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，它们
</font><font style="vertical-align: inherit;">
分别接受表示框左上角和右下角的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point对象。该函数从这些</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表点</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制信息以设置框角的坐标。它是否使用和</font><font style="vertical-align: inherit;">点</font><font style="vertical-align: inherit;">的</font></font><code dir="auto">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或字段</font><font style="vertical-align: inherit;">
作为 x 坐标取决于函数的</font><font style="vertical-align: inherit;">值。</font></font><code dir="auto">time</code><font style="vertical-align: inherit;"></font><code dir="auto">top_left</code><font style="vertical-align: inherit;"></font><code dir="auto">bottom_right</code><font style="vertical-align: inherit;"></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个重载指定</font><font style="vertical-align: inherit;">框的</font></font><code dir="auto">left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和边缘。</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">参数接受
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_int"><font style="vertical-align: inherit;">int</font></a><font style="vertical-align: inherit;">
值，指定框的左侧和右侧 x 坐标，这些值可以是条形索引或时间值，具体取决于</font><font style="vertical-align: inherit;">函数调用中的值。</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">参数接受
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_float"><font style="vertical-align: inherit;">浮点</font></a><font style="vertical-align: inherit;">
值，表示框的顶部和底部 y 坐标。</font></font><code dir="auto">bottom</code><font style="vertical-align: inherit;"></font><code dir="auto">left</code><font style="vertical-align: inherit;"></font><code dir="auto">right</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_int"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"></font><code dir="auto">top</code><font style="vertical-align: inherit;"></font><code dir="auto">bottom</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_float"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该函数的附加参数在两个重载中是相同的：</font></font></p>
<p><code dir="auto">border_color</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定框的所有四个边框的颜色。默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.blue"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">color.blue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">border_width</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定边框的宽度（以像素为单位）。其默认值为 1。</font></font></p>
<p><code dir="auto">border_style</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定边框的样式，可以是
</font><font style="vertical-align: inherit;">本页</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#box-styles"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框样式部分中的任意选项。</font></font></a><font style="vertical-align: inherit;"></font></p>
<p><code dir="auto">extend</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定框的边框是否无限延伸到左侧或右侧 x 坐标之外。它接受以下值之一：
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extend.left</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extend.right</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.both"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extend.both</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.none"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extend.none</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
（默认）。</font></font></p>
<p><code dir="auto">xloc</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定框的左边缘和右边缘是否使用条形索引或时间值作为 x 坐标。默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个重载中，</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;">xloc.bar_index</font></a></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
</font><font style="vertical-align: inherit;">
意味着该函数将使用</font><font style="vertical-align: inherit;">和图表点</font><font style="vertical-align: inherit;">的字段
</font><font style="vertical-align: inherit;">，而</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;">xloc.bar_time</font></a><font style="vertical-align: inherit;">的值
</font><font style="vertical-align: inherit;">
意味着它将使用它们的</font><font style="vertical-align: inherit;">字段。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">index</code><font style="vertical-align: inherit;"></font><code dir="auto">top_left</code><font style="vertical-align: inherit;"></font><code dir="auto">bottom_right</code><font style="vertical-align: inherit;"></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">time</code><font style="vertical-align: inherit;"></font></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第二个重载中，使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;">xloc.bar_index</font></a></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
</font><font style="vertical-align: inherit;">
意味着该函数将</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">值视为条形索引，而
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;">xloc.bar_time</font></a><font style="vertical-align: inherit;">
意味着它将它们视为时间戳。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">left</code><font style="vertical-align: inherit;"></font><code dir="auto">right</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当指定的 x 坐标表示</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形索引</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值时，需要注意允许的最小 x 坐标为
</font></font><code dir="auto">bar_index - 9999</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。对于更大的偏移量，可以使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">bgcolor</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定框内空间的背景颜色。默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.blue"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">color.blue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">text</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框内显示的文本。默认情况下，其值为空字符串。</font></font></p>
<p><code dir="auto">text_size</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定框内文本的大小。它接受以下值之一：
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.tiny"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size.tiny</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.small"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size.small</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.normal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size.normal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.large"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size.large</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.huge"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size.huge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size.auto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
（默认）。</font></font></p>
<p><code dir="auto">text_color</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制文本的颜色。其默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.black"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">color.black</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">text_halign</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定文本在框边界内的水平对齐方式。它接受以下之一：
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text.align_left</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text.align_right</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text.align_center</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
（默认）。</font></font></p>
<p><code dir="auto">text_valign</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定文本在框边界内的垂直对齐方式。它接受以下之一：
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text.align_top</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_bottom"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text.align_bottom</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text.align_center</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
（默认）。</font></font></p>
<p><code dir="auto">text_wrap</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定框是否将文本换行。如果其值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.wrap_auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text.wrap_auto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，框将换行以确保文本不会超出其垂直边框。当文本超出底部时，它还会剪切换行的文本。如果其值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.wrap_none"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text.wrap_none</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，框将文本显示在一行上，该行可以超出其边框。默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.wrap_none"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text.wrap_none</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">text_font_family</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义框文本的字体系列。使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_font.family_default"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">font.family_default</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会使用系统默认字体显示框文本。
使用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_font.family_monospace"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">font.family_monospace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会以等宽字体格式显示文本。默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_font.family_default"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">font.family_default</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">force_overlay</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，绘图将显示在主图表窗格中，即使脚本占用单独的窗格也是如此。可选。默认值为</font></font><code dir="auto">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们编写一个简单的脚本来在图表上显示方框。下面的示例绘制了一个方框，将每个条形图的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高值</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_low"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低值</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从当前条形图的水平中心投射到下一个可用条形图的中心。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个条形图上，脚本通过</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now"><font style="vertical-align: inherit;">chart.point.now()</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.from_index"><font style="vertical-align: inherit;">chart.point_from_index()</font></a></font><code dir="auto">topLeft</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建并</font></font><code dir="auto">bottomRight</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向
</font><font style="vertical-align: inherit;">，然后调用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;">box.new()</font></a><font style="vertical-align: inherit;">
构造一个新框并将其显示在图表上。它还使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;">bgcolor()</font></a><font style="vertical-align: inherit;">突出显示未确认的图表条形图上的背景
，以表明它会重新绘制该框，直到条形图最后一次更新：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.from_index"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Boxes-Creating-boxes-1.BfHkiDpJ_2qyzFB.webp" alt="图像" width="1334" height="608" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6pr"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Creating&nbsp;boxes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;top-left&nbsp;corner&nbsp;of&nbsp;the&nbsp;</span><span class="mtk9">box.&nbsp;Contains&nbsp;`index`&nbsp;and&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">topLeft</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;bottom-right&nbsp;corner&nbsp;of&nbsp;</span><span class="mtk9">the&nbsp;box.&nbsp;Does&nbsp;not&nbsp;contain&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">bottomRight</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;box&nbsp;using&nbsp;the&nbsp;`topLeft`&nbsp;and&nbsp;`bottomRight</span><span class="mtk9">`&nbsp;corner&nbsp;points.&nbsp;Uses&nbsp;the&nbsp;`index`&nbsp;fields&nbsp;as&nbsp;x-coor</span><span class="mtk9">dinates.</span></span><br><span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk33">topLeft</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;the&nbsp;background&nbsp;on&nbsp;the&nbsp;unconfirmed&nbsp;bar.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isconfirmed</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Unconfirmed&nbsp;bar&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">点</font></font><code dir="auto">bottomRight</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code dir="auto">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段比</font></font><code dir="auto">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的大一个条</font></font><code dir="auto">topLeft</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果角的 x 坐标相等，则脚本将在每个条的水平中心绘制一条垂直线，类似于本页
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#creating-lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建线条</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分中的示例。</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似</font><font style="vertical-align: inherit;">，如果</font></font><code dir="auto">topLeft</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">bottomRight</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含相同的坐标，则框不会显示在图表上，因为它们之间没有可绘制的空间。但是，其 ID 仍然存在。</font></font></li>
<li><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">由于我们没有在indicator()</font></a><font style="vertical-align: inherit;">
函数调用</font></font><code dir="auto">max_boxes_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中
</font><font style="vertical-align: inherit;">指定，因此该脚本仅显示图表上大约最后 50 个框。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="modifying-boxes" class="md-heading"><a href="#modifying-boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盒子</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间中存在</font><font style="vertical-align: inherit;">多个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setter</font></font></em><font style="vertical-align: inherit;"></font><code dir="auto">box.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，允许脚本修改
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对象的属性：</font></font></p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_top_left_point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_top_left_point()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_bottom_right_point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_bottom_right_point()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别使用来自指定的信息</font><font style="vertical-align: inherit;">
更新框的左上角和右下角坐标
</font></font><code dir="auto">point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_left()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_right()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将框
的左或右 x 坐标设置</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为一个新
</font></font><code dir="auto">left/right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，该值可以是条形索引或时间值，具体取决于框的</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_top()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_bottom"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_bottom()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将框
的顶部或底部 y 坐标设置</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为新
</font></font><code dir="auto">top/bottom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_lefttop"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_lefttop()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置框的</font></font><code dir="auto">left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坐标</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_rightbottom"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_rightbottom()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置其</font></font><code dir="auto">right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">bottom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坐标。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_border_color"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_border_color()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_border_width"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_border_width()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_border_style"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_border_style()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分别更新框边框</font><font style="vertical-align: inherit;">的</font></font><code dir="auto">color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">
。</font></font><code dir="auto">style</code><font style="vertical-align: inherit;"></font><code dir="auto">id</code><font style="vertical-align: inherit;"></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_extend"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_extend()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">extend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置盒子的</font><font style="vertical-align: inherit;">
水平属性</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_bgcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_bgcolor()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将框
内部空间的颜色设置</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为新的</font></font><code dir="auto">color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_text()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_text_size()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_color"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_text_color()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_halign"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_text_halign()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_valign"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_text_valign()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_text_wrap()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_font_family"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_text_font_family()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更新</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框的文本相关属性。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code dir="auto">line.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间中的 setter 函数一样，所有盒子 setter 都会</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接修改盒子而不返回值，并且每个 setter 函数都接受“系列”参数。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，与</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同，</font></font><code dir="auto">box.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间不包含用于修改框的设置函数。</font><font style="vertical-align: inherit;">对于这种情况，</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户必须
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#creating-boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个具有所需设置的新框。</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此示例使用框来可视化用户定义的 上</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成交量</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高的向上和向下条形图的范围
</font></font><code dir="auto">timeframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。当脚本检测到
</font><font style="vertical-align: inherit;">
的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变化</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">timeframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，它会</font><font style="vertical-align: inherit;">
为其</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">变量分配</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新的框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重置其和
</font><font style="vertical-align: inherit;">值，并突出显示图表背景。</font></font><code dir="auto">upBox</code><font style="vertical-align: inherit;"></font><code dir="auto">downBox</code><font style="vertical-align: inherit;"></font><code dir="auto">upVolume</code><font style="vertical-align: inherit;"></font><code dir="auto">downVolume</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当向上或向下条形图的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成交量</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
超过</font></font><code dir="auto">upVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或 时</font></font><code dir="auto">downVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，脚本会更新成交量跟踪变量并调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_top_left_point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_top_left_point()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_bottom_right_point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.set_bottom_right_point()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来更新</font></font><code dir="auto">upBox</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或坐标。设置器使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now"><font style="vertical-align: inherit;">chart.point.now()</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.from_time"><font style="vertical-align: inherit;">chart.point.from_time()</font></a><font style="vertical-align: inherit;">创建的
</font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;">图表点</font></a></font><code dir="auto">downBox</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的信息
</font><font style="vertical-align: inherit;">
将该条形图的
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;">高值</font></a><font style="vertical-align: inherit;">
和</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_low"><font style="vertical-align: inherit;">低值</font></a><font style="vertical-align: inherit;">
从当前时间投射到</font><font style="vertical-align: inherit;">
的</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close"><font style="vertical-align: inherit;">收盘时间</font></a><font style="vertical-align: inherit;">：</font></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.from_time"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_low"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">timeframe</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Boxes-Modifying-boxes-1.Bj141v5c_297ln.webp" alt="图像" width="1330" height="604" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3sc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Modifying&nbsp;boxes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"High&nbsp;volume&nbsp;boxes"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_boxes_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;timeframe&nbsp;of&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeframe</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.timeframe</span><span class="mtk13">(</span><span class="mtk29">"D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Timeframe"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;box&nbsp;projecting&nbsp;the&nbsp;range&nbsp;of&nbsp;the&nbsp;upward&nbsp;bar&nbsp;with</span><span class="mtk9">&nbsp;the&nbsp;highest&nbsp;`volume`&nbsp;over&nbsp;the&nbsp;`timeframe`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">box</span><span class="mtk1">&nbsp;</span><span class="mtk33">upBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;box&nbsp;projecting&nbsp;the&nbsp;range&nbsp;of&nbsp;the&nbsp;downward&nbsp;bar&nbsp;wi</span><span class="mtk9">th&nbsp;the&nbsp;lowest&nbsp;`volume`&nbsp;over&nbsp;the&nbsp;`timeframe`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">box</span><span class="mtk1">&nbsp;</span><span class="mtk33">downBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;highest&nbsp;volume&nbsp;of&nbsp;upward&nbsp;bars&nbsp;over&nbsp;the&nbsp;`timef</span><span class="mtk9">rame`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">upVolume</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;highest&nbsp;volume&nbsp;of&nbsp;downward&nbsp;bars&nbsp;over&nbsp;the&nbsp;`tim</span><span class="mtk9">eframe`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">downVolume</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;variables.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">upBorder</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">upFill</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">downBorder</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">downFill</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;closing&nbsp;time&nbsp;of&nbsp;the&nbsp;`timeframe`.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">time_close</span><span class="mtk13">(</span><span class="mtk33">timeframe</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;a&nbsp;new&nbsp;bar&nbsp;starts&nbsp;on&nbsp;the&nbsp;`timeframe</span><span class="mtk9">`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">changeTF</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">timeframe.change</span><span class="mtk13">(</span><span class="mtk33">timeframe</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;top-left&nbsp;corner&nbsp;of&nbsp;the&nbsp;</span><span class="mtk9">boxes.&nbsp;Contains&nbsp;`index`&nbsp;and&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">topLeft</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;bottom-right&nbsp;corner&nbsp;of&nbsp;</span><span class="mtk9">the&nbsp;boxes.&nbsp;Does&nbsp;not&nbsp;contain&nbsp;`index`&nbsp;information.</span></span><br><span><span class="mtk33">bottomRight</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_time</span><span class="mtk13">(</span><span class="mtk33">closeTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">changeTF</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk11">volume</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;`upVolume`&nbsp;and&nbsp;`downVolume`&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">upVolume</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">downVolume</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;`upBox`&nbsp;using&nbsp;`time`&nbsp;and&nbsp;`price`&nbsp;inf</span><span class="mtk9">o&nbsp;from&nbsp;the&nbsp;`topLeft`&nbsp;and&nbsp;`bottomRight`&nbsp;points.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">upBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk33">topLeft</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">upBorder</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">xloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">upFill</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;`downBox`&nbsp;with&nbsp;`na`&nbsp;coordinates.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">downBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">downBorder</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">xloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">downFill</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;`upVolume`&nbsp;and&nbsp;`downVolume`&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">upVolume</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">downVolume</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;`upBox`&nbsp;with&nbsp;`na`&nbsp;coordinates.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">upBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">upBorder</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">xloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">upFill</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;`downBox`&nbsp;using&nbsp;`time`&nbsp;and&nbsp;`price`&nbsp;i</span><span class="mtk9">nfo&nbsp;from&nbsp;the&nbsp;`topLeft`&nbsp;and&nbsp;`bottomRight`&nbsp;points.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">downBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk33">topLeft</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">downBorder</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">xloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">downFill</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;``upVolume``&nbsp;and&nbsp;change&nbsp;the&nbsp;``upBox`</span><span class="mtk9">`&nbsp;coordinates&nbsp;when&nbsp;volume&nbsp;increases&nbsp;on&nbsp;an&nbsp;upward&nbsp;b</span><span class="mtk9">ar.</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">upVolume</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">upVolume</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.set_top_left_point</span><span class="mtk13">(</span><span class="mtk33">upBox</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">topLeft</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.set_bottom_right_point</span><span class="mtk13">(</span><span class="mtk33">upBox</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;``downVolume``&nbsp;and&nbsp;change&nbsp;the&nbsp;``down</span><span class="mtk9">Box``&nbsp;coordinates&nbsp;when&nbsp;volume&nbsp;increases&nbsp;on&nbsp;a&nbsp;downw</span><span class="mtk9">ard&nbsp;bar.</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">downVolume</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">downVolume</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.set_top_left_point</span><span class="mtk13">(</span><span class="mtk33">downBox</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">topLeft</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.set_bottom_right_point</span><span class="mtk13">(</span><span class="mtk33">downBox</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;when&nbsp;a&nbsp;new&nbsp;`timeframe`</span><span class="mtk9">&nbsp;bar&nbsp;starts.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">changeTF</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Timeframe&nbsp;change&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数调用包含</font></font><code dir="auto">max_boxes_count = 100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着脚本将保留图表上的最后 100 个框。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在此示例中使用了</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;">box.new()</font></a><font style="vertical-align: inherit;">的
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个重载</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。在 的第一个柱状图上</font><font style="vertical-align: inherit;">，脚本在</font><font style="vertical-align: inherit;">柱状图上升时调用第一个重载，在柱状图下降时调用该重载。它使用第二个重载将具有</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;">na</font></a><font style="vertical-align: inherit;">值的新框分配
</font><font style="vertical-align: inherit;">
给该柱状图上的另一个框变量。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">timeframe</code><font style="vertical-align: inherit;"></font><code dir="auto">upBox</code><font style="vertical-align: inherit;"></font><code dir="auto">downBox</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="box-styles" class="md-heading"><a href="#box-styles"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盒子</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">样式</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;">用户可以在他们的box.new()</font></a><font style="vertical-align: inherit;">
或
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_border_style"><font style="vertical-align: inherit;">box.set_border_style()</font></a></font><code dir="auto">line.style_*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数调用中
</font><font style="vertical-align: inherit;">包含以下变量之一</font><font style="vertical-align: inherit;">
来设置其脚本绘制的框的边框样式：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_border_style"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<hr>





















<table><thead><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">争论</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盒子</font></font></th></tr></thead><tbody><tr><td><code dir="auto">line.style_solid</code></td><td><img src="/pine-script-docs/_astro/box.style_solid.DpZnFQGZ_2oQNCW.webp" alt="盒子样式实心" width="125" height="88" loading="lazy" decoding="async"></td></tr><tr><td><code dir="auto">line.style_dotted</code></td><td><img src="/pine-script-docs/_astro/box.style_dotted.DQk4-fDM_Z23lye8.webp" alt="box_style_dotted" width="125" height="88" loading="lazy" decoding="async"></td></tr><tr><td><code dir="auto">line.style_dashed</code></td><td><img src="/pine-script-docs/_astro/box.style_dashed.BezJLOhC_Z1FMPte.webp" alt="盒子样式_虚线" width="125" height="88" loading="lazy" decoding="async"></td></tr></tbody></table>
<h3 id="reading-box-values" class="md-heading"><a href="#reading-box-values"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取框</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名</font></font><code dir="auto">box.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空间具有</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getter</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，允许脚本从框实例中检索坐标值：</font></font></p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.get_left()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.get_right()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分别获取框左边缘和右边缘的 x 坐标</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。返回的值是否表示条形索引或时间值取决于框的</font></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font></font></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.get_top()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_bottom"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.get_bottom()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分别获取框的顶部和底部 y 坐标</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例绘制了方框，以可视化一段时间内的假设价格范围</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在每个新周期开始时，它使用平均蜡烛范围乘以输入来计算以</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2"><font style="vertical-align: inherit;">hl2</font></a><font style="vertical-align: inherit;">
价格为中心且高度为</font></font><code dir="auto">scaleFactor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的方框的角点
</font><font style="vertical-align: inherit;">。绘制第一个方框后，它会在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for"><font style="vertical-align: inherit;">for</font></a><font style="vertical-align: inherit;">循环内创建新的方框
</font><font style="vertical-align: inherit;">
。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">initialRange</code><font style="vertical-align: inherit;"></font><code dir="auto">numberOfBoxes - 1</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每次循环迭代中，脚本</font></font><code dir="auto">lastBoxDrawn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过
</font><font style="vertical-align: inherit;">
从只读
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_box.all"><font style="vertical-align: inherit;">box.all数组中检索</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个元素来获取
，然后调用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top"><font style="vertical-align: inherit;">box.get_top()</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_bottom"><font style="vertical-align: inherit;">box.get_bottom()</font></a><font style="vertical-align: inherit;">
来获取其 y 坐标。它使用这些值来计算比前一个框高 10 倍的新框的坐标</font><font style="vertical-align: inherit;">：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_box.all"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_bottom"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">scaleFactor</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Boxes-Reading-box-values-1.BjHiyYzc_1hj7GF.webp" alt="图像" width="1332" height="608" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="hw"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Reading&nbsp;box&nbsp;values&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Nested&nbsp;boxes"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_boxes_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;range&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;nested&nbsp;boxes&nbsp;drawn&nbsp;on&nbsp;each&nbsp;period.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfBoxes</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Nested&nbsp;box&nbsp;count"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;scale&nbsp;factor&nbsp;applied&nbsp;to&nbsp;each&nbsp;box.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">scaleFactor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Scale&nbsp;factor"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;initial&nbsp;box&nbsp;range.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">initialRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">scaleFactor</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;top-left&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;initial&nbsp;box.&nbsp;D</span><span class="mtk9">oes&nbsp;not&nbsp;contain&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">topLeft</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">initialRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;bottom-right&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;initial&nbsp;bo</span><span class="mtk9">x.&nbsp;Does&nbsp;not&nbsp;contain&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">initialRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;border&nbsp;and&nbsp;fill&nbsp;colors&nbsp;of&nbsp;the&nbsp;boxes.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">borderColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk16">math.random</span><span class="mtk13">(</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">255</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.random</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.random</span><span class="mtk13">(</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">255</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk33">borderColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">/</span><span class="mtk33">numberOfBoxes</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;box&nbsp;using&nbsp;the&nbsp;`topLeft`&nbsp;and&nbsp;`bottomR</span><span class="mtk9">ight`&nbsp;points.&nbsp;Uses&nbsp;their&nbsp;`index`&nbsp;fields&nbsp;as&nbsp;x-coord</span><span class="mtk9">inates.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk33">topLeft</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">borderColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfBoxes</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Loop&nbsp;to&nbsp;create&nbsp;additional&nbsp;boxes.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfBoxes</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;last&nbsp;box&nbsp;drawn&nbsp;by&nbsp;the&nbsp;script.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">box</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastBoxDrawn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">box.all</span><span class="mtk1">.</span><span class="mtk15">last</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;top&nbsp;price&nbsp;of&nbsp;the&nbsp;last&nbsp;box.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">top</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.get_top</span><span class="mtk13">(</span><span class="mtk33">lastBoxDrawn</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;bottom&nbsp;price&nbsp;of&nbsp;the&nbsp;last&nbsp;box.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottom</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.get_bottom</span><span class="mtk13">(</span><span class="mtk33">lastBoxDrawn</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;scaled&nbsp;range&nbsp;of&nbsp;the&nbsp;new&nbsp;box.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">newRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">scaleFactor</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">top</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottom</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.5</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;`price`&nbsp;fields&nbsp;of&nbsp;the&nbsp;`topLeft`&nbsp;and&nbsp;</span><span class="mtk9">`bottomRight`&nbsp;points.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;This&nbsp;does&nbsp;not&nbsp;affect&nbsp;the&nbsp;coordinates&nbsp;of&nbsp;previou</span><span class="mtk9">s&nbsp;boxes.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">topLeft</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">newRange</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">newRange</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;box&nbsp;using&nbsp;the&nbsp;updated&nbsp;`topLeft`&nbsp;and&nbsp;</span><span class="mtk9">`bottomRight`&nbsp;points.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk33">topLeft</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">borderColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数调用使用</font></font><code dir="auto">max_boxes_count = 500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着脚本可以在图表上显示最多 500 个框。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每幅画都有一个</font></font><code dir="auto">right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条，索引条超出</font></font><code dir="auto">left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
索引范围。由于这些画的 x 坐标最多可以延伸到 500 个条，因此我们将输入</font></font><code dir="auto">maxval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
设置</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 500。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个新时期，脚本都会使用随机的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.rgb"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">color.rgb()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值作为</font><font style="vertical-align: inherit;">框的</font></font><code dir="auto">border_color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和。</font></font><code dir="auto">bgcolor</code><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用都会从
分配给</font><font style="vertical-align: inherit;">和变量的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象
中复制坐标
</font><font style="vertical-align: inherit;">，这就是为什么脚本可以</font><font style="vertical-align: inherit;">在每次循环迭代中修改它们的字段而不影响其他框的原因。</font></font><code dir="auto">topLeft</code><font style="vertical-align: inherit;"></font><code dir="auto">bottomRight</code><font style="vertical-align: inherit;"></font><code dir="auto">price</code><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="cloning-boxes" class="md-heading"><a href="#cloning-boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克隆</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盒</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要克隆特定框</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.copy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.copy()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此函数复制框及其属性。对复制框的任何更改都不会影响原始框。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本</font></font><code dir="auto">originalBox</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个柱上声明一个变量，并</font><font style="vertical-align: inherit;">
每隔一个</font><font style="vertical-align: inherit;">柱
为其分配一个</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新框。在其他柱上，它使用</font></font></a><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.copy"><font style="vertical-align: inherit;">box.copy()</font></a><font style="vertical-align: inherit;">
创建一个</font><font style="vertical-align: inherit;">并调用</font><font style="vertical-align: inherit;">函数来
</font><a href="/pine-script-docs/concepts/lines-and-boxes#modifying-boxes"><font style="vertical-align: inherit;">修改</font></a><font style="vertical-align: inherit;">其属性。如下图所示，这些更改不会修改</font><font style="vertical-align: inherit;">：</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.copy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">copiedBox</code><font style="vertical-align: inherit;"></font><code dir="auto">box.set_*()</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/lines-and-boxes#modifying-boxes"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">originalBox</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Boxes-Cloning-boxes-1.C3LhZvV5_2sfgJn.webp" alt="图像" width="1334" height="604" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5i0"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Cloning&nbsp;boxes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_boxes_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;between&nbsp;each&nbsp;new&nbsp;mainLine&nbsp;assi</span><span class="mtk9">gnment.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;top-left&nbsp;of&nbsp;the&nbsp;`origin</span><span class="mtk9">alBox`.&nbsp;Contains&nbsp;`time`&nbsp;and&nbsp;`index`&nbsp;information.</span></span><br><span><span class="mtk33">topLeft</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;bottom-right&nbsp;of&nbsp;the&nbsp;`or</span><span class="mtk9">iginalBox`.&nbsp;Does&nbsp;not&nbsp;contain&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk33">bottomRight</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;new&nbsp;box&nbsp;with&nbsp;`topLeft`&nbsp;and&nbsp;`bottomRight`&nbsp;corner</span><span class="mtk9">s&nbsp;on&nbsp;every&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">box</span><span class="mtk1">&nbsp;</span><span class="mtk33">originalBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;teal&nbsp;when&nbsp;the&nbsp;bar&nbsp;is&nbsp;rising,&nbsp;maroon&nbsp;when&nbsp;it's&nbsp;</span><span class="mtk9">falling.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">originalColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;a&nbsp;new&nbsp;box&nbsp;using&nbsp;the&nbsp;`topLeft`&nbsp;and&nbsp;`botto</span><span class="mtk9">mRight`&nbsp;info&nbsp;to&nbsp;the&nbsp;`originalBox`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;This&nbsp;box&nbsp;uses&nbsp;the&nbsp;`index`&nbsp;fields&nbsp;from&nbsp;the&nbsp;point</span><span class="mtk9">s&nbsp;as&nbsp;x-coordinates.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">originalBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk33">topLeft</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">originalColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk33">originalColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">))</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;clone&nbsp;of&nbsp;the&nbsp;`originalBox`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">box</span><span class="mtk1">&nbsp;</span><span class="mtk33">copiedBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.copy</span><span class="mtk13">(</span><span class="mtk33">originalBox</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Modify&nbsp;the&nbsp;`copiedBox`.&nbsp;These&nbsp;changes&nbsp;do&nbsp;not&nbsp;af</span><span class="mtk9">fect&nbsp;the&nbsp;`originalBox`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.set_top</span><span class="mtk13">(</span><span class="mtk33">copiedBox</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.set_bottom_right_point</span><span class="mtk13">(</span><span class="mtk33">copiedBox</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bottomRight</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.set_border_color</span><span class="mtk13">(</span><span class="mtk33">copiedBox</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.set_border_width</span><span class="mtk13">(</span><span class="mtk33">copiedBox</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.set_bgcolor</span><span class="mtk13">(</span><span class="mtk33">copiedBox</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="deleting-boxes" class="md-heading"><a href="#deleting-boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要删除脚本绘制的框，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.delete()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。与</font></font><code dir="auto">*.delete()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他绘图命名空间中的函数一样，此函数对于有条件地删除框或在图表上保留特定数量的框非常方便。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例显示代表周期性累积成交量值的框。脚本每条
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#creating-boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个新的框 ID 并将其存储在</font></font><code dir="auto">boxes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组
中</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组的大小</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
超出指定的值</font></font><code dir="auto">numberOfBoxes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，脚本将使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array.shift()从数组中删除最旧的框，并使用</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.delete()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将其删除
</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其他柱状图上，它
通过</font><a href="/pine-script-docs/concepts/lines-and-boxes#modifying-boxes"><font style="vertical-align: inherit;">修改</font></a><font style="vertical-align: inherit;">数组
中</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.last"><font style="vertical-align: inherit;">最后一个</font></a><font style="vertical-align: inherit;">框的
</font><font style="vertical-align: inherit;">来累积</font><font style="vertical-align: inherit;">
每个周期
的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易量</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。然后，脚本使用
</font><a href="/pine-script-docs/language/loops#for"><font style="vertical-align: inherit;">for 循环</font></a><font style="vertical-align: inherit;">查找
</font><font style="vertical-align: inherit;">数组所有框的 ，并</font><font style="vertical-align: inherit;">
根据其
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top"><font style="vertical-align: inherit;">box.get_top()</font></a><font style="vertical-align: inherit;">
值相对于 ，将</font><font style="vertical-align: inherit;">每个框的设置为</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.from_gradient"><font style="vertical-align: inherit;">渐变色</font></a><font style="vertical-align: inherit;">：</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#modifying-boxes"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">top</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.last"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">boxes</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/loops#for"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">highestTop</code><font style="vertical-align: inherit;"></font><code dir="auto">bgcolor</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.from_gradient"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">highestTop</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Boxes-Deleting-boxes-1.CnAZt6YV_ZXP4os.webp" alt="图像" width="1326" height="608" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2k4"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;boxes&nbsp;to&nbsp;show&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18 mtkb">const</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">MAX_BOXES_COUNT</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span></span><br><span><span></span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Deleting&nbsp;boxes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Cumulative&nbsp;volume&nbsp;boxes"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">format</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">format.volume</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_boxes_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">MAX_BOXES_COUNT</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;each&nbsp;period.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;volume&nbsp;boxes&nbsp;in&nbsp;the&nbsp;calcula</span><span class="mtk9">tion.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfBoxes</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Number&nbsp;of&nbsp;boxes"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">MAX_BOXES_COUNT</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;containing&nbsp;the&nbsp;ID&nbsp;of&nbsp;each&nbsp;box&nbsp;displayed&nbsp;</span><span class="mtk9">by&nbsp;the&nbsp;script.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">boxes</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">box</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Push&nbsp;a&nbsp;new&nbsp;box&nbsp;into&nbsp;the&nbsp;`boxes`&nbsp;array.&nbsp;The&nbsp;box&nbsp;</span><span class="mtk9">has&nbsp;the&nbsp;default&nbsp;`xloc.bar_index`&nbsp;property.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">boxes</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">#000000</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">#000000</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Shift&nbsp;the&nbsp;oldest&nbsp;box&nbsp;out&nbsp;of&nbsp;the&nbsp;array&nbsp;and&nbsp;delet</span><span class="mtk9">e&nbsp;it&nbsp;when&nbsp;the&nbsp;array's&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;`numberOfBo</span><span class="mtk9">xes`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">boxes</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfBoxes</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">box.delete</span><span class="mtk13">(</span><span class="mtk33">boxes</span><span class="mtk1">.</span><span class="mtk15">shift</span><span class="mtk13">())</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;last&nbsp;box&nbsp;drawn&nbsp;by&nbsp;the&nbsp;script&nbsp;as&nbsp;of&nbsp;the&nbsp;curren</span><span class="mtk9">t&nbsp;chart&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">box</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">boxes</span><span class="mtk1">.</span><span class="mtk15">last</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;current&nbsp;bar's&nbsp;volume&nbsp;to&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;</span><span class="mtk9">`lastBox`&nbsp;and&nbsp;update&nbsp;the&nbsp;`right`&nbsp;index.</span></span><br><span><span class="mtk33">lastBox</span><span class="mtk1">.</span><span class="mtk15">set_top</span><span class="mtk13">(</span><span class="mtk33">lastBox</span><span class="mtk1">.</span><span class="mtk15">get_top</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span><span class="mtk13">)</span></span><br><span><span class="mtk33">lastBox</span><span class="mtk1">.</span><span class="mtk15">set_right</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;`lastBox`&nbsp;as&nbsp;volume-form</span><span class="mtk9">atted&nbsp;text.</span></span><br><span><span class="mtk33">lastBox</span><span class="mtk1">.</span><span class="mtk15">set_text</span><span class="mtk13">(</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">lastBox</span><span class="mtk1">.</span><span class="mtk15">get_top</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">format.volume</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;highest&nbsp;`top`&nbsp;of&nbsp;all&nbsp;boxes&nbsp;in&nbsp;the&nbsp;`boxes`&nbsp;arr</span><span class="mtk9">ay.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestTop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">id</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">boxes</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">highestTop</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">id</span><span class="mtk1">.</span><span class="mtk15">get_top</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestTop</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`bgcolor`&nbsp;of&nbsp;each&nbsp;`id`&nbsp;in&nbsp;`boxes`&nbsp;with&nbsp;</span><span class="mtk9">a&nbsp;gradient&nbsp;based&nbsp;on&nbsp;the&nbsp;ratio&nbsp;of&nbsp;its&nbsp;`top`&nbsp;to&nbsp;the&nbsp;</span><span class="mtk9">`highestTop`.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">id</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">boxes</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">id</span><span class="mtk1">.</span><span class="mtk15">set_bgcolor</span><span class="mtk13">(</span><span class="mtk16">color.from_gradient</span><span class="mtk13">(</span><span class="mtk33">id</span><span class="mtk1">.</span><span class="mtk15">get_top</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestTop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在代码顶部，我们声明了一个</font></font><code dir="auto">MAX_BOXES_COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
具有“const int”</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限定类型</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的变量。我们将此值用作</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">indicator()</font></a></font><code dir="auto">max_boxes_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数中的
值</font><font style="vertical-align: inherit;">
和输入的最大可能值</font><font style="vertical-align: inherit;">
。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">numberOfBoxes</code><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本使用了box.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的第二次重载
</font><font style="vertical-align: inherit;">
，它分别指定盒子的</font></font><code dir="auto">left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><code dir="auto">bottom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坐标。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">indicator()</font></a><font style="vertical-align: inherit;">调用中包含了
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_format.volume"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format.volume</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为参数</font><font style="vertical-align: inherit;">
，它告诉脚本图表窗格的 y 轴代表</font><em><font style="vertical-align: inherit;">成交量值。每个框还将其</font></em><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top"><font style="vertical-align: inherit;">顶部</font></a><font style="vertical-align: inherit;">值显示
</font><font style="vertical-align: inherit;">
为
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_format.volume"><font style="vertical-align: inherit;">成交量格式的</font></a><font style="vertical-align: inherit;">
文本。</font></font><code dir="auto">format</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_format.volume"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h2 id="polylines" class="md-heading"><a href="#polylines"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 折线是一种</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图，它
使用直线或</font><em><font style="vertical-align: inherit;">曲线</font></em><font style="vertical-align: inherit;">段按顺序连接</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point实例</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中
</font><font style="vertical-align: inherit;">的坐标
。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些强大的绘图功能可以连接图表上任何可用位置的多达 10,000 个点，允许脚本绘制自定义系列、多边形和其他复杂的几何形状，而这些形状使用线条</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对象</font><font style="vertical-align: inherit;">很难或不可能绘制
。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间具有以下用于创建和管理</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;">折线</font></a></font><code dir="auto">polyline.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象的内置功能
</font><font style="vertical-align: inherit;">
：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.new
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数创建一个新的折线实例。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.delete
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数删除现有的折线实例。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.all
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_polyline.all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
引用一个只读
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中包含脚本显示的所有折线的 ID。数组的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
取决于</font></font><code dir="auto">max_polylines_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strategies()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
声明语句以及脚本绘制的折线数量。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同</font><font style="vertical-align: inherit;">，折线没有修改或读取其属性的功能。若要在图表上重新绘制折线，可以</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现有实例并</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有所需更改的新折线。</font></font></p>
<h3 id="creating-polylines" class="md-heading"><a href="#creating-polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.new
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数创建一个新的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实例以显示在图表上。 它具有以下签名：</font></font></p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text" tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">polyline.new(points, curved, closed, xloc, line_color, fill_color, line_style, line_width, force_overlay) → series polyline</span></div></div></code></pre></figure></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下八个参数影响折线绘制的行为：</font></font></p>
<p><code dir="auto">points</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a><font style="vertical-align: inherit;">
对象
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，这些对象确定折线中每个点的坐标。绘图按顺序连接数组中每个元素的坐标
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">，</font></a><font style="vertical-align: inherit;">
从</font><em><font style="vertical-align: inherit;">第一个</font></em><font style="vertical-align: inherit;">开始。折线是否使用</font><font style="vertical-align: inherit;">每个
</font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;">图表点</font></a><font style="vertical-align: inherit;">的或字段</font><font style="vertical-align: inherit;">作为其 x 坐标取决于</font><font style="vertical-align: inherit;">函数调用中的值。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code dir="auto">index</code><font style="vertical-align: inherit;"></font><code dir="auto">time</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">xloc</code><font style="vertical-align: inherit;"></font></p>
<p><code dir="auto">curved</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定绘图是否使用曲线段连接
数组</font><font style="vertical-align: inherit;">
中的每个</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。默认值为</font></font><code dir="auto">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，表示使用直线段。</font></font></p>
<p><code dir="auto">closed</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制折线是否将
数组</font><font style="vertical-align: inherit;">
中的最后一个</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到第一个，形成</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">闭合折线</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。默认值为</font></font><code dir="auto">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">xloc</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定
折线使用数组</font><font style="vertical-align: inherit;">
中每个</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的哪个字段作为其 x 坐标。当其值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，该函数使用这些</font></font><code dir="auto">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段来创建折线。当其值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，该函数使用这些</font></font><code dir="auto">time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段。默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">line_color</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定折线图中所有线段的颜色。默认值为</font></font><code dir="auto">color.blue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">fill_color</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制折线绘制填充的封闭空间的颜色。其默认值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">line_style</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定折线的样式，可以是
</font><font style="vertical-align: inherit;">本页
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#line-styles"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条样式部分中的任何可用选项。默认值为</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_line.style_solid"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line.style_solid</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code dir="auto">line_width</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定折线的宽度（以像素为单位）。默认值为 1。</font></font></p>
<p><code dir="auto">force_overlay</code></p>
<p class="spacer-wrapper"><spacer></spacer><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，绘图将显示在主图表窗格中，即使脚本占用单独的窗格也是如此。可选。默认值为</font></font><code dir="auto">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本演示了在图表上绘制折线的简单示例。它将
一个</font><font style="vertical-align: inherit;">
具有交替值的</font><font style="vertical-align: inherit;">
新
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推送到</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组中，并在每个条形中使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;">bgcolor()</font></a><font style="vertical-align: inherit;">为背景着色
</font><font style="vertical-align: inherit;">
一次</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">price</code><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islastconfirmedhistory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后确认的历史柱上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，脚本在图表上绘制一条新的折线，连接
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">数组</font></a><font style="vertical-align: inherit;">中
每个</font></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表点</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的坐标，从第一个开始：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Polylines-Creating-polylines-1.trunruUb_1O2zpI.webp" alt="图像" width="1348" height="552" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4yv"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Creating&nbsp;polylines&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Oscillating&nbsp;polyline"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;between&nbsp;each&nbsp;point&nbsp;in&nbsp;the&nbsp;draw</span><span class="mtk9">ing.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length&nbsp;between&nbsp;points"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;`chart.point`&nbsp;objects&nbsp;to&nbsp;sequentially</span><span class="mtk9">&nbsp;connect&nbsp;with&nbsp;a&nbsp;polyline.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">points</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;y-coordinate&nbsp;of&nbsp;each&nbsp;point&nbsp;in&nbsp;the&nbsp;`points`.&nbsp;A</span><span class="mtk9">lternates&nbsp;between&nbsp;1&nbsp;and&nbsp;-1&nbsp;on&nbsp;each&nbsp;`newPoint`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">yValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;once&nbsp;every&nbsp;`length`&nbsp;bars,&nbsp;`false`&nbsp;other</span><span class="mtk9">wise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPoint</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Push&nbsp;a&nbsp;new&nbsp;`chart.point`&nbsp;into&nbsp;the&nbsp;`points`.&nbsp;The</span><span class="mtk9">&nbsp;new&nbsp;point&nbsp;contains&nbsp;`time`&nbsp;and&nbsp;`index`&nbsp;info.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">points</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk33">yValue</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Change&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;`yValue`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">yValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">*=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;`polyline`&nbsp;on&nbsp;the&nbsp;last&nbsp;confirmed&nbsp;his</span><span class="mtk9">torical&nbsp;chart&nbsp;bar.</span></span><br><span><span class="mtk9">//&nbsp;The&nbsp;polyline&nbsp;uses&nbsp;the&nbsp;`time`&nbsp;field&nbsp;from&nbsp;each&nbsp;`c</span><span class="mtk9">hart.point`&nbsp;in&nbsp;the&nbsp;`points`&nbsp;array&nbsp;as&nbsp;x-coordinates</span><span class="mtk9">.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">polyline.new</span><span class="mtk13">(</span><span class="mtk33">points</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">xloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">#9151A6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart&nbsp;background&nbsp;on&nbsp;every&nbsp;`newPoi</span><span class="mtk9">nt`&nbsp;condition.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">newPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"New&nbsp;point&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本仅使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一条折线将</font></font></em><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">数组</font></a><font style="vertical-align: inherit;">中的
每个</font></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表点</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与直线段</font><font style="vertical-align: inherit;">连接起来
，并且该绘图从第一个条开始跨越整个可用的图表数据。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然可以使用线条</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现类似的效果
</font><font style="vertical-align: inherit;">，但这样做需要
</font><font style="vertical-align: inherit;">
在每次出现该条件时创建一个新的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">newPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例，并且这种绘制最多只能包含 500 条线段。另一方面，这种单一未封闭折线绘制最多可以包含 9,999 条线段。</font></font></li>
</ul>
<h4 id="curved-drawings" class="md-heading"><a href="#curved-drawings"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">曲线</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线可以绘制出</font><font style="vertical-align: inherit;">无法用</font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;">线</font></a><font style="vertical-align: inherit;">或
</font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;">框生成的</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">曲线</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。启用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;">polyline.new()</font></a><font style="vertical-align: inherit;">函数的参数
时</font><font style="vertical-align: inherit;">
，生成的折线会</font><font style="vertical-align: inherit;">
在其
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">数组中每个</font></a><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a><font style="vertical-align: inherit;">的坐标之间
插入</font><em><font style="vertical-align: inherit;">非线性</font></em><font style="vertical-align: inherit;">值
，以</font><font style="vertical-align: inherit;">生成曲线效果。</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">curved</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们上例中的“振荡折线”脚本使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直线</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段来生成类似于三角波的图形，即在波峰和波谷之间呈之字形的波形。如果我们将该示例中的</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;">polyline.new()</font></a><font style="vertical-align: inherit;">
调用中的</font></font><code dir="auto">curved</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数
设置为 ，则生成的图形将使用</font><em><font style="vertical-align: inherit;">曲线</font></em><font style="vertical-align: inherit;">段连接点</font><font style="vertical-align: inherit;">，从而生成类似于正弦波的平滑非线性形状：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Polylines-Creating-polylines-Curved-drawings-1.BWGXS3tj_10tSGQ.webp" alt="图像" width="1348" height="552" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="76p"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Curved&nbsp;drawings&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Smooth&nbsp;oscillating&nbsp;polyline"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;between&nbsp;each&nbsp;point&nbsp;in&nbsp;the&nbsp;draw</span><span class="mtk9">ing.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length&nbsp;between&nbsp;points"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;`chart.point`&nbsp;objects&nbsp;to&nbsp;sequentially</span><span class="mtk9">&nbsp;connect&nbsp;with&nbsp;a&nbsp;polyline.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">points</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;y-coordinate&nbsp;of&nbsp;each&nbsp;point&nbsp;in&nbsp;the&nbsp;`points`.&nbsp;A</span><span class="mtk9">lternates&nbsp;between&nbsp;1&nbsp;and&nbsp;-1&nbsp;on&nbsp;each&nbsp;`newPoint`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">yValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;once&nbsp;every&nbsp;`length`&nbsp;bars,&nbsp;`false`&nbsp;other</span><span class="mtk9">wise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPoint</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Push&nbsp;a&nbsp;new&nbsp;`chart.point`&nbsp;into&nbsp;the&nbsp;`points`.&nbsp;The</span><span class="mtk9">&nbsp;new&nbsp;point&nbsp;contains&nbsp;`time`&nbsp;and&nbsp;`index`&nbsp;info.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">points</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk33">yValue</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Change&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;`yValue`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">yValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">*=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;curved&nbsp;`polyline`&nbsp;on&nbsp;the&nbsp;last&nbsp;confir</span><span class="mtk9">med&nbsp;historical&nbsp;chart&nbsp;bar.</span></span><br><span><span class="mtk9">//&nbsp;The&nbsp;polyline&nbsp;uses&nbsp;the&nbsp;`time`&nbsp;field&nbsp;from&nbsp;each&nbsp;`c</span><span class="mtk9">hart.point`&nbsp;in&nbsp;the&nbsp;`points`&nbsp;array&nbsp;as&nbsp;x-coordinates</span><span class="mtk9">.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">polyline.new</span><span class="mtk13">(</span><span class="mtk33">points</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">curved</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">xloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">#9151A6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart&nbsp;background&nbsp;on&nbsp;every&nbsp;`newPoi</span><span class="mtk9">nt`&nbsp;condition.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">newPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"New&nbsp;point&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，在此示例中，平滑曲线具有相对一致的行为，并且绘图的任何部分都不会超出其定义的坐标，而绘制弯曲折线时并非总是如此。用于构造折线的数据会严重影响其在其点之间插入的平滑分段函数。在某些情况下，插值曲线</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超出其实际坐标。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们
</font><font style="vertical-align: inherit;">在示例数组中添加一些</font></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表点</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的变化来演示此行为。在下面的版本中，脚本</font><font style="vertical-align: inherit;">
在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now"><font style="vertical-align: inherit;">chart.point.now()</font></a></font><code dir="auto">yValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中将 乘以一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值
。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了直观地展示这一行为，此脚本还在
数组</font><font style="vertical-align: inherit;">
中</font><font style="vertical-align: inherit;">每个
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a><font style="vertical-align: inherit;">的值
处创建一条</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水平线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并显示另一条用直线段连接相同点的折线。正如我们在图表上看到的，两条折线都经过数组中的所有坐标</font><font style="vertical-align: inherit;">。但是，弯曲的折线偶尔会</font><em><font style="vertical-align: inherit;">超出</font></em><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;">水平线</font></a><font style="vertical-align: inherit;">指示的垂直边界
</font><font style="vertical-align: inherit;">，而使用直线段绘制的折线则不会：</font></font><code dir="auto">price</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Polylines-Creating-polylines-Curved-drawings-2.Bh30lTw9_2uiiOc.webp" alt="图像" width="1348" height="552" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="50v"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Curved&nbsp;drawings&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Random&nbsp;oscillating&nbsp;polylines"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;between&nbsp;each&nbsp;point&nbsp;in&nbsp;the&nbsp;draw</span><span class="mtk9">ing.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length&nbsp;between&nbsp;points"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;`chart.point`&nbsp;objects&nbsp;to&nbsp;sequentially</span><span class="mtk9">&nbsp;connect&nbsp;with&nbsp;a&nbsp;polyline.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">points</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;sign&nbsp;of&nbsp;each&nbsp;`price`&nbsp;in&nbsp;the&nbsp;`points`.&nbsp;Alterna</span><span class="mtk9">tes&nbsp;between&nbsp;1&nbsp;and&nbsp;-1&nbsp;on&nbsp;each&nbsp;`newPoint`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">yValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;once&nbsp;every&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPoint</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Push&nbsp;a&nbsp;new&nbsp;`chart.point`&nbsp;with&nbsp;a&nbsp;randomized&nbsp;`pri</span><span class="mtk9">ce`&nbsp;into&nbsp;the&nbsp;`points`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;The&nbsp;new&nbsp;point&nbsp;contains&nbsp;`time`&nbsp;and&nbsp;`index`&nbsp;info.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">points</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk33">yValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.random</span><span class="mtk13">()))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Change&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;`yValue`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">yValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">*=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;newest&nbsp;`chart.point`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">lastPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">points</span><span class="mtk1">.</span><span class="mtk15">last</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;horizontal&nbsp;line&nbsp;at&nbsp;the&nbsp;`lastPoint.price`</span><span class="mtk9">.&nbsp;This&nbsp;line&nbsp;uses&nbsp;the&nbsp;default&nbsp;`xloc.bar_index`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">lastPoint</span><span class="mtk1">.</span><span class="mtk33">index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastPoint</span><span class="mtk1">.</span><span class="mtk33">index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;two&nbsp;`polyline`&nbsp;instances&nbsp;on&nbsp;the&nbsp;last&nbsp;confi</span><span class="mtk9">rmed&nbsp;chart&nbsp;bar.</span></span><br><span><span class="mtk9">//&nbsp;Both&nbsp;polylines&nbsp;use&nbsp;the&nbsp;`time`&nbsp;field&nbsp;from&nbsp;each&nbsp;`</span><span class="mtk9">chart.point`&nbsp;in&nbsp;the&nbsp;`points`&nbsp;array&nbsp;as&nbsp;x-coordinate</span><span class="mtk9">s.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">polyline.new</span><span class="mtk13">(</span><span class="mtk33">points</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">curved</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">xloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">#EB8A3B</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">polyline.new</span><span class="mtk13">(</span><span class="mtk33">points</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">curved</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">xloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">#9151A6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart&nbsp;background&nbsp;on&nbsp;every&nbsp;`newPoi</span><span class="mtk9">nt`&nbsp;condition.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">newPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"New&nbsp;point&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<h4 id="closed-shapes" class="md-heading"><a href="#closed-shapes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">封闭</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形状</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于单条折线可以包含多条直线或曲线段，并且参数</font></font><code dir="auto">closed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许绘图连接其数组中第一个和最后一个
</font><font style="vertical-align: inherit;">
chart.point 的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坐标</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用折线绘制许多不同类型的封闭多边形。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们在 Pine 中绘制一些多边形。以下脚本定期绘制以
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hl2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价格值为中心的随机多边形。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次出现该</font></font><code dir="auto">newPolygon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件时，它
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.clear"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都会清除</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数组</font></font><code dir="auto">points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">
根据
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random"><font style="vertical-align: inherit;">math.random()</font></a></font><code dir="auto">numberOfSides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值计算新多边形的和</font><font style="vertical-align: inherit;">
，然后使用</font><a href="/pine-script-docs/language/loops#for"><font style="vertical-align: inherit;">for 循环</font></a><font style="vertical-align: inherit;">将</font><font style="vertical-align: inherit;">新的
</font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;">图表点推送到</font></a><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">数组</font></a><font style="vertical-align: inherit;">中
，这些点包含具有</font><font style="vertical-align: inherit;">
和半轴</font><font style="vertical-align: inherit;">
的椭圆路径的阶梯坐标。该脚本通过</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">带有直线段的</font><em><font style="vertical-align: inherit;">闭合折线</font></em><font style="vertical-align: inherit;">连接数组
中的每个</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a><font style="vertical-align: inherit;">来绘制多边形
：</font></font><code dir="auto">rotationOffset</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/loops#for"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">numberOfSides</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">xScale</code><font style="vertical-align: inherit;"></font><code dir="auto">yScale</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Polylines-Creating-polylines-Closed-shapes-1.DX7VAEme_ZOQPTt.webp" alt="图像" width="1332" height="612" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="7o9"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Closed&nbsp;shapes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"N-sided&nbsp;polygons"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;size&nbsp;of&nbsp;the&nbsp;horizontal&nbsp;semi-axis.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">xScale</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">3.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"X&nbsp;scale"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;size&nbsp;of&nbsp;the&nbsp;vertical&nbsp;semi-axis.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">yScale</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Y&nbsp;scale"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.atr</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;`chart.point`&nbsp;objects&nbsp;containing&nbsp;vert</span><span class="mtk9">ex&nbsp;coordinates.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">points</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;condition&nbsp;that&nbsp;triggers&nbsp;a&nbsp;new&nbsp;polygon&nbsp;drawing</span><span class="mtk9">.&nbsp;Based&nbsp;on&nbsp;the&nbsp;horizontal&nbsp;axis&nbsp;to&nbsp;prevent&nbsp;overlaps</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPolygon</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk16">int</span><span class="mtk13">(</span><span class="mtk16">math.round</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">xScale</span><span class="mtk13">))</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPolygon</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Clear&nbsp;the&nbsp;`points`&nbsp;array.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">points</span><span class="mtk1">.</span><span class="mtk15">clear</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;sides&nbsp;and&nbsp;vertices&nbsp;in&nbsp;the&nbsp;new&nbsp;polyg</span><span class="mtk9">on.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfSides</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">int</span><span class="mtk13">(</span><span class="mtk16">math.random</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">7</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;random&nbsp;rotation&nbsp;offset&nbsp;applied&nbsp;to&nbsp;the&nbsp;new&nbsp;polyg</span><span class="mtk9">on,&nbsp;in&nbsp;radians.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rotationOffset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.random</span><span class="mtk13">(</span><span class="mtk12">0.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">math.pi</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;size&nbsp;of&nbsp;the&nbsp;angle&nbsp;between&nbsp;each&nbsp;vertex,&nbsp;in&nbsp;rad</span><span class="mtk9">ians.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">step</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">math.pi</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfSides</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;counter-clockwise&nbsp;rotation&nbsp;angle&nbsp;of&nbsp;each&nbsp;vert</span><span class="mtk9">ex.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">angle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rotationOffset</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfSides</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;approximate&nbsp;x-coordinate&nbsp;from&nbsp;an&nbsp;ellipse&nbsp;at&nbsp;t</span><span class="mtk9">he&nbsp;`angle`,&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">xValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">int</span><span class="mtk13">(</span><span class="mtk16">math.round</span><span class="mtk13">(</span><span class="mtk33">xScale</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.cos</span><span class="mtk13">(</span><span class="mtk33">angle</span><span class="mtk13">)))</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;y-coordinate&nbsp;from&nbsp;an&nbsp;ellipse&nbsp;at&nbsp;the&nbsp;`angle`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">yValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">yScale</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sin</span><span class="mtk13">(</span><span class="mtk33">angle</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Push&nbsp;a&nbsp;new&nbsp;`chart.point`&nbsp;containing&nbsp;the&nbsp;`xValue</span><span class="mtk9">`&nbsp;and&nbsp;`yValue`&nbsp;into&nbsp;the&nbsp;`points`&nbsp;array.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;The&nbsp;new&nbsp;point&nbsp;does&nbsp;not&nbsp;contain&nbsp;`time`&nbsp;informati</span><span class="mtk9">on.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">points</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk33">xValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">yValue</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;`step`&nbsp;to&nbsp;the&nbsp;`angle`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">angle</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk33">step</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;closed&nbsp;polyline&nbsp;connecting&nbsp;the&nbsp;`points`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;The&nbsp;polyline&nbsp;uses&nbsp;the&nbsp;`index`&nbsp;field&nbsp;from&nbsp;each&nbsp;`</span><span class="mtk9">chart.point`&nbsp;in&nbsp;the&nbsp;`points`&nbsp;array.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">polyline.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">points</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">closed</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.navy</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">fill_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例显示图表上最后约 50 条折线，因为我们没有</font></font><code dir="auto">max_polylines_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数调用中指定值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code dir="auto">yScale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算将
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.float"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input.float()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
乘以
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.atr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ta.atr(2)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
，以使图纸的垂直比例适应最近的价格范围。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的多边形的最大宽度为水平半轴 ( </font></font><code dir="auto">2 * xScale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 的两倍，四舍五入为最接近的整数。</font></font><code dir="auto">newPolygon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件使用此值来防止多边形绘图重叠。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本将</font></font><code dir="auto">xValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算结果四舍五入为最接近的整数，因为</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a></font><code dir="auto">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的字段
</font><font style="vertical-align: inherit;">
仅接受
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_int"><font style="vertical-align: inherit;">int</font></a><font style="vertical-align: inherit;">
值，因为图表的 x 轴不包含分数条形索引。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_int"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="deleting-polylines" class="md-heading"><a href="#deleting-polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要删除特定的折线</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.delete()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此函数
</font><font style="vertical-align: inherit;">
从脚本及其在图表上的绘图中删除</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线对象。</font></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其他绘图对象一样，我们可以使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.delete()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来维护特定数量的折线绘图或有条件地从图表中删除绘图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，下面的脚本定期绘制近似的算术螺旋，并将其折线 ID 存储在一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中，并
</font></font><a href="/pine-script-docs/language/arrays#using-an-array-as-aqueue"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该数组作为队列</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来管理其显示的绘图数量。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code dir="auto">newSpiral</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件发生时，脚本会创建一个</font></font><code dir="auto">points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数组并
在</font><a href="/pine-script-docs/language/loops#for"><font style="vertical-align: inherit;">for 循环</font></a><font style="vertical-align: inherit;">中添加</font></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表点</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在每次循环迭代中，它都会调用</font><a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;">用户定义函数</font></a><font style="vertical-align: inherit;">来创建一个新的
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a><font style="vertical-align: inherit;"> 
，其中包含相对于 增长的椭圆路径的阶梯值</font><font style="vertical-align: inherit;">。然后，脚本会创建一个随机颜色的
</font><em><font style="vertical-align: inherit;">曲线折线</font></em><font style="vertical-align: inherit;">，连接 的坐标</font><font style="vertical-align: inherit;">并将
</font><font style="vertical-align: inherit;">
其 ID</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push"><font style="vertical-align: inherit;">推送到</font></a><font style="vertical-align: inherit;">数组中。</font></font><a href="/pine-script-docs/language/loops#for"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">spiralPoint()</code>
<a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">angle</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code dir="auto">points</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">polylines</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当数组的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
超出指定的值时</font></font><code dir="auto">numberOfSpirals</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，脚本将使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array.shift()删除最旧的折线，并使用</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.delete()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
删除对象
</font><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Polylines-Deleting-polylines-1.CAlL6dPB_1NJJpi.webp" alt="图像" width="1332" height="610" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1k2"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;polylines&nbsp;allowed&nbsp;on&nbsp;the&nbsp;ch</span><span class="mtk9">art.</span></span><br><span><span class="mtk18 mtkb">const</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">MAX_POLYLINES_COUNT</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span></span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Deleting&nbsp;polylines&nbsp;example"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Spirals"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_polylines_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">MAX_POLYLINES_COUNT</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;spiral&nbsp;drawings&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfSpirals</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Spirals&nbsp;shown"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">MAX_POLYLINES_COUNT</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;full&nbsp;spiral&nbsp;rotations&nbsp;to&nbsp;draw.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">rotations</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Rotations"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;scale&nbsp;of&nbsp;the&nbsp;horizontal&nbsp;semi-axis.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">xScale</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"X&nbsp;scale"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;scale&nbsp;of&nbsp;the&nbsp;vertical&nbsp;semi-axis.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">yScale</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">0.2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Y&nbsp;scale"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.atr</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Calculates&nbsp;an&nbsp;approximate&nbsp;point&nbsp;from&nbsp;an&nbsp;elliptica</span><span class="mtk9">lly-scaled&nbsp;arithmetic&nbsp;spiral.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;A&nbsp;`chart.point`&nbsp;with&nbsp;`index`&nbsp;and&nbsp;`price`&nbsp;informa</span><span class="mtk9">tion.</span></span><br><span><span class="mtk15">spiralPoint</span><span class="mtk13">(</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">angle</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">xOffset</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">yOffset</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">int</span><span class="mtk13">(</span><span class="mtk16">math.round</span><span class="mtk13">(</span><span class="mtk33">angle</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">xScale</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.cos</span><span class="mtk13">(</span><span class="mtk33">angle</span><span class="mtk13">)))</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">xOffset</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">angle</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">yScale</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sin</span><span class="mtk13">(</span><span class="mtk33">angle</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">yOffset</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;polylines.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">polylines</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">polyline</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;condition&nbsp;to&nbsp;create&nbsp;a&nbsp;new&nbsp;spiral.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">newSpiral</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk16">int</span><span class="mtk13">(</span><span class="mtk16">math.round</span><span class="mtk13">(</span><span class="mtk12">4</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">math.pi</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">rotations</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">xScale</span><span class="mtk13">))</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">newSpiral</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;`chart.point`&nbsp;objects&nbsp;for&nbsp;the&nbsp;`spiral</span><span class="mtk9">`&nbsp;drawing.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">points</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk13">&gt;()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;counter-clockwise&nbsp;angle&nbsp;between&nbsp;calculated&nbsp;po</span><span class="mtk9">ints,&nbsp;in&nbsp;radians.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">step</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">math.pi</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;rotation&nbsp;angle&nbsp;of&nbsp;each&nbsp;calculated&nbsp;point&nbsp;on&nbsp;th</span><span class="mtk9">e&nbsp;spiral,&nbsp;in&nbsp;radians.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">theta</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Loop&nbsp;to&nbsp;create&nbsp;the&nbsp;spiral's&nbsp;points.&nbsp;Creates&nbsp;4&nbsp;p</span><span class="mtk9">oints&nbsp;per&nbsp;full&nbsp;rotation.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">rotations</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;new&nbsp;point&nbsp;on&nbsp;the&nbsp;calculated&nbsp;spiral.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">spiralPoint</span><span class="mtk13">(</span><span class="mtk33">theta</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">ohlc4</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;`newPoint`&nbsp;to&nbsp;the&nbsp;`points`&nbsp;array.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">points</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk33">newPoint</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;`step`&nbsp;to&nbsp;the&nbsp;`theta`&nbsp;angle.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">theta</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk33">step</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;random&nbsp;color&nbsp;for&nbsp;the&nbsp;new&nbsp;`spiral`&nbsp;drawing.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">spiralColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk16">math.random</span><span class="mtk13">(</span><span class="mtk12">150</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">255</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.random</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.random</span><span class="mtk13">(</span><span class="mtk12">150</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">255</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;new&nbsp;polyline&nbsp;connecting&nbsp;the&nbsp;spiral&nbsp;points.&nbsp;Uses</span><span class="mtk9">&nbsp;the&nbsp;`index`&nbsp;field&nbsp;from&nbsp;each&nbsp;point&nbsp;as&nbsp;x-coordinate</span><span class="mtk9">s.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">polyline</span><span class="mtk1">&nbsp;</span><span class="mtk33">spiral</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">polyline.new</span><span class="mtk13">(</span><span class="mtk33">points</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">spiralColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Push&nbsp;the&nbsp;new&nbsp;`spiral`&nbsp;into&nbsp;the&nbsp;`polylines`&nbsp;arra</span><span class="mtk9">y.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">polylines</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk33">spiral</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Shift&nbsp;the&nbsp;first&nbsp;polyline&nbsp;out&nbsp;of&nbsp;the&nbsp;array&nbsp;and&nbsp;d</span><span class="mtk9">elete&nbsp;it&nbsp;when&nbsp;the&nbsp;array's&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;`number</span><span class="mtk9">OfSpirals`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">polylines</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">numberOfSpirals</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">polyline.delete</span><span class="mtk13">(</span><span class="mtk33">polylines</span><span class="mtk1">.</span><span class="mtk15">shift</span><span class="mtk13">())</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;when&nbsp;`newSpiral`&nbsp;is&nbsp;`t</span><span class="mtk9">rue`.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">newSpiral</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"New&nbsp;drawing&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们声明了一个</font></font><code dir="auto">MAX_POLYLINES_COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常量值为 100 的全局变量。脚本使用此常量作为
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">indicator()</font></a></font><code dir="auto">max_polylines_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数中的值
</font><font style="vertical-align: inherit;">
和输入</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">maxval</code><font style="vertical-align: inherit;"></font><code dir="auto">numberOfSpirals</code><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/lines-and-boxes#closed-shapes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与上一节</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的“N 边多边形”示例一样
</font><font style="vertical-align: inherit;">，我们将 x 坐标的计算结果四舍五入为最接近的整数，因为</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a></font><code dir="auto">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的字段
</font><font style="vertical-align: inherit;">
只能接受
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_int"><font style="vertical-align: inherit;">int</font></a><font style="vertical-align: inherit;">
值。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_int"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管图形看起来很平滑，但每条折线的
数组</font><font style="vertical-align: inherit;">
每条螺旋旋转
</font></font><code dir="auto">points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅包含</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">四个</font></font></em>
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point对象。由于</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用包含</font></font><code dir="auto">curved = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此每条折线都使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平滑曲线</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接它们的</font></font><code dir="auto">points</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从而产生螺旋实际曲率的视觉近似值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个螺旋的宽度约为
</font></font><code dir="auto">4 * math.pi * rotations * xScale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，四舍五入为最接近的整数。我们在条件中使用此值</font></font><code dir="auto">newSpiral</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来间隔每个图形并防止重叠。</font></font></li>
</ul>
<h3 id="redrawing-polylines" class="md-heading"><a href="#redrawing-polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重绘</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，可能需要在脚本执行过程中更改折线绘制。虽然</font></font><code dir="auto">polyline.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间不包含内置的设置函数，但我们可以</font><font style="vertical-align: inherit;">通过</font><em><font style="vertical-align: inherit;">删除</font></em><font style="vertical-align: inherit;">现有折线并分配具有所需更改的</font><em><font style="vertical-align: inherit;">新实例来</font></em></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新绘制</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量或
</font></font><a href="/pine-script-docs/language/type-system#collections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合引用</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的折线。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.delete()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用来更新折线变量的值。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本绘制闭合折线，连接包含条形的周期的开盘价、最高价、最低价和收盘价</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它
</font></font><code dir="auto">currentDrawing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个条形上创建一个变量，并在每个图表条形上为其分配一个折线 ID。它使用</font></font><code dir="auto">openPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">highPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">lowPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">closePoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量来引用
跟踪周期发展中的 OHLC 值的</font></font><a href="/pine-script-docs/language/type-system#chart-points"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表点</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。随着新值的出现，脚本将新的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对象分配给变量，
</font><font style="vertical-align: inherit;">
使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.from"><font style="vertical-align: inherit;">array.from将它们收集到一个</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中，然后创建一条连接数组点坐标的</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;">新折线</font></a><font style="vertical-align: inherit;">
并将其分配给</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.from"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">currentDrawing</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code dir="auto">newPeriod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件为时</font></font><code dir="auto">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即当前时期未完成），脚本
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#deleting-polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会删除</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用的折线，然后</font></font><code dir="auto">currentDrawing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#creating-polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新的折线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从而得到随着时期的发展而变化的动态绘图：</font></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Polylines-Redrawing-polylines-1.CzU1g71o_2i3aBU.webp" alt="图像" width="1278" height="540" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5ih"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Redrawing&nbsp;polylines&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"OHLC&nbsp;polygons"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_polylines_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;period.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`chart.point`&nbsp;representing&nbsp;the&nbsp;start&nbsp;of&nbsp;each&nbsp;pe</span><span class="mtk9">riod.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk1">&nbsp;</span><span class="mtk33">openPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`chart.point`&nbsp;representing&nbsp;the&nbsp;highest&nbsp;point&nbsp;of</span><span class="mtk9">&nbsp;each&nbsp;period.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk1">&nbsp;</span><span class="mtk33">highPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`chart.point`&nbsp;representing&nbsp;the&nbsp;lowest&nbsp;point&nbsp;of&nbsp;</span><span class="mtk9">each&nbsp;period.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">chart.point</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`chart.point`&nbsp;representing&nbsp;the&nbsp;current&nbsp;bar's&nbsp;cl</span><span class="mtk9">osing&nbsp;point.</span></span><br><span><span class="mtk33">closePoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;current&nbsp;period's&nbsp;polyline&nbsp;drawing.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">polyline</span><span class="mtk1">&nbsp;</span><span class="mtk33">currentDrawing</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;once&nbsp;every&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPeriod</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPeriod</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;new&nbsp;chart&nbsp;points&nbsp;to&nbsp;the&nbsp;`openPoint`,&nbsp;`hi</span><span class="mtk9">ghPoint`,&nbsp;and&nbsp;`closePoint`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">openPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">highPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">lowPoint</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;a&nbsp;new&nbsp;`chart.point`&nbsp;to&nbsp;the&nbsp;`highPoint`&nbsp;w</span><span class="mtk9">hen&nbsp;the&nbsp;`high`&nbsp;is&nbsp;greater&nbsp;than&nbsp;its&nbsp;`price`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">highPoint</span><span class="mtk1">.</span><span class="mtk33">price</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">highPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;a&nbsp;new&nbsp;`chart.point`&nbsp;to&nbsp;the&nbsp;`lowPoint`&nbsp;wh</span><span class="mtk9">en&nbsp;the&nbsp;`low`&nbsp;is&nbsp;less&nbsp;than&nbsp;its&nbsp;`price`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowPoint</span><span class="mtk1">.</span><span class="mtk33">price</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">lowPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;teal&nbsp;when&nbsp;the&nbsp;`closePoint.price`&nbsp;is&nbsp;greater&nbsp;th</span><span class="mtk9">an&nbsp;the&nbsp;`openPoint.price`,&nbsp;maroon&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">drawingColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">openPoint</span><span class="mtk1">.</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Delete&nbsp;the&nbsp;polyline&nbsp;assigned&nbsp;to&nbsp;the&nbsp;`currentDra</span><span class="mtk9">wing`&nbsp;if&nbsp;it's&nbsp;not&nbsp;a&nbsp;`newPeriod`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">newPeriod</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">polyline.delete</span><span class="mtk13">(</span><span class="mtk33">currentDrawing</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Assign&nbsp;a&nbsp;new&nbsp;polyline&nbsp;to&nbsp;the&nbsp;`currentDrawing`.</span></span><br><span><span class="mtk9">//&nbsp;Uses&nbsp;the&nbsp;`index`&nbsp;field&nbsp;from&nbsp;each&nbsp;`chart.point`&nbsp;</span><span class="mtk9">in&nbsp;its&nbsp;array&nbsp;as&nbsp;x-coordinates.</span></span><br><span><span class="mtk33">currentDrawing</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">polyline.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk33">openPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">highPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">closePoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowPoint</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">closed</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">line_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">drawingColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">fill_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk33">drawingColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="realtime-behavior" class="md-heading"><a href="#realtime-behavior"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实时</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行为</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
都受</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回滚操作的影响，这些操作会影响脚本在实时条上执行时的行为。请参阅 Pine Script™ 的</font></font></em><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/execution-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">页面</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本演示了在实时、未确认的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表条上执行回滚时的效果</font><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Realtime-behavior-1.CJQjybQE_1WvIDG.webp" alt="图像" width="1328" height="474" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4ur"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Realtime&nbsp;behavior&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;orange&nbsp;when&nbsp;the&nbsp;`line`&nbsp;is&nbsp;subject&nbsp;to&nbsp;rollback&nbsp;</span><span class="mtk9">and&nbsp;gray&nbsp;after&nbsp;the&nbsp;`line`&nbsp;is&nbsp;committed.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span></span><br><span><span></span></span><br><span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本例中的 line.new() 调用在未确认的条形图上的值发生变化时，每次迭代都会创建一个新的
</font><font style="vertical-align: inherit;">线
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
。由于每次迭代之前都会回滚，脚本会自动删除该条形图上每次更改时创建的对象</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它只</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条形图关闭前创建的最后一条线，并且该
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实例是已确认条形图上持续存在的线实例。</font></font></p>
<h2 id="limitations" class="md-heading"><a href="#limitations"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="total-number-of-objects" class="md-heading"><a href="#total-number-of-objects"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">对象</font></span><font style="vertical-align: inherit;">总数</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会消耗服务器资源，因此每个脚本的绘图总数是有限制的。当脚本创建的绘图对象数量超过允许的限制时，Pine Script™ 运行时会自动删除最旧的对象，这个过程称为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">垃圾收集</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个脚本最多可包含 500 条线、500 个框和 100 条折线。用户可以通过</font><font style="vertical-align: inherit;">
在脚本的
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">indicator()</font></a><font style="vertical-align: inherit;">
或
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;">strategies()</font></a><font style="vertical-align: inherit;">
声明语句中指定</font></font><code dir="auto">max_lines_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">max_boxes_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和值来控制垃圾收集限制。</font></font><code dir="auto">max_polylines_count</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本演示了 Pine 中的垃圾收集工作原理。它在每个图表条上创建新的线条、框和折线。我们尚未</font><font style="vertical-align: inherit;">在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">indicator()</font></a></font><code dir="auto">max_lines_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数调用中为、</font></font><code dir="auto">max_boxes_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
参数指定值</font><font style="vertical-align: inherit;">
，因此脚本将保留图表上最近的约 50 条线条、框和折线，因为这是每个参数的默认设置：</font></font><code dir="auto">max_polylines_count</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Lines-and-boxes-Limitations-Total-number-of-objects-1.BBu4sL-b_2tzxSR.webp" alt="图像" width="1196" height="534" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1u9"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Garbage&nbsp;collection&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;new&nbsp;`chart.point`&nbsp;at&nbsp;the&nbsp;current&nbsp;`bar_index`&nbsp;an</span><span class="mtk9">d&nbsp;`high`.</span></span><br><span><span class="mtk33">firstPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;new&nbsp;`chart.point`&nbsp;one&nbsp;bar&nbsp;into&nbsp;the&nbsp;future&nbsp;at&nbsp;th</span><span class="mtk9">e&nbsp;current&nbsp;`low`.</span></span><br><span><span class="mtk33">secondPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;new&nbsp;`chart.point`&nbsp;one&nbsp;bar&nbsp;into&nbsp;the&nbsp;future&nbsp;at&nbsp;th</span><span class="mtk9">e&nbsp;current&nbsp;`high`.</span></span><br><span><span class="mtk33">thirdPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;`line`&nbsp;connecting&nbsp;the&nbsp;`firstPoint`&nbsp;t</span><span class="mtk9">o&nbsp;the&nbsp;`secondPoint`.</span></span><br><span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">firstPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;`box`&nbsp;with&nbsp;the&nbsp;`firstPoint`&nbsp;top-left</span><span class="mtk9">&nbsp;corner&nbsp;and&nbsp;`secondPoint`&nbsp;bottom-right&nbsp;corner.</span></span><br><span><span class="mtk16">box.new</span><span class="mtk13">(</span><span class="mtk33">firstPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;`polyline`&nbsp;connecting&nbsp;the&nbsp;`firstPoin</span><span class="mtk9">t`,&nbsp;`secondPoint`,&nbsp;and&nbsp;`thirdPoint`&nbsp;sequentially.</span></span><br><span><span class="mtk16">polyline.new</span><span class="mtk13">(</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk33">firstPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">thirdPoint</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">line_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用了 TradingView 的“测量”绘图工具来测量脚本绘图对象覆盖的条形图数量。</font></font></li>
</ul>
<h3 id="future-references-with-xlocbar_index" class="md-heading"><a href="#future-references-with-xlocbar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未来将使用</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xloc.bar_index`进行引用</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xloc.bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定位的对象
可以包含不超过 500 个条形图的 x 坐标。</font></font></p>
<h3 id="other-contexts" class="md-heading"><a href="#other-contexts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本不能</font><font style="vertical-align: inherit;">
在函数中使用</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">request.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些类型的实例可以使用来自调用的值</font></font><code dir="auto">request.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但脚本只能在图表的上下文中创建和绘制它们。</font></font></p>
<p><font style="vertical-align: inherit;"></font><code dir="auto">timeframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个限制也是为什么在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
声明语句中</font><font style="vertical-align: inherit;">使用参数时绘制对象不起作用的原因
。</font></font></p>
<h3 id="historical-buffer-and-max_bars_back" class="md-heading"><a href="#historical-buffer-and-max_bars_back"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史缓冲区和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“max_bars_back”</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将barstate.isrealtime</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与绘图结合使用
</font><font style="vertical-align: inherit;">
有时会产生意外结果。例如，此脚本的目的是忽略所有历史条形图并在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实时</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条形图上绘制跨越 300 条条形图的水平线：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="31d"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Historical&nbsp;buffer&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`chart.point`&nbsp;at&nbsp;the&nbsp;`bar_index`&nbsp;from&nbsp;300&nbsp;bars&nbsp;</span><span class="mtk9">ago&nbsp;and&nbsp;current&nbsp;`close`.</span></span><br><span><span class="mtk33">firstPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">[</span><span class="mtk12">300</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;current&nbsp;bar's&nbsp;`chart.point`&nbsp;containing&nbsp;the&nbsp;cu</span><span class="mtk9">rrent&nbsp;`close`.</span></span><br><span><span class="mtk33">secondPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;line&nbsp;on&nbsp;realtime&nbsp;bars.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isrealtime</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">firstPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，它会在运行时失败并引发错误。脚本失败是因为它无法确定底层
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
序列的历史值的缓冲区大小。虽然代码不包含内置
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量，但内置
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其内部工作中
使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列。因此，从 300 个条形图开始访问</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
的值
需要</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序列
的历史缓冲区
</font><font style="vertical-align: inherit;">
至少为 300 个条形图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 包含一种机制，在大多数情况下可自动检测所需的历史缓冲区大小。它的工作原理是让脚本在有限的时间内访问任意数量的条形图的历史值。在这个脚本的情况下，使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barstate.isrealtime</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来控制线条的绘制会阻止它访问历史系列，因此它无法推断所需的历史缓冲区大小，并且脚本会失败。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个问题的简单解决方案是使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max_bars_back()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数在评估</font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;">条件结构之前</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确定义</font></font></em><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
序列
</font><font style="vertical-align: inherit;">的历史缓冲区
</font><font style="vertical-align: inherit;">：</font></font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="33w"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Historical&nbsp;buffer&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`chart.point`&nbsp;at&nbsp;the&nbsp;`bar_index`&nbsp;from&nbsp;300&nbsp;bars&nbsp;</span><span class="mtk9">ago&nbsp;and&nbsp;current&nbsp;`close.</span></span><br><span><span class="mtk33">firstPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">[</span><span class="mtk12">300</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;current&nbsp;bar's&nbsp;`chart.point`&nbsp;containing&nbsp;the&nbsp;cu</span><span class="mtk9">rrent&nbsp;`close`.</span></span><br><span><span class="mtk33">secondPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Explicitly&nbsp;set&nbsp;the&nbsp;historical&nbsp;buffer&nbsp;of&nbsp;the&nbsp;`ti</span><span class="mtk9">me`&nbsp;series&nbsp;to&nbsp;300&nbsp;bars.</span></span><br><span><span class="mtk16">max_bars_back</span><span class="mtk13">(</span><span class="mtk11">time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">300</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;line&nbsp;on&nbsp;realtime&nbsp;bars.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isrealtime</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">firstPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此类问题可能令人困惑，但非常罕见。Pine Script™ 团队希望随着时间的推移消除这些问题。</font></font></p>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a href="/pine-script-docs/concepts/libraries" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前的</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow-back">  <use xlink:href="#ai:local:theme/arrow-back"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库  </font></font></h4> </a>  <a href="/pine-script-docs/concepts/non-standard-charts-data" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  非标准图表数据</font></font><svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本页</font></font></h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#lines-and-boxes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></li></a><a href="#introduction" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></li></a><a href="#lines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条</font></font></li></a><a href="#creating-lines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建线</font></font></li></a><a href="#modifying-lines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改线条</font></font></li></a><a href="#line-styles" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条样式</font></font></li></a><a href="#reading-line-values" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取线值</font></font></li></a><a href="#cloning-lines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克隆线</font></font></li></a><a href="#deleting-lines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除行</font></font></li></a><a href="#filling-the-space-between-lines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充行与行之间的空间</font></font></li></a><a href="#boxes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盒子</font></font></li></a><a href="#creating-boxes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建框</font></font></li></a><a href="#modifying-boxes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改盒子</font></font></li></a><a href="#box-styles" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盒子样式</font></font></li></a><a href="#reading-box-values" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取框值</font></font></li></a><a href="#cloning-boxes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克隆盒</font></font></li></a><a href="#deleting-boxes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除框</font></font></li></a><a href="#polylines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></li></a><a href="#creating-polylines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建折线</font></font></li></a><a href="#curved-drawings" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">曲线图</font></font></li></a><a href="#closed-shapes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">封闭形状</font></font></li></a><a href="#deleting-polylines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除折线</font></font></li></a><a href="#redrawing-polylines" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重绘折线</font></font></li></a><a href="#realtime-behavior" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实时行为</font></font></li></a><a href="#limitations" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></li></a><a href="#total-number-of-objects" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象总数</font></font></li></a><a href="#future-references-with-xlocbar_index" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未来将使用 `xloc.bar_index` 进行引用</font></font></li></a><a href="#other-contexts" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他背景</font></font></li></a><a href="#historical-buffer-and-max_bars_back" class="document-toc-link" data-astro-cid-oor6cujd="" aria-current="true"><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史缓冲区和“max_bars_back”</font></font></li></a></ul><a class="back-top" href="#top" data-astro-cid-oor6cujd=""><svg width="16" height="16" viewBox="0 0 16 16" data-astro-cid-oor6cujd="" data-icon="theme/back-top">  <symbol id="ai:local:theme/back-top"><path fill="currentColor" fill-rule="evenodd" d="M6.25 12.5A2.75 2.75 0 0 0 9 9.75V4.56L6.78 6.78a.75.75 0 0 1-1.06-1.06l3.5-3.5a.75.75 0 0 1 1.06 0l3.5 3.5a.75.75 0 0 1-1.06 1.06L10.5 4.56v5.19a4.25 4.25 0 0 1-8.5 0v-1a.75.75 0 0 1 1.5 0v1a2.75 2.75 0 0 0 2.75 2.75Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/back-top"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回到顶部
</font></font></a></section></aside></div> </main> </div>            <script data-astro-rerun="" src="/pine-script-docs/static/pine-highlighter-v06.js" data-astro-exec=""></script><div id="goog-gt-tt" class="VIpgJd-yAWNEb-L7lbkb skiptranslate" style="border-radius: 12px; margin: 0 0 0 -23px; padding: 0; font-family: 'Google Sans', Arial, sans-serif;" data-id=""><div id="goog-gt-vt" class="VIpgJd-yAWNEb-hvhgNd"><div class=" VIpgJd-yAWNEb-hvhgNd-l4eHX-i3jM8c"><img src="https://fonts.gstatic.com/s/i/productlogos/translate/v14/24px.svg" width="24" height="24" alt=""></div><div class=" VIpgJd-yAWNEb-hvhgNd-k77Iif-i3jM8c"><div class="VIpgJd-yAWNEb-hvhgNd-IuizWc" dir="ltr">Original text</div><div id="goog-gt-original-text" class="VIpgJd-yAWNEb-nVMfcd-fmcmS VIpgJd-yAWNEb-hvhgNd-axAV1"></div></div><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid ltr"><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid-B7I4Od ltr" dir="ltr"><div class="VIpgJd-yAWNEb-hvhgNd-UTujCb">Rate this translation</div><div class="VIpgJd-yAWNEb-hvhgNd-eO9mKe">Your feedback will be used to help improve Google Translate</div></div><div class="VIpgJd-yAWNEb-hvhgNd-xgov5 ltr"><button id="goog-gt-thumbUpButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Good translation" aria-label="Good translation" aria-pressed="false"><span id="goog-gt-thumbUpIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7H2v13h16c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM7 18H4V9h3v9zm14-7l-3 7H9V8l4.34-4.34L12 9h9v2z"></path></svg></span><span id="goog-gt-thumbUpIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7v13h11c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM5 7H1v13h4V7z"></path></svg></span></button><button id="goog-gt-thumbDownButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Poor translation" aria-label="Poor translation" aria-pressed="false"><span id="goog-gt-thumbDownIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7h5V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zM17 6h3v9h-3V6zM3 13l3-7h9v10l-4.34 4.34L12 15H3v-2z"></path></svg></span><span id="goog-gt-thumbDownIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zm16 0h4V4h-4v13z"></path></svg></span></button></div></div><div id="goog-gt-votingHiddenPane" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><form id="goog-gt-votingForm" action="//translate.googleapis.com/translate_voting?client=te_lib" method="post" target="votingFrame" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><input type="text" name="sl" id="goog-gt-votingInputSrcLang"><input type="text" name="tl" id="goog-gt-votingInputTrgLang"><input type="text" name="query" id="goog-gt-votingInputSrcText"><input type="text" name="gtrans" id="goog-gt-votingInputTrgText"><input type="text" name="vote" id="goog-gt-votingInputVote"></form><iframe name="votingFrame" frameborder="0"></iframe></div></div></div> </body></html>