<html lang="zh-CN" data-theme="light" class="translated-ltr"><head><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/pine-script-docs/static/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>概念/重新粉刷</title><meta name="og:title" content="Concepts / Repainting"><meta name="twitter:title" content="Concepts / Repainting"><meta name="description" content="Everything you need to know about Pine Script™."><meta name="og:description" content="Everything you need to know about Pine Script™."><meta name="twitter:description" content="Everything you need to know about Pine Script™."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png"><meta name="twitter:image" content="/pine-script-docs/meta-image.png"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="../../concepts/repainting/"><meta name="twitter:url" content="../../concepts/repainting/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="../../concepts/repainting/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="stylesheet" href="/pine-script-docs/_astro/index.jN9AZoBe.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.C8b720yZ.css"><script type="module" src="/pine-script-docs/_astro/hoisted.D4iEV6y6.js" data-astro-exec=""></script><style type="text/css" media="screen">.monaco-editor-tv-pine-dark { 
    .mtk1 { color: #ffffff; }
    .mtk2 { color: #131722; }
    .mtk3 { color: #cc6666; }
    .mtk4 { color: #9cdcfe; }
    .mtk5 { color: #ce9178; }
    .mtk6 { color: #d4d4d4; }
    .mtk7 { color: #b5cea8; }
    .mtk8 { color: #608b4e; }
    .mtk9 { color: #787b86; }
    .mtk10 { color: #569cd6; }
    .mtk11 { color: #f77c80; }
    .mtk12 { color: #f57f17; }
    .mtk13 { color: #dcdcdc; }
    .mtk14 { color: #808080; }
    .mtk15 { color: #3179f5; }
    .mtk16 { color: #5b9cf6; }
    .mtk17 { color: #ba68c8; }
    .mtk18 { color: #42bda8; }
    .mtk19 { color: #f44747; }
    .mtk20 { color: #c586c0; }
    .mtk21 { color: #a79873; }
    .mtk22 { color: #dd6a6f; }
    .mtk23 { color: #5bb498; }
    .mtk24 { color: #909090; }
    .mtk25 { color: #778899; }
    .mtk26 { color: #ff00ff; }
    .mtk27 { color: #b46695; }
    .mtk28 { color: #388e3c; }
    .mtk29 { color: #ff0000; }
    .mtk30 { color: #4f76ac; }
    .mtk31 { color: #3dc9b0; }
    .mtk32 { color: #74b0df; }
    .mtk33 { color: #d1d4dc; }
    .mtk34 { color: #4864aa; }
    .mtki { font-style: italic; }
    .mtkb { font-weight: bold; }
    .mtku { text-decoration: underline; text-underline-position: under; }
    .mtks { text-decoration: line-through; }
    .mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style>
<style type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://www.gstatic.com/_/translate_http/_/ss/k=translate_http.tr.26tY-h6gH9w.L.W.O/am=GAY/d=0/rs=AN8SPfrev-A3NvrBP0gNq8zXCqKY7IcBLA/m=el_main_css"></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16px" height="16px" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02Zm-3.95-.3a7.91 7.91 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8V4Zm0 9v2h1v-2H8Zm6-3V9h-2v1h2ZM3 9v1h2V9H3Zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm4.2-6-.7-.7-1.4 1.4.7.7L12.7 6ZM5 13.7l-.7-.7 1.4-1.4.7.7L5 13.7Zm7.7-.7-.7.7-1.4-1.4.7-.7 1.4 1.4ZM4.3 6l.7-.7 1.4 1.4-.7.7L4.3 6Zm3 17 14-14 .8.7L8 23.7l-.7-.7Zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9Z"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh="">    <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="关闭菜单" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="主导航" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="打开导航菜单" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="主页按钮" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><svg width="188" height="44" viewBox="0 0 188 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001ZM32.4978 22.1105L27.1641 25.5207L19.7195 19.2258C19.1767 18.7669 18.4312 18.6305 17.7611 18.8676L13.8245 20.2602L21.9253 9.59841L32.4978 22.1105Z" fill="currentColor"></path>
<path d="M33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="currentColor"></path>
<path d="M59.56 13.96C63.016 13.96 65.536 16.456 65.536 19.696C65.536 22.936 63.016 25.432 59.56 25.432H57.376V31H53.896V13.96H59.56ZM59.512 22.168C61.096 22.168 62.152 21.088 62.152 19.696C62.152 18.304 61.096 17.224 59.512 17.224H57.376V22.168H59.512ZM70.8636 14.944C70.8636 16.096 69.9276 17.032 68.7516 17.032C67.6236 17.032 66.6636 16.096 66.6636 14.944C66.6636 13.792 67.6236 12.856 68.7516 12.856C69.9276 12.856 70.8636 13.792 70.8636 14.944ZM67.1196 31V19H70.4076V31H67.1196ZM73.0849 31V19H76.3729V20.368C76.9969 19.408 78.2449 18.736 79.8049 18.736C82.7089 18.736 84.4369 20.848 84.4369 23.968V31H81.1489V24.52C81.1489 22.792 80.4049 21.736 79.0369 21.736C77.5249 21.736 76.3729 22.84 76.3729 25.144V31H73.0849ZM86.2041 25C86.2041 21.448 88.8681 18.736 92.5161 18.736C95.6601 18.736 98.4201 20.752 98.4201 24.64C98.4201 24.928 98.4201 25.264 98.3721 25.768H89.3961C89.5881 27.376 91.0041 28.264 92.5881 28.264C94.0761 28.264 95.1561 27.568 95.6841 26.752L98.1321 28.576C97.0281 30.184 95.0841 31.264 92.5641 31.264C88.9881 31.264 86.2041 28.792 86.2041 25ZM92.4201 21.448C91.1961 21.448 89.8281 22.072 89.5161 23.536H95.1321C94.8441 22.12 93.6441 21.448 92.4201 21.448ZM104.412 28.24L107.076 26.008C107.916 27.28 109.38 28.024 110.772 28.024C112.14 28.024 113.052 27.352 113.052 26.368C113.052 25.408 112.356 24.736 110.676 24.16L109.236 23.656C106.5 22.696 105.036 21.112 105.036 18.784C105.036 15.568 107.484 13.672 110.796 13.672C112.884 13.672 114.708 14.392 116.172 16.024L113.868 18.4C113.052 17.416 111.996 16.936 110.82 16.936C109.644 16.936 108.54 17.44 108.54 18.448C108.54 19.48 109.38 19.936 111.18 20.584L112.548 21.088C115.044 22 116.604 23.584 116.604 26.152C116.58 29.2 114.156 31.288 110.628 31.288C107.916 31.288 105.636 30.112 104.412 28.24ZM129.859 27.808C128.827 29.872 126.667 31.264 124.171 31.264C120.619 31.264 117.811 28.624 117.811 25C117.811 21.376 120.619 18.736 124.171 18.736C126.667 18.736 128.827 20.128 129.859 22.192L127.003 23.728C126.523 22.624 125.491 21.808 124.171 21.808C122.443 21.808 121.123 23.152 121.123 25C121.123 26.848 122.443 28.192 124.171 28.192C125.491 28.192 126.523 27.376 127.003 26.272L129.859 27.808ZM131.482 31V19H134.77V20.92C135.178 19.744 136.402 18.856 137.746 18.856C138.082 18.856 138.442 18.88 138.85 19V22.336C138.346 22.168 137.89 22.072 137.362 22.072C135.802 22.072 134.77 23.296 134.77 25.264V31H131.482ZM144.215 14.944C144.215 16.096 143.279 17.032 142.103 17.032C140.975 17.032 140.015 16.096 140.015 14.944C140.015 13.792 140.975 12.856 142.103 12.856C143.279 12.856 144.215 13.792 144.215 14.944ZM140.471 31V19H143.759V31H140.471ZM146.436 36.016V19H149.724V20.344C150.276 19.576 151.548 18.736 153.204 18.736C156.396 18.736 158.844 21.592 158.844 25C158.844 28.408 156.396 31.264 153.204 31.264C151.548 31.264 150.276 30.424 149.724 29.656V36.016H146.436ZM155.508 25C155.508 23.128 154.284 21.736 152.484 21.736C150.684 21.736 149.46 23.128 149.46 25C149.46 26.872 150.684 28.264 152.484 28.264C154.284 28.264 155.508 26.872 155.508 25ZM168.407 30.88C167.879 31.048 167.231 31.144 166.319 31.144C163.775 31.144 161.735 29.728 161.735 26.8V21.88H159.311V19H161.735V15.664H165.023V19H168.407V21.88H165.023V26.152C165.023 27.616 165.647 28.192 167.063 28.192C167.591 28.192 168.023 28.12 168.407 27.976V30.88ZM177.626 22.648V13.96H179.978L181.874 16.888L183.746 13.96H186.122V22.648H183.698V18.184L181.874 20.968L180.026 18.136V22.648H177.626ZM171.386 22.648V16.456H169.058V13.96H176.258V16.456H173.93V22.648H171.386Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="搜索文档" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0Zm-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="重置" data-search-clear="" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除</font></font></button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="关闭" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索结果</font></font></div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp="">    </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true" style="display:none"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="关闭图片预览" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94 5.53 4.47Z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="返回文档主页。" data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户手册</font></font></span>  </a>  <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <a href="/pine-script-docs/concepts/alerts" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></a> <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <span class="current-item" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></span> </div>     </div> <div id="slot-container" data-astro-cid-xgirumru="">  <h1 id="repainting" class="md-heading"><a href="#repainting"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<h2 id="introduction" class="md-heading"><a href="#introduction"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将重绘定义为：</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本行为导致历史与实时计算或绘图表现不同</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重绘行为很普遍，许多因素都可能导致重绘。根据我们的定义，我们估计现有指标中超过 95% 都表现出某种形式的重绘行为。例如，常用的指标（如 MACD 和 RSI）在历史条形图上显示已确认的值，但在实时、未确认的图表条形图上会波动，直到收盘。因此，它们
</font><font style="vertical-align: inherit;">在历史和实时状态下的行为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同。</font></font></em><font style="vertical-align: inherit;"></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并非所有重绘行为本质上都是无用或误导性的</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而且此类行为也不会阻止知识渊博的交易者使用具有此类行为的指标。例如，谁会仅仅因为成交量概况指标在实时条形图上更新其值而怀疑它呢？</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人们可能会在所使用的脚本中遇到以下任何形式的重绘，具体取决于脚本的计算内容：</font></font></p>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广泛但通常可以接受</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：脚本可以使用随未确认条形图上的实时价格变化而更新的值。例如，如果在打开的图表条形图上执行的计算中使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">close</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量，则其值将反映条形图中的最新价格。但是，脚本只会在条形图关闭后将新数据点提交到其历史系列。另一个常见情况是使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
获取实时条形图上的更高时间范围数据，如
</font><a href="/pine-script-docs/concepts/other-timeframes-and-data"><font style="vertical-align: inherit;">其他时间范围和数据</font></a><font style="vertical-align: inherit;">页面的
</font></font><a href="/pine-script-docs/concepts/other-timeframes-and-data#historical-and-realtime-behavior"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史和实时行为</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分所述。与图表时间范围内的未确认图表条形图一样，
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;">request.security()</font></a><font style="vertical-align: inherit;">
可以跟踪实时条形图上更高时间范围上下文中的未确认值，这可能导致脚本重新启动执行后重新绘制。使用此类脚本通常没有错，只要您了解它们的工作原理即可。但是，在选择使用此类脚本发出警报或交易订单时，重要的是要了解它们的实时行为和历史行为之间的差异，并自行决定它是否能满足您的需求。</font></font><a href="/pine-script-docs/concepts/other-timeframes-and-data"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">潜在的误导性</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：绘制过去值、计算无法在历史条上复制的实时条形图结果或重新定位过去事件的脚本可能会产生误导。例如，Ichimoku、大多数基于枢轴的脚本、大多数使用 的策略</font></font><code dir="auto">calc_on_every_tick = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security() 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本（
当它在实时条形图上表现不同时）、许多使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">varip 的脚本、许多使用</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timenow 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本
</font><font style="vertical-align: inherit;">以及一些使用</font></font><code dir="auto">barstate.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量的脚本都可能表现出误导性的重绘行为。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可接受</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：将未来信息泄露到过去的脚本、在
</font></font><a href="/pine-script-docs/concepts/non-standard-charts-data"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上执行的策略以及使用实时内部条形图生成警报或订单的脚本，都是可能产生严重误导的重绘行为的例子。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可避免的是</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：来自提供商的数据馈送的修订和图表历史记录的起始条的变化可能会导致脚本中不可避免的重绘行为。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果符合以下情况，前两种类型的重新涂漆是完全可以接受的：</font></font></p>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您已经意识到了这种行为。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你可以忍受它，或者</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你可以规避它。</font></font></li>
</ol>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在应该清楚的是，并非</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有的</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重绘行为都是错误的，需要不惜一切代价避免。在许多情况下，某些形式的重绘可能正是脚本所需要的。重要的是要知道重绘行为何时不</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符合</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">个人需求。为了避免不可接受的重绘，了解工具的工作原理或如何设计构建的工具非常重要。如果您
</font></font><a href="/pine-script-docs/writing/publishing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本，请确保在出版物的描述中提及任何可能误导的行为以及脚本的其他限制。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们不会讨论在非标准图表上使用策略的风险，因为这个问题与重绘无关。
</font><font style="vertical-align: inherit;">
有关此主题的讨论，请参阅</font></font><a href="https://www.tradingview.com/script/q9laJNG9-Backtesting-on-Non-Standard-Charts-Caution-PineCoders-FAQ/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表上的回溯测试：警告！脚本。</font></font></a><font style="vertical-align: inherit;"></font></p></div></aside>
<h3 id="for-script-users" class="md-heading"><a href="#for-script-users"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于脚本</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果了解重绘行为，并确定该行为是否符合分析要求，则可以决定使用重绘指标。不要成为那些在已发布的脚本上贴上“重绘”句子以试图诋毁它们的新手之一，因为这样做表明你缺乏该主题的基础知识。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单地询问脚本是否重绘是相对没有意义的，因为脚本中存在完全可以接受的重绘行为形式。因此，这样的问题不会产生有意义的答案。我们应该问一些关于脚本潜在重绘行为的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具体</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题，例如：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本在历史和实时条形图上的计算/显示方式是否相同？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本发出的警报是否会等待实时条结束后才触发？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本显示的信号标记是否要等待实时条结束后才显示？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本是否绘制/描绘过去的值？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该策略是否使用</font></font><code dir="auto">calc_on_every_tick = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用是否会将未来信息泄露到历史条形图中的过去？</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要的是，您要了解所使用的工具是如何工作的，以及它们的行为是否与您的目标（重绘或不重绘）兼容。如果您阅读本页，您就会发现，重绘是一个复杂的问题。它有很多方面，也有很多原因。即使您不使用 Pine Script™ 编程，本页也将帮助您了解可能导致重绘的一系列原因，并希望能够与脚本作者进行更有意义的讨论。</font></font></p>
<h3 id="for-pine-script-programmers" class="md-heading"><a href="#for-pine-script-programmers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 Pine Script™</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序员</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如上所述，并非所有形式的重绘行为都必须不惜一切代价避免，也并非所有潜在的重绘行为都一定可以避免。我们希望本页能帮助您更好地了解其中的动态，以便您在设计交易工具时考虑到这些行为。本页的内容应该有助于您了解导致误导性重绘结果的常见编码错误。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论您的设计决策是什么，如果您
</font></font><a href="/pine-script-docs/writing/publishing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布了</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本，请向交易者解释该脚本，以便他们了解其行为方式。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本页涵盖了重新粉刷的三大类原因：</font></font></p>
<ul>
<li><a href="/pine-script-docs/concepts/repainting#historical-vs-realtime-calculations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史计算与实时计算</font></font></a></li>
<li><a href="/pine-script-docs/concepts/repainting#plotting-in-the-past"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过去的阴谋</font></font></a></li>
<li><a href="/pine-script-docs/concepts/repainting#dataset-variations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据集变化</font></font></a></li>
</ul>
<h2 id="historical-vs-realtime-calculations" class="md-heading"><a href="#historical-vs-realtime-calculations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史计算与实时</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="fluid-data-values" class="md-heading"><a href="#fluid-data-values"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流体数据</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史数据不包括条形图上的中间价格变动记录；仅包括
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_open"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开盘价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_low"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价（OHLC）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，在实时柱状图（工具市场开放时运行的柱状图）上，
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_low"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价并不固定；它们可以在实时柱状图关闭之前多次更改值，并且其 HLC 值是固定的。它们是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流动的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这导致脚本在历史数据和实时数据上的工作方式有时不同，其中只有开盘价
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_open"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
柱状图期间不会改变。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何使用
实时</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_low"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价等值的脚本
都可能产生在历史条形图上无法重复的计算——因此需要重新绘制。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看一下这个简单的脚本。它检测
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价（在实时栏中，这对应于工具的当前价格）高于和低于
</font></font><a href="https://www.tradingview.com/support/solutions/43000592270"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EMA 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交叉：</font></font></p>
<p><img src="/pine-script-docs/_astro/Repainting-01.B4bnEQz8_PQ677.webp" alt="图像" width="1748" height="726" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="62c"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Repainting"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">)</span></span><br><span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当收盘价超过 EMA 时，脚本使用 bgcolor()</font><font style="vertical-align: inherit;">
将背景颜色设为绿色
，当收盘</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;">价低于</font></a><font style="vertical-align: inherit;">EMA 时，脚本使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bgcolor()将背景颜色设为红色。</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕快照在 30 秒图表上实时显示脚本。已检测到 EMA 交叉，因此实时条形图的背景为绿色。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里的问题是，没有什么可以保证这种情况会一直持续到实时条结束。箭头指向的计时器显示实时条剩余 21 秒，在此之前任何事情都可能发生。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们正在见证一个重新粉刷的剧本。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了防止这种重绘，我们必须重写脚本，使其不使用实时柱线期间波动的值。这将需要使用已过去的柱线（通常是前一个柱线）的值，或
</font><font style="vertical-align: inherit;">
实时不变化的开盘价</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_open"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过多种方式实现这一点。此方法
</font></font><code dir="auto">and barstate.isconfirmed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为我们的交叉检测添加了一个条件，要求脚本在柱状图的最后一次迭代（即柱状图关闭且价格确认时）上执行。这是一种避免重绘的简单方法：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="3cs"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Repainting"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span></span><br><span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这使用在前一根柱线上检测到的交叉：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="71g"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Repainting"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">)[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">)[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这仅使用确认的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价和 EMA 值进行计算：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="6s3"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Repainting"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">)</span></span><br><span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将检测实时柱的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_open"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开盘价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与前几根柱的 EMA 值之间的交叉。请注意，EMA 是使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">close</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算的，因此它会重新绘制。我们必须确保使用确认的值来检测交叉，因此</font></font><code dir="auto">ma[1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在交叉检测逻辑中：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="6fx"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Repainting"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">])</span></span><br><span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">])</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">xUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">xDn</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有这些方法都有一个共同点：虽然它们可以防止重绘，但它们也会在重绘脚本之后触发信号。如果想避免重绘，这是一个不可避免的妥协。鱼与熊掌不可兼得。</font></font></strong></p>
<h3 id="repainting-requestsecurity-calls" class="md-heading"><a href="#repainting-requestsecurity-calls"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新绘制 `request.security()`</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数
</font><font style="vertical-align: inherit;">
在历史和实时条形图上的行为不同。在历史条形图上，它仅返回</font><font style="vertical-align: inherit;">来自其请求上下文的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已确认值，而在实时条形图上它可以返回</font></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未确认</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。当脚本重新启动执行时，具有实时状态的条形图将成为历史条形图，因此将仅包含它在这些条形图上确认的值。如果
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回的值
在实时条形图上波动而没有来自上下文的确认，则脚本将在重新启动执行时重新绘制它们。
</font><font style="vertical-align: inherit;">有关详细说明，请参阅</font><a href="/pine-script-docs/concepts/other-timeframes-and-data"><font style="vertical-align: inherit;">其他时间范围和数据</font></a><font style="vertical-align: inherit;">页面的
</font></font><a href="/pine-script-docs/concepts/other-timeframes-and-data#historical-and-realtime-behavior"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史和实时行为部分。</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/other-timeframes-and-data"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以确保更高时间范围的数据请求仅返回所有条形图上的确认值，而不管条形图状态如何，方法是
</font></font><code dir="auto">expression</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用历史引用运算符
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[]</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将参数偏移至少一个条形图
，并使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barmerge.lookahead_on</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;">request.security()</font></a></font><code dir="auto">lookahead</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中的参数
</font><font style="vertical-align: inherit;">
，如此处
</font><a href="/pine-script-docs/concepts/other-timeframes-and-data#higher-timeframe-data"><font style="vertical-align: inherit;">所述</font></a><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/other-timeframes-and-data#higher-timeframe-data"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的脚本演示了重绘和非重绘 HTF 数据请求之间的区别。它包含两个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用。第一个函数调用请求
来自的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数据，</font></font><code dir="auto">higherTimeframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无需额外指定，第二个调用请求带有偏移量和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barmerge.lookahead_on 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同一系列。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们在所有
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实时</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
柱（具有橙色背景的柱）上看到的， 包含</font></font><code dir="auto">repaintingClose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
未经 确认而波动的值
，这意味着</font><font style="vertical-align: inherit;">当脚本重新启动执行时</font></font><code dir="auto">higherTimeframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新绘制</font></font></em><font style="vertical-align: inherit;"></font><code dir="auto">nonRepaintingClose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。另一方面， 在实时和历史柱上的行为相同，即，它仅在有新的确认数据可用时更改其值：</font></font></p>
<p><img src="/pine-script-docs/_astro/Repainting-Repainting-request-security-calls-1.DKoD6okt_2uKSkR.webp" alt="图像" width="1342" height="570" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5vy"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Repainting&nbsp;vs&nbsp;non-repainting&nbsp;`request.security()`</span><span class="mtk29">&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;timeframe&nbsp;to&nbsp;request&nbsp;data&nbsp;from.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">higherTimeframe</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.timeframe</span><span class="mtk13">(</span><span class="mtk29">"30"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Timeframe"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">timeframe.in_seconds</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">timeframe.in_seconds</span><span class="mtk13">(</span><span class="mtk33">higherTimeframe</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">runtime.error</span><span class="mtk13">(</span><span class="mtk29">"The&nbsp;'Timeframe'&nbsp;input&nbsp;is&nbsp;smaller&nbsp;than&nbsp;the&nbsp;chart's</span><span class="mtk29">&nbsp;timeframe.&nbsp;Choose&nbsp;a&nbsp;higher&nbsp;timeframe."</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;current&nbsp;`close`&nbsp;requested&nbsp;from&nbsp;the&nbsp;`higherTim</span><span class="mtk9">eframe`.&nbsp;Fluctuates&nbsp;without&nbsp;confirmation&nbsp;on&nbsp;realti</span><span class="mtk9">me&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">repaintingClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">request.security</span><span class="mtk13">(</span><span class="mtk11">syminfo.tickerid</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">higherTimeframe</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;last&nbsp;confirmed&nbsp;`close`&nbsp;requested&nbsp;from&nbsp;the&nbsp;`hi</span><span class="mtk9">gherTimeframe`.&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;Behaves&nbsp;the&nbsp;same&nbsp;on&nbsp;historical&nbsp;and&nbsp;realtime&nbsp;bar</span><span class="mtk9">s.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">nonRepaintingClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">request.security</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">syminfo.tickerid</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">higherTimeframe</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookahead</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">barmerge.lookahead_on</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;values.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">repaintingClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Repainting&nbsp;close"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">nonRepaintingClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Non-repainting&nbsp;close"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;a&nbsp;shape&nbsp;when&nbsp;a&nbsp;new&nbsp;`higherTimeframe`&nbsp;start</span><span class="mtk9">s.</span></span><br><span><span class="mtk16">plotshape</span><span class="mtk13">(</span><span class="mtk16">timeframe.change</span><span class="mtk13">(</span><span class="mtk33">higherTimeframe</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Timeframe&nbsp;change&nbsp;marker"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">shape.square</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.top</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.small</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;the&nbsp;background&nbsp;on&nbsp;realtime&nbsp;bars.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isrealtime</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Realtime&nbsp;bar&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当图表发生</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change"><font style="vertical-align: inherit;">变化</font></a><font style="vertical-align: inherit;">时，我们使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotshape()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数来标记
</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">higherTimeframe</code><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果</font><font style="vertical-align: inherit;">低于图表的时间范围，</font><font style="vertical-align: inherit;">该脚本将产生</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_runtime.error"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行时错误。</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">higherTimeframe</code><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在历史条形图上，在每个时间范围</font><em><font style="vertical-align: inherit;">结束</font></em></font><code dir="auto">repaintingClose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时都有一个新值
</font><font style="vertical-align: inherit;">，并且在每个时间范围</font><em><font style="vertical-align: inherit;">开始</font></em><font style="vertical-align: inherit;">时都有一个新值</font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code dir="auto">nonRepaintingClose</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了便于重复使用，下面是一个简单的
</font></font><code dir="auto">noRepaintSecurity()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，可以在脚本中应用该函数来请求非重绘的更高时间范围的值：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="10w"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Requests&nbsp;non-repainting&nbsp;`expression`&nbsp;values&nbsp;from&nbsp;</span><span class="mtk9">the&nbsp;context&nbsp;of&nbsp;the&nbsp;`symbol`&nbsp;and&nbsp;`timeframe`.</span></span><br><span><span class="mtk15">noRepaintSecurity</span><span class="mtk13">(</span><span class="mtk33">symbol</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeframe</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">expression</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">request.security</span><span class="mtk13">(</span><span class="mtk33">symbol</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeframe</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">expression</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookahead</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">barmerge.lookahead_on</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系列的偏移量</font></font><code dir="auto">[1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和使用
</font></font><code dir="auto">lookahead = barmerge.lookahead_on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是相互依赖的。
</font><font style="vertical-align: inherit;">如果不损害功能的完整性，</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就无法删除任何一个。</font></font></strong><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与普通的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用不同，此包装函数不能接受元组</font></font><code dir="auto">expression</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参数。对于多元素用例，可以传递
</font></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义的类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其字段包含要请求的所需元素。</font></font></li>
</ul>
<h3 id="using-requestsecurity-at-lower-timeframes" class="md-heading"><a href="#using-requestsecurity-at-lower-timeframes"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">在较短的时间范围</font></span><font style="vertical-align: inherit;">内使用 `request.security()`</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些脚本使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来请求</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低于</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表时间范围的时间范围内的数据。当专门设计用于处理较低时间范围内的 intrabars 的函数被发送到时间范围内时，这可能很有用。当这种类型的用户定义函数需要检测 intrabars 的第一个 bar（大多数情况下都是这样）时，该技术仅适用于历史 bar。这是因为实时 intrabars 尚未排序。其影响是此类脚本无法实时重现它们在历史 bar 上的行为。例如，任何生成警报的逻辑都会有缺陷，并且需要不断刷新才能将过去的实时 bar 重新计算为历史 bar。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当在比图表更低的时间范围内使用且没有能够区分内部条形图的专门函数时，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security()将仅返回图表条形图扩张中</font></font></a><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一个</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部条形图
的值</font><font style="vertical-align: inherit;">，这通常没用，也不会实时重现，因此导致重新绘制。</font></font></p>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于所有这些原因，除非您了解在比图表更低的时间范围内使用request.security()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的微妙之处
</font><font style="vertical-align: inherit;">
，否则最好避免在这些时间范围内使用该函数。更高质量的脚本将具有检测此类异常的逻辑，并防止显示在使用较低时间范围内无效的结果。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于更可靠的较低时间范围数据请求，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security_lower_tf()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如
</font><a href="/pine-script-docs/concepts/other-timeframes-and-data"><font style="vertical-align: inherit;">其他时间范围和数据</font></a><font style="vertical-align: inherit;">页面的</font></font><a href="/pine-script-docs/concepts/other-timeframes-and-data#lower-timeframe-data"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节
中所述。</font></font><a href="/pine-script-docs/concepts/other-timeframes-and-data"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<h3 id="future-leak-with-requestsecurity" class="md-heading"><a href="#future-leak-with-requestsecurity"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">`request.security()`</font></span><font style="vertical-align: inherit;">的未来泄漏</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当
</font><font style="vertical-align: inherit;">
使用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">request.security()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">lookahead = barmerge.lookahead_on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来获取价格而不偏移系列时</font></font><code dir="auto">[1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将返回历史条形图上的未来数据，这具有危险的误导性。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管历史条形图会在人们应该知道之前神奇地显示未来的价格，但由于未来是未知的，所以不可能实时预测，因此不存在未来的条形图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是一个例子：</font></font></p>
<p><img src="/pine-script-docs/_astro/Repainting-FutureLeakWithRequestSecurity-01.B8DsNHGV_Kgu8T.webp" alt="图像" width="1762" height="850" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1cs"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//&nbsp;FUTURE&nbsp;LEAK!&nbsp;DO&nbsp;NOT&nbsp;USE!</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Future&nbsp;leak"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk33">futureHigh</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">request.security</span><span class="mtk13">(</span><span class="mtk11">syminfo.tickerid</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"1D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookahead</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">barmerge.lookahead_on</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">futureHigh</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，较高的时间范围线在发生之前如何显示时间范围的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高值。避免这种影响的解决方案是使用</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/repainting#repainting-request-security-calls"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中演示的函数
</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本发布中不允许使用前瞻技术产生误导性结果，如
</font><a href="/pine-script-docs/concepts/other-timeframes-and-data"><font style="vertical-align: inherit;">其他时间范围和数据</font></a><font style="vertical-align: inherit;">页面的
</font></font><a href="/pine-script-docs/concepts/other-timeframes-and-data#lookahead"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前瞻</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分所述。使用这种误导性技术的脚本发布
</font><strong><font style="vertical-align: inherit;">将受到审核</font></strong><font style="vertical-align: inherit;">。</font></font><a href="/pine-script-docs/concepts/other-timeframes-and-data"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font></p>
<h3 id="varip" class="md-heading"><a href="#varip"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`varip`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用varip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明模式的脚本
（有关详细信息，请参阅有关</font></font><a href="/pine-script-docs/language/variable-declarations#varip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">varip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
的部分
</font><font style="vertical-align: inherit;">
）会保存实时更新的信息，而这些信息无法在只有 OHLC 信息可用的历史条形图上重现。此类脚本可能在实时情况下有用，包括生成警报，但它们的逻辑无法进行回溯测试，它们在历史条形图上的绘图也无法反映将实时进行的计算。</font></font></p>
<h3 id="bar-state-built-ins" class="md-heading"><a href="#bar-state-built-ins"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">内置</font></span><font style="vertical-align: inherit;">状态栏</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/bar-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用条形状态</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的脚本</font><font style="vertical-align: inherit;">
可能会或可能不会重绘。正如我们在上一节中看到的，使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disconfirmed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barstate.isconfirmed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上是</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免在历史条形图上</font></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重现</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重绘的一种方法</font><font style="vertical-align: inherit;">，历史条形图始终是“已确认的”。但是，使用其他条形状态（例如
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barstate.isnew</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）将导致重绘。原因是在历史条形图上，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barstate.isnew</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
位于</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图的收盘
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但在实时中，它位于</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#open"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开盘价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。使用其他条形状态变量通常会导致历史条形图和实时条形图之间出现某种类型的行为差异。</font></font></p>
<h3 id="timenow" class="md-heading"><a href="#timenow"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`timenow`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timenow
</font><font style="vertical-align: inherit;">
内置函数返回当前时间。使用此变量的脚本无法显示一致的历史和实时行为，因此它们必须重新绘制</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"></font></p>
<h3 id="strategies" class="md-heading"><a href="#strategies"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略使用</font></font><code dir="auto">calc_on_every_tick = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每次实时更新时执行，而策略在
历史条形图</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时运行
。它们很可能不会生成相同的订单执行，因此会重新绘制。请注意，当发生这种情况时，它也会使回溯测试结果无效，因为它们不能代表策略的实时行为。</font></font></p>
<h2 id="plotting-in-the-past" class="md-heading"><a href="#plotting-in-the-past"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">过去</font></span><font style="vertical-align: inherit;">的阴谋</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 5 个柱线过去后检测枢轴的脚本通常会回溯到过去，绘制 5 个柱线前实际枢轴上的枢轴水平或值。这通常会导致毫无戒心的交易者在查看历史柱线上的绘图时推断，当枢轴实时发生时，与检测到枢轴时相比，枢轴上会出现相同的绘图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看一个脚本，该脚本通过将价格置于检测到枢轴点后的 5 个条形图上来显示高枢轴点的价格：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="6rc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Plotting&nbsp;in&nbsp;the&nbsp;past"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk33">pHi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.pivothigh</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">pHi</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">[</span><span class="mtk12">5</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">pHi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">format.mintick</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n🠇"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">yloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">yloc.abovebar</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_none</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.normal</span><span class="mtk13">)</span></span><br></code></div>
<p><img src="/pine-script-docs/_astro/Repainting-PlottingInThePast-01.CdfEKXRh_VvvoS.webp" alt="图像" width="1766" height="736" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本会重新绘制，因为如果一个已过去的实时条形图被识别为枢轴点，且在实际枢轴点出现后的 5 个条形图上没有显示价格，则它可能会被赋予价格。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示效果很好，但可能会产生误导。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为他人开发脚本时，解决此问题的最佳方法是默认绘图时</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不使用</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移，但为脚本用户提供通过输入打开过去绘图的选项，因此他们必然知道脚本正在做什么，例如：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="5em"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Plotting&nbsp;in&nbsp;the&nbsp;past"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk33">plotInThePast</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input</span><span class="mtk13">(</span><span class="mtk11">false</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Plot&nbsp;in&nbsp;the&nbsp;past"</span><span class="mtk13">)</span></span><br><span><span class="mtk33">pHi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.pivothigh</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">pHi</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">[</span><span class="mtk33">plotInThePast</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">pHi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">format.mintick</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n🠇"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">yloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">yloc.abovebar</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_none</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.normal</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="dataset-variations" class="md-heading"><a href="#dataset-variations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据集</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变化</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="starting-points" class="md-heading"><a href="#starting-points"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起点</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">​</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本从图表的第一个历史条形图开始执行，然后按顺序在每个条形图上执行，如本手册的 Pine Script™
</font></font><a href="/pine-script-docs/language/execution-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">页面中所述。如果第一个条形图发生变化，则脚本通常不会像数据集在不同时间点开始时那样计算。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下因素会影响您在图表上看到的条形数量及其</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起点</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您持有的账户类型</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据供应商提供的历史数据</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据集的对齐要求，决定了它的
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起点</font></font></em></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是特定帐户的限制标准：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级计划包含 20,000 个历史条形图。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pro 和 Pro+ 计划的 10000 个历史条形图。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他计划的 5000 个历史条形图。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起点根据以下规则确定，具体取决于图表的时间范围：</font></font></p>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1、5、10、15、30 秒</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：与一天的开始对齐。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 - 14 分钟</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：与一周的开始一致。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15 - 29 分钟</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：与月初一致。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30 – 1439 分钟</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：与一年的开始一致。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1440 分钟及更高</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：与第一个可用的历史数据点对齐。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着时间的推移，这些因素会导致图表的历史记录从不同的时间点开始。这通常会对脚本计算产生影响，因为早期条形图的计算结果变化可能会影响数据集中的所有其他条形图。例如，使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dvaluewhen"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ta.valuewhen()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dbarssince"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ta.barssince()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dema"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ta.ema()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等函数将产生随早期历史记录而变化的结果。</font></font></p>
<h3 id="revision-of-historical-data" class="md-heading"><a href="#revision-of-historical-data"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">历史数据</font></span><font style="vertical-align: inherit;">修订</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史和实时条形图使用交易所/经纪商提供的两种不同的数据馈送来构建：历史数据和实时数据。实时条形图过时，交易所/经纪商有时会对条形图价格进行通常很小的调整，然后将其写入其历史数据。刷新图表或重新执行这些过时的实时条形图上的脚本时，它们将使用历史数据构建和计算，历史数据将包含通常很小的价格修订（如果有的话）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史数据也可能因为其他原因而被修改，例如股票分割。</font></font></p>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a href="/pine-script-docs/concepts/plots" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前的</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow-back">  <use xlink:href="#ai:local:theme/arrow-back"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图  </font></font></h4> </a>  <a href="/pine-script-docs/concepts/sessions" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  会议</font></font><svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本页</font></font></h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#repainting" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></li></a><a href="#introduction" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></li></a><a href="#for-script-users" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于脚本用户</font></font></li></a><a href="#for-pine-script-programmers" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 Pine Script™ 程序员</font></font></li></a><a href="#historical-vs-realtime-calculations" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史计算与实时计算</font></font></li></a><a href="#fluid-data-values" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流体数据值</font></font></li></a><a href="#repainting-requestsecurity-calls" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新绘制 `request.security()` 调用</font></font></li></a><a href="#using-requestsecurity-at-lower-timeframes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在较短的时间范围内使用 `request.security()`</font></font></li></a><a href="#future-leak-with-requestsecurity" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`request.security()` 的未来泄漏</font></font></li></a><a href="#varip" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`varip`</font></font></li></a><a href="#bar-state-built-ins" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置状态栏</font></font></li></a><a href="#timenow" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`timenow`</font></font></li></a><a href="#strategies" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></li></a><a href="#plotting-in-the-past" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过去的阴谋</font></font></li></a><a href="#dataset-variations" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据集变化</font></font></li></a><a href="#starting-points" class="document-toc-link" data-astro-cid-oor6cujd="" aria-current="true"><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起点</font></font></li></a><a href="#revision-of-historical-data" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史数据修订</font></font></li></a></ul><a class="back-top" href="#top" data-astro-cid-oor6cujd=""><svg width="16" height="16" viewBox="0 0 16 16" data-astro-cid-oor6cujd="" data-icon="theme/back-top">  <symbol id="ai:local:theme/back-top"><path fill="currentColor" fill-rule="evenodd" d="M6.25 12.5A2.75 2.75 0 0 0 9 9.75V4.56L6.78 6.78a.75.75 0 0 1-1.06-1.06l3.5-3.5a.75.75 0 0 1 1.06 0l3.5 3.5a.75.75 0 0 1-1.06 1.06L10.5 4.56v5.19a4.25 4.25 0 0 1-8.5 0v-1a.75.75 0 0 1 1.5 0v1a2.75 2.75 0 0 0 2.75 2.75Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/back-top"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回到顶部
</font></font></a></section></aside></div> </main> </div>            <script data-astro-rerun="" src="/pine-script-docs/static/pine-highlighter-v06.js" data-astro-exec=""></script><div id="goog-gt-tt" class="VIpgJd-yAWNEb-L7lbkb skiptranslate" style="border-radius: 12px; margin: 0 0 0 -23px; padding: 0; font-family: 'Google Sans', Arial, sans-serif;" data-id=""><div id="goog-gt-vt" class="VIpgJd-yAWNEb-hvhgNd"><div class=" VIpgJd-yAWNEb-hvhgNd-l4eHX-i3jM8c"><img src="https://fonts.gstatic.com/s/i/productlogos/translate/v14/24px.svg" width="24" height="24" alt=""></div><div class=" VIpgJd-yAWNEb-hvhgNd-k77Iif-i3jM8c"><div class="VIpgJd-yAWNEb-hvhgNd-IuizWc" dir="ltr">Original text</div><div id="goog-gt-original-text" class="VIpgJd-yAWNEb-nVMfcd-fmcmS VIpgJd-yAWNEb-hvhgNd-axAV1"></div></div><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid ltr"><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid-B7I4Od ltr" dir="ltr"><div class="VIpgJd-yAWNEb-hvhgNd-UTujCb">Rate this translation</div><div class="VIpgJd-yAWNEb-hvhgNd-eO9mKe">Your feedback will be used to help improve Google Translate</div></div><div class="VIpgJd-yAWNEb-hvhgNd-xgov5 ltr"><button id="goog-gt-thumbUpButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Good translation" aria-label="Good translation" aria-pressed="false"><span id="goog-gt-thumbUpIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7H2v13h16c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM7 18H4V9h3v9zm14-7l-3 7H9V8l4.34-4.34L12 9h9v2z"></path></svg></span><span id="goog-gt-thumbUpIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7v13h11c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM5 7H1v13h4V7z"></path></svg></span></button><button id="goog-gt-thumbDownButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Poor translation" aria-label="Poor translation" aria-pressed="false"><span id="goog-gt-thumbDownIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7h5V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zM17 6h3v9h-3V6zM3 13l3-7h9v10l-4.34 4.34L12 15H3v-2z"></path></svg></span><span id="goog-gt-thumbDownIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zm16 0h4V4h-4v13z"></path></svg></span></button></div></div><div id="goog-gt-votingHiddenPane" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><form id="goog-gt-votingForm" action="//translate.googleapis.com/translate_voting?client=te_lib" method="post" target="votingFrame" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><input type="text" name="sl" id="goog-gt-votingInputSrcLang"><input type="text" name="tl" id="goog-gt-votingInputTrgLang"><input type="text" name="query" id="goog-gt-votingInputSrcText"><input type="text" name="gtrans" id="goog-gt-votingInputTrgText"><input type="text" name="vote" id="goog-gt-votingInputVote"></form><iframe name="votingFrame" frameborder="0"></iframe></div></div></div> </body></html>