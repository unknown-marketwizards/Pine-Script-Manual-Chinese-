<html lang="zh-CN" data-theme="light" class="translated-ltr"><head><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/pine-script-docs/static/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>编写/调试</title><meta name="og:title" content="Writing / Debugging"><meta name="twitter:title" content="Writing / Debugging"><meta name="description" content="Everything you need to know about Pine Script™."><meta name="og:description" content="Everything you need to know about Pine Script™."><meta name="twitter:description" content="Everything you need to know about Pine Script™."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png"><meta name="twitter:image" content="/pine-script-docs/meta-image.png"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="../../writing/debugging/"><meta name="twitter:url" content="../../writing/debugging/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="../../writing/debugging/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="stylesheet" href="/pine-script-docs/_astro/index.jN9AZoBe.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.C8b720yZ.css"><script type="module" src="/pine-script-docs/_astro/hoisted.D4iEV6y6.js" data-astro-exec=""></script><style type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://www.gstatic.com/_/translate_http/_/ss/k=translate_http.tr.26tY-h6gH9w.L.W.O/am=GAY/d=0/rs=AN8SPfrev-A3NvrBP0gNq8zXCqKY7IcBLA/m=el_main_css"></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16px" height="16px" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02Zm-3.95-.3a7.91 7.91 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8V4Zm0 9v2h1v-2H8Zm6-3V9h-2v1h2ZM3 9v1h2V9H3Zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm4.2-6-.7-.7-1.4 1.4.7.7L12.7 6ZM5 13.7l-.7-.7 1.4-1.4.7.7L5 13.7Zm7.7-.7-.7.7-1.4-1.4.7-.7 1.4 1.4ZM4.3 6l.7-.7 1.4 1.4-.7.7L4.3 6Zm3 17 14-14 .8.7L8 23.7l-.7-.7Zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9Z"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh="">    <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="Close menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey="">Identifiers</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey="">Operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey="">Variable declarations</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey="">Conditional structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey="">Loops</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey="">Type system</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey="">Built-ins</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey="">User-defined functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey="">Objects</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey="">Enums</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey="">Methods</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey="">FAQ</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script™ version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script™ version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script™ version 3</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="主导航" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="Open navigation menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="主页按钮" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><svg width="188" height="44" viewBox="0 0 188 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001ZM32.4978 22.1105L27.1641 25.5207L19.7195 19.2258C19.1767 18.7669 18.4312 18.6305 17.7611 18.8676L13.8245 20.2602L21.9253 9.59841L32.4978 22.1105Z" fill="currentColor"></path>
<path d="M33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="currentColor"></path>
<path d="M59.56 13.96C63.016 13.96 65.536 16.456 65.536 19.696C65.536 22.936 63.016 25.432 59.56 25.432H57.376V31H53.896V13.96H59.56ZM59.512 22.168C61.096 22.168 62.152 21.088 62.152 19.696C62.152 18.304 61.096 17.224 59.512 17.224H57.376V22.168H59.512ZM70.8636 14.944C70.8636 16.096 69.9276 17.032 68.7516 17.032C67.6236 17.032 66.6636 16.096 66.6636 14.944C66.6636 13.792 67.6236 12.856 68.7516 12.856C69.9276 12.856 70.8636 13.792 70.8636 14.944ZM67.1196 31V19H70.4076V31H67.1196ZM73.0849 31V19H76.3729V20.368C76.9969 19.408 78.2449 18.736 79.8049 18.736C82.7089 18.736 84.4369 20.848 84.4369 23.968V31H81.1489V24.52C81.1489 22.792 80.4049 21.736 79.0369 21.736C77.5249 21.736 76.3729 22.84 76.3729 25.144V31H73.0849ZM86.2041 25C86.2041 21.448 88.8681 18.736 92.5161 18.736C95.6601 18.736 98.4201 20.752 98.4201 24.64C98.4201 24.928 98.4201 25.264 98.3721 25.768H89.3961C89.5881 27.376 91.0041 28.264 92.5881 28.264C94.0761 28.264 95.1561 27.568 95.6841 26.752L98.1321 28.576C97.0281 30.184 95.0841 31.264 92.5641 31.264C88.9881 31.264 86.2041 28.792 86.2041 25ZM92.4201 21.448C91.1961 21.448 89.8281 22.072 89.5161 23.536H95.1321C94.8441 22.12 93.6441 21.448 92.4201 21.448ZM104.412 28.24L107.076 26.008C107.916 27.28 109.38 28.024 110.772 28.024C112.14 28.024 113.052 27.352 113.052 26.368C113.052 25.408 112.356 24.736 110.676 24.16L109.236 23.656C106.5 22.696 105.036 21.112 105.036 18.784C105.036 15.568 107.484 13.672 110.796 13.672C112.884 13.672 114.708 14.392 116.172 16.024L113.868 18.4C113.052 17.416 111.996 16.936 110.82 16.936C109.644 16.936 108.54 17.44 108.54 18.448C108.54 19.48 109.38 19.936 111.18 20.584L112.548 21.088C115.044 22 116.604 23.584 116.604 26.152C116.58 29.2 114.156 31.288 110.628 31.288C107.916 31.288 105.636 30.112 104.412 28.24ZM129.859 27.808C128.827 29.872 126.667 31.264 124.171 31.264C120.619 31.264 117.811 28.624 117.811 25C117.811 21.376 120.619 18.736 124.171 18.736C126.667 18.736 128.827 20.128 129.859 22.192L127.003 23.728C126.523 22.624 125.491 21.808 124.171 21.808C122.443 21.808 121.123 23.152 121.123 25C121.123 26.848 122.443 28.192 124.171 28.192C125.491 28.192 126.523 27.376 127.003 26.272L129.859 27.808ZM131.482 31V19H134.77V20.92C135.178 19.744 136.402 18.856 137.746 18.856C138.082 18.856 138.442 18.88 138.85 19V22.336C138.346 22.168 137.89 22.072 137.362 22.072C135.802 22.072 134.77 23.296 134.77 25.264V31H131.482ZM144.215 14.944C144.215 16.096 143.279 17.032 142.103 17.032C140.975 17.032 140.015 16.096 140.015 14.944C140.015 13.792 140.975 12.856 142.103 12.856C143.279 12.856 144.215 13.792 144.215 14.944ZM140.471 31V19H143.759V31H140.471ZM146.436 36.016V19H149.724V20.344C150.276 19.576 151.548 18.736 153.204 18.736C156.396 18.736 158.844 21.592 158.844 25C158.844 28.408 156.396 31.264 153.204 31.264C151.548 31.264 150.276 30.424 149.724 29.656V36.016H146.436ZM155.508 25C155.508 23.128 154.284 21.736 152.484 21.736C150.684 21.736 149.46 23.128 149.46 25C149.46 26.872 150.684 28.264 152.484 28.264C154.284 28.264 155.508 26.872 155.508 25ZM168.407 30.88C167.879 31.048 167.231 31.144 166.319 31.144C163.775 31.144 161.735 29.728 161.735 26.8V21.88H159.311V19H161.735V15.664H165.023V19H168.407V21.88H165.023V26.152C165.023 27.616 165.647 28.192 167.063 28.192C167.591 28.192 168.023 28.12 168.407 27.976V30.88ZM177.626 22.648V13.96H179.978L181.874 16.888L183.746 13.96H186.122V22.648H183.698V18.184L181.874 20.968L180.026 18.136V22.648H177.626ZM171.386 22.648V16.456H169.058V13.96H176.258V16.456H173.93V22.648H171.386Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="搜索文档" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0Zm-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="重置" data-search-clear="" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除</font></font></button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="关闭" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga="">Search results</div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp="">    </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true" style="display:none"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="Close image preview" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94 5.53 4.47Z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="返回文档主页。" data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户手册</font></font></span>  </a>  <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <a href="/pine-script-docs/writing/style-guide" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></a> <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <span class="current-item" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></span> </div>     </div> <div id="slot-container" data-astro-cid-xgirumru="">  <h1 id="debugging" class="md-heading"><a href="#debugging"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<h2 id="introduction" class="md-heading"><a href="#introduction"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TradingView 将 Pine Editor 与图表界面紧密集成，有助于高效、交互式地调试 Pine Script™ 代码，因为脚本可以在图表内外的多个位置产生动态结果。程序员可以利用这些结果来改进脚本的行为，并确保一切按预期运行。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当程序员了解检查编写脚本时可能遇到的各种行为的适当技术时，他们可以快速彻底地识别和解决代码中的潜在问题，从而实现更无缝的整体编码体验。本页演示了使用 Pine Script™ 时调试代码的一些最方便的方法。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在进一步了解此页面之前，我们建议您熟悉 Pine 的
</font></font><a href="/pine-script-docs/language/execution-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/language/type-system"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为在 Pine Script™ 环境中进行调试时了解这些细节至关重要。</font></font></p></div></aside>
<h2 id="the-lay-of-the-land" class="md-heading"><a href="#the-lay-of-the-land"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地形</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">​</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine 脚本可以以多种不同的方式输出其结果，程序员可以利用其中任何一种方式进行调试。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数可以在图表窗格、脚本的状态行、价格（y 轴）刻度和数据窗口中显示结果，提供简单、方便的方法来调试数字和条件值：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-The-lay-of-the-land-1.BMFtSmLt_rnRYW.webp" alt="图像" width="1342" height="590" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6dn"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"The&nbsp;lay&nbsp;of&nbsp;the&nbsp;land&nbsp;-&nbsp;Plots"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`bar_index`&nbsp;in&nbsp;all&nbsp;available&nbsp;locations</span><span class="mtk9">.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"bar_index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当启用图表“状态行”设置的“指标”部分中的“值”复选框时，才会显示脚本的状态行输出。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当启用图表“刻度和线条”设置中的“指标和财务”下拉菜单中的选项时，价格刻度才会显示绘图值或名称。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bgcolor
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数显示脚本窗格背景中的颜色，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barcolor()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数更改主图表的条形图或蜡烛图的颜色。这两个函数都提供了一种可视化条件的简单方法：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-The-lay-of-the-land-2.Dt_T7jt8_Zx7tBv.webp" alt="图像" width="1342" height="556" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3t"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"The&nbsp;lay&nbsp;of&nbsp;the&nbsp;land&nbsp;-&nbsp;Background&nbsp;and&nbsp;bar&nbsp;colors"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;if&nbsp;the&nbsp;`close`&nbsp;is&nbsp;rising&nbsp;over&nbsp;2&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">risingPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rising</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart&nbsp;background&nbsp;and&nbsp;color&nbsp;the&nbsp;ma</span><span class="mtk9">in&nbsp;chart&nbsp;bars&nbsp;based&nbsp;on&nbsp;`risingPrice`.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">risingPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`risingPrice`&nbsp;highlight"</span><span class="mtk13">)</span></span><br><span><span class="mtk16">barcolor</span><span class="mtk13">(</span><span class="mtk33">risingPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.bg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`risingPrice`&nbsp;bar&nbsp;color"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine 的
</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">label</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）在脚本窗格中生成绘图。虽然它们不会在其他位置（例如状态行或数据窗口）返回结果，但它们提供了替代的灵活解决方案，可直接在图表上检查数值、条件和字符串：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-The-lay-of-the-land-3.BR7JNYrd_Z2s1rX.webp" alt="图像" width="1342" height="562" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="543"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"The&nbsp;lay&nbsp;of&nbsp;the&nbsp;land&nbsp;-&nbsp;Drawings"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;time&nbsp;changes&nbsp;on&nbsp;the&nbsp;"1D"&nbsp;timef</span><span class="mtk9">rame.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">newDailyBar</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">timeframe.change</span><span class="mtk13">(</span><span class="mtk29">"1D"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;previous&nbsp;bar's&nbsp;`bar_index`&nbsp;from&nbsp;when&nbsp;`newDail</span><span class="mtk9">yBar`&nbsp;last&nbsp;occurred.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">closedIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.valuewhen</span><span class="mtk13">(</span><span class="mtk33">newDailyBar</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;previous&nbsp;bar's&nbsp;`close`&nbsp;from&nbsp;when&nbsp;`newDailyBar</span><span class="mtk9">`&nbsp;last&nbsp;occurred.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">closedPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.valuewhen</span><span class="mtk13">(</span><span class="mtk33">newDailyBar</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">newDailyBar</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Draws&nbsp;a&nbsp;line&nbsp;from&nbsp;the&nbsp;previous&nbsp;`closedIndex`&nbsp;and&nbsp;</span><span class="mtk9">`closedPrice`&nbsp;to&nbsp;the&nbsp;current&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">closedIndex</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">closedPrice</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">closedIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">closedPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Variable&nbsp;info&nbsp;to&nbsp;display&nbsp;in&nbsp;a&nbsp;label.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"'1D'&nbsp;bar&nbsp;closed&nbsp;at:&nbsp;\n("</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">closedIndex</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">",&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">closedPrice</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">")"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Draws&nbsp;a&nbsp;label&nbsp;at&nbsp;the&nbsp;current&nbsp;`closedIndex`&nbsp;and&nbsp;`c</span><span class="mtk9">losedPrice`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk33">closedIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">closedPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数产生
</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果。每次脚本调用这些函数中的任何一个时，脚本都会在
</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗格中记录一条消息，以及时间戳和导航选项，以识别触发日志的具体时间、图表栏和代码行：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-The-lay-of-the-land-4.fSt39wX6_2urrNy.webp" alt="图像" width="1342" height="666" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="41x"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"The&nbsp;lay&nbsp;of&nbsp;the&nbsp;land&nbsp;-&nbsp;Pine&nbsp;Logs"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;natural&nbsp;logarithm&nbsp;of&nbsp;the&nbsp;current&nbsp;`high&nbsp;-&nbsp;low`</span><span class="mtk9">&nbsp;range.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">logRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.log</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`logRange`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">logRange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"logRange"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Generate&nbsp;an&nbsp;"error"&nbsp;or&nbsp;"info"&nbsp;message&nbsp;on&nbsp;the&nbsp;co</span><span class="mtk9">nfirmed&nbsp;bar,&nbsp;depending&nbsp;on&nbsp;whether&nbsp;`logRange`&nbsp;is&nbsp;de</span><span class="mtk9">fined.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">switch</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">logRange</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">log.error</span><span class="mtk13">(</span><span class="mtk29">"Undefined&nbsp;`logRange`&nbsp;value."</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.info</span><span class="mtk13">(</span><span class="mtk29">"`logRange`&nbsp;value:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">logRange</span><span class="mtk13">))</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Generate&nbsp;a&nbsp;"warning"&nbsp;message&nbsp;for&nbsp;unconfirmed&nbsp;va</span><span class="mtk9">lues.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.warning</span><span class="mtk13">(</span><span class="mtk29">"Unconfirmed&nbsp;`logRange`&nbsp;value:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">logRange</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以应用上述任何一种或几种方法组合来建立适合其需求和偏好的调试例程，具体取决于他们处理的数据类型和结构。请参阅以下部分，详细了解各种调试技术。</font></font></p>
<h2 id="numeric-values" class="md-heading"><a href="#numeric-values"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数值</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">​</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Pine Script™ 中创建代码时，不可避免地要使用数字。因此，为了确保脚本按预期工作，了解如何检查脚本</font><font style="vertical-align: inherit;">接收和计算的数字（ </font></font><a href="/pine-script-docs/language/type-system#int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/language/type-system#float"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">float ）值至关重要。</font></font></a><font style="vertical-align: inherit;"></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节讨论</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于图表的基本数字</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试方法。脚本还可以将数字转换为
</font></font><a href="/pine-script-docs/language/type-system#string"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从而允许使用与字符串相关的技术检查数字。有关更多信息，请参阅
</font></font><a href="/pine-script-docs/writing/debugging#strings"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
部分。</font></font></p></div></aside>
<h3 id="plotting-numbers" class="md-heading"><a href="#plotting-numbers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘制</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查脚本数值的最直接方法之一是使用</font></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，它可以在图表上以图形方式显示结果，并在脚本的状态行、价格刻度和数据窗口中显示格式化的数字。函数
</font></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示其结果的位置取决于参数</font></font><code dir="auto">display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。默认情况下，其值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_display.all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">display.all</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有脚本的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局范围</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能包含</font></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用，这意味着这些函数只能接受全局变量和文字。它们不能使用从
</font></font><a href="/pine-script-docs/language/loops"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义的函数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/language/methods#user-defined-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的局部范围声明的变量。</font></font></p></div></aside>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plot()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数显示以图表时间范围测量的内置
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量值的 1 条变化（例如，“1D”图表上绘制的值为 1 表示当前条和前一个条的开盘时间相差一天）。检查此系列有助于识别图表数据中的时间间隔，这在设计基于时间的指标时非常有用。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们没有指定</font></font><code dir="auto">display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，该函数使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_display.all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">display.all</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着它将在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能的位置显示数据，如下所示：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Numeric-values-Plotting-numbers-1.CPWsJyU1_26SArq.webp" alt="图像" width="1342" height="590" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="ft"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Plotting&nbsp;numbers&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Time&nbsp;changes"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;one-bar&nbsp;change&nbsp;in&nbsp;the&nbsp;chart&nbsp;symbol's&nbsp;`time`&nbsp;v</span><span class="mtk9">alue,&nbsp;measured&nbsp;in&nbsp;units&nbsp;of&nbsp;the&nbsp;chart&nbsp;timeframe.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk11">time</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1000.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">timeframe.in_seconds</span><span class="mtk13">())</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;`timeChange`&nbsp;in&nbsp;all&nbsp;possible&nbsp;locati</span><span class="mtk9">ons.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">timeChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Time&nbsp;difference&nbsp;(in&nbsp;chart&nbsp;bar&nbsp;units)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本状态行和数据窗口中显示的数字反映了图表光标位置的绘制值。当鼠标指针不在图表上时，这些区域将显示最新的条形图值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价格尺度中的数字反映可见图表上的最新可用值。</font></font></li>
</ul>
<h4 id="without-affecting-the-scale" class="md-heading"><a href="#without-affecting-the-scale"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在不影响</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规模的情况下</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在脚本中调试多个数值时，程序员可能希望在不干扰价格刻度或不扰乱图表窗格中的视觉输出的情况下检查它们，因为扭曲的刻度和重叠的图表可能会使评估结果变得更加困难。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查数字而不向图表窗格添加更多视觉效果的一种简单方法是将</font></font><code dir="auto">display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本
</font></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中的值更改为使用它们的其他</font></font><code dir="auto">display.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量或表达式。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看一个实际的例子。在这里，我们编写了以下脚本，通过将值的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.sum"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总和</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">weight * close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除以
序列</font><font style="vertical-align: inherit;">
的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.sum"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总和</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来计算自定义加权移动平均值
</font></font><code dir="auto">weight</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Numeric-values-Plotting-numbers-Without-affecting-the-scale-1.D9lHNsXL_mUjuG.webp" alt="图像" width="1342" height="558" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4fl"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Plotting&nbsp;without&nbsp;affecting&nbsp;the&nbsp;scale&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Weighted&nbsp;Average"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;weight&nbsp;applied&nbsp;to&nbsp;the&nbsp;price&nbsp;on&nbsp;each&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">weight</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.pow</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;numerator&nbsp;of&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sum</span><span class="mtk13">(</span><span class="mtk33">weight</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;denominator&nbsp;of&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sum</span><span class="mtk13">(</span><span class="mtk33">weight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lengthInput`-bar&nbsp;weighted&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">average</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`average`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">average</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Weighted&nbsp;Average"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们想检查计算中使用的变量</font></font><code dir="auto">average</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以了解和微调结果。如果我们使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plot()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在所有位置
显示脚本的</font></font><code dir="auto">weight</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">numerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">denominator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将无法再轻松地</font></font><code dir="auto">average</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图表上识别我们的线，因为每个变量都有完全不同的比例：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Numeric-values-Plotting-numbers-Without-affecting-the-scale-2.CNBE_Mtb_2rATc4.webp" alt="图像" width="1342" height="558" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2j1"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Plotting&nbsp;without&nbsp;affecting&nbsp;the&nbsp;scale&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Weighted&nbsp;Average"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;weight&nbsp;applied&nbsp;to&nbsp;the&nbsp;price&nbsp;on&nbsp;each&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">weight</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.pow</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;numerator&nbsp;of&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sum</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">weight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;denominator&nbsp;of&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sum</span><span class="mtk13">(</span><span class="mtk33">weight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lengthInput`-bar&nbsp;weighted&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">average</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`average`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">average</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Weighted&nbsp;Average"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Create&nbsp;debug&nbsp;plots&nbsp;for&nbsp;the&nbsp;`weight`,&nbsp;`numerator</span><span class="mtk9">`,&nbsp;and&nbsp;`denominator`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">weight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"weight"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">numerator</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"numerator"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">denominator</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"denominator"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然我们可以从脚本设置的“样式”选项卡中隐藏单个图表，但这样做也会阻止我们在任何其他位置检查结果。为了同时查看变量的值并保留图表的比例，我们可以更改</font></font><code dir="auto">display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调试图表中的值。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下版本</font></font><code dir="auto">debugLocations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在调试
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plot()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中包含一个变量
，其值为，</font></font><code dir="auto">display.all - display.pane</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于指定除图表窗格</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之外的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有位置都将显示结果。现在我们可以检查计算的值，而没有额外的混乱：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Numeric-values-Plotting-numbers-Without-affecting-the-scale-3.iomfmsC__26l9R3.webp" alt="图像" width="1342" height="558" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1x1"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Plotting&nbsp;without&nbsp;affecting&nbsp;the&nbsp;scale&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Weighted&nbsp;Average"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;weight&nbsp;applied&nbsp;to&nbsp;the&nbsp;price&nbsp;on&nbsp;each&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">weight</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.pow</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;numerator&nbsp;of&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sum</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">weight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;denominator&nbsp;of&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sum</span><span class="mtk13">(</span><span class="mtk33">weight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lengthInput`-bar&nbsp;weighted&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">average</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`average`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">average</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Weighted&nbsp;Average"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;display&nbsp;locations&nbsp;of&nbsp;all&nbsp;debug&nbsp;plots.</span></span><br><span><span class="mtk33">debugLocations</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.all</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.pane</span></span><br><span><span class="mtk9">//&nbsp;Create&nbsp;debug&nbsp;plots&nbsp;for&nbsp;the&nbsp;`weight`,&nbsp;`numerator</span><span class="mtk9">`,&nbsp;and&nbsp;`denominator`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">weight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"weight"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLocations</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">numerator</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"numerator"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLocations</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">denominator</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"denominator"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLocations</span><span class="mtk13">)</span></span><br></code></div>
<h4 id="from-local-scopes" class="md-heading"><a href="#from-local-scopes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从本地</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">局部范围是</font></font></em><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="/pine-script-docs/language/methods#user-defined-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的缩进代码部分
</font><font style="vertical-align: inherit;">。当使用这些范围内声明的变量时，使用</font></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数直接显示其值</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将不起作用</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为绘图仅适用于文字和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用图表显示局部变量的值，可以将其结果分配给全局变量并将该变量传递给调用</font></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面描述的方法适用于在
</font></font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构内声明的局部变量。对</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/language/methods#user-defined-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">采用类似的过程
</font><font style="vertical-align: inherit;">
需要
</font></font><a href="/pine-script-docs/language/type-system#collections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或其他内置引用类型。
</font><font style="vertical-align: inherit;">有关更多信息，请参阅</font></font><a href="/pine-script-docs/writing/debugging#debugging-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试函数部分。</font></font></a><font style="vertical-align: inherit;"></font></p></div></aside>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，此脚本计算一段时间内</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价的最大和最小变化
</font></font><code dir="auto">lengthInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结构声明局部变量并</font><font style="vertical-align: inherit;">每条更新一次</font></font><code dir="auto">change</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局
</font></font><code dir="auto">maxChange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">：</font></font><code dir="auto">minChange</code><font style="vertical-align: inherit;"></font><code dir="auto">lengthInput</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Numeric-values-Plotting-numbers-From-local-scopes-1.DEllI76K_2tIueB.webp" alt="图像" width="1342" height="554" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5xj"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Plotting&nbsp;numbers&nbsp;from&nbsp;local&nbsp;scopes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Periodic&nbsp;changes"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;chart&nbsp;bars&nbsp;in&nbsp;each&nbsp;period.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Period&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;maximum&nbsp;`close`&nbsp;change&nbsp;over&nbsp;each&nbsp;`lengthInput</span><span class="mtk9">`&nbsp;period&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">maxChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;minimum&nbsp;`close`&nbsp;change&nbsp;over&nbsp;each&nbsp;`lengthInput</span><span class="mtk9">`&nbsp;period&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">minChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;once&nbsp;every&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">periodClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">periodClose</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;change&nbsp;in&nbsp;`close`&nbsp;prices&nbsp;over&nbsp;`lengthInput`&nbsp;b</span><span class="mtk9">ars.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">lengthInput</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;global&nbsp;`maxChange`&nbsp;and&nbsp;`minChange`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">maxChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">maxChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">minChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.min</span><span class="mtk13">(</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">minChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`maxChange`&nbsp;and&nbsp;`minChange`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maxChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Max&nbsp;periodic&nbsp;change"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">minChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Min&nbsp;periodic&nbsp;change"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">hline</span><span class="mtk13">(</span><span class="mtk12">0.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linestyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">hline.style_solid</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们想</font></font><code dir="auto">change</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用绘图检查变量的历史记录。虽然我们无法直接绘制变量，因为脚本在本地范围内声明了它，但我们可以将其值分配给另一个
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量以供函数使用</font></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面，我们在全局范围内添加了一个</font></font><code dir="auto">debugChange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的变量，脚本
</font><font style="vertical-align: inherit;">
使用局部变量在</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">change</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构中重新分配其值。现在，我们可以将
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plot()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与变量一起使用来查看可用</font><font style="vertical-align: inherit;">值</font></font><code dir="auto">debugChange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的历史记录
：</font></font><code dir="auto">change</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Numeric-values-Plotting-numbers-From-local-scopes-2.CPaEqcWa_i20qC.webp" alt="图像" width="1342" height="554" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="55t"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Plotting&nbsp;numbers&nbsp;from&nbsp;local&nbsp;scopes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Periodic&nbsp;changes"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;chart&nbsp;bars&nbsp;in&nbsp;each&nbsp;period.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Period&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;maximum&nbsp;`close`&nbsp;change&nbsp;over&nbsp;each&nbsp;`lengthInput</span><span class="mtk9">`&nbsp;period&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">maxChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;minimum&nbsp;`close`&nbsp;change&nbsp;over&nbsp;each&nbsp;`lengthInput</span><span class="mtk9">`&nbsp;period&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">minChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;once&nbsp;every&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">periodClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Tracks&nbsp;the&nbsp;history&nbsp;of&nbsp;the&nbsp;local&nbsp;`change`&nbsp;variable</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">periodClose</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;change&nbsp;in&nbsp;`close`&nbsp;prices&nbsp;over&nbsp;`lengthInput`&nbsp;b</span><span class="mtk9">ars.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">lengthInput</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;global&nbsp;`maxChange`&nbsp;and&nbsp;`minChange`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">maxChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">maxChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">minChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.min</span><span class="mtk13">(</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">minChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;the&nbsp;`change`&nbsp;value&nbsp;to&nbsp;the&nbsp;`debugChange`&nbsp;</span><span class="mtk9">variable.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`maxChange`&nbsp;and&nbsp;`minChange`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maxChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Max&nbsp;periodic&nbsp;change"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">minChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Min&nbsp;periodic&nbsp;change"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">hline</span><span class="mtk13">(</span><span class="mtk12">0.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linestyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">hline.style_solid</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Create&nbsp;a&nbsp;debug&nbsp;plot&nbsp;to&nbsp;visualize&nbsp;the&nbsp;`change`&nbsp;h</span><span class="mtk9">istory.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">debugChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Extracted&nbsp;change"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">15</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_areabr</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本在调试图中使用了
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot.style_areabr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plot.style_areabr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ，它
不像默认样式那样</font><font style="vertical-align: inherit;">
跨
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na值。</font></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当最右侧可见条形图的绘制值为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时
，价格尺度中的数字代表该条形图之前的最新</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非 na</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值（如果存在）。</font></font></li>
</ul>
<h3 id="with-drawings" class="md-heading"><a href="#with-drawings"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附有</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图纸</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以图形方式检查脚本数值历史记录的另一种方法是使用 Pine 的
</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，包括
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#lines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#polylines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">折线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 Pine 绘图不会在图表窗格以外的任何地方显示结果，但脚本可以在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地范围内创建它们，包括</font></font></em><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/language/methods#user-defined-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的范围</font><font style="vertical-align: inherit;">
（请参阅
</font></font><a href="/pine-script-docs/writing/debugging#debugging-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试函数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分以了解更多信息）。此外，脚本可以将绘图定位在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用的图表位置，而不管当前的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，让我们重新回顾
</font></font><a href="/pine-script-docs/writing/debugging#from-local-scopes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一节</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的“定期更改”脚本。假设我们想
</font><em><font style="vertical-align: inherit;">在不</font></em></font><code dir="auto">change</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用绘图的情况下检查局部变量的历史记录。在这种情况下，我们可以避免声明单独的全局变量，而是直接从</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;">if</font></a><font style="vertical-align: inherit;">结构的局部范围创建绘图对象
</font><font style="vertical-align: inherit;">
。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的脚本是前一个脚本的修改版，它使用
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来可视化变量的行为。在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;">if</font></a></font><code dir="auto">change</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构的范围内
</font><font style="vertical-align: inherit;">
，它调用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;">box.new()</font></a><font style="vertical-align: inherit;">
来创建一个
</font><font style="vertical-align: inherit;">
从</font><font style="vertical-align: inherit;">之前的 bar 到当前
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;">bar_index 的</font></a><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;">方框</font></a><font style="vertical-align: inherit;">：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">lengthInput</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Numeric-values-With-drawings-1.DsvQ-qM2_Z2i05an.webp" alt="图像" width="1342" height="554" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6vp"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Drawing&nbsp;numbers&nbsp;from&nbsp;local&nbsp;scopes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Periodic&nbsp;changes"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_boxes_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;chart&nbsp;bars&nbsp;in&nbsp;each&nbsp;period.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Period&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;maximum&nbsp;`close`&nbsp;change&nbsp;over&nbsp;each&nbsp;`lengthInput</span><span class="mtk9">`&nbsp;period&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">maxChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;minimum&nbsp;`close`&nbsp;change&nbsp;over&nbsp;each&nbsp;`lengthInput</span><span class="mtk9">`&nbsp;period&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">minChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;once&nbsp;every&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">periodClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">periodClose</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;change&nbsp;in&nbsp;`close`&nbsp;prices&nbsp;over&nbsp;`lengthInput`&nbsp;b</span><span class="mtk9">ars.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">lengthInput</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;global&nbsp;`maxChange`&nbsp;and&nbsp;`minChange`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">maxChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">maxChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">minChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.min</span><span class="mtk13">(</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">minChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">change</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Draws&nbsp;a&nbsp;box&nbsp;on&nbsp;the&nbsp;chart&nbsp;to&nbsp;visualize&nbsp;the&nbsp;`change</span><span class="mtk9">`&nbsp;value.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">box</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">change</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.min</span><span class="mtk13">(</span><span class="mtk33">change</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">change</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`maxChange`&nbsp;and&nbsp;`minChange`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maxChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Max&nbsp;periodic&nbsp;change"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">minChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Min&nbsp;periodic&nbsp;change"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">hline</span><span class="mtk13">(</span><span class="mtk12">0.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linestyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">hline.style_solid</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本包含</font></font><code dir="auto">max_boxes_count = 500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，允许其
在图表上</font><font style="vertical-align: inherit;">
显示最多 500 个
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框。</font></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font><font style="vertical-align: inherit;">
在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;">box.new()函数中使用</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.max"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">math.max(change, 0.0)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.min"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">math.min(change, 0.0)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">值。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">top</code><font style="vertical-align: inherit;"></font><code dir="auto">bottom</code><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box.new
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用包含
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.tostring(change)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为其参数，以在每个</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;">方框图</font></a></font><code dir="auto">text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中显示</font><font style="vertical-align: inherit;">变量“浮点”值
</font><font style="vertical-align: inherit;">
的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“字符串”表示形式</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。请参阅
下面</font><a href="/pine-script-docs/writing/debugging#strings"><font style="vertical-align: inherit;">字符串</font></a><font style="vertical-align: inherit;">部分的
</font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;">这一</font></a><font style="vertical-align: inherit;">部分
，了解有关使用字符串表示数据的更多信息。</font></font><code dir="auto">change</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#strings"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关使用
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和其他相关
</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的更多信息，请参阅我们的用户手册的
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和框</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
页面。</font></font></p>
<h2 id="conditions" class="md-heading"><a href="#conditions"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状况</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Pine 中创建的许多脚本都涉及声明和评估
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以指示特定的脚本操作，例如触发不同的计算模式、视觉效果、信号、警报、策略订单等。因此，必须了解如何检查脚本使用的条件以确保正确执行。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节讨论基于图表视觉效果的调试技术。要了解</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志记录</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件，请参阅
下面的</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
部分。</font></font></p></div></aside>
<h3 id="as-numbers" class="md-heading"><a href="#as-numbers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试脚本条件的一种可能方法是基于它们定义</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数值</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这允许程序员使用数字方法来检查它们，例如
</font></font><a href="/pine-script-docs/writing/debugging#numeric-values"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一节</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中概述的方法。</font></font></p>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_ohlc4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看一个简单的例子。此脚本计算ohlc4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价格与</font></font><code dir="auto">lengthInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bar</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动平均线</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之间的比率
</font><font style="vertical-align: inherit;">。它为变量分配一个条件，</font><font style="vertical-align: inherit;">
只要比率值超过 1（即价格高于平均值），</font></font><code dir="auto">priceAbove</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该变量就会返回。</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了检查条件的发生情况，我们创建了一个</font></font><code dir="auto">debugValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量，该变量分配给一个表达式的结果，该表达式使用三元
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_?:"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?:</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">priceAbove</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符，当为</font><font style="vertical-align: inherit;">
时返回 1 </font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，否则返回 0。该脚本在所有可用位置绘制变量的值：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Conditions-As-numbers-1.BoeptaNB_2nR2E8.webp" alt="图像" width="1342" height="498" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6i1"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Conditions&nbsp;as&nbsp;numbers&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA&nbsp;signal"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;moving&nbsp;average&nbsp;calculat</span><span class="mtk9">ion.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;ratio&nbsp;of&nbsp;the&nbsp;`ohlc4`&nbsp;price&nbsp;to&nbsp;its&nbsp;`lengthInpu</span><span class="mtk9">t`-bar&nbsp;moving&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ratio</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">ohlc4</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">ohlc4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;condition&nbsp;to&nbsp;inspect.&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;`ohlc4`&nbsp;</span><span class="mtk9">is&nbsp;above&nbsp;its&nbsp;moving&nbsp;average,&nbsp;`false`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceAbove</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ratio</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;1&nbsp;when&nbsp;the&nbsp;`priceAbove`&nbsp;condition&nbsp;is&nbsp;`tru</span><span class="mtk9">e`,&nbsp;0&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceAbove</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`debugValue.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">debugValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Conditional&nbsp;number"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用数字表示“bool”值还允许脚本使用plotshape()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotchar()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在特定 y 轴位置显示条件形状或字符
</font><font style="vertical-align: inherit;">，并且它有助于使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotarrow()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行条件调试。请参阅
</font></font><a href="/pine-script-docs/writing/debugging#plotting-conditional-shapes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一节</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以了解更多信息。</font></font></li>
</ul>
<h3 id="plotting-conditional-shapes" class="md-heading"><a href="#plotting-conditional-shapes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘制条件</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形状</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotshape
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotchar()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数为调试条件提供了实用性，因为它们可以在包含</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或非 na</font></font><code dir="auto">series</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数时在绝对或相对图表位置绘制形状或字符。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些函数还可以在脚本的状态行和数据窗口中显示</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数值</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示
</font></font><code dir="auto">series</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着它们对于调试
</font></font><a href="/pine-script-docs/writing/debugging#numeric-values"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字也很有帮助。我们在</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#tips"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“提示”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分展示了使用这些函数调试数字的简单实用的方法</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表的图表位置取决于参数</font></font><code dir="auto">location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，默认情况下为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.abovebar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">location.abovebar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.abovebar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">location.abovebar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.belowbar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">location.belowbar时，该函数会根据</font></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主图表</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价格定位形状/字符</font><font style="vertical-align: inherit;">。如果脚本在单独的图表窗格中绘制其值，我们建议使用其他</font></font><code dir="auto">location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项进行调试，以避免影响窗格的比例。</font></font></p></div></aside>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们使用这些函数检查一个条件。以下脚本计算具有
</font><font style="vertical-align: inherit;">
长度</font><font style="vertical-align: inherit;">和变量的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rsi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ，该变量的值是当 RSI 低于 30 时
</font><font style="vertical-align: inherit;">返回的条件的结果。每次发生条件时，它都会调用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;">plotshape()</font></a><font style="vertical-align: inherit;">
在窗格顶部附近显示一个圆圈：</font></font><code dir="auto">lengthInput</code><font style="vertical-align: inherit;"></font><code dir="auto">crossBelow</code><font style="vertical-align: inherit;"></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Conditions-Plotting-conditional-shapes-1.B_YUlhVQ_Z1ARRXr.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="7ip"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Conditional&nbsp;shapes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;cross&nbsp;under&nbsp;30"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;RSI.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;calculated&nbsp;RSI&nbsp;value.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`rsi`&nbsp;crosses&nbsp;below&nbsp;30,&nbsp;`false</span><span class="mtk9">`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">crossBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">30.0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`rsi`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">136</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">76</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">146</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`crossBelow`&nbsp;condition&nbsp;as&nbsp;circles&nbsp;near</span><span class="mtk9">&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;pane.</span></span><br><span><span class="mtk16">plotshape</span><span class="mtk13">(</span><span class="mtk33">crossBelow</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;crossed&nbsp;below&nbsp;30"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">shape.circle</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.top</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.small</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当 时，状态行和数据窗口显示值 1
 ，</font></font><code dir="auto">crossBelow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，显示值 0 </font></font><code dir="auto">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们想在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">精确</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位置而不是相对于图表窗格显示形状。我们可以通过
</font><font style="vertical-align: inherit;">
在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;">plotshape()调用中使用</font></a></font><a href="/pine-script-docs/writing/debugging#as-numbers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件数字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.absolute"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">location.absolute</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来实现这一点
。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此示例中，我们修改了上一个脚本，创建了一个
变量，</font><font style="vertical-align: inherit;">当</font><font style="vertical-align: inherit;">is
时</font></font><code dir="auto">debugNumber</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回值</font><font style="vertical-align: inherit;">，
</font><font style="vertical-align: inherit;">
否则
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;">返回 na。plotshape </font></a><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;">()</font></a><font style="vertical-align: inherit;">
函数使用这个新变量作为其</font><font style="vertical-align: inherit;">参数，并
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.absolute"><font style="vertical-align: inherit;">使用 location.absolute</font></a><font style="vertical-align: inherit;">
作为其</font><font style="vertical-align: inherit;">参数：</font></font><code dir="auto">rsi</code><font style="vertical-align: inherit;"></font><code dir="auto">crossBelow</code><font style="vertical-align: inherit;"></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">series</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.absolute"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">location</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Conditions-Plotting-conditional-shapes-2.Daveblc1_ZgMwC0.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="27v"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Conditional&nbsp;shapes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;cross&nbsp;under&nbsp;30"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;RSI.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;calculated&nbsp;RSI&nbsp;value.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`rsi`&nbsp;crosses&nbsp;below&nbsp;30,&nbsp;`false</span><span class="mtk9">`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">crossBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">30.0</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;the&nbsp;`rsi`&nbsp;when&nbsp;`crossBelow`&nbsp;is&nbsp;`true`,&nbsp;`n</span><span class="mtk9">a`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugNumber</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">crossBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`rsi`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">136</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">76</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">146</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;circles&nbsp;at&nbsp;the&nbsp;`debugNumber`.</span></span><br><span><span class="mtk16">plotshape</span><span class="mtk13">(</span><span class="mtk33">debugNumber</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;when&nbsp;it&nbsp;crossed&nbsp;below&nbsp;30"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">shape.circle</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.absolute</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.small</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们将</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字</font></font></em><font style="vertical-align: inherit;"></font><code dir="auto">debugNumber</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系列传递给函数，我们的条件图现在显示状态行和数据窗口中</font><font style="vertical-align: inherit;">的值，而不是 1 或 0。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试条件的另一种便捷方法是使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotarrow()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当</font><font style="vertical-align: inherit;">参数非零且不为
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;">na时，此函数会绘制一个相对于</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主图表价格</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位置的箭头。每个箭头的长度随</font><font style="vertical-align: inherit;">提供的值而变化。与
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;">plotshape()</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;">plotchar()</font></a><font style="vertical-align: inherit;">一样，
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow"><font style="vertical-align: inherit;">plotarrow()</font></a><font style="vertical-align: inherit;">
也可以在状态行和数据窗口中显示数值结果。</font></font><code dir="auto">series</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">series</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于此功能始终相对于主图表价格定位箭头，我们建议仅在脚本占据主图表窗格时使用它，以避免干扰比例。</font></font></p></div></aside>
<p><font style="vertical-align: inherit;"></font><code dir="auto">crossBelow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此示例展示了使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotarrow()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查条件的另一种方法</font><font style="vertical-align: inherit;">。在此版本中，我们</font><font style="vertical-align: inherit;">在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;">indicator()</font></a></font><code dir="auto">overlay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数中设置为</font><font style="vertical-align: inherit;">
，并添加了
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow"><font style="vertical-align: inherit;">plotarrow()</font></a><font style="vertical-align: inherit;">
调用以可视化条件值。此示例中的测量</font><font style="vertical-align: inherit;">每次条件发生时低于 30 的</font><font style="vertical-align: inherit;">程度：</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">debugNumber</code><font style="vertical-align: inherit;"></font><code dir="auto">rsi</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Conditions-Plotting-conditional-shapes-3.IZzMwtM0_Z1HvpVm.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5sh"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Conditional&nbsp;shapes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;cross&nbsp;under&nbsp;30"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;RSI.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;calculated&nbsp;RSI&nbsp;value.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`rsi`&nbsp;crosses&nbsp;below&nbsp;30,&nbsp;`false</span><span class="mtk9">`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">crossBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">30.0</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`rsi&nbsp;-&nbsp;30.0`&nbsp;when&nbsp;`crossBelow`&nbsp;is&nbsp;`true`,</span><span class="mtk9">&nbsp;`na`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugNumber</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">crossBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">30.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`rsi`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">136</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">76</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">146</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;circles&nbsp;at&nbsp;the&nbsp;`debugNumber`.</span></span><br><span><span class="mtk16">plotarrow</span><span class="mtk13">(</span><span class="mtk33">debugNumber</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;cross&nbsp;below&nbsp;30&nbsp;distnce"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将</font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_display.data_window"><font style="vertical-align: inherit;">display.data_window</font></a><font style="vertical-align: inherit;">的
</font><font style="vertical-align: inherit;">
plot </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;">()</font></a></font><code dir="auto">display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的值
设置</font><font style="vertical-align: inherit;">
为
</font><a href="/pine-script-docs/writing/debugging#without-affecting-the-scale"><font style="vertical-align: inherit;">保留图表的比例</font></a><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">rsi</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_display.data_window"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#without-affecting-the-scale"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要了解有关
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotshape()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotchar()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotarrow()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的更多信息，请参阅本手册的
</font></font><a href="/pine-script-docs/concepts/text-and-shapes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
页面。</font></font></p>
<h3 id="conditional-colors" class="md-heading"><a href="#conditional-colors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Pine 中以直观方式表示条件的一种优雅方式是创建
</font><font style="vertical-align: inherit;">
基于</font><font style="vertical-align: inherit;">或状态返回</font></font><a href="/pine-script-docs/language/type-system#color"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色值的表达式，因为脚本可以使用它们来控制</font></font></a><font style="vertical-align: inherit;"><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;">绘图对象</font></a><font style="vertical-align: inherit;">的外观
或</font><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill"><font style="vertical-align: inherit;">fill()</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;">bgcolor()</font></a><font style="vertical-align: inherit;">或
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor"><font style="vertical-align: inherit;">barcolor()</font></a><font style="vertical-align: inherit;">调用的结果</font><font style="vertical-align: inherit;">
。</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><code dir="auto">false</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数一样，脚本只能
</font><font style="vertical-align: inherit;">
从</font><em><font style="vertical-align: inherit;">全局范围调用</font></em></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fill()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bgcolor()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barcolor()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且函数不能接受任何局部变量。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p></div></aside>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，该脚本计算
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价随</font></font><code dir="auto">lengthInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图的变化，并声明两个“bool”变量来识别价格变化是正还是负。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本使用这些“bool”值作为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_?:"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三元</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表达式中的条件来分配三个“color”变量的值，然后使用这些变量作为</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;">plot()</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;">bgcolor()</font></a><font style="vertical-align: inherit;">和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor"><font style="vertical-align: inherit;">barcolor()</font></a></font><code dir="auto">color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的参数
</font><font style="vertical-align: inherit;">
来调试结果：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Conditions-Conditional-colors-1.B5Y6dhKf_Z1jtyTu.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6v9"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Conditional&nbsp;colors&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Price&nbsp;change&nbsp;colors"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;price&nbsp;change&nbsp;calculatio</span><span class="mtk9">n.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;change&nbsp;in&nbsp;`close`&nbsp;prices&nbsp;over&nbsp;`lengthInput`&nbsp;b</span><span class="mtk9">ars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`priceChange`&nbsp;is&nbsp;a&nbsp;positive&nbsp;va</span><span class="mtk9">lue,&nbsp;`false`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isPositive</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`priceChange`&nbsp;is&nbsp;a&nbsp;negative&nbsp;va</span><span class="mtk9">lue,&nbsp;`false`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isNegative</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceChange</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;a&nbsp;color&nbsp;for&nbsp;the&nbsp;`priceChange`&nbsp;plot&nbsp;to&nbsp;sho</span><span class="mtk9">w&nbsp;when&nbsp;`isPositive`,&nbsp;`isNegative`,&nbsp;or&nbsp;neither&nbsp;occu</span><span class="mtk9">rs.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">isPositive</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">isNegative</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;an&nbsp;80%&nbsp;transparent&nbsp;color&nbsp;for&nbsp;the&nbsp;backgrou</span><span class="mtk9">nd&nbsp;when&nbsp;`isPositive`&nbsp;or&nbsp;`isNegative`,&nbsp;`na`&nbsp;otherwi</span><span class="mtk9">se.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">isPositive</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">isNegative</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;a&nbsp;color&nbsp;to&nbsp;emphasize&nbsp;chart&nbsp;bars&nbsp;when&nbsp;`isP</span><span class="mtk9">ositive`&nbsp;occurs.&nbsp;Otherwise,&nbsp;returns&nbsp;the&nbsp;`chart.bg_</span><span class="mtk9">color`.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">barColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">isPositive</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.bg_color</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`priceChange`&nbsp;and&nbsp;color&nbsp;it&nbsp;with&nbsp;the&nbsp;`p</span><span class="mtk9">lotColor`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">priceChange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Price&nbsp;change"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_area</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;pane's&nbsp;background&nbsp;with&nbsp;the&nbsp;`bgCol</span><span class="mtk9">or`.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Background&nbsp;highlight"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Emphasize&nbsp;the&nbsp;chart&nbsp;bars&nbsp;with&nbsp;positive&nbsp;price&nbsp;ch</span><span class="mtk9">ange&nbsp;using&nbsp;the&nbsp;`barColor`.</span></span><br><span><span class="mtk16">barcolor</span><span class="mtk13">(</span><span class="mtk33">barColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Positive&nbsp;change&nbsp;bars"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barcolor
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数始终为主图表的条形图着色，无论脚本是否占用另一个图表窗格，并且仅当条形图可见时图表才会显示结果。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/colors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关使用颜色</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/concepts/fills"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/backgrounds"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
突出显示背景</font><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/concepts/bar-coloring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">着色条的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多信息，请参阅</font><font style="vertical-align: inherit;">颜色、填​​充、背景和条形着色页面。</font></font></p>
<h3 id="using-drawings" class="md-heading"><a href="#using-drawings"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图纸</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 的
</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了灵活的方式来可视化图表上的条件，尤其是当条件在本地范围内时。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑以下脚本，该脚本</font></font><code dir="auto">filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用平滑参数（ ）计算自定义，该参数会</font><font style="vertical-align: inherit;">
根据最近的
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume"><font style="vertical-align: inherit;">成交量条件在</font></a><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;">if</font></a></font><code dir="auto">alpha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构中改变其值
</font><font style="vertical-align: inherit;">
：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Conditions-Using-drawings-1.bqLda39j_Z13aGwI.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="c0"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Conditional&nbsp;drawings&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Volume-based&nbsp;filter"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;volume&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Volume&nbsp;average&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;`volume`&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgVolume</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">volume</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;custom&nbsp;price&nbsp;filter&nbsp;based&nbsp;on&nbsp;volume&nbsp;activity.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">filter</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;smoothing&nbsp;parameter&nbsp;of&nbsp;the&nbsp;filter&nbsp;calculation</span><span class="mtk9">.&nbsp;Its&nbsp;value&nbsp;depends&nbsp;on&nbsp;multiple&nbsp;volume&nbsp;conditions.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`alpha`&nbsp;to&nbsp;1&nbsp;if&nbsp;`volume`&nbsp;exceeds&nbsp;its&nbsp;`l</span><span class="mtk9">engthInput`-bar&nbsp;moving&nbsp;average.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgVolume</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`alpha`&nbsp;to&nbsp;0.5&nbsp;if&nbsp;`volume`&nbsp;exceeds&nbsp;its&nbsp;</span><span class="mtk9">previous&nbsp;value.</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.5</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`alpha`&nbsp;to&nbsp;0.01&nbsp;otherwise.</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.01</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;new&nbsp;`filter`&nbsp;value.</span></span><br><span><span class="mtk33">filter</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">filter</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">filter</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`filter`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">filter</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Filter"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们想检查控制</font></font><code dir="auto">alpha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值的条件。我们可以通过多种方式使用图表视觉效果来完成任务。但是，有些方法需要更多代码和谨慎处理。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，为了
使用</font><a href="/pine-script-docs/writing/debugging#plotting-conditional-shapes"><font style="vertical-align: inherit;">绘制的形状</font></a><font style="vertical-align: inherit;">或
</font><a href="/pine-script-docs/writing/debugging#conditional-colors"><font style="vertical-align: inherit;">背景颜色来可视化</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结构的条件
</font><font style="vertical-align: inherit;">，我们必须在全局范围内创建额外的变量或表达式，以供</font><font style="vertical-align: inherit;">或
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;">bgcolor()</font></a><font style="vertical-align: inherit;">
函数访问。</font></font><a href="/pine-script-docs/writing/debugging#plotting-conditional-shapes"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#conditional-colors"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">plot*()</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，我们可以使用
</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来简洁地可视化条件，而无需那些额外的步骤。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是对上一个脚本的修改，该脚本
在</font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;">条件结构</font></a><font style="vertical-align: inherit;">
的特定分支中
调用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">label.new()，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便在执行这些分支时在图表上绘制
</font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;">标签</font></a><font style="vertical-align: inherit;">。这些简单的更改使我们能够在图表上识别这些条件，而无需太多额外的代码：</font></font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Conditions-Using-drawings-2.6tfkMr81_1G1BSn.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="21d"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Conditional&nbsp;drawings&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Volume-based&nbsp;filter"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_labels_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;volume&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Volume&nbsp;average&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;`volume`&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgVolume</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">volume</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;custom&nbsp;price&nbsp;filter&nbsp;based&nbsp;on&nbsp;volume&nbsp;activity.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">filter</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;smoothing&nbsp;parameter&nbsp;of&nbsp;the&nbsp;filter&nbsp;calculation</span><span class="mtk9">.&nbsp;Its&nbsp;value&nbsp;depends&nbsp;on&nbsp;multiple&nbsp;volume&nbsp;conditions.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`alpha`&nbsp;to&nbsp;1&nbsp;if&nbsp;`volume`&nbsp;exceeds&nbsp;its&nbsp;`l</span><span class="mtk9">engthInput`-bar&nbsp;moving&nbsp;average.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgVolume</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;debug&nbsp;label.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"alpha&nbsp;=&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`alpha`&nbsp;to&nbsp;0.5&nbsp;if&nbsp;`volume`&nbsp;exceeds&nbsp;its&nbsp;</span><span class="mtk9">previous&nbsp;value.</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">volume</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;debug&nbsp;label.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"alpha&nbsp;=&nbsp;0.5"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.5</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`alpha`&nbsp;to&nbsp;0.01&nbsp;otherwise.</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.01</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;new&nbsp;`filter`&nbsp;value.</span></span><br><span><span class="mtk33">filter</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">filter</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">filter</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`filter`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">filter</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Filter"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在重新赋值表达式上方添加了
</font><font style="vertical-align: inherit;">label.new </font><em><font style="vertical-align: inherit;">( </font></em></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用，因为</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;">if</font></a><font style="vertical-align: inherit;">结构中每个分支的返回类型
</font><font style="vertical-align: inherit;">
必须匹配。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code dir="auto">alpha</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数包括</font></font><code dir="auto">max_labels_count = 500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定脚本可以
</font><font style="vertical-align: inherit;">在图表上显示最多 500 个</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签。</font></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="compound-and-nested-conditions" class="md-heading"><a href="#compound-and-nested-conditions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复合条件和嵌套</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当程序员需要识别可能发生多种条件的情况时，他们可以</font><font style="vertical-align: inherit;">通过用逻辑运算符（</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_and"><font style="vertical-align: inherit;">与</font></a><font style="vertical-align: inherit;">、
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_or"><font style="vertical-align: inherit;">或）聚合各个条件来构建</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复合条件</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_and"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_or"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，这行代码显示仅</font><font style="vertical-align: inherit;">当发生</font><font style="vertical-align: inherit;">或时才</font><font style="vertical-align: inherit;">返回
</font></font><code dir="auto">compoundCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的变量</font><font style="vertical-align: inherit;">：</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><code dir="auto">condition1</code><font style="vertical-align: inherit;"></font><code dir="auto">condition2</code><font style="vertical-align: inherit;"></font><code dir="auto">condition3</code><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="67s"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">compoundCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition1</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">condition2</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以</font><font style="vertical-align: inherit;">使用
</font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;">条件结构</font></a><font style="vertical-align: inherit;">或</font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_?:"><font style="vertical-align: inherit;">三元表达式创建</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套条件</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。例如，
</font><font style="vertical-align: inherit;">如果
发生</font><font style="vertical-align: inherit;">且</font><font style="vertical-align: inherit;">或，则此</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;">if</font></a><font style="vertical-align: inherit;">
结构将分配</font><font style="vertical-align: inherit;">给变量</font><font style="vertical-align: inherit;">。但是，与上面的逻辑表达式不同，此结构的分支还允许脚本在分配“bool”值之前执行其他代码：</font></font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_?:"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><code dir="auto">nestedCondition</code><font style="vertical-align: inherit;"></font><code dir="auto">condition1</code><font style="vertical-align: inherit;"></font><code dir="auto">condition2</code><font style="vertical-align: inherit;"></font><code dir="auto">condition3</code><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="3sj"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">nestedCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;[additional_code]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition2</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;[additional_code]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">nestedCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition3</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;[additional_code]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">nestedCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论哪种情况，无论是使用代码中的复合条件还是嵌套条件，都可以通过验证组成它们的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各个条件</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的行为来省去很多麻烦并确保它们按预期工作。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本计算了</font><font style="vertical-align: inherit;">上划线</font><font style="vertical-align: inherit;">的
</font></font><code dir="auto">rsi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">。然后，它创建了五个变量来表示不同的奇异条件。该脚本在逻辑表达式中使用这些变量为变量分配一个“bool”值
，并</font><font style="vertical-align: inherit;">使用
</font><a href="/pine-script-docs/writing/debugging#conditional-colors"><font style="vertical-align: inherit;">条件背景颜色</font></a><font style="vertical-align: inherit;">显示结果
</font><font style="vertical-align: inherit;">：</font></font><code dir="auto">median</code><font style="vertical-align: inherit;"></font><code dir="auto">rsi</code><font style="vertical-align: inherit;"></font><code dir="auto">lengthInput</code><font style="vertical-align: inherit;"></font><code dir="auto">compoundCondition</code><font style="vertical-align: inherit;"></font><code dir="auto">compoundCondition</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#conditional-colors"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Conditions-Compound-conditions-1.BIlbHbn5_Z1hVb8A.webp" alt="图像" width="1342" height="588" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="27w"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Compound&nbsp;conditions&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;RSI&nbsp;and&nbsp;median&nbsp;RSI&nbsp;calculations</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lengthInput`-bar&nbsp;RSI.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lengthInput`-bar&nbsp;median&nbsp;of&nbsp;the&nbsp;`rsi`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">median</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.median</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#1:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;1-bar&nbsp;`rsi`&nbsp;chan</span><span class="mtk9">ge&nbsp;switches&nbsp;from&nbsp;1&nbsp;to&nbsp;-1.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">changeNegative</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk16">math.sign</span><span class="mtk13">(</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk13">)))</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">-2</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#2:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;previous&nbsp;bar's&nbsp;`</span><span class="mtk9">rsi`&nbsp;is&nbsp;greater&nbsp;than&nbsp;70.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">prevAbove70</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">70.0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#3:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;current&nbsp;`close`&nbsp;</span><span class="mtk9">is&nbsp;lower&nbsp;than&nbsp;the&nbsp;previous&nbsp;bar's&nbsp;`open`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#4:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`rsi`&nbsp;is&nbsp;between</span><span class="mtk9">&nbsp;60&nbsp;and&nbsp;70.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">betweenLevels</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">bool</span><span class="mtk13">(</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk12">70.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">60.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#5:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`rsi`&nbsp;is&nbsp;above&nbsp;t</span><span class="mtk9">he&nbsp;`median`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">aboveMedian</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">median</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;first&nbsp;condition&nbsp;occurs&nbsp;alongsi</span><span class="mtk9">de&nbsp;conditions&nbsp;2&nbsp;and&nbsp;3&nbsp;or&nbsp;4&nbsp;and&nbsp;5.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">compundCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">changeNegative</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk13">((</span><span class="mtk33">prevAbove70</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeBelow</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">betweenLevels</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">aboveMedian</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//Plot&nbsp;the&nbsp;`rsi`&nbsp;and&nbsp;the&nbsp;`median`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">201</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">109</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">34</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">median</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;Median"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">180</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">160</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">102</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;red&nbsp;when&nbsp;the&nbsp;`compundC</span><span class="mtk9">ondition`&nbsp;occurs.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">compundCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"compundCondition"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们上面所看到的，仅通过可视化其最终结果并不一定容易理解其行为</font></font><code dir="auto">compoundCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为五个底层奇异条件决定了最终值。为了有效地调试</font></font><code dir="auto">compoundCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本例中的，我们还必须检查组成它的条件。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的示例中，我们添加了五个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotchar()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用，以便在发生每种单一情况时在图表上显示
</font></font><a href="/pine-script-docs/writing/debugging#plotting-conditional-shapes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在状态行和数据窗口中显示数值。检查每个结果为我们提供了有关 行为的更完整信息
</font></font><code dir="auto">compoundCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Conditions-Compound-conditions-2.CqS0Ugyz_Z181FHW.webp" alt="图像" width="1342" height="590" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5jz"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Compound&nbsp;conditions&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;RSI&nbsp;and&nbsp;median&nbsp;RSI&nbsp;calculations</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lengthInput`-bar&nbsp;RSI.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lengthInput`-bar&nbsp;median&nbsp;of&nbsp;the&nbsp;`rsi`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">median</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.median</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#1:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;1-bar&nbsp;`rsi`&nbsp;chan</span><span class="mtk9">ge&nbsp;switches&nbsp;from&nbsp;1&nbsp;to&nbsp;-1.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">changeNegative</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk16">math.sign</span><span class="mtk13">(</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk13">)))</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">-2</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#2:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;previous&nbsp;bar's&nbsp;`</span><span class="mtk9">rsi`&nbsp;is&nbsp;greater&nbsp;than&nbsp;70.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">prevAbove70</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">70.0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#3:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;current&nbsp;`close`&nbsp;</span><span class="mtk9">is&nbsp;lower&nbsp;than&nbsp;the&nbsp;previous&nbsp;bar's&nbsp;`open`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#4:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`rsi`&nbsp;is&nbsp;between</span><span class="mtk9">&nbsp;60&nbsp;and&nbsp;70.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">betweenLevels</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">bool</span><span class="mtk13">(</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk12">70.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">60.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;#5:&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`rsi`&nbsp;is&nbsp;above&nbsp;t</span><span class="mtk9">he&nbsp;`median`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">aboveMedian</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">median</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;first&nbsp;condition&nbsp;occurs&nbsp;alongsi</span><span class="mtk9">de&nbsp;conditions&nbsp;2&nbsp;and&nbsp;3&nbsp;or&nbsp;4&nbsp;and&nbsp;5.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">compundCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">changeNegative</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk13">((</span><span class="mtk33">prevAbove70</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeBelow</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">betweenLevels</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">aboveMedian</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//Plot&nbsp;the&nbsp;`rsi`&nbsp;and&nbsp;the&nbsp;`median`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">201</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">109</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">34</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">median</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI&nbsp;Median"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">180</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">160</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">102</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;red&nbsp;when&nbsp;the&nbsp;`compundC</span><span class="mtk9">ondition`&nbsp;occurs.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">compundCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"compundCondition"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;characters&nbsp;on&nbsp;the&nbsp;chart&nbsp;when&nbsp;conditions&nbsp;1-</span><span class="mtk9">5&nbsp;occur.</span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">changeNegative</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"changeNegative&nbsp;(1)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.absolute</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">prevAbove70</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">70.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"prevAbove70&nbsp;(2)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.absolute</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">closeBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"closeBelow&nbsp;(3)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"3"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.bottom</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">betweenLevels</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"betweenLevels&nbsp;(4)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"4"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.absolute</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">aboveMedian</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">median</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"aboveMedian&nbsp;(5)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"5"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.absolute</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotchar()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用都使用一个
</font></font><a href="/pine-script-docs/writing/debugging#as-numbers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><code dir="auto">series</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数。函数在状态行和数据窗口中显示数值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了条件调用之外，所有
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotchar()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用都</font></font><code dir="auto">closeBelow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.absolute"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">location.absolute</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为参数，以便在字符</font><font style="vertical-align: inherit;">不为
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;">na</font></a></font><code dir="auto">location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （即条件发生）时在精确位置显示字符</font><font style="vertical-align: inherit;">
。调用</font><font style="vertical-align: inherit;">使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.bottom"><font style="vertical-align: inherit;">location.bottom</font></a><font style="vertical-align: inherit;">
在窗格底部附近显示其字符。</font></font><code dir="auto">series</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">closeBelow</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.bottom"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节的示例中，我们将各个条件分配给具有简单名称和注释的单独变量。虽然这种格式不是创建复合条件所必需的，因为可以直接在逻辑表达式中组合条件，但它可以使代码更易读，更易于调试，如
</font></font><a href="/pine-script-docs/writing/debugging#tips"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
部分所述。</font></font></li>
</ul>
<h2 id="strings" class="md-heading"><a href="#strings"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><a href="/pine-script-docs/language/type-system#string"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
是字母数字、控制字符和其他字符（例如 Unicode）的序列。它们在调试脚本时非常有用，因为程序员可以使用它们将脚本的数据类型表示为人类可读的文本，并使用具有
文本相关属性的</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或使用
</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来检查它们。</font></font></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节讨论“字符串”转换以及通过
</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/concepts/tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查字符串。
</font></font><a href="/pine-script-docs/concepts/lines-and-boxes#boxes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框也可以显示文本。但是，它们用于调试字符串的实用性比本节和下面的</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分中介绍的技术更有限
</font><font style="vertical-align: inherit;">
。</font></font></p></div></aside>
<h3 id="representing-other-types" class="md-heading"><a href="#representing-other-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示其他</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以创建几乎任何数据类型的“字符串”表示，当其他方法可能不够用时，可以促进有效调试。在探索“字符串”检查技术之前，让我们简要回顾一下使用字符串</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本数据的方法。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 包含预定义逻辑，用于构建其他几种内置类型的“字符串”表示形式，例如
</font></font><a href="/pine-script-docs/language/type-system#int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="/pine-script-docs/language/type-system#float"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">float</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="/pine-script-docs/language/type-system#bool"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/language/matrices"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix 。脚本可以通过</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.tostring()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.format()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数方便地表示字符串等类型
</font><font style="vertical-align: inherit;">
。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此代码片段使用以下函数创建字符串来表示多个值：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="2vx"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"1.25"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">floatRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk12">1.25</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"1"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">rounded0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk12">1.25</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"1.3"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">rounded1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk12">1.25</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#.#"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"1.2500"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailingZeros</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk12">1.25</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#.0000"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"true"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">trueRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"false"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">falseRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"[1,&nbsp;2,&nbsp;-3.14]"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">floatArrayRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">-3.14</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"[2,&nbsp;20,&nbsp;0]"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">roundedArrayRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">2.22</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">19.6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">-0.43</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"[Hello,&nbsp;World,&nbsp;!]"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">stringArrayRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk29">"Hello"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"World"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"!"</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"Test:&nbsp;2.718&nbsp;^&nbsp;2&nbsp;&gt;&nbsp;5:&nbsp;true"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">mixedTypeRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"{0}{1,&nbsp;number,&nbsp;#.###}&nbsp;^&nbsp;2&nbsp;&gt;&nbsp;{2}:&nbsp;{3}"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Test:&nbsp;"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">math.e</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">math.e</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">math.e</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Combines&nbsp;all&nbsp;the&nbsp;above&nbsp;strings&nbsp;into&nbsp;a&nbsp;multi-line&nbsp;</span><span class="mtk9">string.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">combined</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"{0}\n{1}\n{2}\n{3}\n{4}\n{5}\n{6}\n{7}\n{8}\n{9}"</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">floatRepr</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rounded0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rounded1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailingZeros</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">trueRepr</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">falseRepr</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">floatArrayRepr</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">roundedArrayRepr</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stringArrayRepr</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">mixedTypeRepr</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用表示 UNIX 时间戳的“int”值（例如从与时间相关的函数和变量返回的值）时，还可以使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.format()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.format_time()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将它们转换为人类可读的日期字符串。此代码块演示了使用这些函数转换时间戳的多种方法：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="27r"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;UNIX&nbsp;timestamp,&nbsp;in&nbsp;milliseconds.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">unixTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1279411200000</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"2010-07-18T00:00:00+0000"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">default</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format_time</span><span class="mtk13">(</span><span class="mtk33">unixTime</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"2010-07-18"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">ymdRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format_time</span><span class="mtk13">(</span><span class="mtk33">unixTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"yyyy-MM-dd"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"07-18-2010"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">mdyRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format_time</span><span class="mtk13">(</span><span class="mtk33">unixTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MM-dd-yyyy"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"20:00:00,&nbsp;2010-07-17"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">hmsymdRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format_time</span><span class="mtk13">(</span><span class="mtk33">unixTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"HH:mm:ss,&nbsp;yyyy-MM-dd"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"America/New_York"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"Year:&nbsp;2010,&nbsp;Month:&nbsp;07,&nbsp;Day:&nbsp;18,&nbsp;Time:&nbsp;1</span><span class="mtk9">2:00:00"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">customFormat</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Year:&nbsp;{0,&nbsp;time,&nbsp;yyyy},&nbsp;Month:&nbsp;{1,&nbsp;time,&nbsp;MM},&nbsp;Day:</span><span class="mtk29">&nbsp;{2,&nbsp;time,&nbsp;dd},&nbsp;Time:&nbsp;{3,&nbsp;time,&nbsp;hh:mm:ss}"</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">unixTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">unixTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">unixTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">unixTime</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用没有内置“字符串”表示的类型</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如
</font></font><a href="/pine-script-docs/language/type-system#color"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">color</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="/pine-script-docs/language/maps"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">map</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等）时，程序员可以使用自定义逻辑或格式来构造表示。例如，此代码调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.format()来使用其</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.r"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.g"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.b"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.t"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
组件</font><font style="vertical-align: inherit;">
来表示“颜色”值
：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="2fk"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;built-in&nbsp;`color.maroon`&nbsp;value&nbsp;with&nbsp;17%&nbsp;transp</span><span class="mtk9">arency.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">myColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">17</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Get&nbsp;the&nbsp;red,&nbsp;green,&nbsp;blue,&nbsp;and&nbsp;transparency&nbsp;comp</span><span class="mtk9">onents&nbsp;from&nbsp;`myColor`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">r</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.r</span><span class="mtk13">(</span><span class="mtk33">myColor</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">g</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.g</span><span class="mtk13">(</span><span class="mtk33">myColor</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">b</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.b</span><span class="mtk13">(</span><span class="mtk33">myColor</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.t</span><span class="mtk13">(</span><span class="mtk33">myColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns:&nbsp;"color&nbsp;(r&nbsp;=&nbsp;136,&nbsp;g&nbsp;=&nbsp;14,&nbsp;b&nbsp;=&nbsp;79,&nbsp;t&nbsp;=&nbsp;17)</span><span class="mtk9">"</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">customRepr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"color&nbsp;(r&nbsp;=&nbsp;{0},&nbsp;g&nbsp;=&nbsp;{1},&nbsp;b&nbsp;=&nbsp;{2},&nbsp;t&nbsp;=&nbsp;{3})"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">r</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">g</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">b</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用字符串表示数据的方式有无数种。选择用于调试的字符串格式时，请确保结果
</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可读</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并提供足够的信息以供正确检查。以下部分解释了通过使用</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图表上显示字符串来验证字符串的方法，这些部分之后的部分解释了如何在</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗格中将字符串显示为消息。</font></font></p>
<h3 id="using-labels" class="md-heading"><a href="#using-labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许脚本在图表上的任何可用位置显示动态文本（“系列字符串”）。在图表上显示此类文本的位置取决于程序员想要检查的信息及其调试偏好。</font></font></p>
<h4 id="on-successive-bars" class="md-heading"><a href="#on-successive-bars"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在连续的</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图上</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当检查影响图表比例的值的历史记录或使用具有不同类型的多个系列时，一种简单方便的调试方法是绘制
</font><font style="vertical-align: inherit;">在连续的条形上</font><font style="vertical-align: inherit;">显示
</font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;">字符串表示形式的</font></a></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签。</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本计算四个系列：</font></font><code dir="auto">highestClose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、、
</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">。它使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format"><font style="vertical-align: inherit;">str.format()</font></a><font style="vertical-align: inherit;">
创建表示系列值和时间戳的格式化“字符串”，然后调用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new"><font style="vertical-align: inherit;">label.new()</font></a><font style="vertical-align: inherit;">
绘制一个
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;">标签</font></a></font><code dir="auto">percentRank</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在每个条形图的</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;">最高点</font></a><font style="vertical-align: inherit;">
显示结果
</font><font style="vertical-align: inherit;">
：</font></font><code dir="auto">barsSinceHigh</code><font style="vertical-align: inherit;"></font><code dir="auto">isLow</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Strings-Using-labels-On-successive-bars-1.QDEDvANn_xLWsm.webp" alt="图像" width="1342" height="506" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="t1"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Labels&nbsp;on&nbsp;successive&nbsp;bars&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Inspecting&nbsp;multiple&nbsp;series"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_labels_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation&nbsp;window.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;highest&nbsp;`close`&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;percent&nbsp;rank&nbsp;of&nbsp;the&nbsp;current&nbsp;`close`&nbsp;compared&nbsp;</span><span class="mtk9">to&nbsp;previous&nbsp;values&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">percentRank</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentrank</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;since&nbsp;the&nbsp;`close`&nbsp;was&nbsp;equal&nbsp;to</span><span class="mtk9">&nbsp;the&nbsp;`highestClose`.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsSinceHigh</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.barssince</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestClose</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`percentRank`&nbsp;is&nbsp;0,&nbsp;i.e.,&nbsp;when</span><span class="mtk9">&nbsp;the&nbsp;`close`&nbsp;is&nbsp;the&nbsp;lowest.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">percentRank</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;multi-line&nbsp;string&nbsp;representing&nbsp;the&nbsp;`time`,&nbsp;`hig</span><span class="mtk9">hestClose`,&nbsp;`percentRank`,&nbsp;`barsSinceHigh`,&nbsp;and&nbsp;`i</span><span class="mtk9">sLow`.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugString</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"time&nbsp;(GMT):&nbsp;{0,&nbsp;time,&nbsp;yyyy-MM-dd'T'HH:mm:ss}\nhig</span><span class="mtk29">hestClose:&nbsp;{1,&nbsp;number,&nbsp;#.####}</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span><span class="mtk33">npercentRank</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.##}%\</span><span class="mtk33">nbarsSinceHigh</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">integer</span><span class="mtk1">}\</span><span class="mtk33">nisLow</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">4</span><span class="mtk1">}</span><span class="mtk29">",</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">percentRank</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsSinceHigh</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLow</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Draws&nbsp;a&nbsp;label&nbsp;showing&nbsp;the&nbsp;`debugString`&nbsp;at&nbsp;each&nbsp;b</span><span class="mtk9">ar's&nbsp;`high`.</span></span><br><span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugString</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然上述示例允许人们在任意带有标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图的条形图上检查脚本系列的结果
</font><font style="vertical-align: inherit;">
，但是像这样的连续绘图可能会使图表变得混乱，尤其是在查看较长的字符串时。</font></font></p>
<p><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一种更直观、更紧凑的方式来检查带有标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的连续条形的值，</font><font style="vertical-align: inherit;">就是利用</font></font><code dir="auto">tooltip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性而不是属性</font></font><code dir="auto">text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，因为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
只会在光标</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">悬停</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其上时显示其工具提示。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面，我们修改了之前的脚本，使用</font></font><code dir="auto">debugString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><code dir="auto">tooltip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数而不是</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new"><font style="vertical-align: inherit;">label.new()</font></a></font><code dir="auto">text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中的参数
</font><font style="vertical-align: inherit;">
。现在，我们可以查看特定条形图上的结果，而没有额外的噪音：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Strings-Using-labels-On-successive-bars-2.GO5WpodJ_Z1KqWXN.webp" alt="图像" width="1342" height="528" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3bw"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Tooltips&nbsp;on&nbsp;successive&nbsp;bars&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Inspecting&nbsp;multiple&nbsp;series"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_labels_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation&nbsp;window.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;highest&nbsp;`close`&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;percent&nbsp;rank&nbsp;of&nbsp;the&nbsp;current&nbsp;`close`&nbsp;compared&nbsp;</span><span class="mtk9">to&nbsp;previous&nbsp;values&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">percentRank</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentrank</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;since&nbsp;the&nbsp;`close`&nbsp;was&nbsp;equal&nbsp;to</span><span class="mtk9">&nbsp;the&nbsp;`highestClose`.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsSinceHigh</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.barssince</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestClose</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`percentRank`&nbsp;is&nbsp;0,&nbsp;i.e.,&nbsp;when</span><span class="mtk9">&nbsp;the&nbsp;`close`&nbsp;is&nbsp;the&nbsp;lowest.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">percentRank</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;multi-line&nbsp;string&nbsp;representing&nbsp;the&nbsp;`time`,&nbsp;`hig</span><span class="mtk9">hestClose`,&nbsp;`percentRank`,&nbsp;`barsSinceHigh`,&nbsp;and&nbsp;`i</span><span class="mtk9">sLow`.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugString</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"time&nbsp;(GMT):&nbsp;{0,&nbsp;time,&nbsp;yyyy-MM-dd'T'HH:mm:ss}\nhig</span><span class="mtk29">hestClose:&nbsp;{1,&nbsp;number,&nbsp;#.####}</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span><span class="mtk33">npercentRank</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.##}%\</span><span class="mtk33">nbarsSinceHigh</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">integer</span><span class="mtk1">}\</span><span class="mtk33">nisLow</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">4</span><span class="mtk1">}</span><span class="mtk29">",</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">percentRank</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsSinceHigh</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLow</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Draws&nbsp;a&nbsp;label&nbsp;showing&nbsp;the&nbsp;`debugString`&nbsp;in&nbsp;a&nbsp;tool</span><span class="mtk9">tip&nbsp;at&nbsp;each&nbsp;bar's&nbsp;`high`.</span></span><br><span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">tooltip</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugString</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值得注意的是，脚本最多可以显示 500 个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
图，这意味着上述示例只允许用户检查最近 500 个图表条中的字符串。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果程序员想要查看</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">早期</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表条的结果，一种方法是创建条件逻辑，仅允许在特定时间范围内绘图，例如：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="3k2"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">startTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">endTime</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk33">create_drawing_id</span><span class="mtk18">&gt;</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们在前面的示例中使用此结构，并将
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.left_visible_bar_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.left_visible_bar_time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.right_visible_bar_time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为</font></font><code dir="auto">startTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">endTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，则脚本将仅
</font><font style="vertical-align: inherit;">在
</font><strong><font style="vertical-align: inherit;">可见的图表条上创建</font></strong></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签，并避免在其他条上绘制。 使用此逻辑，我们可以滚动查看</font></font></a><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">任何</font></em><font style="vertical-align: inherit;">图表条上的标签</font><font style="vertical-align: inherit;">，只要
</font><font style="vertical-align: inherit;">可见范围内最多有条：</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code dir="auto">max_labels_count</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Strings-Using-labels-On-successive-bars-3.Dr46dKLS_Z1WAyIK.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="nt"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Tooltips&nbsp;on&nbsp;visible&nbsp;bars&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Inspecting&nbsp;multiple&nbsp;series"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_labels_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation&nbsp;window.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;highest&nbsp;`close`&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;percent&nbsp;rank&nbsp;of&nbsp;the&nbsp;current&nbsp;`close`&nbsp;compared&nbsp;</span><span class="mtk9">to&nbsp;previous&nbsp;values&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">percentRank</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentrank</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;since&nbsp;the&nbsp;`close`&nbsp;was&nbsp;equal&nbsp;to</span><span class="mtk9">&nbsp;the&nbsp;`highestClose`.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsSinceHigh</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.barssince</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestClose</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`percentRank`&nbsp;is&nbsp;0,&nbsp;i.e.,&nbsp;when</span><span class="mtk9">&nbsp;the&nbsp;`close`&nbsp;is&nbsp;the&nbsp;lowest.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">percentRank</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;multi-line&nbsp;string&nbsp;representing&nbsp;the&nbsp;`time`,&nbsp;`hig</span><span class="mtk9">hestClose`,&nbsp;`percentRank`,&nbsp;`barsSinceHigh`,&nbsp;and&nbsp;`i</span><span class="mtk9">sLow`.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugString</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"time&nbsp;(GMT):&nbsp;{0,&nbsp;time,&nbsp;yyyy-MM-dd'T'HH:mm:ss}\nhig</span><span class="mtk29">hestClose:&nbsp;{1,&nbsp;number,&nbsp;#.####}</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span><span class="mtk33">npercentRank</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.##}%\</span><span class="mtk33">nbarsSinceHigh</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">integer</span><span class="mtk1">}\</span><span class="mtk33">nisLow</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">4</span><span class="mtk1">}</span><span class="mtk29">",</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">highestClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">percentRank</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsSinceHigh</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLow</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.left_visible_bar_time</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.right_visible_bar_time</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Draws&nbsp;a&nbsp;label&nbsp;showing&nbsp;the&nbsp;`debugString`&nbsp;in&nbsp;a&nbsp;tool</span><span class="mtk9">tip&nbsp;at&nbsp;each&nbsp;visible&nbsp;bar's&nbsp;`high`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk16">chart.point.now</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">tooltip</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugString</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果可见图表包含的条形图数量超过允许的绘制数量，则脚本将仅显示可见范围内最新条形图的结果。要使用此技术获得最佳效果，请放大图表以将可见范围限制在允许的绘制数量内。</font></font></li>
</ul>
<h4 id="at-the-end-of-the-chart" class="md-heading"><a href="#at-the-end-of-the-chart"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">在图表</font></span><font style="vertical-align: inherit;">的末尾</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试带有标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的脚本字符串的常用方法
</font><font style="vertical-align: inherit;">是将它们显示在图表的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">末尾</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即当字符串不变或只有特定条的值需要分析时。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的脚本包含一个用户定义的</font></font><code dir="auto">printLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，无论脚本何时调用它，它都会在图表上的最后一个可用时间绘制
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。我们在本例中使用该函数显示“Hello world!”字符串、一些基本图表信息以及数据馈送的当前 OHLCV 值：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Strings-Using-labels-At-the-end-of-the-chart-1.C-6hYXkR_Z1lpCgi.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6ml"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Labels&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;chart&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Chart&nbsp;info"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Draws&nbsp;a&nbsp;label&nbsp;to&nbsp;print&nbsp;the&nbsp;`txt`&nbsp;at&nbsp;the&nbsp;last&nbsp;</span><span class="mtk9">available&nbsp;time&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;When&nbsp;called&nbsp;from&nbsp;the&nbsp;global&nbsp;scope,</span><span class="mtk9">&nbsp;the&nbsp;label&nbsp;updates&nbsp;its&nbsp;text&nbsp;using&nbsp;the&nbsp;specified&nbsp;`t</span><span class="mtk9">xt`&nbsp;on&nbsp;every&nbsp;bar.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;txt&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;string&nbsp;to&nbsp;display&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;price&nbsp;&nbsp;The&nbsp;optional&nbsp;y-axis&nbsp;location&nbsp;of&nbsp;the&nbsp;label.</span><span class="mtk9">&nbsp;If&nbsp;not&nbsp;specified,&nbsp;draws&nbsp;the&nbsp;label&nbsp;above&nbsp;the&nbsp;last&nbsp;</span><span class="mtk9">chart&nbsp;bar.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;resulting&nbsp;label&nbsp;ID.</span></span><br><span><span class="mtk15">printLabel</span><span class="mtk13">(</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk11">last_bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.right_visible_bar_time</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">price</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">yloc.abovebar</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">yloc.price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">label.style_none</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.set_text</span><span class="mtk13">(</span><span class="mtk33">result</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.set_y</span><span class="mtk13">(</span><span class="mtk33">result</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;formatted&nbsp;string&nbsp;containing&nbsp;information&nbsp;about&nbsp;t</span><span class="mtk9">he&nbsp;current&nbsp;chart.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">chartInfo</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Symbol:&nbsp;{0}:{1}\nTimeframe:&nbsp;{2}\nStandard&nbsp;chart:&nbsp;</span><span class="mtk29">{3}\nReplay&nbsp;active:&nbsp;{4}"</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">syminfo.prefix</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.ticker</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">timeframe.period</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.is_standard</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">str.contains</span><span class="mtk13">(</span><span class="mtk11">syminfo.tickerid</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"replay"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;formatted&nbsp;string&nbsp;containing&nbsp;OHLCV&nbsp;values.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcvInfo</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"O:&nbsp;{0,&nbsp;number,&nbsp;#.#####},&nbsp;H:&nbsp;{1,&nbsp;number,&nbsp;#.#####},</span><span class="mtk29">&nbsp;L:&nbsp;{2,&nbsp;number,&nbsp;#.#####},&nbsp;C:&nbsp;{3,&nbsp;number,&nbsp;#.#####},</span><span class="mtk29">&nbsp;V:&nbsp;{4}"</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk11">volume</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">format.volume</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Print&nbsp;"Hello&nbsp;world!"&nbsp;and&nbsp;the&nbsp;`chartInfo`&nbsp;at&nbsp;the</span><span class="mtk9">&nbsp;end&nbsp;of&nbsp;the&nbsp;chart&nbsp;on&nbsp;the&nbsp;first&nbsp;bar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isfirst</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">printLabel</span><span class="mtk13">(</span><span class="mtk29">"Hello&nbsp;world!"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n\n\n\n\n\n\n"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">printLabel</span><span class="mtk13">(</span><span class="mtk33">chartInfo</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n\n"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Print&nbsp;current&nbsp;`ohlcvInfo`&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;cha</span><span class="mtk9">rt,&nbsp;updating&nbsp;the&nbsp;displayed&nbsp;text&nbsp;as&nbsp;new&nbsp;data&nbsp;comes&nbsp;</span><span class="mtk9">in.</span></span><br><span><span class="mtk15">printLabel</span><span class="mtk13">(</span><span class="mtk33">ohlcvInfo</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该函数</font><font style="vertical-align: inherit;">
使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time"><font style="vertical-align: inherit;">last_bar_time</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time"><font style="vertical-align: inherit;">chart.right_visible_bar_time</font></a><font style="vertical-align: inherit;">
的
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.max"><font style="vertical-align: inherit;">最大值设置绘制</font></a><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;">标签</font></a></font><code dir="auto">printLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的 x 坐标，
</font><font style="vertical-align: inherit;">
以确保它始终在最后一个可用条中显示结果。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.max"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当从</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局范围</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用时，该函数会创建一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，其</font></font><code dir="auto">text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><code dir="auto">y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会在每条柱状图上更新。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们对该函数进行了三次调用，并添加了换行符（ ），以演示</font><font style="vertical-align: inherit;">如果字符串具有足够的行距，用户可以在图表末尾叠加多个</font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;">标签</font></a></font><code dir="auto">\n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的结果
。</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="using-tables" class="md-heading"><a href="#using-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><a href="/pine-script-docs/concepts/tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在单元格内显示字符串，这些字符串按列和行排列在相对于图表窗格的可视空间的固定位置。它们可以用作基于图表的多功能调试工具，因为与
</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同，它们允许程序员在有组织的可视结构中检查一个或</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“系列字符串”，而不受图表比例或条形索引的影响。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本计算自定义值，其结果是</font><font style="vertical-align: inherit;">
加权
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;">收盘价的</font></a><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.ema"><font style="vertical-align: inherit;">EMA</font></a><font style="vertical-align: inherit;">
与
系列</font><font style="vertical-align: inherit;">
的</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.ema"><font style="vertical-align: inherit;">EMA</font></a></font><code dir="auto">filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的比率
</font><font style="vertical-align: inherit;">。为了检查计算中使用的变量，它会在第一个条形图上创建一个
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;">表格</font></a><font style="vertical-align: inherit;">
实例，在最后一个历史条形图上初始化表格的单元格，然后用最新图表条形图上前几条形图值的“字符串”表示来更新必要的单元格</font><font style="vertical-align: inherit;">：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.ema"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.ema"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">weight</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">barsBack</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Strings-Using-tables-1.Bfvract8_Z20ywVF.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5b6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Debugging&nbsp;with&nbsp;tables&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"History&nbsp;inspection"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;back&nbsp;in&nbsp;the&nbsp;chart's&nbsp;history&nbsp;to</span><span class="mtk9">&nbsp;inspect.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsBack</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bars&nbsp;back"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4999</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;percent&nbsp;rank&nbsp;of&nbsp;`volume`&nbsp;over&nbsp;10&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">weight</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentrank</span><span class="mtk13">(</span><span class="mtk11">volume</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;10-bar&nbsp;EMA&nbsp;of&nbsp;`weight&nbsp;*&nbsp;close`&nbsp;values.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk33">weight</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;10-bar&nbsp;EMA&nbsp;of&nbsp;`weight`&nbsp;values.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk33">weight</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;ratio&nbsp;of&nbsp;the&nbsp;`numerator`&nbsp;to&nbsp;the&nbsp;`denominator`</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">filter</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`filter`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">filter</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;filter"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;frame,&nbsp;border,&nbsp;and&nbsp;text&nbsp;in&nbsp;the&nbsp;`</span><span class="mtk9">debugTable`.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;table&nbsp;that&nbsp;contains&nbsp;"string"&nbsp;representations&nbsp;of</span><span class="mtk9">&nbsp;variable&nbsp;names&nbsp;and&nbsp;values&nbsp;on&nbsp;the&nbsp;latest&nbsp;chart&nbsp;bar</span><span class="mtk9">.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugTable</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">position.top_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">frame_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">frame_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">border_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">border_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Initialize&nbsp;cells&nbsp;on&nbsp;the&nbsp;last&nbsp;confirmed&nbsp;historic</span><span class="mtk9">al&nbsp;bar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Variable"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"Value&nbsp;{0,&nbsp;number,&nbsp;integer}&nbsp;bars&nbsp;ago"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsBack</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"weight"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"numerator"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"denominator"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"filter"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tableColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;value&nbsp;cells&nbsp;on&nbsp;the&nbsp;last&nbsp;available&nbsp;bar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islast</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell_set_text</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">weight</span><span class="mtk13">[</span><span class="mtk33">barsBack</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">format.percent</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell_set_text</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">numerator</span><span class="mtk13">[</span><span class="mtk33">barsBack</span><span class="mtk13">]))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell_set_text</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">denominator</span><span class="mtk13">[</span><span class="mtk33">barsBack</span><span class="mtk13">]))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">table.cell_set_text</span><span class="mtk13">(</span><span class="mtk33">debugTable</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">filter</span><span class="mtk13">[</span><span class="mtk33">barsBack</span><span class="mtk13">]))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关键字来指定分配
</font><font style="vertical-align: inherit;">
给第一个条形图上的变量的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">debugTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在整个脚本执行过程中保持不变。</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本在两个if</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构内修改表格
。第一个结构</font><font style="vertical-align: inherit;">
仅在最后确认的历史条 ( </font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islastconfirmedhistory"><font style="vertical-align: inherit;">barstate.islastconfirmedhistory ) 上使用</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table.cell"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table.cell()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初始化单元格
。第二个结构使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table.cell_set_text"><font style="vertical-align: inherit;">table.cell_set_text()</font></a><font style="vertical-align: inherit;">
调用最新可用条 ( </font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islast"><font style="vertical-align: inherit;">barstate.islast</font></a><font style="vertical-align: inherit;"> ) ，使用我们变量值的
</font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;">字符串表示形式</font></a><font style="vertical-align: inherit;">更新</font><font style="vertical-align: inherit;">相关单元格的属性
</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islastconfirmedhistory"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">text</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table.cell_set_text"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islast"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要注意的是，尽管表格可以提供调试实用程序，即在处理多个系列或创建图表日志时，但它们的计算成本比本页讨论的其他技术更高，并且可能需要</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多代码</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此外，与
</font></font><a href="/pine-script-docs/writing/debugging#using-labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同，只能从最新的脚本执行中查看表格的状态。因此，我们建议在调试时</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明智</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谨慎地</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用它们
，尽可能选择</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简化的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。有关使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对象的更多信息，请参阅</font></font><a href="/pine-script-docs/concepts/tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
页面。</font></font></p>
<h2 id="pine-logs" class="md-heading"><a href="#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">松木</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">​</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs 是脚本在执行过程中特定点输出的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互式消息</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它们为程序员提供了一种强大的方法，让他们能够以最少的代码检查脚本的数据、条件和执行流程。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与本页讨论的其他工具不同，Pine Logs 经过精心设计，可用于深入脚本调试。脚本不会在图表或数据窗口中显示 Pine Logs。相反，它们会在专用的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs 窗格</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中打印带有时间戳的消息，该窗格提供专门的导航功能和过滤选项。</font></font></p>
<p><font style="vertical-align: inherit;"></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要访问 Pine Logs 窗格，请从编辑器的“更多”菜单或从使用函数</font><font style="vertical-align: inherit;">的图表上加载的脚本的“更多”菜单中选择“Pine Logs...” ：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-1.D3YhPfKI_1eBx6z.webp" alt="图像" width="720" height="296" loading="lazy" decoding="async"></p>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">个人脚本</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能生成 Pine 日志。已发布的脚本
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建日志，即使其代码中有函数调用。在</font><a href="/pine-script-docs/writing/publishing"><font style="vertical-align: inherit;">发布</font></a><font style="vertical-align: inherit;">具有调试功能的脚本</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，必须考虑替代方法，例如上文中概述的方法
。</font></font><a href="/pine-script-docs/writing/publishing"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></div></aside>
<h3 id="creating-logs" class="md-heading"><a href="#creating-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以通过调用命名空间中的函数来创建日志</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数均具有以下签名：</font></font></p>
<div class="expressive-code not-content"><link rel="stylesheet" href="/pine-script-docs/_astro/ec.dtidy.css"><script type="module" src="/pine-script-docs/_astro/ec.8gcug.js" data-astro-exec=""></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">log.*(message) → void</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">log.*(formatString, arg0, arg1, ...) → void</span></div></div></code></pre></figure></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个重载记录</font></font><code dir="auto">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs 窗格中指定的内容。第二个重载类似于
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.format()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为它根据</font></font><code dir="auto">formatString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中提供的附加参数记录格式化的消息。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数都有不同的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试级别</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，允许程序员对窗格中显示的结果</font><font style="vertical-align: inherit;">进行分类和
</font></font><a href="/pine-script-docs/writing/debugging#filtering-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤：</font></font></a><font style="vertical-align: inherit;"></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.info
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数记录窗格中以灰色文本显示的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“信息”</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别
的条目。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.warning
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.warning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数记录窗格中以橙色文本显示的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“警告”</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别
的条目。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.error
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.error"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数记录窗格中以红色文本显示的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“错误”</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别
的条目。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此代码演示了这三个函数之间的区别。它</font><font style="vertical-align: inherit;">
在第一个可用条形上</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.info()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.warning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.warning()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.error"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.error() ：</font></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Creating-logs-1.B6M1BlvN_1OBeQe.webp" alt="图像" width="1342" height="428" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3z"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Debug&nbsp;levels&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isfirst</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.info</span><span class="mtk13">(</span><span class="mtk29">"This&nbsp;is&nbsp;an&nbsp;'info'&nbsp;message."</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.warning</span><span class="mtk13">(</span><span class="mtk29">"This&nbsp;is&nbsp;a&nbsp;'warning'&nbsp;message."</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.error</span><span class="mtk13">(</span><span class="mtk29">"This&nbsp;is&nbsp;an&nbsp;'error'&nbsp;message."</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs 可以在脚本执行过程中的任何地方执行。它们允许程序员跟踪历史条形图的信息并监控其脚本在实时、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未确认</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图上的行为。在历史条形图上执行时，脚本会为条形图上的每次调用生成一次新消息</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。在实时条形图上，对函数的调用可以在</font><em><font style="vertical-align: inherit;">每个新报价</font></em></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上创建新条目</font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本计算每个条形图的</font></font><code dir="auto">close - open</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值与其</font></font><code dir="auto">high - low</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围之间的平均比率。当
</font></font><code dir="auto">denominator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不为零时，脚本将调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.info()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以在已确认的条形图上打印计算变量的值，并
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.warning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用 log.warning()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以在未确认的条形图上打印值。否则，它使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.error"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.error()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来指示发生了除以零的情况，因为这种情况会影响结果
</font></font><code dir="auto">average</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Creating-logs-2.DgOgH4xb_ZRjj9G.webp" alt="图像" width="1342" height="666" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="22f"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Logging&nbsp;historical&nbsp;and&nbsp;realtime&nbsp;data&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;bar&nbsp;ratio"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;current&nbsp;bar's&nbsp;change&nbsp;from&nbsp;the&nbsp;`open`&nbsp;to&nbsp;`clos</span><span class="mtk9">e`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;current&nbsp;bar's&nbsp;`low`&nbsp;to&nbsp;`high`&nbsp;range.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;ratio&nbsp;of&nbsp;the&nbsp;bar's&nbsp;open-to-close&nbsp;range&nbsp;to&nbsp;its</span><span class="mtk9">&nbsp;full&nbsp;range.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ratio</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;`ratio`&nbsp;over&nbsp;10&nbsp;non-na&nbsp;values.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">average</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk33">ratio</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`average`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">average</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"average"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Log&nbsp;a&nbsp;division&nbsp;by&nbsp;zero&nbsp;error&nbsp;if&nbsp;the&nbsp;`denominato</span><span class="mtk9">r`&nbsp;is&nbsp;0.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.error</span><span class="mtk13">(</span><span class="mtk29">"Division&nbsp;by&nbsp;0&nbsp;in&nbsp;confirmed&nbsp;results!"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Otherwise,&nbsp;log&nbsp;the&nbsp;confirmed&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.info</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Values&nbsp;(confirmed):\nnumerator:&nbsp;{1,&nbsp;number,&nbsp;#.###</span><span class="mtk29">#####}\ndenominator:&nbsp;{2,&nbsp;number,&nbsp;#.########}</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span><span class="mtk33">nratio</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}\</span><span class="mtk33">naverage</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}",</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ratio</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">average</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Log&nbsp;a&nbsp;division&nbsp;by&nbsp;zero&nbsp;error&nbsp;if&nbsp;the&nbsp;`denominato</span><span class="mtk9">r`&nbsp;is&nbsp;0.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.error</span><span class="mtk13">(</span><span class="mtk29">"Division&nbsp;by&nbsp;0&nbsp;on&nbsp;unconfirmed&nbsp;bar."</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Otherwise,&nbsp;log&nbsp;the&nbsp;unconfirmed&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.warning</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Values&nbsp;(unconfirmed):\nnumerator:&nbsp;{1,&nbsp;number,&nbsp;#.#</span><span class="mtk29">#######}\ndenominator:&nbsp;{2,&nbsp;number,&nbsp;#.########}</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span><span class="mtk33">nratio</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}\</span><span class="mtk33">naverage</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}",</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ratio</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">numerator</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">denominator</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">average</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在未确认的条形图上回滚每个报价，这意味着这些报价的结果会显示在窗格中，直到脚本重新开始执行。若要仅记录
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已确认</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图上的消息，请
</font><font style="vertical-align: inherit;">
在触发调用的条件下使用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barstate.isconfirmed</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当登录未确认的条形图时，我们建议确保这些日志包含</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一信息</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或使用不同的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试级别</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以便您可以
根据需要</font></font><a href="/pine-script-docs/writing/debugging#filtering-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs 窗格将显示历史条形图的最近 10,000 条条目。如果脚本在历史条形图上生成超过 10,000 条日志，并且程序员需要查看更早的条目，他们可以使用条件逻辑将调用限制
</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在特定事件上。请参阅
</font></font><a href="/pine-script-docs/writing/debugging#using-inputs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节以获取将日志生成限制在用户指定的时间范围内的示例。</font></font></li>
</ul>
<h3 id="inspecting-logs" class="md-heading"><a href="#inspecting-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs 包含一些有用的功能，可简化检查过程。每当脚本生成日志时，它都会自动在消息前加上精细的时间戳，以表示日志事件在时间序列中发生的位置。此外，每个条目都包含
</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“源代码”</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“滚动到栏”</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图标，在 Pine Logs 窗格中将鼠标悬停在条目上时会出现这些图标：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Inspecting-logs-1.CEw5SsHB_27329j.webp" alt="图像" width="1342" height="470" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击条目的“源代码”图标将在 Pine 编辑器中打开脚本并突出显示触发日志的特定代码行：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Inspecting-logs-2.1cfqckmg_1omSJk.webp" alt="图像" width="1342" height="434" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击条目的“滚动到条形图”图标可将图表导航到日志发生的特定条形图，然后暂时显示包含该条形图时间信息的工具提示：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Inspecting-logs-3.AJrWQdc2_ZHsjQK.webp" alt="图像" width="1342" height="560" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具提示中的时间信息取决于图表的时间范围，就像链接到图表光标和绘图工具的 x 轴标签一样。例如，EOD 图表上的工具提示将仅显示星期几和日期，而 10 秒图表上的工具提示还将包含一天中的时间，包括秒数。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当图表包含多个生成日志的脚本时，请务必注意每个脚本都维护自己</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独立的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息历史记录。要在图表上有多个脚本时检查特定脚本的消息，请从 Pine Logs 窗格顶部的下拉列表中选择其标题：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Inspecting-logs-4.CY8OpkgY_Z10JTlu.webp" alt="图像" width="1342" height="374" loading="lazy" decoding="async"></p>
<h3 id="filtering-logs" class="md-heading"><a href="#filtering-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个脚本可以生成大量日志，具体取决于触发其调用的条件</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。当脚本仅生成少量日志时，直接滚动查看日志历史记录以查找特定条目可能就足够了，但在搜索数百或数千条消息时，这种方法就变得很麻烦。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs 窗格包含多个用于过滤消息的选项，允许通过隔离特定的
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符序列</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始时间</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试级别</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来简化其结果。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击窗格顶部的“搜索”图标将打开一个搜索栏，该搜索栏会匹配文本以过滤已记录的消息。搜索过滤器还会以蓝色突出显示每条消息的匹配部分以供参考。例如，在这里，我们输入“confirmed”以匹配我们之前的脚本生成的所有结果，其中文本中的某个单词：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Filtering-logs-1.Bo6VZioU_Cbru5.webp" alt="图像" width="1342" height="664" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，此搜索的结果还将带有
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“未确认”</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的消息视为匹配项，因为该词包含我们的查询。我们可以通过在搜索栏右侧的选项中选择“全词”复选框来忽略这些匹配项：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Filtering-logs-2.75PYAT31_Z8HPfP.webp" alt="图像" width="1342" height="664" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此过滤器还支持</font></font><a href="https://en.wikipedia.org/wiki/Regular_expression" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正则表达式 (regex)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，允许用户在搜索选项中选择“Regex”复选框时执行匹配自定义</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符模式</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的高级搜索。例如，此正则表达式匹配所有包含“average”后跟表示大于 0.5 且小于或等于 1 的数字的序列的条目：</font></font></p>
<p><code dir="auto">average:\s*(0\.[6-9]\d*|0\.5\d*[1-9]\d*|1\.0*)</code></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Filtering-logs-3.C8CgIgDR_ZwuDXw.webp" alt="图像" width="1342" height="664" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击“开始日期”图标将打开一个对话框，允许用户指定结果中显示的第一个日志的日期和时间：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Filtering-logs-4.ByHNqBMd_1OJ3LK.webp" alt="图像" width="1342" height="566" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定起点后，日志历史上方会出现一个包含开始时间的标签：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Filtering-logs-5.Dv8F4vq1_1DX0la.webp" alt="图像" width="1342" height="388" loading="lazy" decoding="async"></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以</font><font style="vertical-align: inherit;">使用选择过滤选项中最右侧图标时可用的复选框按</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试级别过滤结果。在这里，我们停用了“信息”和“警告”级别，因此结果将仅包含“错误”消息：</font></font></em><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Filtering-logs-6.CJM074om_Z1UkF5.webp" alt="图像" width="1342" height="664" loading="lazy" decoding="async"></p>
<h4 id="using-inputs" class="md-heading"><a href="#using-inputs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以交互方式过滤脚本记录结果的另一种更复杂的方法是创建</font><font style="vertical-align: inherit;">
与条件逻辑链接的</font></font><a href="/pine-script-docs/concepts/inputs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以激活代码中的特定调用。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看一个例子。此代码计算
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;">收盘</font></a><font style="vertical-align: inherit;">价
的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rma"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RMA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
，并声明一些唯一条件以形成
</font><a href="/pine-script-docs/writing/debugging#compound-and-nested-conditions"><font style="vertical-align: inherit;">复合条件</font></a><font style="vertical-align: inherit;">。该脚本使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;">log.info()</font></a><font style="vertical-align: inherit;">
在 Pine Logs 窗格中显示重要的调试信息，包括变量的值</font><font style="vertical-align: inherit;">和确定其结果的“bool”变量。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#compound-and-nested-conditions"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">compoundCondition</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们声明了</font></font><code dir="auto">filterLogsInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">logStartInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">logEndInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量，分别将其分配给一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.bool"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input.bool()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和两个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input.time()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用，以进行自定义日志过滤。当</font></font><code dir="auto">filterLogsInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 时</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，脚本只会在条形图的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
介于</font></font><code dir="auto">logStartInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">logEndInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值之间时生成新日志，从而使我们能够以交互方式隔离特定时间范围内发生的条目：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Pine-logs-Filtering-logs-Using-inputs-1.BCr7IdYS_ZmAWLn.webp" alt="图像" width="1342" height="524" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1ss"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Filtering&nbsp;logs&nbsp;using&nbsp;inputs&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Compound&nbsp;condition&nbsp;in&nbsp;input&nbsp;range"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;for&nbsp;moving&nbsp;average&nbsp;calculations.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;If&nbsp;`true`,&nbsp;only&nbsp;allows&nbsp;logs&nbsp;within&nbsp;the&nbsp;input&nbsp;time</span><span class="mtk9">&nbsp;range.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">filterLogsInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.bool</span><span class="mtk13">(</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Only&nbsp;log&nbsp;in&nbsp;time&nbsp;range"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">group</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Log&nbsp;filter"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;starting&nbsp;time&nbsp;for&nbsp;logs&nbsp;if&nbsp;`filterLogsInput`&nbsp;i</span><span class="mtk9">s&nbsp;`true`.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">logStartInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.time</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Start&nbsp;time"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">group</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Log&nbsp;filter"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">confirm</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;ending&nbsp;time&nbsp;for&nbsp;logs&nbsp;if&nbsp;`filterLogsInput`&nbsp;is&nbsp;</span><span class="mtk9">`true`.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">logEndInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.time</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"End&nbsp;time"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">group</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Log&nbsp;filter"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">confirm</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;RMA&nbsp;of&nbsp;`close`&nbsp;prices.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;`close`&nbsp;exceeds&nbsp;the&nbsp;`rma`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rma</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;current&nbsp;`close`&nbsp;is&nbsp;greater&nbsp;tha</span><span class="mtk9">n&nbsp;the&nbsp;max&nbsp;of&nbsp;the&nbsp;previous&nbsp;`hl2`&nbsp;and&nbsp;`close`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceRising</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk11">hl2</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">])</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`rma`&nbsp;is&nbsp;positively&nbsp;accelerati</span><span class="mtk9">ng.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">rmaAccelerating</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rma</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">rma</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">rma</span><span class="mtk13">[</span><span class="mtk12">2</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;difference&nbsp;between&nbsp;`rma`&nbsp;and&nbsp;`</span><span class="mtk9">close`&nbsp;exceeds&nbsp;2&nbsp;times&nbsp;the&nbsp;current&nbsp;ATR.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeAtThreshold</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rma</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.atr</span><span class="mtk13">(</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;all&nbsp;the&nbsp;above&nbsp;conditions&nbsp;occur.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">compoundCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceBelow</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceRising</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">rmaAccelerating</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeAtThreshold</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`rma`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart&nbsp;background&nbsp;when&nbsp;the&nbsp;`compou</span><span class="mtk9">ndCondition`&nbsp;occurs.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">compoundCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Compound&nbsp;condition&nbsp;highlight"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;If&nbsp;`filterLogsInput`&nbsp;is&nbsp;`true`,&nbsp;is&nbsp;only&nbsp;`true`&nbsp;in</span><span class="mtk9">&nbsp;the&nbsp;input&nbsp;time&nbsp;range.&nbsp;Otherwise,&nbsp;always&nbsp;`true`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">showLog</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">filterLogsInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">logStartInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">logEndInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Log&nbsp;results&nbsp;for&nbsp;a&nbsp;confirmed&nbsp;bar&nbsp;when&nbsp;`showLog`&nbsp;</span><span class="mtk9">is&nbsp;`true`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">showLog</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.info</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"\nclose:&nbsp;{0,&nbsp;number,&nbsp;#.#####}\nrma:&nbsp;{1,&nbsp;number,&nbsp;#</span><span class="mtk29">.#####}\npriceBelow:&nbsp;{2}\npriceRising:&nbsp;{3}</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span><span class="mtk33">nrmaAccelerating</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">4</span><span class="mtk1">}\</span><span class="mtk33">ncloseAtThreshold</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">5</span><span class="mtk1">}\</span><span class="mtk33">n</span><span class="mtk1">\</span><span class="mtk33">ncompoundCondition</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">6</span><span class="mtk1">}</span><span class="mtk29">",</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceBelow</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceRising</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rmaAccelerating</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeAtThreshold</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">compoundCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"></font><code dir="auto">input.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分配给 、 和 变量的函数</font></font><code dir="auto">filterLogsInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括
</font></font><code dir="auto">logStartInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font><font style="vertical-align: inherit;">参数</font></font><code dir="auto">logEndInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code dir="auto">group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用于在脚本的设置中组织和区分它们。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含input.time
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.time"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用</font></font><code dir="auto">confirm = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以便我们可以在图表上直接以交互方式设置开始和结束时间。要重置输入，请从脚本的“更多”菜单的选项中选择“重置点…”。</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发每个log.info()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用的条件
</font><font style="vertical-align: inherit;">
包括
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barstate.isconfirmed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
，以将日志生成限制为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已确认的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图。</font></font></li>
</ul>
<h2 id="debugging-functions" class="md-heading"><a href="#debugging-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/language/methods#user-defined-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
是由用户编写的自定义函数。它们封装了脚本稍后可调用的操作序列。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个
</font></font><a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义的函数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="/pine-script-docs/language/methods#user-defined-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
都有一个</font><font style="vertical-align: inherit;">嵌入到脚本全局作用域中的
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">局部作用域。函数签名中的参数和函数主体内声明的变量属于该函数的局部作用域，脚本的外部作用域或其他函数的作用域</font></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接访问它们。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下部分解释了程序员可以从函数的本地范围调试值的几种方法。我们将使用此脚本作为后续示例的起点。它包含一个函数，该函数返回指数移动平均线，其平滑参数根据条形图</font><font style="vertical-align: inherit;">
上第</font><font style="vertical-align: inherit;">25 和第 75 个
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.percentile_linear_interpolation"><font style="vertical-align: inherit;">百分位数</font></a></font><code dir="auto">customMA()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之外的距离而变化</font><font style="vertical-align: inherit;">：</font></font><code dir="auto">source</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.percentile_linear_interpolation"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Debugging-functions-1.C82H9E7R_Z1zqdTD.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4f6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Debugging&nbsp;functions&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;`customMA()`&nbsp;calculatio</span><span class="mtk9">n.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Calculates&nbsp;a&nbsp;moving&nbsp;average&nbsp;that&nbsp;only&nbsp;respon</span><span class="mtk9">ds&nbsp;to&nbsp;values&nbsp;outside&nbsp;the&nbsp;first&nbsp;and&nbsp;third&nbsp;quartiles</span><span class="mtk9">.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;source&nbsp;&nbsp;The&nbsp;series&nbsp;of&nbsp;values&nbsp;to&nbsp;process.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;length&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;moving&nbsp;average&nbsp;value.</span></span><br><span><span class="mtk15">customMA</span><span class="mtk13">(</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;custom&nbsp;moving&nbsp;average.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;25th&nbsp;and&nbsp;75th&nbsp;`source`&nbsp;percentile</span><span class="mtk9">s.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentile_linear_interpolation</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentile_linear_interpolation</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">75</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;range&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.range</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Half&nbsp;the&nbsp;ratio&nbsp;of&nbsp;the&nbsp;`outerRange`&nbsp;to&nbsp;the&nbsp;`totalR</span><span class="mtk9">ange`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.5</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Mix&nbsp;the&nbsp;`source`&nbsp;with&nbsp;the&nbsp;`result`&nbsp;based&nbsp;on&nbsp;the</span><span class="mtk9">&nbsp;`alpha`&nbsp;value.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">result</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Return&nbsp;the&nbsp;`result`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`customMA()`&nbsp;result&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">maValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">customMA</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`maValue`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="extracting-local-variables" class="md-heading"><a href="#extracting-local-variables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提取局部</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当程序员想要
</font><font style="vertical-align: inherit;">通过
</font><a href="/pine-script-docs/writing/debugging#plotting-numbers"><font style="vertical-align: inherit;">绘制</font></a><font style="vertical-align: inherit;">其值、
为</font><font style="vertical-align: inherit;">背景或图表条着色等方式</font><a href="/pine-script-docs/writing/debugging#conditional-colors"><font style="vertical-align: inherit;">检查</font></a></font><a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">局部变量时，他们必须将值</font><em><font style="vertical-align: inherit;">提取到</font></em><em><font style="vertical-align: inherit;">全局范围</font></em><font style="vertical-align: inherit;">，因为产生此类输出的内置函数只能接受全局变量和文字。</font></font><a href="/pine-script-docs/writing/debugging#plotting-numbers"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#conditional-colors"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于函数返回的值在发生调用的范围中可用，因此一种直接的提取方法是让函数返回一个</font><font style="vertical-align: inherit;">包含所有需要检查的值的</font></font><a href="/pine-script-docs/language/type-system#tuples"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元组。</font></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们修改了</font></font><code dir="auto">customMA()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数以返回
</font><font style="vertical-align: inherit;">包含函数所有计算变量的</font></font><a href="/pine-script-docs/language/type-system#tuples"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元组。现在，我们可以使用</font></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元组声明</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用该函数，以使值在全局范围内可用，并使用
</font></font><a href="/pine-script-docs/writing/debugging#plotting-numbers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plots</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查它们：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Debugging-functions-Extracting-local-variables-1.Crv6Jvx8_Z2qevgh.webp" alt="图像" width="1342" height="588" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="56z"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Extracting&nbsp;local&nbsp;variables&nbsp;with&nbsp;tuples&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;`customMA()`&nbsp;calculatio</span><span class="mtk9">n.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Calculates&nbsp;a&nbsp;moving&nbsp;average&nbsp;that&nbsp;only&nbsp;respon</span><span class="mtk9">ds&nbsp;to&nbsp;values&nbsp;outside&nbsp;the&nbsp;first&nbsp;and&nbsp;third&nbsp;quartiles</span><span class="mtk9">.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;source&nbsp;&nbsp;The&nbsp;series&nbsp;of&nbsp;values&nbsp;to&nbsp;process.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;length&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;moving&nbsp;average&nbsp;value.</span></span><br><span><span class="mtk15">customMA</span><span class="mtk13">(</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;custom&nbsp;moving&nbsp;average.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;25th&nbsp;and&nbsp;75th&nbsp;`source`&nbsp;percentile</span><span class="mtk9">s.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentile_linear_interpolation</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentile_linear_interpolation</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">75</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;range&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.range</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Half&nbsp;the&nbsp;ratio&nbsp;of&nbsp;the&nbsp;`outerRange`&nbsp;to&nbsp;the&nbsp;`totalR</span><span class="mtk9">ange`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.5</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Mix&nbsp;the&nbsp;`source`&nbsp;with&nbsp;the&nbsp;`result`&nbsp;based&nbsp;on&nbsp;the</span><span class="mtk9">&nbsp;`alpha`&nbsp;value.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">result</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Return&nbsp;a&nbsp;tuple&nbsp;containing&nbsp;the&nbsp;`result`&nbsp;and&nbsp;othe</span><span class="mtk9">r&nbsp;local&nbsp;variables.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">[</span><span class="mtk33">result</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk13">]</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Declare&nbsp;a&nbsp;tuple&nbsp;containing&nbsp;all&nbsp;values&nbsp;returned&nbsp;</span><span class="mtk9">by&nbsp;`customMA()`.</span></span><br><span><span class="mtk13">[</span><span class="mtk33">maValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1Debug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3Debug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRangeDebug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRangeDebug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">alphaDebug</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">customMA</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`maValue`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Display&nbsp;location&nbsp;for&nbsp;plots&nbsp;with&nbsp;different&nbsp;scale.</span></span><br><span><span class="mtk33">notOnPane</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.all</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.pane</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;extracted&nbsp;`q1`&nbsp;and&nbsp;`q3`&nbsp;values&nbsp;in&nbsp;a</span><span class="mtk9">ll&nbsp;plot&nbsp;locations.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">q1Debug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"q1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">q3Debug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"q3"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;other&nbsp;extracted&nbsp;values&nbsp;in&nbsp;the&nbsp;statu</span><span class="mtk9">s&nbsp;line&nbsp;and&nbsp;Data&nbsp;Window&nbsp;to&nbsp;avoid&nbsp;impacting&nbsp;the&nbsp;scal</span><span class="mtk9">e.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">outerRangeDebug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"outerRange"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">notOnPane</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">totalRangeDebug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"totalRange"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">notOnPane</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">alphaDebug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"alpha"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">notOnPane</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart&nbsp;when&nbsp;`alphaDebug`&nbsp;is&nbsp;0,&nbsp;i.e</span><span class="mtk9">.,&nbsp;when&nbsp;the&nbsp;`maValue`&nbsp;does&nbsp;not&nbsp;change.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">alphaDebug</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`alpha&nbsp;==&nbsp;0.0`&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用来绘制</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">变量
</font></font><code dir="auto">display.all - display.pane</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的图，
以</font><a href="/pine-script-docs/writing/debugging#without-affecting-the-scale"><font style="vertical-align: inherit;">避免影响图表的比例</font></a><font style="vertical-align: inherit;">。</font></font><code dir="auto">outerRangeDebug</code><font style="vertical-align: inherit;"></font><code dir="auto">totalRangeDebug</code><font style="vertical-align: inherit;"></font><code dir="auto">alphaDebug</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#without-affecting-the-scale"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本还使用
</font></font><a href="/pine-script-docs/writing/debugging#conditional-colors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件颜色</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font><font style="vertical-align: inherit;">为 0时</font><font style="vertical-align: inherit;">突出显示图表窗格的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，表示不会发生变化。</font></font><code dir="auto">debugAlpha</code><font style="vertical-align: inherit;"></font><code dir="auto">maValue</code><font style="vertical-align: inherit;"></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提取函数局部变量值的</font><font style="vertical-align: inherit;">另一种更</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法是将它们传递给全局范围内声明的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用类型变量。</font></font></em><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数作用域可以访问全局变量以进行计算。虽然脚本无法直接从函数作用域内重新分配全局变量的值，但</font><font style="vertical-align: inherit;">如果它们是引用类型（例如
</font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;">数组</font></a><font style="vertical-align: inherit;">、
</font><a href="/pine-script-docs/language/matrices"><font style="vertical-align: inherit;">矩阵</font></a><font style="vertical-align: inherit;">、
</font><a href="/pine-script-docs/language/maps"><font style="vertical-align: inherit;">映射</font></a><font style="vertical-align: inherit;">和
</font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;">用户定义类型） ，则可以更新这些值的</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素或属性</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/matrices"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/maps"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此版本</font></font><code dir="auto">debugData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在全局范围内声明一个变量，该变量引用
</font><font style="vertical-align: inherit;">
具有“字符串”键和“浮点”值的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_map"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">customMA()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在函数的本地范围内，脚本将包含每个本地变量的名称和值的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键值</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对放入映射中。调用函数后，脚本绘制存储的</font></font><code dir="auto">debugData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="w6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Extracting&nbsp;local&nbsp;variables&nbsp;with&nbsp;reference&nbsp;types&nbsp;d</span><span class="mtk29">emo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;`customMA()`&nbsp;calculatio</span><span class="mtk9">n.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;map&nbsp;with&nbsp;"string"&nbsp;keys&nbsp;and&nbsp;"float"&nbsp;values&nbsp;for&nbsp;d</span><span class="mtk9">ebugging&nbsp;the&nbsp;`customMA()`.</span></span><br><span><span class="mtk18 mtkb">map</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">string</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugData</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">map.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">string</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Calculates&nbsp;a&nbsp;moving&nbsp;average&nbsp;that&nbsp;only&nbsp;respon</span><span class="mtk9">ds&nbsp;to&nbsp;values&nbsp;outside&nbsp;the&nbsp;first&nbsp;and&nbsp;third&nbsp;quartiles</span><span class="mtk9">.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;source&nbsp;&nbsp;The&nbsp;series&nbsp;of&nbsp;values&nbsp;to&nbsp;process.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;length&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;moving&nbsp;average&nbsp;value.</span></span><br><span><span class="mtk15">customMA</span><span class="mtk13">(</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;custom&nbsp;moving&nbsp;average.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;25th&nbsp;and&nbsp;75th&nbsp;`source`&nbsp;percentile</span><span class="mtk9">s.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentile_linear_interpolation</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">map.put</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"q1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentile_linear_interpolation</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">75</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">map.put</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"q3"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;range&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">map.put</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"outerRange"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.range</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">map.put</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"totalRange"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Half&nbsp;the&nbsp;ratio&nbsp;of&nbsp;the&nbsp;`outerRange`&nbsp;to&nbsp;the&nbsp;`totalR</span><span class="mtk9">ange`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.5</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">map.put</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"alpha"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Mix&nbsp;the&nbsp;`source`&nbsp;with&nbsp;the&nbsp;`result`&nbsp;based&nbsp;on&nbsp;the</span><span class="mtk9">&nbsp;`alpha`&nbsp;value.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">result</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Return&nbsp;the&nbsp;`result`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`customMA()`&nbsp;result&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">maValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">customMA</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`maValue`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Display&nbsp;location&nbsp;for&nbsp;plots&nbsp;with&nbsp;different&nbsp;scale.</span></span><br><span><span class="mtk33">notOnPane</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.all</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.pane</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;extracted&nbsp;`q1`&nbsp;and&nbsp;`q3`&nbsp;values&nbsp;in&nbsp;a</span><span class="mtk9">ll&nbsp;plot&nbsp;locations.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">map.get</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"q1"</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"q1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">map.get</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"q3"</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"q3"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;other&nbsp;extracted&nbsp;values&nbsp;in&nbsp;the&nbsp;statu</span><span class="mtk9">s&nbsp;line&nbsp;and&nbsp;Data&nbsp;Window&nbsp;to&nbsp;avoid&nbsp;impacting&nbsp;the&nbsp;scal</span><span class="mtk9">e.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">map.get</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"outerRange"</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"outerRange"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">notOnPane</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">map.get</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"totalRange"</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"totalRange"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">notOnPane</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">map.get</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"alpha"</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"alpha"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">notOnPane</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart&nbsp;when&nbsp;the&nbsp;extracted&nbsp;`alpha`&nbsp;</span><span class="mtk9">is&nbsp;0,&nbsp;i.e.,&nbsp;when&nbsp;the&nbsp;`maValue`&nbsp;does&nbsp;not&nbsp;change.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk16">map.get</span><span class="mtk13">(</span><span class="mtk33">debugData</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"alpha"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`alpha&nbsp;==&nbsp;0.0`&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将每个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">map.put()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用放在与每个变量声明相同的行上，用逗号分隔，以保持简洁并避免在</font></font><code dir="auto">customMA()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码中添加多余的行。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.get"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">map.get()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来检索调试
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plot()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bgcolor()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用的每个值。</font></font></li>
</ul>
<h3 id="local-drawings-and-logs" class="md-heading"><a href="#local-drawings-and-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地图纸和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><code dir="auto">plot.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与函数和其他需要全局范围可访问的值的函数
</font><font style="vertical-align: inherit;">不同，脚本可以</font><font style="vertical-align: inherit;">直接在函数内部生成</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图对象</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs ，从而允许程序员灵活地调试其局部变量</font></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而无需</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将值提取到外部范围。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此示例中，我们使用
</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来显示
范围</font><font style="vertical-align: inherit;">内值的</font></font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串表示形式</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">customMA()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在函数内部，脚本调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.format()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来创建表示本地范围数据的格式化字符串，然后调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">label.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.info()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分别在工具提示中显示图表上的文本并在
</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗格中记录包含文本的“信息”消息：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Debugging-functions-Local-drawings-and-logs-1.iGi0vyrx_2s4zkG.webp" alt="图像" width="1342" height="528" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4fm"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Local&nbsp;drawings&nbsp;and&nbsp;logs&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_labels_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;`customMA()`&nbsp;calculatio</span><span class="mtk9">n.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Calculates&nbsp;a&nbsp;moving&nbsp;average&nbsp;that&nbsp;only&nbsp;respon</span><span class="mtk9">ds&nbsp;to&nbsp;values&nbsp;outside&nbsp;the&nbsp;first&nbsp;and&nbsp;third&nbsp;quartiles</span><span class="mtk9">.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;source&nbsp;&nbsp;The&nbsp;series&nbsp;of&nbsp;values&nbsp;to&nbsp;process.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;length&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;moving&nbsp;average&nbsp;value.</span></span><br><span><span class="mtk15">customMA</span><span class="mtk13">(</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;custom&nbsp;moving&nbsp;average.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;25th&nbsp;and&nbsp;75th&nbsp;`source`&nbsp;percentile</span><span class="mtk9">s.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentile_linear_interpolation</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.percentile_linear_interpolation</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">75</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;range&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.range</span><span class="mtk13">(</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Half&nbsp;the&nbsp;ratio&nbsp;of&nbsp;the&nbsp;`outerRange`&nbsp;to&nbsp;the&nbsp;`totalR</span><span class="mtk9">ange`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.5</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Mix&nbsp;the&nbsp;`source`&nbsp;with&nbsp;the&nbsp;`result`&nbsp;based&nbsp;on&nbsp;the</span><span class="mtk9">&nbsp;`alpha`&nbsp;value.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">result</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;formatted&nbsp;string&nbsp;containing&nbsp;representations&nbsp;of&nbsp;</span><span class="mtk9">all&nbsp;local&nbsp;variables.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"\n`customMA()`&nbsp;data\n----------\nsource:&nbsp;{0,&nbsp;numb</span><span class="mtk29">er,&nbsp;#.########}\nlength:&nbsp;{1}\nq1:&nbsp;{2,&nbsp;number,&nbsp;#.##</span><span class="mtk29">######}</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span><span class="mtk33">nq3</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}\</span><span class="mtk33">nouterRange</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}\</span><span class="mtk33">ntotalRange</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span><span class="mtk33">nalpha</span><span class="mtk1">{</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}\</span><span class="mtk33">nresult</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">7</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}",</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">source</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">q3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">outerRange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalRange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">alpha</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;tooltip&nbsp;displaying&nbsp;the&nbsp;`deb</span><span class="mtk9">ugText`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">tooltip</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugText</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Print&nbsp;an&nbsp;"info"&nbsp;message&nbsp;in&nbsp;the&nbsp;Pine&nbsp;Logs&nbsp;pane&nbsp;w</span><span class="mtk9">hen&nbsp;the&nbsp;bar&nbsp;is&nbsp;confirmed.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.info</span><span class="mtk13">(</span><span class="mtk33">debugText</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Return&nbsp;the&nbsp;`result`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`customMA()`&nbsp;result&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">maValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">customMA</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`maValue`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;MA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font></font><code dir="auto">max_labels_count = 500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicator()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数中加入了显示
</font><font style="vertical-align: inherit;">最近 500 个呼叫</font></font><a href="/pine-script-docs/concepts/text-and-shapes#labels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的标签</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">customMA()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该函数
</font><font style="vertical-align: inherit;">
在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;">if语句中使用</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barstate.isconfirmed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仅
在</font><em><font style="vertical-align: inherit;">已确认的</font></em><font style="vertical-align: inherit;">条形图
上调用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;">log.info()</font></a><font style="vertical-align: inherit;">。它不会在每个实时报价上记录新消息。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></li>
</ul>
<h2 id="debugging-loops" class="md-heading"><a href="#debugging-loops"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><a href="/pine-script-docs/language/loops"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一种基于</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计数器</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
( </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for )、</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#collections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容
</font><font style="vertical-align: inherit;">
( </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for…in</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 或</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
( </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 重复执行代码块的结构。它们允许脚本执行重复任务，而无需冗余的代码行。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个循环实例都维护一个单独的局部作用域，所有外部作用域都无法访问该作用域。在循环作用域内声明的所有变量都特定于该循环，这意味着不能在外部作用域中使用它们。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 Pine 中的其他结构一样，循环调试的方法有很多种。本节探讨了一些有用的技巧，包括提取</font></font><a href="/pine-script-docs/concepts/plots"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的局部值、使用
</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图检查值以及使用</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跟踪循环的执行
</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用此脚本作为以下部分示例的起点。它汇总
1 个条形图的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
价变化率，并在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for"><font style="vertical-align: inherit;">for</font></a></font><code dir="auto">lookbackInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环中累积它们
</font><font style="vertical-align: inherit;">
，然后将结果除以以</font><font style="vertical-align: inherit;">计算最终平均值：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">lookbackInput</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Debugging-loops-1.Co481TKA_ZQmJYP.webp" alt="图像" width="1342" height="504" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="407"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Debugging&nbsp;loops&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Aggregate&nbsp;ROC"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lookback"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;ROC&nbsp;of&nbsp;`close`&nbsp;prices&nbsp;over&nbsp;each&nbsp;lengt</span><span class="mtk9">h&nbsp;from&nbsp;1&nbsp;to&nbsp;`lookbackInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculation&nbsp;loop.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`close`&nbsp;value&nbsp;`length`&nbsp;bars&nbsp;ago.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">length</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`close`&nbsp;rate&nbsp;of&nbsp;change&nbsp;over&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;`roc`&nbsp;to&nbsp;`aroc`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Divide&nbsp;`aroc`&nbsp;by&nbsp;the&nbsp;`lookbackInput`.</span></span><br><span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">/=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`aroc`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">aroc</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"aroc"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">在循环内修改的</font><em><font style="vertical-align: inherit;">全局</font></em></font><code dir="auto">aroc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量，而</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">外部范围无法访问的</font><em><font style="vertical-align: inherit;">局部变量。</font></em></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code dir="auto">pastClose</code><font style="vertical-align: inherit;"></font><code dir="auto">roc</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="inspecting-a-single-iteration" class="md-heading"><a href="#inspecting-a-single-iteration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查单次</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迭代</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当程序员需要专注于特定的循环迭代时，他们可以使用多种技术，其中大多数需要使用
循环内的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来触发调试操作，例如将值提取到外部变量、创建
</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图纸</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息等。</font></font></p>
<p><font style="vertical-align: inherit;"></font><code dir="auto">roc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例以三种不同的方式检查循环单次迭代中的</font><font style="vertical-align: inherit;">局部值。当循环计数器的值等于时</font></font><code dir="auto">debugCounterInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，脚本将分配</font></font><code dir="auto">roc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给</font></font><code dir="auto">rocDebug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全局范围内的变量以进行
</font></font><a href="/pine-script-docs/writing/debugging#plotting-numbers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;">line.new()</font></a><font style="vertical-align: inherit;">
从 0 到该</font><font style="vertical-align: inherit;">值
绘制一条垂直</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线，并使用</font></font></a><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;">log.info()在</font></a><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;">Pine Logs</font></a><font style="vertical-align: inherit;">窗格
</font><font style="vertical-align: inherit;">中记录一条消息
</font><font style="vertical-align: inherit;">：</font></font><code dir="auto">roc</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Debugging-loops-Inspecting-a-single-iteration-1.tCjAEA7s_1OlVrm.webp" alt="图像" width="1342" height="664" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6mx"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Inspecting&nbsp;a&nbsp;single&nbsp;iteration&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Aggregate&nbsp;ROC"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_lines_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lookback"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`length`&nbsp;value&nbsp;in&nbsp;the&nbsp;loop's&nbsp;execution&nbsp;where&nbsp;</span><span class="mtk9">value&nbsp;extraction&nbsp;occurs.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugCounterInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Loop&nbsp;counter&nbsp;value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">group</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Debugging"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`roc`&nbsp;value&nbsp;extracted&nbsp;from&nbsp;the&nbsp;loop.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rocDebug</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;ROC&nbsp;of&nbsp;`close`&nbsp;over&nbsp;lags&nbsp;from&nbsp;1&nbsp;to&nbsp;`l</span><span class="mtk9">ookbackInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculation&nbsp;loop.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`close`&nbsp;value&nbsp;`length`&nbsp;bars&nbsp;ago.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">length</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`close`&nbsp;rate&nbsp;of&nbsp;change&nbsp;over&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;`roc`&nbsp;to&nbsp;`aroc`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Trigger&nbsp;debug&nbsp;actions&nbsp;when&nbsp;the&nbsp;`length`&nbsp;equals&nbsp;</span><span class="mtk9">the&nbsp;`debugCounterInput`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugCounterInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;`roc`&nbsp;to&nbsp;`rocDebug`&nbsp;so&nbsp;the&nbsp;script&nbsp;can&nbsp;pl</span><span class="mtk9">ot&nbsp;its&nbsp;value.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">rocDebug</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;vertical&nbsp;line&nbsp;from&nbsp;0&nbsp;to&nbsp;the&nbsp;`roc`&nbsp;at&nbsp;the</span><span class="mtk9">&nbsp;`bar_index`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Log&nbsp;an&nbsp;"info"&nbsp;message&nbsp;in&nbsp;the&nbsp;Pine&nbsp;Logs&nbsp;pane.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.info</span><span class="mtk13">(</span><span class="mtk29">"{0}-bar&nbsp;`roc`{1}:&nbsp;{2,&nbsp;number,&nbsp;#.########}"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"&nbsp;(confirmed)"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Divide&nbsp;`aroc`&nbsp;by&nbsp;the&nbsp;`lookbackInput`.</span></span><br><span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">/=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`aroc`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">aroc</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"aroc"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`rocDebug`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rocDebug</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Extracted&nbsp;roc"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">206</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">55</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">136</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">40</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分配给的input.int
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用</font></font><code dir="auto">debugCounterInput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含一个</font></font><code dir="auto">group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参数，用于在脚本的设置中区分它。</font></font></li>
<li><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed"><font style="vertical-align: inherit;">每当barstate.isconfirmed</font></a><font style="vertical-align: inherit;">
为时， </font><font style="vertical-align: inherit;">log.info
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用都会在格式化消息中包含“(confirmed)”
 。在</font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;">Pine Logs</font></a><font style="vertical-align: inherit;">窗格中搜索此文本
</font><font style="vertical-align: inherit;">将过滤掉未确认条中的条目。请参阅
上面的</font><a href="/pine-script-docs/writing/debugging#filtering-logs"><font style="vertical-align: inherit;">过滤日志</font></a><font style="vertical-align: inherit;">部分。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#filtering-logs"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="inspecting-multiple-iterations" class="md-heading"><a href="#inspecting-multiple-iterations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查多次</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迭代</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当检查来自多个循环迭代的值时，利用
</font></font><a href="/pine-script-docs/language/type-system#collections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或字符串来收集结果以便在循环终止后用于输出函数通常会很有帮助。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此版本演示了几种从所有迭代中收集和显示循环值的方法。它</font><font style="vertical-align: inherit;">在全局范围内
声明一个</font></font><code dir="auto">logText</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串和一个
数组。在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for"><font style="vertical-align: inherit;">for</font></a><font style="vertical-align: inherit;">
循环的本地范围内，脚本将</font><font style="vertical-align: inherit;">and</font><font style="vertical-align: inherit;">的</font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;">字符串表示</font></a><font style="vertical-align: inherit;">与
</font><font style="vertical-align: inherit;">连接</font><em><font style="vertical-align: inherit;">起来</font></em><font style="vertical-align: inherit;">，并调用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push"><font style="vertical-align: inherit;">array.push()</font></a><font style="vertical-align: inherit;">
将迭代的</font><font style="vertical-align: inherit;">值推送到</font><font style="vertical-align: inherit;">数组中。</font></font><code dir="auto">debugValues</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font><code dir="auto">roc</code><font style="vertical-align: inherit;"></font><code dir="auto">logText</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">roc</code><font style="vertical-align: inherit;"></font><code dir="auto">debugValues</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环结束后，脚本
</font></font><a href="/pine-script-docs/writing/debugging#plotting-numbers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘制</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组
中的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.first"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.last"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一个</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值
</font></font><code dir="auto">debugValues</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，绘制一个
</font><font style="vertical-align: inherit;">
带有</font><em><font style="vertical-align: inherit;">工具提示的</font></em></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，显示
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">数组</font></a><font style="vertical-align: inherit;">的
</font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;">字符串表示</font></a><font style="vertical-align: inherit;">形式，并在确认栏后</font><font style="vertical-align: inherit;">在
</font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;">Pine Logs</font></a><font style="vertical-align: inherit;">窗格中显示：</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">logText</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Debugging-loops-Inspecting-multiple-iterations-1.CYLBy0Wy_ZVV2R6.webp" alt="图像" width="1342" height="588" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="77u"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Inspecting&nbsp;multiple&nbsp;iterations&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Aggregate&nbsp;ROC"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_labels_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lookback"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;containing&nbsp;the&nbsp;`roc`&nbsp;value&nbsp;from&nbsp;each&nbsp;loo</span><span class="mtk9">p&nbsp;iteration.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugValues</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;"string"&nbsp;containing&nbsp;information&nbsp;about&nbsp;the&nbsp;`roc`</span><span class="mtk9">&nbsp;on&nbsp;each&nbsp;iteration.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">logText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;ROC&nbsp;of&nbsp;`close`&nbsp;over&nbsp;lags&nbsp;from&nbsp;1&nbsp;to&nbsp;`l</span><span class="mtk9">ookbackInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculation&nbsp;loop.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`close`&nbsp;value&nbsp;`length`&nbsp;bars&nbsp;ago.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">length</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`close`&nbsp;rate&nbsp;of&nbsp;change&nbsp;over&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;`roc`&nbsp;to&nbsp;`aroc`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Concatenate&nbsp;a&nbsp;new&nbsp;"string"&nbsp;representation&nbsp;with&nbsp;</span><span class="mtk9">the&nbsp;`debugText`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">logText</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\nlength:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">",&nbsp;roc:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">roc</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Push&nbsp;the&nbsp;`roc`&nbsp;value&nbsp;into&nbsp;the&nbsp;`debugValues`&nbsp;arr</span><span class="mtk9">ay.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">array.push</span><span class="mtk13">(</span><span class="mtk33">debugValues</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Divide&nbsp;`aroc`&nbsp;by&nbsp;the&nbsp;`lookbackInput`.</span></span><br><span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">/=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`aroc`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">aroc</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"aroc"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`roc`&nbsp;values&nbsp;from&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;i</span><span class="mtk9">teration.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">array.first</span><span class="mtk13">(</span><span class="mtk33">debugValues</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"First&nbsp;iteration&nbsp;roc"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">166</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">84</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">233</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">array.last</span><span class="mtk13">(</span><span class="mtk33">debugValues</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Last&nbsp;iteration&nbsp;roc"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">115</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">86</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">218</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;tooltip&nbsp;containing&nbsp;a&nbsp;"strin</span><span class="mtk9">g"&nbsp;representation&nbsp;of&nbsp;the&nbsp;`debugValues`&nbsp;array.</span></span><br><span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">aroc</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">206</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">55</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">136</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">tooltip</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">debugValues</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//&nbsp;Log&nbsp;the&nbsp;`logText`&nbsp;in&nbsp;the&nbsp;Pine&nbsp;Logs&nbsp;pane&nbsp;when&nbsp;th</span><span class="mtk9">e&nbsp;bar&nbsp;is&nbsp;confirmed.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.info</span><span class="mtk13">(</span><span class="mtk33">logText</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查多次迭代循环的另一种方法是生成连续的</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或在循环范围内</font><font style="vertical-align: inherit;">创建/修改
</font></font><a href="/pine-script-docs/language/type-system#drawing-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图对象，以详细跟踪其执行模式。</font></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例使用</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来跟踪脚本循环的执行流程。它在每次迭代时都会生成一条新的“信息”消息，以跟踪循环在每个确认的条形图上进行时本地范围的计算：</font></font></p>
<p><img src="/pine-script-docs/_astro/Debugging-Debugging-loops-Inspecting-multiple-iterations-2.CahjoXFr_Z1z4bNL.webp" alt="图像" width="1342" height="662" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5py"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Inspecting&nbsp;multiple&nbsp;iterations&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Aggregate&nbsp;ROC"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lookback"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;ROC&nbsp;of&nbsp;`close`&nbsp;over&nbsp;lags&nbsp;from&nbsp;1&nbsp;to&nbsp;`l</span><span class="mtk9">ookbackInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculation&nbsp;loop.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`close`&nbsp;value&nbsp;`length`&nbsp;bars&nbsp;ago.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">length</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`close`&nbsp;rate&nbsp;of&nbsp;change&nbsp;over&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;`roc`&nbsp;to&nbsp;`aroc`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">log.info</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"{0}\nlength&nbsp;(counter):&nbsp;{1}\npastClose:&nbsp;{2,&nbsp;number</span><span class="mtk29">,&nbsp;#.#####}\n</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">distance</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}\</span><span class="mtk33">nroc</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}\</span><span class="mtk33">n</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">before</span><span class="mtk1">&nbsp;</span><span class="mtk33">division</span><span class="mtk13">)</span><span class="mtk18">:</span><span class="mtk1">&nbsp;{</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk18">,</span><span class="mtk1">&nbsp;#.########}\</span><span class="mtk33">n</span><span class="mtk1">{</span><span class="mtk12">6</span><span class="mtk1">}</span><span class="mtk29">",</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"LOOP&nbsp;START"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">roc</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">aroc</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"LOOP&nbsp;END"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Divide&nbsp;`aroc`&nbsp;by&nbsp;the&nbsp;`lookbackInput`.</span></span><br><span><span class="mtk33">aroc</span><span class="mtk1">&nbsp;</span><span class="mtk18">/=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`aroc`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">aroc</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"aroc"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在循环内部迭代生成
</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或绘图时，务必避免不必要的混乱，并努力实现轻松导航。调试时，数量越多并不总是越好，尤其是在循环内工作时。</font></font></li>
</ul>
<h2 id="tips" class="md-heading"><a href="#tips"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="organization-and-readability" class="md-heading"><a href="#organization-and-readability"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组织性和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可读性</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本时，明智的做法是优先考虑有条理、易读的源代码。有条理且易读的代码有助于简化调试过程。此外，编写良好的代码随着时间的推移更容易维护。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是根据我们的
</font></font><a href="/pine-script-docs/writing/style-guide"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和本页示例提供的一些快速提示：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽量遵循一般的
</font></font><a href="/pine-script-docs/writing/style-guide#script-organization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本组织</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议。使用此结构组织脚本可使查找和检查更加容易。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择易于</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理解</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的变量和函数名称。请参阅
</font></font><a href="/pine-script-docs/writing/style-guide#naming-conventions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名约定</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分中的一些示例。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在调试时，将表达式的重要部分临时分配给具有信息名称的变量通常很有帮助。将表达式分解为可重复使用的部分有助于简化检查过程。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code dir="auto">//@function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">//@variable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等）来记录您的代码。注解特别有用，因为当将鼠标悬停在代码中任意位置的变量和函数标识符上时，Pine Editor 的自动建议会在弹出窗口中显示变量和函数描述。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，在许多情况下，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少即是多</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。调试时，不要让过多的脚本输出或不必要的信息淹没自己。保持简单，只包含您需要的信息。</font></font></li>
</ul>
<h3 id="speeding-up-repetitive-tasks" class="md-heading"><a href="#speeding-up-repetitive-tasks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加速重复</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在调试代码时我们经常使用一些方便的技巧：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotchar()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotshape()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在脚本的状态行和数据窗口中快速显示“int”、“float”或“bool”变量和表达式的结果。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们经常使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bgcolor()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图表上直观地展示某些</font></font><a href="/pine-script-docs/writing/debugging#conditions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
的历史
。</font></font></li>
<li><font style="vertical-align: inherit;"><a href="/pine-script-docs/writing/debugging#at-the-end-of-the-chart"><font style="vertical-align: inherit;">我们使用本节</font></a></font><code dir="auto">printLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中函数
</font><font style="vertical-align: inherit;">的单行版本</font><font style="vertical-align: inherit;">在图表末尾打印字符串。</font></font><a href="/pine-script-docs/writing/debugging#at-the-end-of-the-chart"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用
带有参数</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的 label.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用来</font><a href="/pine-script-docs/writing/debugging#on-successive-bars"><font style="vertical-align: inherit;">在连续的条形图上的</font></a></font><code dir="auto">tooltip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具提示中显示字符串
</font><font style="vertical-align: inherit;">。</font></font><a href="/pine-script-docs/writing/debugging#on-successive-bars"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用这些函数在</font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;">Pine Logs</font></a><font style="vertical-align: inherit;">窗格中
</font></font><code dir="auto">log.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速显示以
</font></font><a href="/pine-script-docs/writing/debugging#representing-other-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串表示的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据
。</font></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当人们建立起典型的调试过程时，创建</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键盘宏</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常会有所帮助，以加快重复任务并减少在每个代码中设置调试输出的时间。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是一个简单的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoHotkey</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本（</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 代码），其中包含上述五种技术的热字符串。该脚本通过输入指定的字符序列后跟空格来生成代码片段：</font></font></p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="txt" tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">; ————— This is AHK code, not Pine Script™. —————</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">; Specify that hotstrings trigger when they end with space, tab, linefeed, or carriage return.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">#Hotstring EndChars `t `n `r</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,show::SendInput, plotchar(%Clipboard%, "%Clipboard%", "", color = chart.fg_color, display = display.all - display.pane){Enter}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,highlight::SendInput, bgcolor(bool(%Clipboard%) ? color.new(color.orange, 80) : na, title = "%Clipboard% highlight"){Enter}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,print::SendInput, printLabel(string txt, float price = na) =&gt; int labelTime = math.max(last_bar_time, chart.right_visible_bar_time), var label result = label.new(labelTime, na, txt, xloc.bar_time, na(price) ? yloc.abovebar : yloc.price, na, label.style_none, chart.fg_color, size.large), label.set_text(result, txt), label.set_y(result, price), result`nprintLabel(){Left}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,tooltip::SendInput, label.new(bar_index, high, color = color.new(chart.fg_color, 70), tooltip = str.tostring(%Clipboard%)){Enter}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,log::SendInput, log.info(str.tostring(%Clipboard%)){Enter}</span></div></div></code></pre></figure></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“,,show” 宏生成一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plotchar()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用，该调用使用剪贴板的内容作为</font></font><code dir="auto">series</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">title</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参数。复制</font></font><code dir="auto">variableName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量或</font></font><code dir="auto">close &gt; open</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表达式并输入“,,show”后跟一个空格将分别产生：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="4s0"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">variableName</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"variableName"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.all</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.pane</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"close&nbsp;&gt;&nbsp;open"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.all</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.pane</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“,,highlight” 宏生成一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bgcolor()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用，该调用根据复制到剪贴板的变量或表达式，
使用</font></font><a href="/pine-script-docs/writing/debugging#conditional-colors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件颜色</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
突出显示图表窗格的背景
。例如，复制</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barstate.isrealtime</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量并输入“,,highlight”后跟一个空格将产生：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="79m"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk16">bool</span><span class="mtk13">(</span><span class="mtk11">barstate.isrealtime</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"barstate.isrealtime&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“,,print” 宏生成单行</font></font><code dir="auto">printLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数并创建一个空调</font></font><code dir="auto">printLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用，光标放在其中。输入“,,print”后跟一个空格，您需要做的就是输入要显示的文本：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="403"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk15">printLabel</span><span class="mtk13">(</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk11">last_bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.right_visible_bar_time</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk33">labelTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">price</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">yloc.abovebar</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">yloc.price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_none</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.set_text</span><span class="mtk13">(</span><span class="mtk33">result</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.set_y</span><span class="mtk13">(</span><span class="mtk33">result</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span></span><br><span><span class="mtk15">printLabel</span><span class="mtk13">()</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“,,tooltip” 宏生成一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">label.new()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用，</font></font><code dir="auto">tooltip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其参数使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.tostring()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对剪贴板的内容进行操作。复制</font></font><code dir="auto">variableName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量并输入“,,tooltip”后跟一个空格，结果如下：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="4ib"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">tooltip</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">variableName</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“,,log” 宏生成一个带有
参数的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log.info()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
调用，</font></font><code dir="auto">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该参数对剪贴板的内容使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.tostring()在</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/writing/debugging#pine-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗格
中显示变量和表达式的字符串表示形式
</font><font style="vertical-align: inherit;">。复制表达式</font></font><code dir="auto">bar_index % 2 == 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并输入“,,log”后跟一个空格，结果如下：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="2a6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk16">log.info</span><span class="mtk13">(</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AHK 适用于</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备。如果您的设备使用不同的操作系统，请研究其他软件以采用类似的过程。</font></font></li>
</ul>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a href="/pine-script-docs/writing/style-guide" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前的</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow-back">  <use xlink:href="#ai:local:theme/arrow-back"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南  </font></font></h4> </a>  <a href="/pine-script-docs/writing/profiling-and-optimization" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  分析和优化</font></font><svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本页</font></font></h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#debugging" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></li></a><a href="#introduction" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></li></a><a href="#the-lay-of-the-land" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地形</font></font></li></a><a href="#numeric-values" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数值</font></font></li></a><a href="#plotting-numbers" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘制数字</font></font></li></a><a href="#without-affecting-the-scale" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在不影响规模的情况下</font></font></li></a><a href="#from-local-scopes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从本地范围</font></font></li></a><a href="#with-drawings" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附有图纸</font></font></li></a><a href="#conditions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状况</font></font></li></a><a href="#as-numbers" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为数字</font></font></li></a><a href="#plotting-conditional-shapes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘制条件形状</font></font></li></a><a href="#conditional-colors" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件颜色</font></font></li></a><a href="#using-drawings" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用图纸</font></font></li></a><a href="#compound-and-nested-conditions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复合条件和嵌套条件</font></font></li></a><a href="#strings" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font></li></a><a href="#representing-other-types" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示其他类型</font></font></li></a><a href="#using-labels" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用标签</font></font></li></a><a href="#on-successive-bars" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在连续的条形图上</font></font></li></a><a href="#at-the-end-of-the-chart" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图表的末尾</font></font></li></a><a href="#using-tables" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用表格</font></font></li></a><a href="#pine-logs" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">松木</font></font></li></a><a href="#creating-logs" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建日志</font></font></li></a><a href="#inspecting-logs" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查日志</font></font></li></a><a href="#filtering-logs" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤日志</font></font></li></a><a href="#using-inputs" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用输入</font></font></li></a><a href="#debugging-functions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试功能</font></font></li></a><a href="#extracting-local-variables" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提取局部变量</font></font></li></a><a href="#local-drawings-and-logs" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地图纸和日志</font></font></li></a><a href="#debugging-loops" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试循环</font></font></li></a><a href="#inspecting-a-single-iteration" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查单次迭代</font></font></li></a><a href="#inspecting-multiple-iterations" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查多次迭代</font></font></li></a><a href="#tips" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示</font></font></li></a><a href="#organization-and-readability" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组织性和可读性</font></font></li></a><a href="#speeding-up-repetitive-tasks" class="document-toc-link" data-astro-cid-oor6cujd="" aria-current="true"><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加速重复任务</font></font></li></a></ul><a class="back-top" href="#top" data-astro-cid-oor6cujd=""><svg width="16" height="16" viewBox="0 0 16 16" data-astro-cid-oor6cujd="" data-icon="theme/back-top">  <symbol id="ai:local:theme/back-top"><path fill="currentColor" fill-rule="evenodd" d="M6.25 12.5A2.75 2.75 0 0 0 9 9.75V4.56L6.78 6.78a.75.75 0 0 1-1.06-1.06l3.5-3.5a.75.75 0 0 1 1.06 0l3.5 3.5a.75.75 0 0 1-1.06 1.06L10.5 4.56v5.19a4.25 4.25 0 0 1-8.5 0v-1a.75.75 0 0 1 1.5 0v1a2.75 2.75 0 0 0 2.75 2.75Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/back-top"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回到顶部
</font></font></a></section></aside></div> </main> </div>            <script data-astro-rerun="" src="/pine-script-docs/static/pine-highlighter-v06.js" data-astro-exec=""></script><div id="goog-gt-tt" class="VIpgJd-yAWNEb-L7lbkb skiptranslate" style="border-radius: 12px; margin: 0 0 0 -23px; padding: 0; font-family: 'Google Sans', Arial, sans-serif;" data-id=""><div id="goog-gt-vt" class="VIpgJd-yAWNEb-hvhgNd"><div class=" VIpgJd-yAWNEb-hvhgNd-l4eHX-i3jM8c"><img src="https://fonts.gstatic.com/s/i/productlogos/translate/v14/24px.svg" width="24" height="24" alt=""></div><div class=" VIpgJd-yAWNEb-hvhgNd-k77Iif-i3jM8c"><div class="VIpgJd-yAWNEb-hvhgNd-IuizWc" dir="ltr">Original text</div><div id="goog-gt-original-text" class="VIpgJd-yAWNEb-nVMfcd-fmcmS VIpgJd-yAWNEb-hvhgNd-axAV1"></div></div><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid ltr"><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid-B7I4Od ltr" dir="ltr"><div class="VIpgJd-yAWNEb-hvhgNd-UTujCb">Rate this translation</div><div class="VIpgJd-yAWNEb-hvhgNd-eO9mKe">Your feedback will be used to help improve Google Translate</div></div><div class="VIpgJd-yAWNEb-hvhgNd-xgov5 ltr"><button id="goog-gt-thumbUpButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Good translation" aria-label="Good translation" aria-pressed="false"><span id="goog-gt-thumbUpIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7H2v13h16c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM7 18H4V9h3v9zm14-7l-3 7H9V8l4.34-4.34L12 9h9v2z"></path></svg></span><span id="goog-gt-thumbUpIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7v13h11c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM5 7H1v13h4V7z"></path></svg></span></button><button id="goog-gt-thumbDownButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Poor translation" aria-label="Poor translation" aria-pressed="false"><span id="goog-gt-thumbDownIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7h5V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zM17 6h3v9h-3V6zM3 13l3-7h9v10l-4.34 4.34L12 15H3v-2z"></path></svg></span><span id="goog-gt-thumbDownIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zm16 0h4V4h-4v13z"></path></svg></span></button></div></div><div id="goog-gt-votingHiddenPane" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><form id="goog-gt-votingForm" action="//translate.googleapis.com/translate_voting?client=te_lib" method="post" target="votingFrame" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><input type="text" name="sl" id="goog-gt-votingInputSrcLang"><input type="text" name="tl" id="goog-gt-votingInputTrgLang"><input type="text" name="query" id="goog-gt-votingInputSrcText"><input type="text" name="gtrans" id="goog-gt-votingInputTrgText"><input type="text" name="vote" id="goog-gt-votingInputVote"></form><iframe name="votingFrame" frameborder="0"></iframe></div></div></div> </body></html>