<html lang="zh-CN" data-theme="light" class="translated-ltr"><head><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/pine-script-docs/static/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>语言/矩阵</title><meta name="og:title" content="Language / Matrices"><meta name="twitter:title" content="Language / Matrices"><meta name="description" content="Everything you need to know about Pine Script™."><meta name="og:description" content="Everything you need to know about Pine Script™."><meta name="twitter:description" content="Everything you need to know about Pine Script™."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png"><meta name="twitter:image" content="/pine-script-docs/meta-image.png"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="../../language/matrices/"><meta name="twitter:url" content="../../language/matrices/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="../../language/matrices/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="stylesheet" href="/pine-script-docs/_astro/index.jN9AZoBe.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.C8b720yZ.css"><script type="module" src="/pine-script-docs/_astro/hoisted.D4iEV6y6.js" data-astro-exec=""></script><style type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://www.gstatic.com/_/translate_http/_/ss/k=translate_http.tr.26tY-h6gH9w.L.W.O/am=GAY/d=0/rs=AN8SPfrev-A3NvrBP0gNq8zXCqKY7IcBLA/m=el_main_css"></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16px" height="16px" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02Zm-3.95-.3a7.91 7.91 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8V4Zm0 9v2h1v-2H8Zm6-3V9h-2v1h2ZM3 9v1h2V9H3Zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm4.2-6-.7-.7-1.4 1.4.7.7L12.7 6ZM5 13.7l-.7-.7 1.4-1.4.7.7L5 13.7Zm7.7-.7-.7.7-1.4-1.4.7-.7 1.4 1.4ZM4.3 6l.7-.7 1.4 1.4-.7.7L4.3 6Zm3 17 14-14 .8.7L8 23.7l-.7-.7Zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9Z"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh="">    <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="关闭菜单" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="主导航" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="打开导航菜单" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="主页按钮" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><svg width="188" height="44" viewBox="0 0 188 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001ZM32.4978 22.1105L27.1641 25.5207L19.7195 19.2258C19.1767 18.7669 18.4312 18.6305 17.7611 18.8676L13.8245 20.2602L21.9253 9.59841L32.4978 22.1105Z" fill="currentColor"></path>
<path d="M33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="currentColor"></path>
<path d="M59.56 13.96C63.016 13.96 65.536 16.456 65.536 19.696C65.536 22.936 63.016 25.432 59.56 25.432H57.376V31H53.896V13.96H59.56ZM59.512 22.168C61.096 22.168 62.152 21.088 62.152 19.696C62.152 18.304 61.096 17.224 59.512 17.224H57.376V22.168H59.512ZM70.8636 14.944C70.8636 16.096 69.9276 17.032 68.7516 17.032C67.6236 17.032 66.6636 16.096 66.6636 14.944C66.6636 13.792 67.6236 12.856 68.7516 12.856C69.9276 12.856 70.8636 13.792 70.8636 14.944ZM67.1196 31V19H70.4076V31H67.1196ZM73.0849 31V19H76.3729V20.368C76.9969 19.408 78.2449 18.736 79.8049 18.736C82.7089 18.736 84.4369 20.848 84.4369 23.968V31H81.1489V24.52C81.1489 22.792 80.4049 21.736 79.0369 21.736C77.5249 21.736 76.3729 22.84 76.3729 25.144V31H73.0849ZM86.2041 25C86.2041 21.448 88.8681 18.736 92.5161 18.736C95.6601 18.736 98.4201 20.752 98.4201 24.64C98.4201 24.928 98.4201 25.264 98.3721 25.768H89.3961C89.5881 27.376 91.0041 28.264 92.5881 28.264C94.0761 28.264 95.1561 27.568 95.6841 26.752L98.1321 28.576C97.0281 30.184 95.0841 31.264 92.5641 31.264C88.9881 31.264 86.2041 28.792 86.2041 25ZM92.4201 21.448C91.1961 21.448 89.8281 22.072 89.5161 23.536H95.1321C94.8441 22.12 93.6441 21.448 92.4201 21.448ZM104.412 28.24L107.076 26.008C107.916 27.28 109.38 28.024 110.772 28.024C112.14 28.024 113.052 27.352 113.052 26.368C113.052 25.408 112.356 24.736 110.676 24.16L109.236 23.656C106.5 22.696 105.036 21.112 105.036 18.784C105.036 15.568 107.484 13.672 110.796 13.672C112.884 13.672 114.708 14.392 116.172 16.024L113.868 18.4C113.052 17.416 111.996 16.936 110.82 16.936C109.644 16.936 108.54 17.44 108.54 18.448C108.54 19.48 109.38 19.936 111.18 20.584L112.548 21.088C115.044 22 116.604 23.584 116.604 26.152C116.58 29.2 114.156 31.288 110.628 31.288C107.916 31.288 105.636 30.112 104.412 28.24ZM129.859 27.808C128.827 29.872 126.667 31.264 124.171 31.264C120.619 31.264 117.811 28.624 117.811 25C117.811 21.376 120.619 18.736 124.171 18.736C126.667 18.736 128.827 20.128 129.859 22.192L127.003 23.728C126.523 22.624 125.491 21.808 124.171 21.808C122.443 21.808 121.123 23.152 121.123 25C121.123 26.848 122.443 28.192 124.171 28.192C125.491 28.192 126.523 27.376 127.003 26.272L129.859 27.808ZM131.482 31V19H134.77V20.92C135.178 19.744 136.402 18.856 137.746 18.856C138.082 18.856 138.442 18.88 138.85 19V22.336C138.346 22.168 137.89 22.072 137.362 22.072C135.802 22.072 134.77 23.296 134.77 25.264V31H131.482ZM144.215 14.944C144.215 16.096 143.279 17.032 142.103 17.032C140.975 17.032 140.015 16.096 140.015 14.944C140.015 13.792 140.975 12.856 142.103 12.856C143.279 12.856 144.215 13.792 144.215 14.944ZM140.471 31V19H143.759V31H140.471ZM146.436 36.016V19H149.724V20.344C150.276 19.576 151.548 18.736 153.204 18.736C156.396 18.736 158.844 21.592 158.844 25C158.844 28.408 156.396 31.264 153.204 31.264C151.548 31.264 150.276 30.424 149.724 29.656V36.016H146.436ZM155.508 25C155.508 23.128 154.284 21.736 152.484 21.736C150.684 21.736 149.46 23.128 149.46 25C149.46 26.872 150.684 28.264 152.484 28.264C154.284 28.264 155.508 26.872 155.508 25ZM168.407 30.88C167.879 31.048 167.231 31.144 166.319 31.144C163.775 31.144 161.735 29.728 161.735 26.8V21.88H159.311V19H161.735V15.664H165.023V19H168.407V21.88H165.023V26.152C165.023 27.616 165.647 28.192 167.063 28.192C167.591 28.192 168.023 28.12 168.407 27.976V30.88ZM177.626 22.648V13.96H179.978L181.874 16.888L183.746 13.96H186.122V22.648H183.698V18.184L181.874 20.968L180.026 18.136V22.648H177.626ZM171.386 22.648V16.456H169.058V13.96H176.258V16.456H173.93V22.648H171.386Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="搜索文档" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0Zm-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="重置" data-search-clear="" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除</font></font></button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="关闭" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索结果</font></font></div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp="">    </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true" style="display:none"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="关闭图片预览" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94 5.53 4.47Z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-has-labels-above="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="返回文档主页。" data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户手册</font></font></span>  </a>  <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <a href="/pine-script-docs/language/execution-model" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></a> <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <span class="current-item" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></span> </div>  <div id="article-labels" class="not-content" data-astro-cid-i7sip6yg=""><div style="background-color: #651FFF" data-astro-cid-i7sip6yg=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">先进的</font></font></div></div>   </div> <div id="slot-container" data-has-labels="" data-astro-cid-xgirumru="">  <h1 id="matrices" class="md-heading"><a href="#matrices"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本页包含高级资料。如果您是初级 Pine Script™ 程序员，我们建议您在进入本页之前先熟悉其他更易于访问的 Pine Script™ 功能。</font></font></p></div></aside>
<h2 id="introduction" class="md-heading"><a href="#introduction"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 矩阵是 :ref:</font></font><a href="@sute/language/type-system#collections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以矩形格式存储值引用。它们相当于二维</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象，具有用于检查、修改和专门计算的函数和方法。与</font></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一样，所有矩阵元素必须是同一</font></font><a href="/pine-script-docs/language/type-system#types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a href="/pine-script-docs/language/type-system#enum-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵使用两个</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引引用其元素</font><font style="vertical-align: inherit;">：一个索引用于
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，另一个索引用于</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。每个索引从 0 开始，延伸到矩阵中的行数/列数减一。Pine 中的矩阵可以具有动态的行数和列数，这些行数和列数随条形图的不同而变化。
</font><font style="vertical-align: inherit;">
矩阵中的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.elements_count"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素总数是</font></font></a><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows"><font style="vertical-align: inherit;">行数</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns"><font style="vertical-align: inherit;">列数</font></a><font style="vertical-align: inherit;">的
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乘积</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（例如，5x5 矩阵总共有 25 个）。与
</font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;">数组</font></a><font style="vertical-align: inherit;">一样，矩阵中的元素总数不能超过 100,000。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<h2 id="declaring-a-matrix" class="md-heading"><a href="#declaring-a-matrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 使用以下语法进行矩阵声明：</font></font></p>
<div class="expressive-code not-content"><link rel="stylesheet" href="/pine-script-docs/_astro/ec.dtidy.css"><script type="module" src="/pine-script-docs/_astro/ec.8gcug.js" data-astro-exec=""></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[var/varip ][matrix&lt;type&gt; ]&lt;identifier&gt; = &lt;expression&gt;</span></div></div></code></pre></figure></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中</font></font><code dir="auto">&lt;type&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
</font><font style="vertical-align: inherit;">矩阵的</font></font><a href="/pine-script-docs/language/type-system#type-templates"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型模板</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">&lt;expression&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，用于声明它将包含的值的类型，并且返回类型的矩阵实例或</font></font><code dir="auto">na</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当将矩阵变量声明为时，用户必须通过包含</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix"><font style="vertical-align: inherit;">矩阵</font></a><font style="vertical-align: inherit;">
关键字和
</font><a href="/pine-script-docs/language/type-system#type-templates"><font style="vertical-align: inherit;">类型模板</font></a></font><code dir="auto">na</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指定标识符将引用特定类型的矩阵
</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#type-templates"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此行声明了一个新</font></font><code dir="auto">myMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量，其值为</font></font><code dir="auto">na</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它明确将变量声明为</font></font><code dir="auto">matrix&lt;float&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这告诉编译器该变量只能接受
包含</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_float"><font style="vertical-align: inherit;">浮点值的</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对象
</font><font style="vertical-align: inherit;">
：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_float"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="5nh"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当矩阵变量未分配给时</font></font><code dir="auto">na</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关键字及其类型模板是可选的，因为编译器将使用变量引用的对象的类型信息。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们声明一个引用</font><font style="vertical-align: inherit;">
具有两行、两列和一个0 的</font></font><code dir="auto">myMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新实例的变量。</font><font style="vertical-align: inherit;">在这种情况下，变量从新对象获取其类型信息，因此它不需要显式的类型声明：</font></font><code dir="auto">matrix&lt;float&gt;</code><font style="vertical-align: inherit;"></font><code dir="auto">initial_value</code><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="4yq"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk33">myMatrix</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="using-var-and-varip-keywords" class="md-heading"><a href="#using-var-and-varip-keywords"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 `var` 和 `varip`</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其他变量一样，用户可以包含
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">varip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关键字，以指示脚本仅声明一次矩阵变量，而不是在每个条形图上都声明一次。使用此关键字声明的矩阵变量将指向图表整个范围内的同一实例，除非脚本明确为其分配另一个矩阵，从而允许矩阵及其元素引用在脚本迭代之间持续存在。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本</font><font style="vertical-align: inherit;">
使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var"><font style="vertical-align: inherit;">var</font></a></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字声明一个分配给矩阵的变量，该矩阵包含一行两个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素
。每 20 个条形图，脚本都会将 1 添加到</font><font style="vertical-align: inherit;">矩阵第一行的第一个元素。plot
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;">()</font></a><font style="vertical-align: inherit;">
调用会在图表上显示此元素。从图中可以看出，</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get"><font style="vertical-align: inherit;">m.get(0, 0)</font></a><font style="vertical-align: inherit;">的值
在条形图之间保持不变，永远不会返回到初始值 0：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">m</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Declaring-a-matrix-Using-var-and-varip-keywords-1.DaUqe-zB_10ShDW.webp" alt="图像" width="1342" height="372" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="50c"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"var&nbsp;matrix&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;1x2&nbsp;rectangular&nbsp;matrix&nbsp;declared&nbsp;only&nbsp;at&nbsp;`bar_in</span><span class="mtk9">dex&nbsp;==&nbsp;0`,&nbsp;i.e.,&nbsp;the&nbsp;first&nbsp;bar.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;20th&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">update</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">update</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">currentValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Get&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;first&nbsp;row&nbsp;and&nbsp;colu</span><span class="mtk9">mn.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">currentValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;first&nbsp;row&nbsp;and&nbsp;column&nbsp;element&nbsp;value&nbsp;to&nbsp;`</span><span class="mtk9">currentValue&nbsp;+&nbsp;1`.</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;value&nbsp;from&nbsp;the&nbsp;first&nbsp;row&nbsp;and&nbsp;column.</span></span><br></code></div>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用varip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明的矩阵变量
与在历史数据上使用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量一样
</font><font style="vertical-align: inherit;">，但它们会在每个新的价格变动时更新实时条形图（即自脚本上次编译以来的条形图）的值。分配给
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">varip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量的矩阵只能保存
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_float"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">float</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_bool"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_color"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">color</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_string"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
类型或
</font></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义类型，这些类型或这些类型的集合（</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、矩阵或</font></font><a href="/pine-script-docs/language/maps"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">仅包含在其字段中。</font></font></p></div></aside>
<h2 id="reading-and-writing-matrix-elements" class="md-heading"><a href="#reading-and-writing-matrix-elements"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取和写入矩阵</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="matrixget-and-matrixset" class="md-heading"><a href="#matrixget-and-matrixset"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.get()` 和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.set()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><code dir="auto">row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要从指定索引</font><font style="vertical-align: inherit;">处的矩阵中检索值</font></font><code dir="auto">column</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.get()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此函数定位指定的矩阵元素并返回其值。同样，要覆盖特定元素的值，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.set()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将指定索引处的元素分配</font><font style="vertical-align: inherit;">给新
</font></font><code dir="auto">row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">。</font></font><code dir="auto">column</code><font style="vertical-align: inherit;"></font><code dir="auto">value</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例定义了一个方阵，该矩阵</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有两行和两列，</font></font><code dir="auto">initial_value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一条柱上的所有元素均为 0。该脚本使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.get()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.set()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法将不同柱上每个元素的值加 1。它每 11 条柱更新一次第一行的第一个值，每 7 条柱更新一次第一行的第二个值，每 5 条柱更新一次第二行的第一个值，每 3 条柱更新一次第二行的第二个值。该脚本在图表上绘制每个元素的值：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Reading-and-writing-matrix-elements-1.Cpd5xwu1_Z2j5Ymv.webp" alt="图像" width="1340" height="380" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6hz"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Reading&nbsp;and&nbsp;writing&nbsp;elements&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x2&nbsp;square&nbsp;matrix&nbsp;of&nbsp;`float`&nbsp;values.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">11</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Adds&nbsp;1&nbsp;to&nbsp;the&nbsp;value&nbsp;at&nbsp;row&nbsp;0,&nbsp;column&nbsp;0&nbsp;every&nbsp;11</span><span class="mtk9">th&nbsp;bar.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">7</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Adds&nbsp;1&nbsp;to&nbsp;the&nbsp;value&nbsp;at&nbsp;row&nbsp;0,&nbsp;column&nbsp;1&nbsp;every&nbsp;7t</span><span class="mtk9">h&nbsp;bar.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Adds&nbsp;1&nbsp;to&nbsp;the&nbsp;value&nbsp;at&nbsp;row&nbsp;1,&nbsp;column&nbsp;0&nbsp;every&nbsp;5t</span><span class="mtk9">h&nbsp;bar.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Adds&nbsp;1&nbsp;to&nbsp;the&nbsp;value&nbsp;at&nbsp;row&nbsp;1,&nbsp;column&nbsp;1&nbsp;every&nbsp;3r</span><span class="mtk9">d&nbsp;bar.</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Row&nbsp;0,&nbsp;Column&nbsp;0&nbsp;Value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Row&nbsp;0,&nbsp;Column&nbsp;1&nbsp;Value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Row&nbsp;1,&nbsp;Column&nbsp;0&nbsp;Value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Row&nbsp;1,&nbsp;Column&nbsp;1&nbsp;Value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="matrixfill" class="md-heading"><a href="#matrixfill"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`矩阵.fill()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要用特定值覆盖所有矩阵元素，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.fill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.fill()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此函数将整个矩阵或索引范围内的所有项目
</font></font><code dir="auto">from_row/column</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向</font><font style="vertical-align: inherit;">
调用中指定的
</font></font><code dir="auto">to_row/column</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。例如，此代码片段声明一个 4x4 方阵，然后用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random"><font style="vertical-align: inherit;">随机</font></a><font style="vertical-align: inherit;">
值填充其元素：</font></font><code dir="auto">value</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="62j"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk33">myMatrix</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">)</span></span><br><span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">fill</span><span class="mtk13">(</span><span class="mtk16">math.random</span><span class="mtk13">())</span></span><br></code></div>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.fill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，当将matrix.fill()与包含特殊类型（ </font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linefill</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">label</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或</font></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDT 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
矩阵一起</font><font style="vertical-align: inherit;">使用时
</font><font style="vertical-align: inherit;">，所有替换的元素都将指向函数调用中传递的同一对象。</font></font></p>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本声明一个包含四行四列标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用的矩阵，并
</font><font style="vertical-align: inherit;">
在第一个条形图上用新</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象
填充
该矩阵。在每个条形图上，脚本将</font></font><code dir="auto">x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 0 行第 0 列引用的标签的属性设置为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将</font></font><code dir="auto">text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 3 行第 3 列引用的标签的属性设置为图表上的标签数量。虽然矩阵可以引用 16 个 (4x4) 标签，但每个元素都指向同一个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此图表上只有一个标签会更新其</font><font style="vertical-align: inherit;">每个条形图上的属性</font></font><code dir="auto">x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code dir="auto">text</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Reading-and-writing-matrix-elements-2.EKhiO87r_27PkSE.webp" alt="图像" width="986" height="350" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2tw"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Object&nbsp;matrix&nbsp;fill&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;4x4&nbsp;label&nbsp;matrix.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Fill&nbsp;`m`&nbsp;with&nbsp;a&nbsp;new&nbsp;label&nbsp;object&nbsp;on&nbsp;the&nbsp;first&nbsp;b</span><span class="mtk9">ar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">fill</span><span class="mtk13">(</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;label&nbsp;objects&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">numLabels</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.all</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`x`&nbsp;of&nbsp;the&nbsp;label&nbsp;from&nbsp;the&nbsp;first&nbsp;row&nbsp;and</span><span class="mtk9">&nbsp;column&nbsp;to&nbsp;`bar_index`.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">set_x</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`text`&nbsp;of&nbsp;the&nbsp;label&nbsp;at&nbsp;the&nbsp;last&nbsp;row&nbsp;and</span><span class="mtk9">&nbsp;column&nbsp;to&nbsp;the&nbsp;number&nbsp;of&nbsp;labels.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">set_text</span><span class="mtk13">(</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"Total&nbsp;labels&nbsp;on&nbsp;the&nbsp;chart:&nbsp;{0}"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">numLabels</span><span class="mtk13">))</span></span><br></code></div>
<h2 id="rows-and-columns" class="md-heading"><a href="#rows-and-columns"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="retrieving" class="md-heading"><a href="#retrieving"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵通过matrix.row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数方便地检索特定行或列中的所有值
</font><font style="vertical-align: inherit;">
。这些函数将值返回为一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对象，该数组对象的大小根据矩阵的另一个维度确定，即
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数组的大小等于</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列数， </font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组
的大小
</font><font style="vertical-align: inherit;">
等于</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的脚本</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个图表条上用值 1 - 6 填充一个 3x2 矩阵。它调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法来访问矩阵中的第一行和第一列数组，并将它们连同数组大小一起显示在图表的标签中：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Rows-and-columns-Retrieving-1.BTrlXXxp_Zjj8GI.webp" alt="图像" width="954" height="340" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="94"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Retrieving&nbsp;rows&nbsp;and&nbsp;columns&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x2&nbsp;rectangular&nbsp;matrix.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;0,&nbsp;column&nbsp;0&nbsp;value&nbsp;to&nbsp;1.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;0,&nbsp;column&nbsp;1&nbsp;value&nbsp;to&nbsp;2.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;1,&nbsp;column&nbsp;0&nbsp;value&nbsp;to&nbsp;3.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;1,&nbsp;column&nbsp;1&nbsp;value&nbsp;to&nbsp;4.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;1,&nbsp;column&nbsp;0&nbsp;value&nbsp;to&nbsp;5.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;1,&nbsp;column&nbsp;1&nbsp;value&nbsp;to&nbsp;6.</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;first&nbsp;row&nbsp;of&nbsp;the&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">row0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;first&nbsp;column&nbsp;of&nbsp;the&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">column0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;first&nbsp;row&nbsp;and&nbsp;column&nbsp;of&nbsp;the&nbsp;matrix&nbsp;a</span><span class="mtk9">nd&nbsp;their&nbsp;sizes&nbsp;in&nbsp;a&nbsp;label.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br><span><span class="mtk33">debugLabel</span><span class="mtk1">.</span><span class="mtk15">set_x</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">)</span></span><br><span><span class="mtk33">debugLabel</span><span class="mtk1">.</span><span class="mtk15">set_text</span><span class="mtk13">(</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"Row&nbsp;0:&nbsp;{0},&nbsp;Size:&nbsp;{1}\nCol&nbsp;0:&nbsp;{2},&nbsp;Size:&nbsp;{3}"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">row0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">column0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了获取标签中显示的数组的大小，我们使用了
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rows()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">columns()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法而不是
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array.size()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来表明数组的大小</font></font><code dir="auto">row0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于列数，数组的大小</font></font><code dir="auto">column0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于行数。</font></font></li>
</ul>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将行/列中的引用复制到新
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组。对这些函数返回的</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的修改</font><font style="vertical-align: inherit;">
不会直接影响矩阵的元素或形状。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们修改了之前的脚本，在
</font><font style="vertical-align: inherit;">
显示标签之前</font></font><code dir="auto">row0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.set"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array.set()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">row0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法将第一个元素设置为 10。此脚本还绘制了从第 0 行、第 0 列开始的值。如我们所见，标签显示数组的第一个元素是 10。但是，
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
显示相应的矩阵元素仍具有 1 的值：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Rows-and-columns-Retrieving-2.CJgBcT5Y_1sKqb7.webp" alt="图像" width="1324" height="372" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5tg"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Retrieving&nbsp;rows&nbsp;and&nbsp;columns&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x2&nbsp;rectangular&nbsp;matrix.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;0,&nbsp;column&nbsp;0&nbsp;value&nbsp;to&nbsp;1.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;0,&nbsp;column&nbsp;1&nbsp;value&nbsp;to&nbsp;2.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;1,&nbsp;column&nbsp;0&nbsp;value&nbsp;to&nbsp;3.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;1,&nbsp;column&nbsp;1&nbsp;value&nbsp;to&nbsp;4.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;1,&nbsp;column&nbsp;0&nbsp;value&nbsp;to&nbsp;5.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;row&nbsp;1,&nbsp;column&nbsp;1&nbsp;value&nbsp;to&nbsp;6.</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;first&nbsp;row&nbsp;of&nbsp;the&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">row0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;first&nbsp;column&nbsp;of&nbsp;the&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">column0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;first&nbsp;`row`&nbsp;element&nbsp;to&nbsp;10.</span></span><br><span><span class="mtk33">row0</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;first&nbsp;row&nbsp;and&nbsp;column&nbsp;of&nbsp;the&nbsp;matrix&nbsp;a</span><span class="mtk9">nd&nbsp;their&nbsp;sizes&nbsp;in&nbsp;a&nbsp;label.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br><span><span class="mtk33">debugLabel</span><span class="mtk1">.</span><span class="mtk15">set_x</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">)</span></span><br><span><span class="mtk33">debugLabel</span><span class="mtk1">.</span><span class="mtk15">set_text</span><span class="mtk13">(</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"Row&nbsp;0:&nbsp;{0},&nbsp;Size:&nbsp;{1}\nCol&nbsp;0:&nbsp;{2},&nbsp;Size:&nbsp;{3}"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">row0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">column0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()))</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;`m`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
虽然对
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row"><font style="vertical-align: inherit;">matrix.row()</font></a><font style="vertical-align: inherit;">
或
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col"><font style="vertical-align: inherit;">matrix.col()返回的</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的更改
</font><font style="vertical-align: inherit;">
不会直接影响父矩阵，但需要注意的是，包含
</font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;">UDT</font></a><font style="vertical-align: inherit;">
或特殊类型（包括
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;">line</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;">linefill</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;">box</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;">polyline</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;">label</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;">table</font></a><font style="vertical-align: inherit;">或
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a><font style="vertical-align: inherit;">）的矩阵所得到的数组表现为行/列的</font><em><font style="vertical-align: inherit;">浅表副本</font></em><font style="vertical-align: inherit;">，即，这些函数返回的数组中的元素指向与相应矩阵元素相同的对象。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本包含一个自定义</font></font><code dir="auto">myUDT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型，其中包含一个</font></font><code dir="auto">value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始值为 0 的字段。它声明一个 1x1矩阵来保存</font><font style="vertical-align: inherit;">第一个条形图上的</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个实例，然后</font><font style="vertical-align: inherit;">调用将矩阵的第一行复制为数组
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">。</font></a><font style="vertical-align: inherit;">在每个图表条形图上，脚本都会将 1 添加到</font><font style="vertical-align: inherit;">第一个
</font><font style="vertical-align: inherit;">数组元素的字段。在这种情况下，</font><font style="vertical-align: inherit;">矩阵元素的字段也会在每个条形图上增加，因为两个元素都引用同一个对象：</font></font><code dir="auto">myUDT</code><font style="vertical-align: inherit;"></font><code dir="auto">m.row(0)</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">value</code><font style="vertical-align: inherit;"></font><code dir="auto">row</code><font style="vertical-align: inherit;"></font><code dir="auto">value</code><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="77j"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Row&nbsp;with&nbsp;reference&nbsp;types&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@type</span><span class="mtk9">&nbsp;A&nbsp;custom&nbsp;type&nbsp;that&nbsp;holds&nbsp;a&nbsp;float&nbsp;value.</span></span><br><span><span class="mtk18">type</span><span class="mtk1">&nbsp;</span><span class="mtk33">myUDT</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;1x1&nbsp;matrix&nbsp;of&nbsp;`myUDT`&nbsp;type.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">myUDT</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">myUDT</span><span class="mtk13">&gt;(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">myUDT</span><span class="mtk1">.</span><span class="mtk15">new</span><span class="mtk13">())</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;the&nbsp;first&nbsp;row&nbsp;of&nbsp;`m`.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">myUDT</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;first&nbsp;element&nbsp;of&nbsp;the&nbsp;`row`.</span></span><br><span><span class="mtk18 mtkb">myUDT</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstElement</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">firstElement</span><span class="mtk1">.</span><span class="mtk33">value</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;the&nbsp;`value`&nbsp;field&nbsp;of&nbsp;`firstElement`.&nbsp;A</span><span class="mtk9">lso&nbsp;affects&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;matrix.</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk33">value</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`value`&nbsp;of&nbsp;the&nbsp;`myUDT`&nbsp;object&nbsp;from&nbsp;the</span><span class="mtk9">&nbsp;first&nbsp;row&nbsp;and&nbsp;column&nbsp;of&nbsp;`m`.</span></span><br></code></div>
<h3 id="inserting" class="md-heading"><a href="#inserting"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以通过matrix.add_row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.add_col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向矩阵添加新行和新列
。这些函数将</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的值引用插入
</font><font style="vertical-align: inherit;">
到指定</font></font><code dir="auto">row/column</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引处的矩阵中。如果</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵为空（没有行或列），则</font></font><code dir="auto">array_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中的 可以是任意大小。如果指定索引处存在行/列，则矩阵会将现有行/列及其后的所有行/列的索引值增加 1。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的脚本声明了一个空</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵，并使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.add_row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.add_col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法插入行和列。它首先在第 0 行插入一个包含三个元素的数组，变成
</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 1x3 矩阵，然后在第 1 行插入另一个数组，将形状更改为 2x3。之后，脚本在第 0 行插入另一个数组，将形状更改为</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3x3，并将之前索引为 0 及更高位置的所有行的索引移动。它在最后一列索引处插入另一个数组，将形状更改为 3x4。最后，它在最后一行索引处添加一个包含四个值的数组。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的矩阵有四行四列，按升序排列包含 1-16 的值。脚本</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用用户定义的</font></font><code dir="auto">debugLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数显示每行/列插入后的行，以可视化该过程：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Rows-and-columns-Inserting-1.SBCXGGVm_ZyieEL.webp" alt="图像" width="1282" height="396" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4zc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Rows&nbsp;and&nbsp;columns&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//Create&nbsp;an&nbsp;empty&nbsp;matrix.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">30</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Empty&nbsp;matrix"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Insert&nbsp;an&nbsp;array&nbsp;at&nbsp;row&nbsp;0.&nbsp;`m`&nbsp;will&nbsp;now&nbsp;have&nbsp;1&nbsp;r</span><span class="mtk9">ow&nbsp;and&nbsp;3&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">7</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"New&nbsp;row&nbsp;at\nindex&nbsp;0"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Insert&nbsp;an&nbsp;array&nbsp;at&nbsp;row&nbsp;1.&nbsp;`m`&nbsp;will&nbsp;now&nbsp;have&nbsp;2&nbsp;r</span><span class="mtk9">ows&nbsp;and&nbsp;3&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">9</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">11</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"New&nbsp;row&nbsp;at\nindex&nbsp;1"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Insert&nbsp;another&nbsp;array&nbsp;at&nbsp;row&nbsp;0.&nbsp;`m`&nbsp;will&nbsp;now&nbsp;hav</span><span class="mtk9">e&nbsp;3&nbsp;rows&nbsp;and&nbsp;3&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;The&nbsp;values&nbsp;previously&nbsp;on&nbsp;row&nbsp;0&nbsp;will&nbsp;now&nbsp;be&nbsp;on&nbsp;r</span><span class="mtk9">ow&nbsp;1,&nbsp;and&nbsp;the&nbsp;values&nbsp;from&nbsp;row&nbsp;1&nbsp;will&nbsp;be&nbsp;on&nbsp;row&nbsp;2.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"New&nbsp;row&nbsp;at\nindex&nbsp;0"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Insert&nbsp;an&nbsp;array&nbsp;at&nbsp;column&nbsp;3.&nbsp;`m`&nbsp;will&nbsp;now&nbsp;have&nbsp;</span><span class="mtk9">3&nbsp;rows&nbsp;and&nbsp;4&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">12</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"New&nbsp;column&nbsp;at\nindex&nbsp;3"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Insert&nbsp;an&nbsp;array&nbsp;at&nbsp;row&nbsp;3.&nbsp;`m`&nbsp;will&nbsp;now&nbsp;have&nbsp;4&nbsp;r</span><span class="mtk9">ows&nbsp;and&nbsp;4&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">13</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">15</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">16</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"New&nbsp;row&nbsp;at\nindex&nbsp;3"</span><span class="mtk13">)</span></span><br></code></div>
<aside aria-label="注意！" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像
从</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;">line</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;">linefill</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;">box</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;">polyline</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;">label</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;">table</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;">chart.point</font></a><font style="vertical-align: inherit;">或</font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;">UDT</font></a><font style="vertical-align: inherit;">实例的矩阵中
</font></font><a href="/pine-script-docs/language/matrices#retrieving"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索到的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行或列数组
表现为浅拷贝一样，包含此类类型的矩阵的元素引用与
插入到其中的</font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;">数组</font></a><font style="vertical-align: inherit;">相同的对象。在这种情况下，对任一对象中元素值的修改都会影响另一个对象。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></div></aside>
<h3 id="removing" class="md-heading"><a href="#removing"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要从矩阵中删除特定行或列，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.remove_row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.remove_col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些函数会删除指定的行/列，并将其后的所有行/列的索引值减少 1。</font></font></p>
<p><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/matrices#inserting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于此示例，我们从上面的部分</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将以下代码行添加到我们的“行和列演示”脚本中
</font><font style="vertical-align: inherit;">：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="2j5"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//&nbsp;Removing&nbsp;example</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Remove&nbsp;the&nbsp;first&nbsp;row&nbsp;and&nbsp;last&nbsp;column&nbsp;from&nbsp;the&nbsp;m</span><span class="mtk9">atrix.&nbsp;`m`&nbsp;will&nbsp;now&nbsp;have&nbsp;3&nbsp;rows&nbsp;and&nbsp;3&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">remove_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">remove_col</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">30</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Removed&nbsp;row&nbsp;0\nand&nbsp;column&nbsp;3"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此代码使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.remove_row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.remove_col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法删除矩阵的第一行和最后一列</font><font style="vertical-align: inherit;">
，并在 处的标签中显示行</font></font><code dir="auto">bar_index + 30</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我们可以看到，</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行此块后具有 3x3 形状，并且所有现有行的索引值减少 1：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Rows-and-columns-Removing-1.Bi1zJWmd_ZpgTSa.webp" alt="图像" width="1044" height="394" loading="lazy" decoding="async"></p>
<h3 id="swapping" class="md-heading"><a href="#swapping"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交换</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要交换矩阵的行和列而不改变其维度，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.swap_rows"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.swap_rows()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.swap_columns"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.swap_columns()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">row1/column1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 。这些函数交换
和索引</font><font style="vertical-align: inherit;">处元素的位置</font></font><code dir="auto">row2/column2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将以下几行添加到
</font></font><a href="/pine-script-docs/language/matrices#removing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的示例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，交换的第一行和最后一行</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在标签中显示更改</font></font><code dir="auto">bar_index + 40</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="5j5"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//&nbsp;Swapping&nbsp;example</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Swap&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;row.&nbsp;`m`&nbsp;retains&nbsp;the&nbsp;sa</span><span class="mtk9">me&nbsp;dimensions.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">swap_rows</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">40</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Swapped&nbsp;rows&nbsp;0\nand&nbsp;2"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在新的标签中，我们看到矩阵的行数与以前相同，并且第一行和最后一行交换了位置：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Rows-and-columns-Swapping-1.CEKWu0X8_ZXVDWE.webp" alt="图像" width="1044" height="392" loading="lazy" decoding="async"></p>
<h3 id="replacing" class="md-heading"><a href="#replacing"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更换</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，可能需要完全</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替换</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵中的一行或一列。为此，
请在所需位置</font></font><a href="/pine-script-docs/language/matrices#inserting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新数组</font></font><code dir="auto">row/column</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
</font></font><a href="/pine-script-docs/language/matrices#removing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前位于该索引处的旧元素。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的代码中，我们定义了一个</font></font><code dir="auto">replaceRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，该方法使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add_row()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">values</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法在索引处</font><font style="vertical-align: inherit;">
插入新行</font></font><code dir="auto">row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remove_row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法删除移动到</font></font><code dir="auto">row + 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引的旧行。此脚本使用该</font></font><code dir="auto">replaceRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法用数字 1-9 填充 3x3 矩阵的行。它在使用自定义方法替换行之前和之后在图表上绘制标签</font></font><code dir="auto">debugLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Rows-and-columns-Replacing-1.DOIpvAMN_ZBuSGC.webp" alt="图像" width="706" height="296" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5c3"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Replacing&nbsp;rows&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Replaces&nbsp;the&nbsp;`row`&nbsp;of&nbsp;`this`&nbsp;matrix&nbsp;with&nbsp;a&nbsp;new&nbsp;ar</span><span class="mtk9">ray&nbsp;of&nbsp;`values`.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;row&nbsp;The&nbsp;row&nbsp;index&nbsp;to&nbsp;replace.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;values&nbsp;The&nbsp;array&nbsp;of&nbsp;values&nbsp;to&nbsp;insert.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">replaceRow</span><span class="mtk13">(</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">values</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk33">row</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">values</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Inserts&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;`values`&nbsp;array&nbsp;at&nbsp;the&nbsp;`ro</span><span class="mtk9">w`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">remove_row</span><span class="mtk13">(</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Removes&nbsp;the&nbsp;old&nbsp;elements&nbsp;previously&nbsp;at&nbsp;the&nbsp;`row</span><span class="mtk9">`.</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x3&nbsp;matrix.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Original"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Replace&nbsp;each&nbsp;row&nbsp;of&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">replaceRow</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3.0</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">replaceRow</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">4.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6.0</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">replaceRow</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">7.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9.0</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Replaced&nbsp;rows"</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="looping-through-a-matrix" class="md-heading"><a href="#looping-through-a-matrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="for" class="md-heading"><a href="#for"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`为`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当脚本只需要迭代矩阵中的行/列索引时，最常用的方法是使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
循环。例如，此行创建一个循环，</font></font><code dir="auto">row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其值从 0 开始，然后逐一增加，直到达到比</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵中的行数少 1（即最后一行索引）：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="1rf"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了迭代</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵中的所有索引值，我们可以创建一个
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环，迭代</font></font><code dir="auto">column</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个值的每个索引</font></font><code dir="auto">row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="4y4"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们使用这个嵌套结构来创建一个
可视化矩阵元素的</font></font><a href="/pine-script-docs/language/methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在下面的脚本中，我们定义了一个在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;">表</font></a></font><code dir="auto">toTable()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象
中显示矩阵元素的方法
</font><font style="vertical-align: inherit;">
。它在每个</font><font style="vertical-align: inherit;">索引上迭代，并在每个</font><font style="vertical-align: inherit;">索引上迭代</font><font style="vertical-align: inherit;">。在循环中，它将每个元素转换为
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_string"><font style="vertical-align: inherit;">字符串</font></a><font style="vertical-align: inherit;">
以显示在相应的表单元格中。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">row</code><font style="vertical-align: inherit;"></font><code dir="auto">column</code><font style="vertical-align: inherit;"></font><code dir="auto">row</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_string"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个栏上，脚本创建一个空</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵，用行填充它，并调用</font></font><code dir="auto">m.toTable()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以显示其元素：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Looping-through-a-matrix-For-1.AD9eoMUJ_ZEOwGG.webp" alt="图像" width="1258" height="392" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="u0"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"for&nbsp;loop&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Matrix&nbsp;to&nbsp;table"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;elements&nbsp;of&nbsp;`this`&nbsp;matrix&nbsp;in&nbsp;a&nbsp;table</span><span class="mtk9">.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;The&nbsp;position&nbsp;of&nbsp;the&nbsp;table&nbsp;on&nbsp;the&nbsp;char</span><span class="mtk9">t.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;table.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;text&nbsp;in&nbsp;each&nbsp;cell.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;A&nbsp;note&nbsp;string&nbsp;to&nbsp;display&nbsp;on&nbsp;the&nbsp;bottom&nbsp;ro</span><span class="mtk9">w&nbsp;of&nbsp;the&nbsp;table.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;A&nbsp;new&nbsp;`table`&nbsp;object&nbsp;with&nbsp;cells&nbsp;corresponding&nbsp;to</span><span class="mtk9">&nbsp;each&nbsp;element&nbsp;of&nbsp;`this`&nbsp;matrix.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">toTable</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">position</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">position.middle_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;rows&nbsp;in&nbsp;`this`&nbsp;matrix.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">rows</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;columns&nbsp;in&nbsp;`this`&nbsp;matrix.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">columns</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;table&nbsp;that&nbsp;displays&nbsp;the&nbsp;elements&nbsp;of&nbsp;`this`&nbsp;matr</span><span class="mtk9">ix&nbsp;with&nbsp;an&nbsp;optional&nbsp;`note`&nbsp;cell.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span><span class="mtk33">position</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">columns</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rows</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Iterate&nbsp;over&nbsp;each&nbsp;row&nbsp;index&nbsp;of&nbsp;`this`&nbsp;matrix.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">rows</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Iterate&nbsp;over&nbsp;each&nbsp;column&nbsp;index&nbsp;of&nbsp;`this`&nbsp;matrix</span><span class="mtk9">&nbsp;on&nbsp;each&nbsp;`row`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">col</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">columns</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;element&nbsp;from&nbsp;`this`&nbsp;matrix&nbsp;at&nbsp;the&nbsp;`row`&nbsp;and&nbsp;`</span><span class="mtk9">col`&nbsp;index.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">element</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk33">row</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">col</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Initialize&nbsp;the&nbsp;corresponding&nbsp;`result`&nbsp;cell&nbsp;with</span><span class="mtk9">&nbsp;the&nbsp;`element`&nbsp;value.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk33">col</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">element</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Initialize&nbsp;a&nbsp;merged&nbsp;cell&nbsp;on&nbsp;the&nbsp;bottom&nbsp;row&nbsp;if&nbsp;a</span><span class="mtk9">&nbsp;`note`&nbsp;is&nbsp;provided.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rows</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">.</span><span class="mtk15">merge_cells</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rows</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">columns</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rows</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Return&nbsp;the&nbsp;`result`&nbsp;table.</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x4&nbsp;matrix&nbsp;of&nbsp;values.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;rows&nbsp;to&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">7</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">9</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">11</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;a&nbsp;column&nbsp;to&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">12</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;elements&nbsp;of&nbsp;`m`&nbsp;in&nbsp;a&nbsp;table.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">toTable</span><span class="mtk13">()</span></span><br></code></div>
<h3 id="forin" class="md-heading"><a href="#forin"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`for…in`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当脚本需要迭代并检索矩阵的行时，使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_for%7Bdot%7D%7Bdot%7D%7Bdot%7Din"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for…in</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结构通常比标准循环更受欢迎</font></font><code dir="auto">for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此结构直接引用矩阵中的行
</font></font><a href="/pine-script-docs/language/arrays"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使其成为此类用例的更方便的选择。例如，此行创建一个循环，为矩阵中的每一行</font><font style="vertical-align: inherit;">返回一个数组</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="5qq"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下指标使用输入计算 OHLC 数据的移动平均值</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并在图表上显示值。自定义
</font></font><code dir="auto">rowWiseAvg()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法使用结构循环遍历矩阵的行，
以生成包含</font><font style="vertical-align: inherit;">
每个</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg"><font style="vertical-align: inherit;">array.avg()</font></a></font><code dir="auto">for...in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数组
</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">row</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个图表条上，脚本创建一个</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有四行四列的新矩阵</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它通过
</font><font style="vertical-align: inherit;">
每个后续条上的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.add_col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.remove_col()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">m.rowWiseAvg()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法将新的 OHLC 数据列排队到该矩阵中。它使用行计算数组</font></font><code dir="auto">averages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后在图表上绘制元素值：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Looping-through-a-matrix-For-in-1.DsFiIU_K_Z1Fdgid.webp" alt="图像" width="1342" height="682" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="10p"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"for...in&nbsp;loop&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;OHLC"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;terms&nbsp;in&nbsp;the&nbsp;average.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Calculates&nbsp;the&nbsp;average&nbsp;of&nbsp;each&nbsp;matrix&nbsp;row.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowWiseAvg</span><span class="mtk13">(</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;with&nbsp;elements&nbsp;corresponding&nbsp;to&nbsp;each&nbsp;row'</span><span class="mtk9">s&nbsp;average.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Iterate&nbsp;over&nbsp;each&nbsp;`row`&nbsp;of&nbsp;`this`&nbsp;matrix.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Push&nbsp;the&nbsp;average&nbsp;of&nbsp;each&nbsp;`row`&nbsp;into&nbsp;the&nbsp;`result</span><span class="mtk9">`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk33">row</span><span class="mtk1">.</span><span class="mtk15">avg</span><span class="mtk13">())</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Return&nbsp;the&nbsp;resulting&nbsp;array.</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;4x`length`&nbsp;matrix&nbsp;of&nbsp;values.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;a&nbsp;new&nbsp;column&nbsp;containing&nbsp;OHLC&nbsp;values&nbsp;to&nbsp;the&nbsp;</span><span class="mtk9">matrix.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//&nbsp;Remove&nbsp;the&nbsp;first&nbsp;column.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">remove_col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;containing&nbsp;averages&nbsp;of&nbsp;`open`,&nbsp;`high`,&nbsp;`</span><span class="mtk9">low`,&nbsp;and&nbsp;`close`&nbsp;over&nbsp;`length`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">averages</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">rowWiseAvg</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">averages</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;Open"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">averages</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;High"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">averages</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;Low"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">averages</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;Close"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><code dir="auto">for...in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环还可以引用每行的索引值。例如，在每次循环迭代中</font></font><code dir="auto">for [i, row] in m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个包含
行索引和</font><font style="vertical-align: inherit;">来自矩阵的</font></font><code dir="auto">i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相应数组的元组</font><font style="vertical-align: inherit;">
。</font></font><code dir="auto">row</code><font style="vertical-align: inherit;"></font><code dir="auto">m</code><font style="vertical-align: inherit;"></font></li>
</ul>
<h2 id="copying-a-matrix" class="md-heading"><a href="#copying-a-matrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="shallow-copies" class="md-heading"><a href="#shallow-copies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浅</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拷贝</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine 脚本可以通过
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.copy()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制矩阵。此函数返回矩阵的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浅表副本</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，不会影响原始矩阵或其引用的形状。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本将一个新矩阵分配给变量</font></font><code dir="auto">myMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并添加两列。它</font><font style="vertical-align: inherit;">
使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy"><font style="vertical-align: inherit;">myMatrix.copy()</font></a></font><code dir="auto">myCopy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法创建一个新矩阵</font><font style="vertical-align: inherit;">
，然后添加一个新行。它通过用户定义</font><font style="vertical-align: inherit;">函数在标签中显示两个矩阵的行：</font></font><code dir="auto">myMatrix</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">debugLabel()</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Copying-a-matrix-Shallow-copies-1.Bwmv7fvt_Z2gUKoY.webp" alt="图像" width="774" height="328" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1ju"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Shallow&nbsp;copy&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x2&nbsp;`float`&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3.0</span><span class="mtk13">))</span></span><br><span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4.0</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;`myMatrix`.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">myCopy</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">copy</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;a&nbsp;row&nbsp;to&nbsp;the&nbsp;last&nbsp;index&nbsp;of&nbsp;`myCopy`.</span></span><br><span><span class="mtk33">myCopy</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk33">myCopy</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">5.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6.0</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;rows&nbsp;of&nbsp;both&nbsp;matrices&nbsp;in&nbsp;separate&nbsp;l</span><span class="mtk9">abels.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Original"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">myCopy</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Shallow&nbsp;Copy"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要注意的是，矩阵浅拷贝中的元素指向与原始矩阵相同的值。当矩阵包含特殊类型（</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_line"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linefill</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_box"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">box</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyline</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">label</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_table"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chart.point</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或
</font></font><a href="/pine-script-docs/language/type-system#user-defined-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，浅拷贝的元素引用与原始矩阵相同的对象。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本声明一个变量，</font><font style="vertical-align: inherit;">其初始值为</font></font><code dir="auto">myMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a 。然后，它</font><font style="vertical-align: inherit;">通过
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy"><font style="vertical-align: inherit;">myMatrix.copy()</font></a><font style="vertical-align: inherit;">复制到一个变量，</font><font style="vertical-align: inherit;">
并绘制标签数量。如下所示，
</font><font style="vertical-align: inherit;">
图表上只有一个</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;">标签</font></a><font style="vertical-align: inherit;">，因为 中的元素引用与 中的元素相同的对象</font><font style="vertical-align: inherit;">。因此，对 中元素值的更改会</font><font style="vertical-align: inherit;">影响两个矩阵中的值：</font></font><code dir="auto">newLabel</code><font style="vertical-align: inherit;"></font><code dir="auto">myMatrix</code><font style="vertical-align: inherit;"></font><code dir="auto">myCopy</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_label"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">myCopy</code><font style="vertical-align: inherit;"></font><code dir="auto">myMatrix</code><font style="vertical-align: inherit;"></font><code dir="auto">myCopy</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Copying-a-matrix-Shallow-copies-2.CimkBVuC_XKEfb.webp" alt="图像" width="522" height="236" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="42t"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Shallow&nbsp;copy&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Initial&nbsp;value&nbsp;of&nbsp;the&nbsp;original&nbsp;matrix&nbsp;elements.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">newLabel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Original"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;1x1&nbsp;matrix&nbsp;containing&nbsp;a&nbsp;new&nbsp;`label`&nbsp;instance.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">newLabel</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;`myMatrix`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">myCopy</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">copy</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;first&nbsp;label&nbsp;from&nbsp;the&nbsp;`myCopy`&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">testLabel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myCopy</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Change&nbsp;the&nbsp;`text`,&nbsp;`style`,&nbsp;and&nbsp;`x`&nbsp;values&nbsp;of&nbsp;`</span><span class="mtk9">testLabel`.&nbsp;Also&nbsp;affects&nbsp;the&nbsp;`newLabel`.</span></span><br><span><span class="mtk33">testLabel</span><span class="mtk1">.</span><span class="mtk15">set_text</span><span class="mtk13">(</span><span class="mtk29">"Copy"</span><span class="mtk13">)</span></span><br><span><span class="mtk33">testLabel</span><span class="mtk1">.</span><span class="mtk15">set_style</span><span class="mtk13">(</span><span class="mtk11">label.style_label_up</span><span class="mtk13">)</span></span><br><span><span class="mtk33">testLabel</span><span class="mtk1">.</span><span class="mtk15">set_x</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;labels.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">label.all</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="deep-copies" class="md-heading"><a href="#deep-copies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">深层</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过明确复制矩阵引用的每个对象，可以生成矩阵的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">深度复制</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即，其元素指向原始值的副本的矩阵）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们在之前的脚本中添加了一个</font></font><code dir="auto">deepCopy()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义的方法。该方法创建一个新矩阵并使用
</font></font><a href="/pine-script-docs/language/matrices#for"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套的 for 循环</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将所有元素分配给原始元素的副本。当脚本调用此方法而不是内置的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">copy()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，我们会看到图表上现在有两个标签，并且对标签的任何更改</font></font><code dir="auto">myCopy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都不会影响标签</font></font><code dir="auto">myMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Copying-a-matrix-Deep-copies-1.DxEfU-j0_1Lkpmy.webp" alt="图像" width="624" height="248" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="48y"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Deep&nbsp;copy&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Returns&nbsp;a&nbsp;deep&nbsp;copy&nbsp;of&nbsp;a&nbsp;label&nbsp;matrix.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">deepCopy</span><span class="mtk13">(</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;deep&nbsp;copy&nbsp;of&nbsp;`this`&nbsp;matrix.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">that</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">copy</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">that</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">that</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;the&nbsp;element&nbsp;at&nbsp;each&nbsp;`row`&nbsp;and&nbsp;`column`&nbsp;o</span><span class="mtk9">f&nbsp;`that`&nbsp;matrix&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;retrieved&nbsp;label.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">that</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk33">row</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">column</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">that</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk33">row</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">column</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">copy</span><span class="mtk13">())</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">that</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Initial&nbsp;value&nbsp;of&nbsp;the&nbsp;original&nbsp;matrix.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">newLabel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Original"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;1x1&nbsp;matrix&nbsp;containing&nbsp;a&nbsp;new&nbsp;`label`&nbsp;instance.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">newLabel</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;deep&nbsp;copy&nbsp;of&nbsp;`myMatrix`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">label</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">myCopy</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">deepCopy</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;first&nbsp;label&nbsp;from&nbsp;the&nbsp;`myCopy`&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">label</span><span class="mtk1">&nbsp;</span><span class="mtk33">testLabel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myCopy</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Change&nbsp;the&nbsp;`text`,&nbsp;`style`,&nbsp;and&nbsp;`x`&nbsp;values&nbsp;of&nbsp;`</span><span class="mtk9">testLabel`.&nbsp;Does&nbsp;not&nbsp;affect&nbsp;the&nbsp;`newLabel`.</span></span><br><span><span class="mtk33">testLabel</span><span class="mtk1">.</span><span class="mtk15">set_text</span><span class="mtk13">(</span><span class="mtk29">"Copy"</span><span class="mtk13">)</span></span><br><span><span class="mtk33">testLabel</span><span class="mtk1">.</span><span class="mtk15">set_style</span><span class="mtk13">(</span><span class="mtk11">label.style_label_up</span><span class="mtk13">)</span></span><br><span><span class="mtk33">testLabel</span><span class="mtk1">.</span><span class="mtk15">set_x</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Change&nbsp;the&nbsp;`x`&nbsp;value&nbsp;of&nbsp;`newLabel`.</span></span><br><span><span class="mtk33">newLabel</span><span class="mtk1">.</span><span class="mtk15">set_x</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;labels.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">label.all</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="submatrices" class="md-heading"><a href="#submatrices"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子矩阵</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Pine 中，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子矩阵</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
</font><font style="vertical-align: inherit;">现有矩阵的</font></font><a href="/pine-script-docs/language/matrices#shallow-copies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浅表副本</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">from_row/column</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，仅包含和</font></font><code dir="auto">to_row/column</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参数指定的行和列。本质上，它是矩阵的切片副本。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，下面的脚本</font><font style="vertical-align: inherit;">
通过
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix"><font style="vertical-align: inherit;">m.submatrix()</font></a></font><code dir="auto">mSub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法从矩阵创建一个矩阵</font><font style="vertical-align: inherit;">
，然后调用我们的用户定义</font><font style="vertical-align: inherit;">函数在标签中显示两个矩阵的行：</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">debugLabel()</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Copying-a-matrix-Submatrices-1.BTbnoi2I_Z7HBh.webp" alt="图像" width="774" height="304" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="sw"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Submatrix&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x3&nbsp;matrix&nbsp;of&nbsp;values.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;columns&nbsp;to&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">9</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">8</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">7</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;rows&nbsp;of&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Original&nbsp;Matrix"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x2&nbsp;submatrix&nbsp;of&nbsp;`m`&nbsp;containing&nbsp;the&nbsp;first&nbsp;two&nbsp;r</span><span class="mtk9">ows&nbsp;and&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">mSub</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">submatrix</span><span class="mtk13">(</span><span class="mtk33">from_row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">to_row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">from_column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">to_column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;rows&nbsp;of&nbsp;`mSub`</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">mSub</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Submatrix"</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="scope-and-history" class="md-heading"><a href="#scope-and-history"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵变量在每个条形上留下历史轨迹，允许脚本使用历史引用运算符
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[]与先前分配给变量的过去矩阵实例进行交互。此外，脚本可以在</font></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/user-defined-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="/pine-script-docs/language/methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="/pine-script-docs/language/conditional-structures"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
范围内修改分配给全局变量的矩阵
</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本计算了实体和芯线距离相对于条形图范围的平均比率。它</font><font style="vertical-align: inherit;">在表格中
</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示数据以及之前条形图的值。用户定义</font><font style="vertical-align: inherit;">函数将当前和历史比率列添加到</font><font style="vertical-align: inherit;">，并且该</font><font style="vertical-align: inherit;">函数引用</font><font style="vertical-align: inherit;">使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D"><font style="vertical-align: inherit;">[]</font></a><font style="vertical-align: inherit;">运算符
分配给 的矩阵</font><font style="vertical-align: inherit;">
来计算平均值矩阵：</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font><code dir="auto">addData()</code><font style="vertical-align: inherit;"></font><code dir="auto">globalMatrix</code><font style="vertical-align: inherit;"></font><code dir="auto">calcAvg()</code><font style="vertical-align: inherit;"></font><code dir="auto">previous</code><font style="vertical-align: inherit;"></font><code dir="auto">globalMatrix</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Scope-and-history-1.iA9FQFRn_Z1tlC9r.webp" alt="图像" width="1282" height="650" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1s6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Scope&nbsp;and&nbsp;history&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bar&nbsp;ratio&nbsp;comparison"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;global&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalMatrix</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Calculates&nbsp;the&nbsp;ratio&nbsp;of&nbsp;body&nbsp;range&nbsp;to&nbsp;candle&nbsp;rang</span><span class="mtk9">e.</span></span><br><span><span class="mtk15">bodyRatio</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">math.abs</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Calculates&nbsp;the&nbsp;ratio&nbsp;of&nbsp;upper&nbsp;wick&nbsp;range&nbsp;to&nbsp;candl</span><span class="mtk9">e&nbsp;range.</span></span><br><span><span class="mtk15">upperWickRatio</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">))</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Calculates&nbsp;the&nbsp;ratio&nbsp;of&nbsp;lower&nbsp;wick&nbsp;range&nbsp;to&nbsp;candl</span><span class="mtk9">e&nbsp;range.</span></span><br><span><span class="mtk15">lowerWickRatio</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">(</span><span class="mtk16">math.min</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Adds&nbsp;data&nbsp;to&nbsp;the&nbsp;`globalMatrix`.</span></span><br><span><span class="mtk15">addData</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;a&nbsp;new&nbsp;column&nbsp;of&nbsp;data&nbsp;at&nbsp;`column`&nbsp;0.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">globalMatrix</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk33">bodyRatio</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">upperWickRatio</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowerWickRatio</span><span class="mtk13">()))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;column&nbsp;of&nbsp;`globalMatrix`&nbsp;from&nbsp;index&nbsp;0&nbsp;`length</span><span class="mtk9">`&nbsp;bars&nbsp;ago.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastValues</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalMatrix</span><span class="mtk1">.</span><span class="mtk15">col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)[</span><span class="mtk33">length</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;`pastValues`&nbsp;to&nbsp;the&nbsp;`globalMatrix`,&nbsp;or&nbsp;an&nbsp;a</span><span class="mtk9">rray&nbsp;of&nbsp;`na`&nbsp;if&nbsp;`pastValues`&nbsp;is&nbsp;`na`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">pastValues</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">globalMatrix</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">3</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">globalMatrix</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastValues</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Returns&nbsp;the&nbsp;`length`-bar&nbsp;average&nbsp;of&nbsp;matrices&nbsp;assi</span><span class="mtk9">gned&nbsp;to&nbsp;`globalMatrix`&nbsp;on&nbsp;historical&nbsp;bars.</span></span><br><span><span class="mtk15">calcAvg</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;sum&nbsp;historical&nbsp;`globalMatrix`&nbsp;matrices.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">sums</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk33">globalMatrix</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalMatrix</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`globalMatrix`&nbsp;matrix&nbsp;`i`&nbsp;bars&nbsp;before&nbsp;the&nbsp;cur</span><span class="mtk9">rent&nbsp;bar.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">previous</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalMatrix</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Break&nbsp;the&nbsp;loop&nbsp;if&nbsp;`previous`&nbsp;is&nbsp;`na`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">previous</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">sums</span><span class="mtk1">.</span><span class="mtk15">fill</span><span class="mtk13">(</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">break</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;the&nbsp;sum&nbsp;of&nbsp;`sums`&nbsp;and&nbsp;`previous`&nbsp;to&nbsp;`sum</span><span class="mtk9">s`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">sums</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.sum</span><span class="mtk13">(</span><span class="mtk33">sums</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">previous</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Divide&nbsp;the&nbsp;`sums`&nbsp;matrix&nbsp;by&nbsp;the&nbsp;`length`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">sums</span><span class="mtk1">.</span><span class="mtk15">mult</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;data&nbsp;to&nbsp;the&nbsp;`globalMatrix`.</span></span><br><span><span class="mtk15">addData</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;historical&nbsp;average&nbsp;of&nbsp;the&nbsp;`globalMatrix`&nbsp;matr</span><span class="mtk9">ices.</span></span><br><span><span class="mtk33">globalAvg</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">calcAvg</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`table`&nbsp;displaying&nbsp;information&nbsp;from&nbsp;the&nbsp;`global</span><span class="mtk9">Matrix`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoTable</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">position.middle_center</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalMatrix</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalMatrix</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.navy</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Define&nbsp;value&nbsp;cells.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalAvg</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">j</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">value</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">value</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.333</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">infoTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk33">j</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">value</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Define&nbsp;header&nbsp;cells.</span></span><br><span><span class="mtk33">infoTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Body&nbsp;ratio"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br><span><span class="mtk33">infoTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Upper&nbsp;wick&nbsp;ratio"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br><span><span class="mtk33">infoTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lower&nbsp;wick&nbsp;ratio"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br><span><span class="mtk33">infoTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Current&nbsp;average"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br><span><span class="mtk33">infoTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"{0}&nbsp;bars&nbsp;ago"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"></font><code dir="auto">addData()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">函数</font></font><code dir="auto">calcAvg()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有参数，因为它们直接与</font><font style="vertical-align: inherit;">
外部作用域中声明的</font></font><code dir="auto">globalMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和变量交互。</font></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font></li>
<li><code dir="auto">calcAvg()</code><font style="vertical-align: inherit;"><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum"><font style="vertical-align: inherit;">通过使用matrix.sum()</font></a></font><code dir="auto">previous</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加矩阵
</font><font style="vertical-align: inherit;">
并</font><font style="vertical-align: inherit;">使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult"><font style="vertical-align: inherit;">matrix.mult()</font></a><font style="vertical-align: inherit;">将所有元素相乘来计算平均值</font><font style="vertical-align: inherit;">。我们将在
下面的</font><a href="/pine-script-docs/language/matrices#matrix-calculations"><font style="vertical-align: inherit;">矩阵计算</font></a><font style="vertical-align: inherit;">部分讨论这些和其他专门的函数。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">1 / length</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/matrices#matrix-calculations"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h2 id="inspecting-a-matrix" class="md-heading"><a href="#inspecting-a-matrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查矩阵形状及其元素内的模式的能力至关重要，因为它有助于揭示有关矩阵及其与各种计算和转换的兼容性的重要信息。Pine Script™ 包含几个用于矩阵检查的内置函数，包括
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_square()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_identity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_identity()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_diagonal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_diagonal()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_antidiagonal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_antidiagonal()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_symmetric"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_symmetric()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_antisymmetric"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_antisymmetric()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_triangular"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_triangular()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_stochastic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_stochastic()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_binary"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_binary()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_zero"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.is_zero()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示这些功能，此示例包含一个自定义
</font></font><code dir="auto">inspect()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，该方法使用带有函数的条件块</font></font><code dir="auto">matrix.is_*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来返回有关矩阵的信息。它</font><font style="vertical-align: inherit;">在图表上的标签中显示</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵的字符串表示形式和返回的描述
：</font></font><code dir="auto">m.inspect()</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Inspecting-a-matrix-1.CnldBvch_25YXn4.webp" alt="图像" width="1196" height="424" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="55u"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Matrix&nbsp;inspection&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Inspects&nbsp;a&nbsp;matrix&nbsp;using&nbsp;`matrix.is_*()`&nbsp;functions</span><span class="mtk9">&nbsp;and&nbsp;returns&nbsp;a&nbsp;`string`&nbsp;describing&nbsp;some&nbsp;of&nbsp;its&nbsp;fea</span><span class="mtk9">tures.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">inspect</span><span class="mtk13">(</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk13">)</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;string&nbsp;describing&nbsp;`this`&nbsp;matrix.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"This&nbsp;matrix:\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">is_square</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"-&nbsp;Has&nbsp;an&nbsp;equal&nbsp;number&nbsp;of&nbsp;rows&nbsp;and&nbsp;columns.\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">is_binary</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"-&nbsp;Contains&nbsp;only&nbsp;1s&nbsp;and&nbsp;0s.\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">is_zero</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"-&nbsp;Is&nbsp;filled&nbsp;with&nbsp;0s.\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">is_triangular</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"-&nbsp;Contains&nbsp;only&nbsp;0s&nbsp;above&nbsp;and/or&nbsp;below&nbsp;its&nbsp;main&nbsp;di</span><span class="mtk29">agonal.\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">is_diagonal</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"-&nbsp;Only&nbsp;has&nbsp;nonzero&nbsp;values&nbsp;in&nbsp;its&nbsp;main&nbsp;diagonal.\n</span><span class="mtk29">"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">is_antidiagonal</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"-&nbsp;Only&nbsp;has&nbsp;nonzero&nbsp;values&nbsp;in&nbsp;its&nbsp;main&nbsp;antidiagona</span><span class="mtk29">l.\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">is_symmetric</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"-&nbsp;Equals&nbsp;its&nbsp;transpose.\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">is_antisymmetric</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"-&nbsp;Equals&nbsp;the&nbsp;negative&nbsp;of&nbsp;its&nbsp;transpose.\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">is_identity</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"-&nbsp;Is&nbsp;the&nbsp;identity&nbsp;matrix.\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;4x4&nbsp;identity&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;rows&nbsp;to&nbsp;the&nbsp;matrix.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;`m`&nbsp;matrix&nbsp;in&nbsp;a&nbsp;blue&nbsp;label.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_right</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;result&nbsp;of&nbsp;`m.inspect()`&nbsp;in&nbsp;a&nbsp;purple</span><span class="mtk9">&nbsp;label.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">inspect</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_left</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="manipulating-a-matrix" class="md-heading"><a href="#manipulating-a-matrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="reshaping" class="md-heading"><a href="#reshaping"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重塑</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵的形状可以决定其与各种矩阵运算的兼容性。在某些情况下，需要在不影响元素数量或它们引用的值的情况下更改矩阵的维度，这也称为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重塑</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。要在 Pine 中重塑矩阵，请使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reshape"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.reshape()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例演示了对矩阵进行多次重塑操作的结果。初始</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵的形状为 1x8（一行八列）。通过连续调用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reshape"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.reshape()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法，脚本将形状更改</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 2x4、4x2 和 8x1。它使用自定义方法在图表上的标签中显示每个重塑矩阵
</font></font><code dir="auto">debugLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Manipulating-a-matrix-Reshaping-1.DYGzopbC_Z2j7E98.webp" alt="图像" width="1206" height="430" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5q6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Reshaping&nbsp;example"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;matrix&nbsp;containing&nbsp;the&nbsp;values&nbsp;1-8.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;the&nbsp;initial&nbsp;vector&nbsp;of&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">7</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Initial&nbsp;1x8&nbsp;matrix"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Reshape.&nbsp;`m`&nbsp;now&nbsp;has&nbsp;2&nbsp;rows&nbsp;and&nbsp;4&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">reshape</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Reshaped&nbsp;to&nbsp;2x4"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Reshape.&nbsp;`m`&nbsp;now&nbsp;has&nbsp;4&nbsp;rows&nbsp;and&nbsp;2&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">reshape</span><span class="mtk13">(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Reshaped&nbsp;to&nbsp;4x2"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Reshape.&nbsp;`m`&nbsp;now&nbsp;has&nbsp;8&nbsp;rows&nbsp;and&nbsp;1&nbsp;column.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">reshape</span><span class="mtk13">(</span><span class="mtk12">8</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">30</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Reshaped&nbsp;to&nbsp;8x1"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次调用时，元素的顺序</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会改变
</font></font><code dir="auto">m.reshape()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"></font><code dir="auto">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重塑矩阵时，和参数</font><font style="vertical-align: inherit;">的乘积</font></font><code dir="auto">columns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必须等于
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.elements_count"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.elements_count()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值，因为
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reshape"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.reshape()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不能改变矩阵中元素的数量。</font></font></li>
</ul>
<h3 id="reversing" class="md-heading"><a href="#reversing"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆转</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reverse"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用matrix.reverse()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反转矩阵中所有元素的顺序
。此函数将</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 i 行和第 j 列的 m </font><font style="vertical-align: inherit;">×n 矩阵的引用移动到 m - 1 - i 行和 n - 1 - j 列。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本创建一个 3x3 矩阵，其中包含按升序排列的值 1-9，然后使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reverse"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reverse()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法反转其内容。它通过以下方式在图表上的标签中显示矩阵的原始版本和修改版本</font></font><code dir="auto">m.debugLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Manipulating-a-matrix-Reversing-1.Cgfm4aYH_1ccxk3.webp" alt="图像" width="634" height="242" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4g"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Reversing&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x3&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;rows&nbsp;to&nbsp;`m`.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">7</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;contents&nbsp;of&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Original"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Reverse&nbsp;`m`,&nbsp;then&nbsp;display&nbsp;its&nbsp;contents.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">reverse</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Reversed"</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="transposing" class="md-heading"><a href="#transposing"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移调</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转置矩阵是一种基本操作，它将矩阵中的所有行和列沿其</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主对角线</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（行索引等于列索引的所有值的对角线向量）翻转。此过程会生成一个行和列维度反转的新矩阵，称为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转置。脚本可以使用</font></font></em><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.transpose()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算矩阵的转置
</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于任何 m 行、n 列的矩阵， matrix.transpose()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回的矩阵
</font><font style="vertical-align: inherit;">
将有 n 行和 m 列。矩阵中第 i 行和第 j 列的所有元素都对应于其转置中第 j 行和第 i 列的元素。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例声明一个 2x4</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵，使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.transpose()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法计算其转置，并使用我们的自定义方法在图表上显示两个矩阵
</font></font><code dir="auto">debugLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如下所示，转置矩阵具有 4x2 形状，转置的行与原始矩阵的列匹配：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Manipulating-a-matrix-Transposing-1.DLTkeyZ__ZDefeU.webp" alt="图像" width="744" height="294" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4ef"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Element-wise&nbsp;calculations&nbsp;example"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Developing&nbsp;values"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;data&nbsp;points&nbsp;in&nbsp;the&nbsp;averages.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;timeframe&nbsp;of&nbsp;each&nbsp;reset&nbsp;period.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeframe</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.timeframe</span><span class="mtk13">(</span><span class="mtk29">"D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Reset&nbsp;Timeframe"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;4x`length`&nbsp;matrix&nbsp;of&nbsp;OHLC&nbsp;values.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;a&nbsp;new&nbsp;bar&nbsp;at&nbsp;the&nbsp;`timef</span><span class="mtk9">rame`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">queueColumn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">timeframe.change</span><span class="mtk13">(</span><span class="mtk33">timeframe</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">queueColumn</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;new&nbsp;values&nbsp;to&nbsp;the&nbsp;end&nbsp;column&nbsp;of&nbsp;`ohlcData`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Remove&nbsp;the&nbsp;oldest&nbsp;column&nbsp;from&nbsp;`ohlcData`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">remove_col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Adjust&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;column&nbsp;1&nbsp;for&nbsp;new&nbsp;hig</span><span class="mtk9">hs.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Adjust&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;column&nbsp;2&nbsp;for&nbsp;new&nbsp;low</span><span class="mtk9">s.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Adjust&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;column&nbsp;3&nbsp;for&nbsp;the&nbsp;new</span><span class="mtk9">&nbsp;closing&nbsp;price.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`matrix.avg()`&nbsp;of&nbsp;all&nbsp;elements&nbsp;in&nbsp;`ohlcData`.</span></span><br><span><span class="mtk33">avgOHLC4</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">avg</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`matrix.avg()`&nbsp;of&nbsp;all&nbsp;elements&nbsp;in&nbsp;rows&nbsp;1&nbsp;and&nbsp;</span><span class="mtk9">2,&nbsp;i.e.,&nbsp;the&nbsp;average&nbsp;of&nbsp;all&nbsp;`high`&nbsp;and&nbsp;`low`&nbsp;value</span><span class="mtk9">s.</span></span><br><span><span class="mtk33">avgHL2</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">submatrix</span><span class="mtk13">(</span><span class="mtk33">from_row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">to_row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">avg</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`matrix.max()`&nbsp;of&nbsp;all&nbsp;values&nbsp;in&nbsp;`ohlcData`.&nbsp;E</span><span class="mtk9">quivalent&nbsp;to&nbsp;`ohlcData.row(1).max()`.</span></span><br><span><span class="mtk33">maxHigh</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">max</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`array.min()`&nbsp;of&nbsp;all&nbsp;`low`&nbsp;values&nbsp;in&nbsp;`ohlcDat</span><span class="mtk9">a`.&nbsp;Equivalent&nbsp;to&nbsp;`ohlcData.min()`.</span></span><br><span><span class="mtk33">minLow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">min</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`array.avg()`&nbsp;of&nbsp;the&nbsp;last&nbsp;column&nbsp;in&nbsp;`ohlcData</span><span class="mtk9">`,&nbsp;i.e.,&nbsp;the&nbsp;current&nbsp;OHLC4.</span></span><br><span><span class="mtk33">ohlc4Value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">col</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">avg</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">avgOHLC4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;OHLC4"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">avgHL2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;HL2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.navy</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maxHigh</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Max&nbsp;High"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">minLow</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Min&nbsp;Low"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ohlc4Value</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Current&nbsp;OHLC4"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="sorting" class="md-heading"><a href="#sorting"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sort"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以通过matrix.sort()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对矩阵的内容进行排序
。与</font><font style="vertical-align: inherit;">对</font><em><font style="vertical-align: inherit;">元素进行排序的</font></em></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.sort"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array.sort()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同
</font><font style="vertical-align: inherit;">，此函数</font><font style="vertical-align: inherit;">
根据指定的值按指定的顺序</font><font style="vertical-align: inherit;">
（默认为</font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_order.ascending"><font style="vertical-align: inherit;">order.ascending</font></a><font style="vertical-align: inherit;"> ）组织矩阵中的所有</font><em><font style="vertical-align: inherit;">行</font></em><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code dir="auto">order</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_order.ascending"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">column</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本声明一个 3x3矩阵，</font><font style="vertical-align: inherit;">根据第一列按升序对副本
</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的行进行排序，然后</font><font style="vertical-align: inherit;">根据第二列按降序对副本的行进行排序。它使用我们的</font><font style="vertical-align: inherit;">
方法在标签中显示原始矩阵和排序后的副本：</font></font><code dir="auto">m1</code><font style="vertical-align: inherit;"></font><code dir="auto">m2</code><font style="vertical-align: inherit;"></font><code dir="auto">debugLabel()</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Manipulating-a-matrix-Sorting-1.7v_kYwQL_ZOu1j2.webp" alt="图像" width="892" height="320" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5h"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Sorting&nbsp;rows&nbsp;example"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x3&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;rows&nbsp;to&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">7</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Original"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Copy&nbsp;`m`&nbsp;and&nbsp;sort&nbsp;rows&nbsp;in&nbsp;ascending&nbsp;order&nbsp;based</span><span class="mtk9">&nbsp;on&nbsp;the&nbsp;first&nbsp;column&nbsp;(default).</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">copy</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">sort</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Sorted&nbsp;using&nbsp;col&nbsp;0\n(Ascending)"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Copy&nbsp;`m`&nbsp;and&nbsp;sort&nbsp;rows&nbsp;in&nbsp;descending&nbsp;order&nbsp;base</span><span class="mtk9">d&nbsp;on&nbsp;the&nbsp;second&nbsp;column.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">copy</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m2</span><span class="mtk1">.</span><span class="mtk15">sort</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">order.descending</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m2</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Sorted&nbsp;using&nbsp;col&nbsp;1\n(Descending)"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要注意的是，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sort"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.sort()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不会对矩阵的列进行排序。但是，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用此函数在</font></font></em><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.transpose()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的帮助下对矩阵列进行排序
</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本包含一个</font></font><code dir="auto">sortColumns()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，该方法使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sort"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sort()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法
根据</font><font style="vertical-align: inherit;">原始矩阵对应的列对矩阵的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
进行排序
。该脚本使用此方法</font><font style="vertical-align: inherit;">根据矩阵第一行的内容对矩阵进行排序：</font></font><code dir="auto">row</code><font style="vertical-align: inherit;"></font><code dir="auto">m</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Manipulating-a-matrix-Sorting-2.BaU7IEP__2g88Bo.webp" alt="图像" width="826" height="316" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="67i"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Sorting&nbsp;columns&nbsp;example"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Sorts&nbsp;the&nbsp;columns&nbsp;of&nbsp;`this`&nbsp;matrix&nbsp;based&nbsp;on&nbsp;the&nbsp;v</span><span class="mtk9">alues&nbsp;in&nbsp;the&nbsp;specified&nbsp;`row`.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">sortColumns</span><span class="mtk13">(</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">ascending</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;transpose&nbsp;of&nbsp;`this`&nbsp;matrix.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">thisT</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">transpose</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`order.ascending`&nbsp;when&nbsp;`ascending`&nbsp;is&nbsp;`true`,&nbsp;</span><span class="mtk9">`order.descending`&nbsp;otherwise.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">order</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ascending</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">order.ascending</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">order.descending</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Sort&nbsp;the&nbsp;rows&nbsp;of&nbsp;`thisT`&nbsp;using&nbsp;the&nbsp;`row`&nbsp;column</span><span class="mtk9">.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">thisT</span><span class="mtk1">.</span><span class="mtk15">sort</span><span class="mtk13">(</span><span class="mtk33">row</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">order</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;copy&nbsp;of&nbsp;`this`&nbsp;matrix&nbsp;with&nbsp;sorted&nbsp;columns.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">thisT</span><span class="mtk1">.</span><span class="mtk15">transpose</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x3&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;rows&nbsp;to&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">7</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Original"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Sort&nbsp;the&nbsp;columns&nbsp;of&nbsp;`m`&nbsp;based&nbsp;on&nbsp;the&nbsp;first&nbsp;row&nbsp;</span><span class="mtk9">and&nbsp;display&nbsp;the&nbsp;result.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">sortColumns</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Sorted&nbsp;using&nbsp;row&nbsp;0\n(Ascending)"</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="concatenating" class="md-heading"><a href="#concatenating"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以使用</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.concat"><font style="vertical-align: inherit;">matrix.concat()</font></a></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个矩阵
</font><font style="vertical-align: inherit;">。此函数将矩阵的行附加到</font><font style="vertical-align: inherit;">
具有相同列数的矩阵</font><font style="vertical-align: inherit;">的末尾。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.concat"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">id2</code><font style="vertical-align: inherit;"></font><code dir="auto">id1</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建一个矩阵，其中元素表示一个矩阵的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加到另一个矩阵，
</font></font><a href="/pine-script-docs/language/matrices#transposing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请转置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个矩阵，
</font><font style="vertical-align: inherit;">
对转置矩阵
使用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.concat"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.concat()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ，然后对
结果使用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transpose() 。</font></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本将</font></font><code dir="auto">m2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵的行附加到</font></font><code dir="auto">m1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
矩阵，并使用</font><font style="vertical-align: inherit;">矩阵的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转置副本</font></font></em><font style="vertical-align: inherit;"></font><code dir="auto">m1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加其列。它使用自定义方法在标签中连接它们的行和列后显示和</font></font><code dir="auto">m2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵以及结果
</font></font><code dir="auto">debugLabel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Manipulating-a-matrix-Concatenating-1.Dk8fPc4l_1FGbFm.webp" alt="图像" width="1222" height="366" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6x3"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Concatenation&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x3&nbsp;matrix&nbsp;filled&nbsp;with&nbsp;1s.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x3&nbsp;matrix&nbsp;filled&nbsp;with&nbsp;2s.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;transpose&nbsp;of&nbsp;`m1`.</span></span><br><span><span class="mtk33">t1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">transpose</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;transpose&nbsp;of&nbsp;`m2`.</span></span><br><span><span class="mtk33">t2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m2</span><span class="mtk1">.</span><span class="mtk15">transpose</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;original&nbsp;matrices.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Matrix&nbsp;1"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m2</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Matrix&nbsp;2"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Append&nbsp;the&nbsp;rows&nbsp;of&nbsp;`m2`&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;`m1`&nbsp;and&nbsp;</span><span class="mtk9">display&nbsp;`m1`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">concat</span><span class="mtk13">(</span><span class="mtk33">m2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Appended&nbsp;rows"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Append&nbsp;the&nbsp;rows&nbsp;of&nbsp;`t2`&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;`t1`,&nbsp;the</span><span class="mtk9">n&nbsp;display&nbsp;the&nbsp;transpose&nbsp;of&nbsp;`t1.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t1</span><span class="mtk1">.</span><span class="mtk15">concat</span><span class="mtk13">(</span><span class="mtk33">t2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t1</span><span class="mtk1">.</span><span class="mtk15">transpose</span><span class="mtk13">()</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">30</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Appended&nbsp;columns"</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="matrix-calculations" class="md-heading"><a href="#matrix-calculations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="element-wise-calculations" class="md-heading"><a href="#element-wise-calculations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素级</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine 脚本可以通过</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.avg"><font style="vertical-align: inherit;">matrix.avg()</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.min"><font style="vertical-align: inherit;">matrix.min()</font></a><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.max"><font style="vertical-align: inherit;">matrix.max()</font></a><font style="vertical-align: inherit;">和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mode"><font style="vertical-align: inherit;">matrix.mode()</font></a><font style="vertical-align: inherit;">计算矩阵中所有元素的
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平均值</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小值</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大值</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">众数</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些函数的操作与其等效函数相同，允许用户使用相同的语法对矩阵、其</font><a href="/pine-script-docs/language/matrices#submatrices"><font style="vertical-align: inherit;">子矩阵</font></a><font style="vertical-align: inherit;">及其
</font><a href="/pine-script-docs/language/matrices#rows-and-columns"><font style="vertical-align: inherit;">行和列</font></a><font style="vertical-align: inherit;">运行元素级计算
。例如，</font><font style="vertical-align: inherit;">
对具有值 1-9 的 3x3 矩阵和
具有相同九个元素的</font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;">数组</font></a><font style="vertical-align: inherit;">调用的内置函数</font><font style="vertical-align: inherit;">
都将返回值 5。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.avg"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.min"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.max"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mode"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">array.*</code><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/matrices#submatrices"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/matrices#rows-and-columns"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">*.avg()</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的脚本使用</font></font><code dir="auto">*.avg()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">*.max()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">*.min()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法计算某个时期内 OHLC 数据的发展平均值和极值。
</font><font style="vertical-align: inherit;">每当</font><font style="vertical-align: inherit;">时
，它会</font><font style="vertical-align: inherit;">
在矩阵末尾添加一个包含</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_open"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开盘价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_low"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低价</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收盘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价的新列。当 时</font><font style="vertical-align: inherit;">，脚本使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get"><font style="vertical-align: inherit;">get()</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set"><font style="vertical-align: inherit;">set()</font></a><font style="vertical-align: inherit;">
矩阵方法调整最后一列中的元素，以在当前时期内发展 HLC 值。它使用矩阵</font><font style="vertical-align: inherit;">、
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix"><font style="vertical-align: inherit;">submatrix()</font></a><font style="vertical-align: inherit;">以及
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row"><font style="vertical-align: inherit;">row()</font></a><font style="vertical-align: inherit;">
和
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col"><font style="vertical-align: inherit;">col()</font></a><font style="vertical-align: inherit;">
数组来计算各个时期内发展中的 OHLC4 和 HL2 平均值</font><font style="vertical-align: inherit;">
、各个时期内的最高价和最低价</font><font style="vertical-align: inherit;">以及当前时期发展中的 OHLC4 价格：</font></font><code dir="auto">ohlcData</code><font style="vertical-align: inherit;"></font><code dir="auto">queueColumn</code><font style="vertical-align: inherit;"></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><code dir="auto">false</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">ohlcData</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font><code dir="auto">length</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Matrix-calculations-Element-wise-calculations-1.qqvZC3jo_uJ39n.webp" alt="图像" width="1338" height="678" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4ef"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Element-wise&nbsp;calculations&nbsp;example"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Developing&nbsp;values"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;data&nbsp;points&nbsp;in&nbsp;the&nbsp;averages.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;timeframe&nbsp;of&nbsp;each&nbsp;reset&nbsp;period.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeframe</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.timeframe</span><span class="mtk13">(</span><span class="mtk29">"D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Reset&nbsp;Timeframe"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;4x`length`&nbsp;matrix&nbsp;of&nbsp;OHLC&nbsp;values.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;a&nbsp;new&nbsp;bar&nbsp;at&nbsp;the&nbsp;`timef</span><span class="mtk9">rame`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">queueColumn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">timeframe.change</span><span class="mtk13">(</span><span class="mtk33">timeframe</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">queueColumn</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;new&nbsp;values&nbsp;to&nbsp;the&nbsp;end&nbsp;column&nbsp;of&nbsp;`ohlcData`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Remove&nbsp;the&nbsp;oldest&nbsp;column&nbsp;from&nbsp;`ohlcData`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">remove_col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Adjust&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;column&nbsp;1&nbsp;for&nbsp;new&nbsp;hig</span><span class="mtk9">hs.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Adjust&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;column&nbsp;2&nbsp;for&nbsp;new&nbsp;low</span><span class="mtk9">s.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Adjust&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;column&nbsp;3&nbsp;for&nbsp;the&nbsp;new</span><span class="mtk9">&nbsp;closing&nbsp;price.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`matrix.avg()`&nbsp;of&nbsp;all&nbsp;elements&nbsp;in&nbsp;`ohlcData`.</span></span><br><span><span class="mtk33">avgOHLC4</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">avg</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`matrix.avg()`&nbsp;of&nbsp;all&nbsp;elements&nbsp;in&nbsp;rows&nbsp;1&nbsp;and&nbsp;</span><span class="mtk9">2,&nbsp;i.e.,&nbsp;the&nbsp;average&nbsp;of&nbsp;all&nbsp;`high`&nbsp;and&nbsp;`low`&nbsp;value</span><span class="mtk9">s.</span></span><br><span><span class="mtk33">avgHL2</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">submatrix</span><span class="mtk13">(</span><span class="mtk33">from_row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">to_row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">avg</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`matrix.max()`&nbsp;of&nbsp;all&nbsp;values&nbsp;in&nbsp;`ohlcData`.&nbsp;E</span><span class="mtk9">quivalent&nbsp;to&nbsp;`ohlcData.row(1).max()`.</span></span><br><span><span class="mtk33">maxHigh</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">max</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`array.min()`&nbsp;of&nbsp;all&nbsp;`low`&nbsp;values&nbsp;in&nbsp;`ohlcDat</span><span class="mtk9">a`.&nbsp;Equivalent&nbsp;to&nbsp;`ohlcData.min()`.</span></span><br><span><span class="mtk33">minLow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">min</span><span class="mtk13">()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`array.avg()`&nbsp;of&nbsp;the&nbsp;last&nbsp;column&nbsp;in&nbsp;`ohlcData</span><span class="mtk9">`,&nbsp;i.e.,&nbsp;the&nbsp;current&nbsp;OHLC4.</span></span><br><span><span class="mtk33">ohlc4Value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ohlcData</span><span class="mtk1">.</span><span class="mtk15">col</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">avg</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">avgOHLC4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;OHLC4"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">avgHL2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;HL2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.navy</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maxHigh</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Max&nbsp;High"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">minLow</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Min&nbsp;Low"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ohlc4Value</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Current&nbsp;OHLC4"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个例子中，我们交替使用了
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array.*()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.*()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法来展示它们在语法和行为上的相似性。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用户可以通过将
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.avg"><font style="vertical-align: inherit;">matrix.avg()</font></a><font style="vertical-align: inherit;">乘以
matrix.elements_count
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.elements_count"><font style="vertical-align: inherit;">()来计算</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.sum"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array.sum()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的矩阵等效值
</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.avg"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.elements_count"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="special-calculations" class="md-heading"><a href="#special-calculations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特殊</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 具有多个内置函数，用于执行基本矩阵算术和线性代数运算，包括
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.sum()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.diff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.diff()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.mult()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.pow()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.det()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.inv()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.pinv()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rank"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.rank()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.trace"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.trace()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.eigenvalues"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.eigenvalues()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.eigenvectors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.eigenvectors()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.kron"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.kron()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些函数是高级功能，可促进各种矩阵计算和转换。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面，我们通过一些基本示例解释一些基本功能。</font></font></p>
<h4 id="matrixsum-and-matrixdiff" class="md-heading"><a href="#matrixsum-and-matrixdiff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.sum()` 和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.diff()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以使用matrix.sum()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.diff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.diff()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数对两个具有相同形状的矩阵或一个矩阵和一个标量值执行加法和减法
</font><font style="vertical-align: inherit;">
。这些函数使用矩阵或标量中的值</font></font><code dir="auto">id2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对 中的元素进行加法或减法</font></font><code dir="auto">id1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本演示了 Pine 中矩阵加法和减法的一个简单示例。它创建一个 3x3 矩阵，计算其
</font></font><a href="/pine-script-docs/language/matrices#transposing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后计算
两个矩阵的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.sum()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.diff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.diff()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
。此示例在图表上的标签中显示原始矩阵、其
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及由此产生的总和和差矩阵：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Matrix-calculations-Special-calculations-1.CqDsJl37_RrqVF.webp" alt="图像" width="1056" height="332" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5ya"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Matrix&nbsp;sum&nbsp;and&nbsp;diff&nbsp;example"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x3&nbsp;matrix.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;rows&nbsp;to&nbsp;`m`.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">0.5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.5</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3.0</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">3.5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4.5</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"A"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Get&nbsp;and&nbsp;display&nbsp;the&nbsp;transpose&nbsp;of&nbsp;`m`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">transpose</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Aᵀ"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;matrices.&nbsp;The&nbsp;resu</span><span class="mtk9">lting&nbsp;matrix&nbsp;is&nbsp;symmetric.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">matrix.sum</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"A&nbsp;+&nbsp;Aᵀ"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;difference&nbsp;between&nbsp;the&nbsp;two&nbsp;matric</span><span class="mtk9">es.&nbsp;The&nbsp;resulting&nbsp;matrix&nbsp;is&nbsp;antisymmetric.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">matrix.diff</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">30</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"A&nbsp;-&nbsp;Aᵀ"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个例子中，我们将原始矩阵标记为“A”，将转置矩阵标记为“A^T^”。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将“A”和“A^T^”相加会产生一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_symmetric"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对称</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
矩阵，而将“A”和“A^T^”相减则会形成一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_antisymmetric"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反对称</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
矩阵。</font></font></li>
</ul>
<h4 id="matrixmult" class="md-heading"><a href="#matrixmult"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.mult()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以通过
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.mult()函数将两个矩阵相乘。此函数还可以将矩阵与</font></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或标量值</font><font style="vertical-align: inherit;">
相乘
。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在将两个矩阵相乘的情况下，与加法和减法不同，矩阵乘法不要求两个矩阵具有相同的形状。但是，第一个矩阵的列数必须等于第二个矩阵的行数。由
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.mult()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回的结果矩阵
将包含与 相同的行数</font></font><code dir="auto">id1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和列数</font></font><code dir="auto">id2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。例如，2x3 矩阵乘以 3x4 矩阵将产生一个具有两行和四列的矩阵，如下所示。结果矩阵中的每个值都是</font><font style="vertical-align: inherit;">中对应行</font><font style="vertical-align: inherit;">和 中列的</font></font><a href="https://en.wikipedia.org/wiki/Dot_product" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">点积</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code dir="auto">id1</code><font style="vertical-align: inherit;"></font><code dir="auto">id2</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Matrix-calculations-Special-calculations-2.B9VMtj33_ZXAisD.webp" alt="图像" width="1010" height="338" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4fl"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Matrix&nbsp;mult&nbsp;example"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x3&nbsp;matrix.</span></span><br><span><span class="mtk33">a</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x4&nbsp;matrix.</span></span><br><span><span class="mtk33">b</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;rows&nbsp;to&nbsp;`a`.</span></span><br><span><span class="mtk33">a</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">))</span></span><br><span><span class="mtk33">a</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;rows&nbsp;to&nbsp;`b`.</span></span><br><span><span class="mtk33">b</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">0.5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk13">))</span></span><br><span><span class="mtk33">b</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">2.5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3.5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4.0</span><span class="mtk13">))</span></span><br><span><span class="mtk33">b</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">4.5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5.5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6.0</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;result&nbsp;of&nbsp;`a`&nbsp;*&nbsp;`b`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">ab</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">a</span><span class="mtk1">.</span><span class="mtk15">mult</span><span class="mtk13">(</span><span class="mtk33">b</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;`a`,&nbsp;`b`,&nbsp;and&nbsp;`ab`&nbsp;matrices.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">a</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"A"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">b</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"B"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span><span class="mtk33">ab</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"A&nbsp;*&nbsp;B"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与标量乘法相反，矩阵乘法是非</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交换的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即</font></font><code dir="auto">matrix.mult(a, b)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不一定产生与相同的结果
</font></font><code dir="auto">matrix.mult(b, a)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在我们的示例中，后者将引发运行时错误，因为中的列数</font></font><code dir="auto">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不等于中的行数</font></font><code dir="auto">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当将一个矩阵和一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相乘时，此函数将该操作视为与</font></font><code dir="auto">id1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单列矩阵相乘，但它返回一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，其元素数与 中的行数相同</font></font><code dir="auto">id1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。当
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.mult()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
传递标量作为其</font></font><code dir="auto">id2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值时，该函数返回一个新矩阵，其元素是 中的元素</font></font><code dir="auto">id1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乘以 的</font></font><code dir="auto">id2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font></font></p>
<h4 id="matrixdet" class="md-heading"><a href="#matrixdet"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.det()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行列式是与</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square"><font style="vertical-align: inherit;">方阵</font></a><font style="vertical-align: inherit;">相关的标量值
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用于描述方阵的一些特性，即可逆性。如果矩阵有逆
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv"><font style="vertical-align: inherit;">，</font></a><font style="vertical-align: inherit;">则其行列式不为零。否则，矩阵为</font><em><font style="vertical-align: inherit;">奇异矩阵（不可逆）。脚本可以通过</font></em><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det"><font style="vertical-align: inherit;">matrix.det()</font></a><font style="vertical-align: inherit;">
计算矩阵的行列式
</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序员可以使用行列式来检测矩阵之间的相似性、识别</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">满秩</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秩亏</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵、以及求解线性方程组等。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本利用行列式，使用
</font></font><a href="https://en.wikipedia.org/wiki/Cramer's_rule" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克莱姆规则</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">求解具有匹配数目的未知值的线性方程组。用户定义</font></font><code dir="auto">solve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数返回一个
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#type_array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，其中包含系统中每个未知值的解，其中数组的第 n 个元素是系数矩阵的行列式，第 n 列被常数列替换，再除以原始系数的行列式。</font></font></p>
<p><font style="vertical-align: inherit;"></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此脚本中，我们定义了保存这三个方程的系数和常数的</font><font style="vertical-align: inherit;">矩阵：</font></font></p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">3 * x0 + 4 * x1 - 1 * x2 = 8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">5 * x0 - 2 * x1 + 1 * x2 = 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">2 * x0 - 2 * x1 + 1 * x2 = 1</span></div></div></code></pre></figure></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该系统的解是</font></font><code dir="auto">(x0 = 1, x1 = 2, x2 = 3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。脚本通过以下方式计算这些值</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将</font></font><code dir="auto">m.solve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们绘制在图表上：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Matrix-calculations-Special-calculations-3.Bq84ZoEi_1X2sQR.webp" alt="图像" width="1336" height="344" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="461"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Determinants&nbsp;example"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Cramer's&nbsp;Rule"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Solves&nbsp;a&nbsp;system&nbsp;of&nbsp;linear&nbsp;equations&nbsp;with&nbsp;a&nbsp;matchi</span><span class="mtk9">ng&nbsp;number&nbsp;of&nbsp;unknowns&nbsp;using&nbsp;Cramer's&nbsp;rule.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;An&nbsp;augmented&nbsp;matrix&nbsp;containing&nbsp;the&nbsp;coeffi</span><span class="mtk9">cients&nbsp;for&nbsp;each&nbsp;unknown&nbsp;and&nbsp;the&nbsp;results&nbsp;of</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;equations.&nbsp;For&nbsp;example,&nbsp;a&nbsp;row&nbsp;cont</span><span class="mtk9">aining&nbsp;the&nbsp;values&nbsp;2,&nbsp;-1,&nbsp;and&nbsp;3&nbsp;represents&nbsp;the&nbsp;equa</span><span class="mtk9">tion</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`2&nbsp;*&nbsp;x0&nbsp;+&nbsp;(-1)&nbsp;*&nbsp;x1&nbsp;=&nbsp;3`,&nbsp;where&nbsp;`x0`&nbsp;a</span><span class="mtk9">nd&nbsp;`x1`&nbsp;are&nbsp;the&nbsp;unknown&nbsp;values&nbsp;in&nbsp;the&nbsp;system.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;An&nbsp;array&nbsp;containing&nbsp;solutions&nbsp;for&nbsp;each&nbsp;variable&nbsp;</span><span class="mtk9">in&nbsp;the&nbsp;system.</span></span><br><span><span class="mtk15">solve</span><span class="mtk13">(</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;coefficient&nbsp;matrix&nbsp;for&nbsp;the&nbsp;system&nbsp;of&nbsp;equation</span><span class="mtk9">s.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">coefficients</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">submatrix</span><span class="mtk13">(</span><span class="mtk33">from_column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">to_column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;array&nbsp;of&nbsp;resulting&nbsp;constants&nbsp;for&nbsp;each&nbsp;equatio</span><span class="mtk9">n.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">constants</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">col</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;containing&nbsp;solutions&nbsp;for&nbsp;each&nbsp;unknown&nbsp;in</span><span class="mtk9">&nbsp;the&nbsp;system.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;determinant&nbsp;value&nbsp;of&nbsp;the&nbsp;coefficient&nbsp;matrix.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">baseDet</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">coefficients</span><span class="mtk1">.</span><span class="mtk15">det</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">modified</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">col</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">coefficients</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">modified</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">coefficients</span><span class="mtk1">.</span><span class="mtk15">copy</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">modified</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk33">col</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">constants</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">modified</span><span class="mtk1">.</span><span class="mtk15">remove_col</span><span class="mtk13">(</span><span class="mtk33">col</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;solution&nbsp;for&nbsp;the&nbsp;column's&nbsp;unknown</span><span class="mtk9">&nbsp;by&nbsp;dividing&nbsp;the&nbsp;determinant&nbsp;of&nbsp;`modified`&nbsp;by&nbsp;the&nbsp;</span><span class="mtk9">`baseDet`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk33">modified</span><span class="mtk1">.</span><span class="mtk15">det</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">baseDet</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">result</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x4&nbsp;matrix&nbsp;containing&nbsp;coefficients&nbsp;and&nbsp;results&nbsp;</span><span class="mtk9">for&nbsp;a&nbsp;system&nbsp;of&nbsp;three&nbsp;equations.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;rows&nbsp;for&nbsp;the&nbsp;following&nbsp;equations:</span></span><br><span><span class="mtk9">//&nbsp;Equation&nbsp;1:&nbsp;3&nbsp;*&nbsp;x0&nbsp;+&nbsp;4&nbsp;*&nbsp;x1&nbsp;-&nbsp;1&nbsp;*&nbsp;x2&nbsp;=&nbsp;8</span></span><br><span><span class="mtk9">//&nbsp;Equation&nbsp;2:&nbsp;5&nbsp;*&nbsp;x0&nbsp;-&nbsp;2&nbsp;*&nbsp;x1&nbsp;+&nbsp;1&nbsp;*&nbsp;x2&nbsp;=&nbsp;4</span></span><br><span><span class="mtk9">//&nbsp;Equation&nbsp;3:&nbsp;2&nbsp;*&nbsp;x0&nbsp;-&nbsp;2&nbsp;*&nbsp;x1&nbsp;+&nbsp;1&nbsp;*&nbsp;x2&nbsp;=&nbsp;1</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">3.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8.0</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">5.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">-2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4.0</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">-2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;solutions&nbsp;to&nbsp;the&nbsp;unknowns&nbsp;in&nbsp;the&nbsp;syst</span><span class="mtk9">em&nbsp;of&nbsp;equations&nbsp;represented&nbsp;by&nbsp;`m`.</span></span><br><span><span class="mtk33">solutions</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">solve</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">solutions</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"x0"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Plots&nbsp;1.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">solutions</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"x1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Plots&nbsp;2.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">solutions</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"x2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Plots&nbsp;3.</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">求解方程组对于
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回归分析</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特别有用，例如线性和多项式回归。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克莱默法则适用于小型方程组。然而，它在大型系统中计算效率低下。</font><font style="vertical-align: inherit;">对于此类用例，通常首选其他方法，例如</font></font><a href="https://en.wikipedia.org/wiki/Gaussian_elimination" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高斯消元法。</font></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h4 id="matrixinv-and-matrixpinv" class="md-heading"><a href="#matrixinv-and-matrixpinv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.inv()` 和</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.pinv()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于任何非奇异
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方阵</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，都有一个逆矩阵，
当与原矩阵</font><a href="/pine-script-docs/language/matrices#matrix-mult"><font style="vertical-align: inherit;">相乘时，会得到</font></a></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_identity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单位</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
矩阵
。逆矩阵在各种矩阵变换和方程组求解中都很有用。</font><strong><font style="vertical-align: inherit;">如果存在</font></strong><font style="vertical-align: inherit;">逆矩阵，脚本可以通过
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv"><font style="vertical-align: inherit;">matrix.inv()</font></a><font style="vertical-align: inherit;">函数计算矩阵的逆矩阵</font><font style="vertical-align: inherit;">
。</font></font><a href="/pine-script-docs/language/matrices#matrix-mult"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于奇异（不可逆）矩阵，可以</font><font style="vertical-align: inherit;">通过
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv"><font style="vertical-align: inherit;">matrix.pinv()函数计算广义逆（</font></a></font><a href="https://en.wikipedia.org/wiki/Moore%E2%80%93Penrose_inverse" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伪逆</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），无论矩阵是方阵还是非零矩阵
</font><font style="vertical-align: inherit;">
。请记住，与真逆不同，伪逆与原始矩阵的乘积不一定等于单位矩阵，除非原始矩阵</font><em><font style="vertical-align: inherit;">是可逆的</font></em><font style="vertical-align: inherit;">。</font></font><code dir="auto">determinant &lt;_PageMatrices_MatrixCalculations_SpecialCalculations_MatrixDet&gt;</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据用户输入形成一个 2x2 矩阵，然后使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.inv()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.pinv()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法计算 的逆或伪逆</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。脚本在图表上的标签中显示原始矩阵、其逆或伪逆及其乘积：</font></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Matrix-calculations-Special-calculations-4.BXfICGI-_Z1Y52Ud.webp" alt="图像" width="844" height="314" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="7by"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Inverse&nbsp;example"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Element&nbsp;inputs&nbsp;for&nbsp;the&nbsp;2x2&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">r0c0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">4.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Row&nbsp;0,&nbsp;Col&nbsp;0"</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">r0c1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">3.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Row&nbsp;0,&nbsp;Col&nbsp;1"</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">r1c0</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Row&nbsp;1,&nbsp;Col&nbsp;0"</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">r1c1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Row&nbsp;1,&nbsp;Col&nbsp;1"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Displays&nbsp;the&nbsp;rows&nbsp;of&nbsp;a&nbsp;matrix&nbsp;in&nbsp;a&nbsp;label&nbsp;with&nbsp;a&nbsp;n</span><span class="mtk9">ote.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;The&nbsp;matrix&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;barIndex&nbsp;The&nbsp;`bar_index`&nbsp;to&nbsp;display&nbsp;the&nbsp;label&nbsp;</span><span class="mtk9">at.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;bgColor&nbsp;The&nbsp;background&nbsp;color&nbsp;of&nbsp;the&nbsp;label.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;textColor&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;label's&nbsp;text.</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;above&nbsp;the&nbsp;rows.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">debugLabel</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">this</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">textColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x2&nbsp;matrix&nbsp;of&nbsp;input&nbsp;values.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;input&nbsp;values&nbsp;to&nbsp;`m`.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk33">r0c0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">r0c1</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk33">r1c0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">r1c1</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;if&nbsp;`m`&nbsp;is&nbsp;square&nbsp;with&nbsp;a&nbsp;nonzero&nbsp;determi</span><span class="mtk9">nant,&nbsp;indicating&nbsp;invertibility.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isInvertible</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">is_square</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">det</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;inverse&nbsp;or&nbsp;pseudoinverse&nbsp;of&nbsp;`m`.</span></span><br><span><span class="mtk33">mInverse</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">isInvertible</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">inv</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">pinv</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;product&nbsp;of&nbsp;`m`&nbsp;and&nbsp;`mInverse`.&nbsp;Returns&nbsp;the&nbsp;id</span><span class="mtk9">entity&nbsp;matrix&nbsp;when&nbsp;`isInvertible`&nbsp;is&nbsp;`true`.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">product</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">mult</span><span class="mtk13">(</span><span class="mtk33">mInverse</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;`m`,&nbsp;`mInverse`,&nbsp;and&nbsp;their&nbsp;`product`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Original"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">mInverse</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">isInvertible</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Inverse"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Pseudoinverse"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">product</span><span class="mtk1">.</span><span class="mtk15">debugLabel</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">note</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Product"</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本仅
</font><font style="vertical-align: inherit;">
当</font><font style="vertical-align: inherit;">为时才会调用</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.inv()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即</font><font style="vertical-align: inherit;">为
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square"><font style="vertical-align: inherit;">平方</font></a><font style="vertical-align: inherit;">
且具有非零
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det"><font style="vertical-align: inherit;">行列式</font></a><font style="vertical-align: inherit;">时。否则，它使用
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv"><font style="vertical-align: inherit;">m.pinv()</font></a><font style="vertical-align: inherit;">
来计算广义逆。</font></font><code dir="auto">isInvertible</code><font style="vertical-align: inherit;"></font><code dir="auto">true</code><font style="vertical-align: inherit;"></font><code dir="auto">m</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<h4 id="matrixrank" class="md-heading"><a href="#matrixrank"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`矩阵.rank()`</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵的秩</font><font style="vertical-align: inherit;">表示矩阵所含线性独立向量（行或列）的数量。本质上，矩阵秩衡量的是无法用其他向量的线性组合来表示的向量的数量，换句话说，衡量的是包含唯一信息的向量的数量</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></em><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本可以通过</font></font></strong><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rank"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.rank()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
计算矩阵的秩
</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"></font><code dir="auto">m1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本确定两个 3x3 矩阵（和）</font><font style="vertical-align: inherit;">中线性独立向量的数量</font></font><code dir="auto">m2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并在单独的窗格中绘制这些值。正如我们在图表上看到的，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rank"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m1.rank()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值为 3，因为每个向量都是唯一的。
</font><font style="vertical-align: inherit;">
另一方面，</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rank"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m2.rank()值为 1，因为它只有一个唯一向量：</font></font></a><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Matrices-Matrix-calculations-Special-calculations-5.DU77KrgW_Z14e0aC.webp" alt="图像" width="952" height="338" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="45w"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Matrix&nbsp;rank&nbsp;example"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x3&nbsp;full-rank&nbsp;matrix.</span></span><br><span><span class="mtk33">m1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x3&nbsp;rank-deficient&nbsp;matrix.</span></span><br><span><span class="mtk33">m2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;linearly&nbsp;independent&nbsp;vectors&nbsp;to&nbsp;`m1`.</span></span><br><span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">7</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;linearly&nbsp;dependent&nbsp;vectors&nbsp;to&nbsp;`m2`.</span></span><br><span><span class="mtk33">m2</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m2</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">))</span></span><br><span><span class="mtk33">m2</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;`matrix.rank()`&nbsp;values.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m1</span><span class="mtk1">.</span><span class="mtk15">rank</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m2</span><span class="mtk1">.</span><span class="mtk15">rank</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵可以具有的最高秩值是其行数和列数中的最小值。具有最大可能秩的矩阵称为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">满秩</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵，任何非满秩的矩阵称为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秩亏</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵。</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="/pine-script-docs/language/matrices#matrix-det"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">满秩方阵的行列式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非零
</font><font style="vertical-align: inherit;">，且此类矩阵有
</font></font><a href="/pine-script-docs/language/matrices#matrix-inv-and-matrix-pinv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。相反，
</font><font style="vertical-align: inherit;">
秩亏矩阵的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行列式始终为 0。</font></font></a><font style="vertical-align: inherit;"></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于每个元素都只包含相同值的矩阵（例如，填充了 0 的矩阵），其秩始终为 0，因为没有任何向量包含唯一信息。对于任何其他具有不同值的矩阵，最小可能秩为 1。</font></font></li>
</ul>
<h2 id="error-handling" class="md-heading"><a href="#error-handling"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了由于语法不正确而在脚本编译过程中发生的常见</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译器</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误之外，使用矩阵的脚本在执行过程中还可能引发特定的</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行时</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误。当脚本引发运行时错误时，它会在脚本标题旁边显示一个红色感叹号。用户可以通过单击此图标来查看错误消息。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们讨论用户在脚本中使用矩阵时可能遇到的运行时错误。</font></font></p>
<h3 id="the-rowcolumn-index-xx-is-out-of-bounds-rowcolumn-size-is-yy" class="md-heading"><a href="#the-rowcolumn-index-xx-is-out-of-bounds-rowcolumn-size-is-yy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行/列索引（xx）超出范围，行/列大小为</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（yy）。</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当尝试使用包括matrix.get()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.set()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.fill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.fill()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.submatrix()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在内的函数以及一些与
</font><font style="vertical-align: inherit;">矩阵的</font></font><a href="/pine-script-docs/language/matrices#rows-and-columns"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行和列</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关的函数访问矩阵维度之外的索引时，就会发生此运行时错误
。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此代码包含两行将产生此运行时错误。
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.set()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法引用了</font></font><code dir="auto">row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不存在的索引 (2)。
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m.submatrix()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法引用了所有列索引，直到</font></font><code dir="auto">to_column - 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font><code dir="auto">to_column</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为 4 会导致运行时错误，因为引用的最后一个列索引 (3) 在 中不存在</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="3ar"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Out&nbsp;of&nbsp;bounds&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x3&nbsp;matrix&nbsp;with&nbsp;a&nbsp;max&nbsp;row&nbsp;index&nbsp;of&nbsp;1&nbsp;and&nbsp;max&nbsp;co</span><span class="mtk9">lumn&nbsp;index&nbsp;of&nbsp;2.&nbsp;</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;The&nbsp;`row`&nbsp;index&nbsp;is&nbsp;out&nbsp;of&nbsp;bounds&nbsp;on&nbsp;this&nbsp;line.&nbsp;</span><span class="mtk9">The&nbsp;max&nbsp;value&nbsp;is&nbsp;1.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">submatrix</span><span class="mtk13">(</span><span class="mtk33">from_column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">to_column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;The&nbsp;`to_column`&nbsp;index&nbsp;is&nbsp;invalid&nbsp;on&nbsp;this&nbsp;line.&nbsp;</span><span class="mtk9">The&nbsp;max&nbsp;value&nbsp;is&nbsp;3.</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.navy</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以通过确保函数调用不引用大于或等于行数/列数的索引来避免脚本中出现此错误。</font></font></p>
<h3 id="the-array-size-does-not-match-the-number-of-rowscolumns-in-the-matrix" class="md-heading"><a href="#the-array-size-does-not-match-the-number-of-rowscolumns-in-the-matrix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组大小与矩阵的行数/列数不匹配</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.add_row()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.add_col()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数将
行和列</font></font><a href="/pine-script-docs/language/matrices#inserting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非空矩阵时，插入数组的大小必须与矩阵维度一致。插入行的大小必须与列数匹配，插入列的大小必须与行数匹配。否则，脚本将引发此运行时错误。例如：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="577"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Invalid&nbsp;array&nbsp;size&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Declare&nbsp;an&nbsp;empty&nbsp;matrix.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">))</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;a&nbsp;column.&nbsp;Changes&nbsp;the&nbsp;shape&nbsp;of&nbsp;`m`&nbsp;to&nbsp;2x1.</span></span><br><span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_col</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">))</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Raises&nbsp;a&nbsp;runtime&nbsp;error&nbsp;because&nbsp;`m`&nbsp;has&nbsp;2&nbsp;rows,&nbsp;</span><span class="mtk9">not&nbsp;3.&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">col</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk13">))</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当为空时，可以插入</font><em><font style="vertical-align: inherit;">任意</font></em></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小的行或列数组</font><font style="vertical-align: inherit;">
，如第一</font><font style="vertical-align: inherit;">行所示。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code dir="auto">m.add_col()</code><font style="vertical-align: inherit;"></font></li>
</ul>
<h3 id="cannot-call-matrix-methods-when-the-id-of-matrix-is-na" class="md-heading"><a href="#cannot-call-matrix-methods-when-the-id-of-matrix-is-na"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当矩阵的 ID 为</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“na”时，无法调用矩阵方法。</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当矩阵变量被赋值给 时</font></font><code dir="auto">na</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着该变量不引用现有对象。因此，不能使用内置</font></font><code dir="auto">matrix.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数和方法。例如：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="1zk"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"na&nbsp;matrix&nbsp;methods&nbsp;demo"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`matrix`&nbsp;variable&nbsp;assigned&nbsp;to&nbsp;`na`.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk33">mCopy</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">copy</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Raises&nbsp;a&nbsp;runtime&nbsp;error.&nbsp;You&nbsp;can't&nbsp;copy&nbsp;a&nbsp;matrix</span><span class="mtk9">&nbsp;that&nbsp;doesn't&nbsp;exist.</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">mCopy</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.navy</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要解决此错误，请</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用函数之前分配给有效的矩阵实例</font></font><code dir="auto">matrix.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<h3 id="matrix-is-too-large-maximum-size-of-the-matrix-is-100000-elements" class="md-heading"><a href="#matrix-is-too-large-maximum-size-of-the-matrix-is-100000-elements"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵太大。矩阵的最大大小为 100,000 个</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素。</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.elements_count"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论矩阵的形状如何，矩阵 ( matrix.elements_count()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )中的元素总数</font><font style="vertical-align: inherit;">都不能超过</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,000</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。例如，此脚本将引发错误，因为它将
</font><font style="vertical-align: inherit;">1000 行（包含 101 个元素）</font></font><a href="/pine-script-docs/language/matrices#inserting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到矩阵中：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="53a"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Matrix&nbsp;too&nbsp;large&nbsp;demo"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk12">1000</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;This&nbsp;raises&nbsp;an&nbsp;error&nbsp;because&nbsp;the&nbsp;script&nbsp;adds&nbsp;10</span><span class="mtk9">1&nbsp;elements&nbsp;on&nbsp;each&nbsp;iteration.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;1000&nbsp;rows&nbsp;*&nbsp;101&nbsp;elements&nbsp;per&nbsp;row&nbsp;=&nbsp;101000&nbsp;total</span><span class="mtk9">&nbsp;elements.&nbsp;This&nbsp;is&nbsp;too&nbsp;large.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">101</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br></code></div>
<h3 id="the-rowcolumn-index-must-be-0--from_rowcolumn--to_rowcolumn" class="md-heading"><a href="#the-rowcolumn-index-must-be-0--from_rowcolumn--to_rowcolumn"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行/列索引必须是 0 &lt;= from_row/column &lt; to_row/column。</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用带有</font><font style="vertical-align: inherit;">和
</font><font style="vertical-align: inherit;">索引</font></font><code dir="auto">matrix.*()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的函数时，</font><font style="vertical-align: inherit;">值必须小于相应的</font><font style="vertical-align: inherit;">值，最小可能值为 0。否则，脚本将引发运行时错误。</font></font><code dir="auto">from_row/column</code><font style="vertical-align: inherit;"></font><code dir="auto">to_row/column</code><font style="vertical-align: inherit;"></font><code dir="auto">from_*</code><font style="vertical-align: inherit;"></font><code dir="auto">to_*</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本显示尝试
</font><font style="vertical-align: inherit;">从 4x4</font><font style="vertical-align: inherit;">矩阵声明一个</font><font style="vertical-align: inherit;">值为 2 且
值为 2 的</font></font><a href="/pine-script-docs/language/matrices#submatrices"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子矩阵</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这将导致错误：</font></font><code dir="auto">m</code><font style="vertical-align: inherit;"></font><code dir="auto">from_row</code><font style="vertical-align: inherit;"></font><code dir="auto">to_row</code><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="1yn"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Invalid&nbsp;from_row,&nbsp;to_row&nbsp;demo"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;4x4&nbsp;matrix&nbsp;filled&nbsp;with&nbsp;a&nbsp;random&nbsp;value.&nbsp;</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.random</span><span class="mtk13">())</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">mSub</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">submatrix</span><span class="mtk13">(</span><span class="mtk33">from_row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">to_row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Raises&nbsp;an&nbsp;error.&nbsp;`from_row`&nbsp;can't&nbsp;equal&nbsp;`to_row</span><span class="mtk9">`.</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">mSub</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br></code></div>
<h3 id="matrices-id1-and-id2-must-have-an-equal-number-of-rows-and-columns-to-be-added" class="md-heading"><a href="#matrices-id1-and-id2-must-have-an-equal-number-of-rows-and-columns-to-be-added"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵“id1”和“id2”必须具有相同数量的行和列才能相加</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
</font></font><a href="/pine-script-docs/language/matrices#matrix-sum-and-matrix-diff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.sum() 和 matrix.diff()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数时，</font></font><code dir="auto">id1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">id2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵必须具有相同的行数和列数。尝试添加或减去两个维度不匹配的矩阵将引发错误，如以下代码所示：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="wv"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Invalid&nbsp;sum&nbsp;dimensions&nbsp;demo"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x3&nbsp;matrix.&nbsp;</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x4&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">mSum</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.sum</span><span class="mtk13">(</span><span class="mtk33">m1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Raises&nbsp;an&nbsp;error.&nbsp;`m1`&nbsp;and&nbsp;`m2`&nbsp;don't&nbsp;have&nbsp;match</span><span class="mtk9">ing&nbsp;dimensions.</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">mSum</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br></code></div>
<h3 id="the-number-of-columns-in-the-id1-matrix-must-equal-the-number-of-rows-in-the-matrix-or-the-number-of-elements-in-the-array-id2" class="md-heading"><a href="#the-number-of-columns-in-the-id1-matrix-must-equal-the-number-of-rows-in-the-matrix-or-the-number-of-elements-in-the-array-id2"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">“id1”矩阵的列数必须等于矩阵“id2”</font></span><font style="vertical-align: inherit;">的行数（或数组中的元素数） 。</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用
</font></font><a href="/pine-script-docs/language/matrices#matrix-mult"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.mult()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code dir="auto">id1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵与</font></font><code dir="auto">id2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵或数组相乘时， 的
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.rows()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array.size()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必须</font></font><code dir="auto">id2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于
</font><font style="vertical-align: inherit;">
中的</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.columns()</font></font></a><font style="vertical-align: inherit;"></font><code dir="auto">id1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果它们不对齐，脚本将引发此错误。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，此脚本尝试将两个 2x3 矩阵相乘。虽然
</font><font style="vertical-align: inherit;">可以将这些矩阵</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相加</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但不能将它们</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相乘：</font></font></em><font style="vertical-align: inherit;"></font></p>
<div class="pine-colorizer not-content colorized" data-id="2az"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Invalid&nbsp;mult&nbsp;dimensions&nbsp;demo"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x3&nbsp;matrix.&nbsp;</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;2x3&nbsp;matrix.</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">mSum</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.mult</span><span class="mtk13">(</span><span class="mtk33">m1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">m2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Raises&nbsp;an&nbsp;error.&nbsp;The&nbsp;number&nbsp;of&nbsp;columns&nbsp;in&nbsp;`m1`&nbsp;</span><span class="mtk9">and&nbsp;rows&nbsp;in&nbsp;`m2`&nbsp;aren't&nbsp;equal.</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">mSum</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br></code></div>
<h3 id="operation-not-available-for-non-square-matrices" class="md-heading"><a href="#operation-not-available-for-non-square-matrices"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于非方阵，该操作不可用</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些矩阵运算，包括
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.inv()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.det()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.eigenvalues"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.eigenvalues()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrix.eigenvectors()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仅适用于</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方阵</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即行数和列数相同的矩阵。当尝试在非方阵上执行此类函数时，脚本将引发错误，指出该操作不可用或无法计算矩阵的结果</font></font><code dir="auto">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。例如：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="k6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Non-square&nbsp;demo"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;3x5&nbsp;matrix.&nbsp;</span></span><br><span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">m</span><span class="mtk1">.</span><span class="mtk15">det</span><span class="mtk13">())</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Raises&nbsp;a&nbsp;runtime&nbsp;error.&nbsp;You&nbsp;can't&nbsp;calculate&nbsp;the</span><span class="mtk9">&nbsp;determinant&nbsp;of&nbsp;a&nbsp;3x5&nbsp;matrix.</span></span><br></code></div>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a href="/pine-script-docs/language/arrays" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前的</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow-back">  <use xlink:href="#ai:local:theme/arrow-back"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组  </font></font></h4> </a>  <a href="/pine-script-docs/language/maps" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  地图</font></font><svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本页</font></font></h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#matrices" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></li></a><a href="#introduction" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></li></a><a href="#declaring-a-matrix" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明矩阵</font></font></li></a><a href="#using-var-and-varip-keywords" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 `var` 和 `varip` 关键字</font></font></li></a><a href="#reading-and-writing-matrix-elements" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取和写入矩阵元素</font></font></li></a><a href="#matrixget-and-matrixset" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.get()` 和 `matrix.set()`</font></font></li></a><a href="#matrixfill" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`矩阵.fill()`</font></font></li></a><a href="#rows-and-columns" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行和列</font></font></li></a><a href="#retrieving" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索</font></font></li></a><a href="#inserting" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入</font></font></li></a><a href="#removing" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></li></a><a href="#swapping" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交换</font></font></li></a><a href="#replacing" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更换</font></font></li></a><a href="#looping-through-a-matrix" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环矩阵</font></font></li></a><a href="#for" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`为`</font></font></li></a><a href="#forin" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`for…in`</font></font></li></a><a href="#copying-a-matrix" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制矩阵</font></font></li></a><a href="#shallow-copies" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浅拷贝</font></font></li></a><a href="#deep-copies" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">深层复制</font></font></li></a><a href="#submatrices" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子矩阵</font></font></li></a><a href="#scope-and-history" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围和历史</font></font></li></a><a href="#inspecting-a-matrix" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查矩阵</font></font></li></a><a href="#manipulating-a-matrix" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作矩阵</font></font></li></a><a href="#reshaping" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重塑</font></font></li></a><a href="#reversing" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆转</font></font></li></a><a href="#transposing" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移调</font></font></li></a><a href="#sorting" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序</font></font></li></a><a href="#concatenating" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接</font></font></li></a><a href="#matrix-calculations" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵计算</font></font></li></a><a href="#element-wise-calculations" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素级计算</font></font></li></a><a href="#special-calculations" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特殊计算</font></font></li></a><a href="#matrixsum-and-matrixdiff" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.sum()` 和 `matrix.diff()`</font></font></li></a><a href="#matrixmult" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.mult()`</font></font></li></a><a href="#matrixdet" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.det()`</font></font></li></a><a href="#matrixinv-and-matrixpinv" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`matrix.inv()` 和 `matrix.pinv()`</font></font></li></a><a href="#matrixrank" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-5" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`矩阵.rank()`</font></font></li></a><a href="#error-handling" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误处理</font></font></li></a><a href="#the-rowcolumn-index-xx-is-out-of-bounds-rowcolumn-size-is-yy" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行/列索引（xx）超出范围，行/列大小为（yy）。</font></font></li></a><a href="#the-array-size-does-not-match-the-number-of-rowscolumns-in-the-matrix" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组大小与矩阵中的行数/列数不匹配。</font></font></li></a><a href="#cannot-call-matrix-methods-when-the-id-of-matrix-is-na" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当矩阵的 ID 为“na”时，无法调用矩阵方法。</font></font></li></a><a href="#matrix-is-too-large-maximum-size-of-the-matrix-is-100000-elements" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵太大。矩阵的最大大小为 100,000 个元素。</font></font></li></a><a href="#the-rowcolumn-index-must-be-0--from_rowcolumn--to_rowcolumn" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行/列索引必须是 0 &lt;= from_row/column &lt; to_row/column。</font></font></li></a><a href="#matrices-id1-and-id2-must-have-an-equal-number-of-rows-and-columns-to-be-added" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵“id1”和“id2”必须具有相同数量的行和列才能相加。</font></font></li></a><a href="#the-number-of-columns-in-the-id1-matrix-must-equal-the-number-of-rows-in-the-matrix-or-the-number-of-elements-in-the-array-id2" class="document-toc-link" data-astro-cid-oor6cujd="" aria-current="true"><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“id1”矩阵的列数必须等于矩阵“id2”的行数（或数组中的元素数）。</font></font></li></a><a href="#operation-not-available-for-non-square-matrices" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于非方阵，该操作不可用。</font></font></li></a></ul><a class="back-top" href="#top" data-astro-cid-oor6cujd=""><svg width="16" height="16" viewBox="0 0 16 16" data-astro-cid-oor6cujd="" data-icon="theme/back-top">  <symbol id="ai:local:theme/back-top"><path fill="currentColor" fill-rule="evenodd" d="M6.25 12.5A2.75 2.75 0 0 0 9 9.75V4.56L6.78 6.78a.75.75 0 0 1-1.06-1.06l3.5-3.5a.75.75 0 0 1 1.06 0l3.5 3.5a.75.75 0 0 1-1.06 1.06L10.5 4.56v5.19a4.25 4.25 0 0 1-8.5 0v-1a.75.75 0 0 1 1.5 0v1a2.75 2.75 0 0 0 2.75 2.75Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/back-top"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回到顶部
</font></font></a></section></aside></div> </main> </div>            <script data-astro-rerun="" src="/pine-script-docs/static/pine-highlighter-v06.js" data-astro-exec=""></script><div id="goog-gt-tt" class="VIpgJd-yAWNEb-L7lbkb skiptranslate" style="border-radius: 12px; margin: 0 0 0 -23px; padding: 0; font-family: 'Google Sans', Arial, sans-serif;" data-id=""><div id="goog-gt-vt" class="VIpgJd-yAWNEb-hvhgNd"><div class=" VIpgJd-yAWNEb-hvhgNd-l4eHX-i3jM8c"><img src="https://fonts.gstatic.com/s/i/productlogos/translate/v14/24px.svg" width="24" height="24" alt=""></div><div class=" VIpgJd-yAWNEb-hvhgNd-k77Iif-i3jM8c"><div class="VIpgJd-yAWNEb-hvhgNd-IuizWc" dir="ltr">Original text</div><div id="goog-gt-original-text" class="VIpgJd-yAWNEb-nVMfcd-fmcmS VIpgJd-yAWNEb-hvhgNd-axAV1"></div></div><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid ltr"><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid-B7I4Od ltr" dir="ltr"><div class="VIpgJd-yAWNEb-hvhgNd-UTujCb">Rate this translation</div><div class="VIpgJd-yAWNEb-hvhgNd-eO9mKe">Your feedback will be used to help improve Google Translate</div></div><div class="VIpgJd-yAWNEb-hvhgNd-xgov5 ltr"><button id="goog-gt-thumbUpButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Good translation" aria-label="Good translation" aria-pressed="false"><span id="goog-gt-thumbUpIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7H2v13h16c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM7 18H4V9h3v9zm14-7l-3 7H9V8l4.34-4.34L12 9h9v2z"></path></svg></span><span id="goog-gt-thumbUpIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7v13h11c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM5 7H1v13h4V7z"></path></svg></span></button><button id="goog-gt-thumbDownButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Poor translation" aria-label="Poor translation" aria-pressed="false"><span id="goog-gt-thumbDownIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7h5V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zM17 6h3v9h-3V6zM3 13l3-7h9v10l-4.34 4.34L12 15H3v-2z"></path></svg></span><span id="goog-gt-thumbDownIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zm16 0h4V4h-4v13z"></path></svg></span></button></div></div><div id="goog-gt-votingHiddenPane" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><form id="goog-gt-votingForm" action="//translate.googleapis.com/translate_voting?client=te_lib" method="post" target="votingFrame" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><input type="text" name="sl" id="goog-gt-votingInputSrcLang"><input type="text" name="tl" id="goog-gt-votingInputTrgLang"><input type="text" name="query" id="goog-gt-votingInputSrcText"><input type="text" name="gtrans" id="goog-gt-votingInputTrgText"><input type="text" name="vote" id="goog-gt-votingInputVote"></form><iframe name="votingFrame" frameborder="0"></iframe></div></div></div> </body></html>