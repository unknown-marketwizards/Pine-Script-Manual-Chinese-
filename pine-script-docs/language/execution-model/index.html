<html lang="zh-CN" data-theme="light" class="translated-ltr"><head><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/pine-script-docs/static/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>语言/执行模型</title><meta name="og:title" content="Language / Execution model"><meta name="twitter:title" content="Language / Execution model"><meta name="description" content="Everything you need to know about Pine Script™."><meta name="og:description" content="Everything you need to know about Pine Script™."><meta name="twitter:description" content="Everything you need to know about Pine Script™."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png"><meta name="twitter:image" content="/pine-script-docs/meta-image.png"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="../../language/execution-model/"><meta name="twitter:url" content="../../language/execution-model/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="../../language/execution-model/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="stylesheet" href="/pine-script-docs/_astro/index.jN9AZoBe.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.C8b720yZ.css"><script type="module" src="/pine-script-docs/_astro/hoisted.D4iEV6y6.js" data-astro-exec=""></script><style type="text/css" media="screen">.monaco-editor-tv-pine-dark { 
    .mtk1 { color: #ffffff; }
    .mtk2 { color: #131722; }
    .mtk3 { color: #cc6666; }
    .mtk4 { color: #9cdcfe; }
    .mtk5 { color: #ce9178; }
    .mtk6 { color: #d4d4d4; }
    .mtk7 { color: #b5cea8; }
    .mtk8 { color: #608b4e; }
    .mtk9 { color: #787b86; }
    .mtk10 { color: #569cd6; }
    .mtk11 { color: #f77c80; }
    .mtk12 { color: #f57f17; }
    .mtk13 { color: #dcdcdc; }
    .mtk14 { color: #808080; }
    .mtk15 { color: #3179f5; }
    .mtk16 { color: #5b9cf6; }
    .mtk17 { color: #ba68c8; }
    .mtk18 { color: #42bda8; }
    .mtk19 { color: #f44747; }
    .mtk20 { color: #c586c0; }
    .mtk21 { color: #a79873; }
    .mtk22 { color: #dd6a6f; }
    .mtk23 { color: #5bb498; }
    .mtk24 { color: #909090; }
    .mtk25 { color: #778899; }
    .mtk26 { color: #ff00ff; }
    .mtk27 { color: #b46695; }
    .mtk28 { color: #388e3c; }
    .mtk29 { color: #ff0000; }
    .mtk30 { color: #4f76ac; }
    .mtk31 { color: #3dc9b0; }
    .mtk32 { color: #74b0df; }
    .mtk33 { color: #d1d4dc; }
    .mtk34 { color: #4864aa; }
    .mtki { font-style: italic; }
    .mtkb { font-weight: bold; }
    .mtku { text-decoration: underline; text-underline-position: under; }
    .mtks { text-decoration: line-through; }
    .mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style>
<style type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://www.gstatic.com/_/translate_http/_/ss/k=translate_http.tr.26tY-h6gH9w.L.W.O/am=GAY/d=0/rs=AN8SPfrev-A3NvrBP0gNq8zXCqKY7IcBLA/m=el_main_css"></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16px" height="16px" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02Zm-3.95-.3a7.91 7.91 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16px" height="16px" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8V4Zm0 9v2h1v-2H8Zm6-3V9h-2v1h2ZM3 9v1h2V9H3Zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm4.2-6-.7-.7-1.4 1.4.7.7L12.7 6ZM5 13.7l-.7-.7 1.4-1.4.7.7L5 13.7Zm7.7-.7-.7.7-1.4-1.4.7-.7 1.4 1.4ZM4.3 6l.7-.7 1.4 1.4-.7.7L4.3 6Zm3 17 14-14 .8.7L8 23.7l-.7-.7Zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9Z"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh="">    <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="Close menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey="">FAQ</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script™ version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script™ version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script™ version 3</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="主导航" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="Open navigation menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="主页按钮" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><svg width="188" height="44" viewBox="0 0 188 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001ZM32.4978 22.1105L27.1641 25.5207L19.7195 19.2258C19.1767 18.7669 18.4312 18.6305 17.7611 18.8676L13.8245 20.2602L21.9253 9.59841L32.4978 22.1105Z" fill="currentColor"></path>
<path d="M33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="currentColor"></path>
<path d="M59.56 13.96C63.016 13.96 65.536 16.456 65.536 19.696C65.536 22.936 63.016 25.432 59.56 25.432H57.376V31H53.896V13.96H59.56ZM59.512 22.168C61.096 22.168 62.152 21.088 62.152 19.696C62.152 18.304 61.096 17.224 59.512 17.224H57.376V22.168H59.512ZM70.8636 14.944C70.8636 16.096 69.9276 17.032 68.7516 17.032C67.6236 17.032 66.6636 16.096 66.6636 14.944C66.6636 13.792 67.6236 12.856 68.7516 12.856C69.9276 12.856 70.8636 13.792 70.8636 14.944ZM67.1196 31V19H70.4076V31H67.1196ZM73.0849 31V19H76.3729V20.368C76.9969 19.408 78.2449 18.736 79.8049 18.736C82.7089 18.736 84.4369 20.848 84.4369 23.968V31H81.1489V24.52C81.1489 22.792 80.4049 21.736 79.0369 21.736C77.5249 21.736 76.3729 22.84 76.3729 25.144V31H73.0849ZM86.2041 25C86.2041 21.448 88.8681 18.736 92.5161 18.736C95.6601 18.736 98.4201 20.752 98.4201 24.64C98.4201 24.928 98.4201 25.264 98.3721 25.768H89.3961C89.5881 27.376 91.0041 28.264 92.5881 28.264C94.0761 28.264 95.1561 27.568 95.6841 26.752L98.1321 28.576C97.0281 30.184 95.0841 31.264 92.5641 31.264C88.9881 31.264 86.2041 28.792 86.2041 25ZM92.4201 21.448C91.1961 21.448 89.8281 22.072 89.5161 23.536H95.1321C94.8441 22.12 93.6441 21.448 92.4201 21.448ZM104.412 28.24L107.076 26.008C107.916 27.28 109.38 28.024 110.772 28.024C112.14 28.024 113.052 27.352 113.052 26.368C113.052 25.408 112.356 24.736 110.676 24.16L109.236 23.656C106.5 22.696 105.036 21.112 105.036 18.784C105.036 15.568 107.484 13.672 110.796 13.672C112.884 13.672 114.708 14.392 116.172 16.024L113.868 18.4C113.052 17.416 111.996 16.936 110.82 16.936C109.644 16.936 108.54 17.44 108.54 18.448C108.54 19.48 109.38 19.936 111.18 20.584L112.548 21.088C115.044 22 116.604 23.584 116.604 26.152C116.58 29.2 114.156 31.288 110.628 31.288C107.916 31.288 105.636 30.112 104.412 28.24ZM129.859 27.808C128.827 29.872 126.667 31.264 124.171 31.264C120.619 31.264 117.811 28.624 117.811 25C117.811 21.376 120.619 18.736 124.171 18.736C126.667 18.736 128.827 20.128 129.859 22.192L127.003 23.728C126.523 22.624 125.491 21.808 124.171 21.808C122.443 21.808 121.123 23.152 121.123 25C121.123 26.848 122.443 28.192 124.171 28.192C125.491 28.192 126.523 27.376 127.003 26.272L129.859 27.808ZM131.482 31V19H134.77V20.92C135.178 19.744 136.402 18.856 137.746 18.856C138.082 18.856 138.442 18.88 138.85 19V22.336C138.346 22.168 137.89 22.072 137.362 22.072C135.802 22.072 134.77 23.296 134.77 25.264V31H131.482ZM144.215 14.944C144.215 16.096 143.279 17.032 142.103 17.032C140.975 17.032 140.015 16.096 140.015 14.944C140.015 13.792 140.975 12.856 142.103 12.856C143.279 12.856 144.215 13.792 144.215 14.944ZM140.471 31V19H143.759V31H140.471ZM146.436 36.016V19H149.724V20.344C150.276 19.576 151.548 18.736 153.204 18.736C156.396 18.736 158.844 21.592 158.844 25C158.844 28.408 156.396 31.264 153.204 31.264C151.548 31.264 150.276 30.424 149.724 29.656V36.016H146.436ZM155.508 25C155.508 23.128 154.284 21.736 152.484 21.736C150.684 21.736 149.46 23.128 149.46 25C149.46 26.872 150.684 28.264 152.484 28.264C154.284 28.264 155.508 26.872 155.508 25ZM168.407 30.88C167.879 31.048 167.231 31.144 166.319 31.144C163.775 31.144 161.735 29.728 161.735 26.8V21.88H159.311V19H161.735V15.664H165.023V19H168.407V21.88H165.023V26.152C165.023 27.616 165.647 28.192 167.063 28.192C167.591 28.192 168.023 28.12 168.407 27.976V30.88ZM177.626 22.648V13.96H179.978L181.874 16.888L183.746 13.96H186.122V22.648H183.698V18.184L181.874 20.968L180.026 18.136V22.648H177.626ZM171.386 22.648V16.456H169.058V13.96H176.258V16.456H173.93V22.648H171.386Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="搜索文档" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0Zm-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="重置" data-search-clear="" data-astro-cid-fg37foga=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除</font></font></button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="关闭" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga="">Search results</div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp="">    </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true" style="display:none"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题</font></font></span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14V3Zm0 18h1.5v5H14v-5Zm12-5.5V14h-5v1.5h5ZM8 14v1.5H3V14h5Zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1 3.4-3.6ZM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1 3.6 3.5Z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;黑暗的&nbsp;&nbsp;</font></font></option><option value="light" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;明亮&nbsp;&nbsp;</font></font></option><option value="auto" selected="true" data-astro-cid-lmznfliq=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;&nbsp;自动&nbsp;&nbsp;</font></font></option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="Close image preview" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94 5.53 4.47Z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="文档侧边栏" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Pine Script™ v5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初识Pine Script™</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个指标</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/time-series" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份标识</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量声明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件结构</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义函数</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警报</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/backgrounds" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-coloring" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图色彩</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-plotting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形图状态</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表信息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/colors" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/fills" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/levels" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/lines-and-boxes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线条和盒子</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非标准图表数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他时间范围和数据</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/plots" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新粉刷</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/tables" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/text-and-shapes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本和形状</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间范围</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写脚本</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">风格指南</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和优化</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布脚本</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常问问题</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行说明</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移指南</font></font></div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 5</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 4</font></font></a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转至 Pine Script™ 版本 3</font></font></a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里可以获得更多信息？</font></font></a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="返回文档主页。" data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户手册</font></font></span>  </a>  <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <a href="/pine-script-docs/language/execution-model" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></a> <span class="divider" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span> <span class="current-item" data-astro-cid-wlavna2o=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></span> </div>     </div> <div id="slot-container" data-astro-cid-xgirumru="">  <h1 id="execution-model" class="md-heading"><a href="#execution-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模型</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™ 运行时的执行模型与 Pine Script™ 的</font></font><a href="/pine-script-docs/language/time-series"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间序列</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="/pine-script-docs/language/type-system"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型系统</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密切相关。了解这三者是充分利用 Pine Script™ 功能的关键。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型决定了脚本在图表上的执行方式，从而决定了您在脚本中编写的代码的运行方式。如果没有 Pine Script™ 的运行时，您的代码将无法执行任何操作，因为代码编译后会启动，并在图表上执行，因为
</font></font><a href="/pine-script-docs/language/execution-model#events-triggering-the-execution-of-a-script"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发脚本执行的事件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之一已经发生。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当 Pine 脚本加载到图表上时，它会使用每个条形图的可用 OHLCV（开盘价、最高价、最低价、收盘价、成交量）值在每个历史条形图上执行一次。一旦脚本的执行到达数据集中最右侧的条形图，如果交易当前在图表符号上处于活动状态，则</font><font style="vertical-align: inherit;">每次发生</font><em><font style="vertical-align: inherit;">更新</font></em><font style="vertical-align: inherit;">（即价格或成交量变化）时，
 Pine Script™</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指标都会执行一次。默认情况下，Pine Script™</font></font></em><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">策略</font></em><font style="vertical-align: inherit;">仅在最右侧条形图关闭时执行，但它们也可以配置为在每次更新时执行，就像指标一样。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有符号/时间范围对都有一个包含有限数量的条形图的数据集。当您向左滚动图表以查看数据集的较早条形图时，相应的条形图会加载到图表上。当该特定符号/时间范围对不再有条形图或已加载您的账户类型允许的</font></font><a href="/pine-script-docs/writing/limitations#chart-bars"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大条形图数量</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，加载过程将停止
。您可以将图表向左滚动，直到数据集的第一个条形图，其索引值为 0（参见
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bar_index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当脚本首次在图表上运行时，数据集中的所有条形图都是
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史条形图</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，除了最右边的条形图（如果交易时段处于活动状态）。当最右边的条形图处于活动状态时，它被称为
</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实时条形图</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。当检测到价格或交易量变化时，实时条形图会更新。当实时条形图关闭时，它将成为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已过去的实时条形图</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并打开一个新的实时条形图。</font></font></p>
<h2 id="calculation-based-on-historical-bars" class="md-heading"><a href="#calculation-based-on-historical-bars"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据历史</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱计算</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们采用一个简单的脚本并跟踪其在历史柱上的执行情况：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="2ao"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Script"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk33">src</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br><span><span class="mtk33">a</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk33">src</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk33">b</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk33">src</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span class="mtk33">c</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.cross</span><span class="mtk13">(</span><span class="mtk33">a</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">b</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">a</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">b</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotshape</span><span class="mtk13">(</span><span class="mtk33">c</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在历史柱上，当该柱的 OHLCV 值全部已知时，脚本将在柱收盘时执行。在柱上执行脚本之前，内置变量（例如</font></font><code dir="auto">open</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
 </font></font><code dir="auto">high</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">low</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code dir="auto">close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">volume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）将设置为与该柱的值相对应的值。</font><strong><font style="vertical-align: inherit;">每个历史柱</font></strong></font><code dir="auto">time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行一次脚本</font><font style="vertical-align: inherit;">。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的示例脚本首先在索引 0 处的数据集的第一个柱上执行。每个语句都使用当前柱的值执行。因此，在数据集的第一个柱上，以下语句：</font></font></p>
<div class="pine-colorizer not-content colorized" data-id="5aa"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk33">src</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br></code></div>
<p><font style="vertical-align: inherit;"></font><code dir="auto">src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用第一个柱的值</font><font style="vertical-align: inherit;">初始化变量</font></font><code dir="auto">close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后依次执行接下来的每一行。由于脚本只对每个历史柱执行一次，因此脚本将始终使用相同的</font></font><code dir="auto">close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值对特定历史柱进行计算。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本中每一行的执行都会产生计算，进而生成指标的输出值，然后可以将其绘制在图表上。我们的示例使用脚本末尾的</font></font><code dir="auto">plot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">plotshape</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用来输出一些值。对于策略，计算结果可用于绘制值或指示要下达的订单。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个条形图上执行并绘制之后，脚本将在数据集的第二个条形图上执行，该条形图的索引为 1。然后重复该过程，直到数据集中的所有历史条形图都被处理并且脚本到达图表上的最右边的条形图。</font></font></p>
<p><img src="/pine-script-docs/_astro/execution_model_calculation_on_history.ZMeUmfch_jaqxS.webp" alt="图像" width="1600" height="800" loading="lazy" decoding="async"></p>
<h2 id="calculation-based-on-realtime-bars" class="md-heading"><a href="#calculation-based-on-realtime-bars"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据实时</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱线计算</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine 脚本在实时条形图上的行为与在历史条形图上的行为截然不同。回想一下，当图表符号上的交易处于活动状态时，实时条形图是图表上最右侧的条形图。另外，回想一下，策略在实时条形图上可以以两种不同的方式运行。默认情况下，它们仅在实时条形图关闭时执行，但
可以将声明语句</font></font><code dir="auto">calc_on_every_tick</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的参数</font></font><code dir="auto">strategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为 true 以修改策略的行为，以便它在每次实时条形图更新时执行，就像指标一样。因此，此处描述的指标行为仅适用于使用 的策略</font></font><code dir="auto">calc_on_every_tick=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在历史和实时条形图上执行脚本最重要的区别在于，虽然它们在历史条形图上只执行一次，但脚本在实时条形图期间每次发生更新时都会执行。这意味着内置变量（例如，</font></font><code dir="auto">high</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">low</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><code dir="auto">close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在历史条形图上永远不会改变，但在实时条形图上的每次脚本迭代中</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都会</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变。脚本计算中使用的内置变量的变化反过来会导致这些计算结果的变化。这是脚本跟踪实时价格行为所必需的。因此，同一个脚本在实时条形图期间每次执行时可能会产生不同的结果。</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实时条形图中，</font></font><code dir="auto">close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量始终代表</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前价格</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。同样，</font></font><code dir="auto">high</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">low</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置变量代表自实时条形图开始以来达到的最高点和最低点。Pine Script™ 的内置变量仅代表实时条形图上次更新时的最终值。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们在实时栏中关注我们的脚本示例。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当脚本到达实时栏时，它会首次执行。它使用内置变量的当前值来生成一组结果，并在需要时绘制它们。在下一次更新发生时脚本再次执行之前，其用户定义变量将重置为已知状态，对应于上一个栏结束时的最后一次</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态。如果由于每个栏都初始化而未对变量进行提交，则它们将重新初始化。在这两种情况下，它们最后计算的状态都会丢失。绘制的标签和线条的状态也会重置。在实时栏中每次新的脚本迭代之前重置脚本的用户定义变量和绘图称为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回滚</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。其效果是将脚本重置为实时栏打开时的已知状态，因此实时栏中的计算始终从干净状态执行。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当实时条形图中的价格或交易量发生变化时，不断重新计算脚本的值可能会导致出现这种情况：</font></font><code dir="auto">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于出现交叉，我们示例中的变量变为真，因此脚本最后一行绘制的红色标记将出现在图表上。如果在下一次价格更新时，价格发生了变化，以至于由于不再有交叉，该
</font></font><code dir="auto">close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不再产生计算结果为</font></font><code dir="auto">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真，那么之前绘制的标记将消失。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当实时柱线关闭时，脚本将执行最后一次。通常，变量会在执行前回滚。但是，由于此迭代是实时柱线上的最后一次迭代，因此计算完成后，变量将提交给柱线的最终值。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总结一下实时条形图的流程：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实时栏打开时执行，然后每次更新时执行一次</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次实时更新之前</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量都会回滚</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量在收盘价更新时</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交一次</font><font style="vertical-align: inherit;">。</font></font></li>
</ul>
<h2 id="events-triggering-the-execution-of-a-script" class="md-heading"><a href="#events-triggering-the-execution-of-a-script"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">触发脚本</font></span><font style="vertical-align: inherit;">执行的事件</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当发生以下事件之一时，将在图表上的完整条形图集上执行脚本：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表上加载了新的符号或时间范围。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Pine Script™ 编辑器或图表的“指标和策略”对话框中，将脚本保存或添加到图表中。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在脚本的“设置/输入”对话框中修改了一个值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在策略的“设置/属性”对话框中修改值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测到浏览器刷新事件。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当交易处于活动状态时，会在实时栏上执行脚本：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生上述情况之一，导致脚本在实时栏开盘时执行，或</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于检测到价格或数量变化，实时条形图会更新。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，当市场活跃时图表未发生任何变化，一系列已打开然后关闭的实时条形图将落后于当前实时条形图。虽然这些</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已过去的实时条形图</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将得到</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认，</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为它们的变量已全部提交，但脚本尚未在它们的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状态下执行它们，因为脚本上次在图表数据集上运行时它们并不存在。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当事件触发图表上的脚本执行并导致其在现在已成为历史条形图的条形图上运行时，脚本的计算结果有时会与在相同条形图为实时条形图时上次收盘更新时计算的结果不同。这可能是由于实时条形图收盘时保存的 OHLCV 值与在相同条形图成为历史条形图时从数据馈送中获取的 OHLCV 值之间存在细微差异造成的。此行为是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重绘</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的可能原因之一。</font></font></p>
<h2 id="more-information" class="md-heading"><a href="#more-information"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置</font></font><code dir="auto">barstate.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量提供有关
执行脚本</font></font><a href="/pine-script-docs/concepts/bar-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的条形图类型或事件的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息。记录这些变量的页面还包含一个脚本，例如，该脚本可让您直观地看到实时条形图和历史条形图之间的差异。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略页面解释了策略计算的细节，这些细节与指标的</font></font><a href="/pine-script-docs/concepts/strategies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">细节不同。</font></font></li>
</ul>
<h2 id="historical-values-of-functions" class="md-heading"><a href="#historical-values-of-functions"><font style="vertical-align: inherit;"><span class="fancy-wrap"><font style="vertical-align: inherit;">函数</font></span><font style="vertical-align: inherit;">的历史值</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine 中的每个函数调用都会留下历史值的痕迹，脚本可以使用
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[]</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
运算符在后续的柱状图上访问这些历史值。历史函数系列依赖于连续调用来记录每个柱状图的输出。当脚本没有在每个柱状图上调用函数时，它可能会产生不一致的历史记录，这可能会影响计算和结果，即当它依赖于历史系列的连续性来按预期运行时。在这些情况下，编译器会警告用户，让他们意识到函数的值（无论是内置的还是用户定义的）可能会产生误导。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示，让我们编写一个脚本来计算当前柱的索引，并在每隔一个柱上输出该值。在下面的脚本中，我们定义了一个</font></font><code dir="auto">calcBarIndex()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，该函数在每个柱上将其内部变量的先前值加 1。</font></font><code dir="auto">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本在每个返回的柱上调用该函数</font></font><code dir="auto">condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code dir="auto">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每隔一个柱）来更新该</font></font><code dir="auto">customIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。它将这个值与内置值一起绘制</font></font><code dir="auto">bar_index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以验证输出：</font></font></p>
<p><img src="/pine-script-docs/_astro/Function_historical_context_1.BS8uzH0h_1erubd.webp" alt="图像" width="1712" height="836" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="142"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;script"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Calculates&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;current&nbsp;bar&nbsp;by&nbsp;adding</span><span class="mtk9">&nbsp;1&nbsp;to&nbsp;its&nbsp;own&nbsp;value&nbsp;from&nbsp;the&nbsp;previous&nbsp;bar.</span></span><br><span><span class="mtk9">//&nbsp;The&nbsp;first&nbsp;bar&nbsp;will&nbsp;have&nbsp;an&nbsp;index&nbsp;of&nbsp;0.</span></span><br><span><span class="mtk15">calcBarIndex</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">index</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">index</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">index</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">replacement</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`true`&nbsp;on&nbsp;every&nbsp;other&nbsp;bar.</span></span><br><span><span class="mtk33">condition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">customIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Call&nbsp;`calcBarIndex()`&nbsp;when&nbsp;the&nbsp;`condition`&nbsp;is&nbsp;`</span><span class="mtk9">true`.&nbsp;This&nbsp;prompts&nbsp;the&nbsp;compiler&nbsp;to&nbsp;raise&nbsp;a&nbsp;warnin</span><span class="mtk9">g.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">customIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">calcBarIndex</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Bar&nbsp;index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">customIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_cross</span><span class="mtk13">)</span></span><br></code></div>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></strong></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nz
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数
用指定</font><font style="vertical-align: inherit;">值（默认为 0）</font><font style="vertical-align: inherit;">
替换
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。在脚本的第一个条形图上，当系列没有历史记录时，
 </font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;">na</font></a><font style="vertical-align: inherit;">
值将替换为 -1，然后再加 1 以返回初始值 0。</font></font><code dir="auto">replacement</code><font style="vertical-align: inherit;"></font><code dir="auto">index</code><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#var_na"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查图表后，我们发现两个图大不相同。出现这种情况的原因是脚本在</font><font style="vertical-align: inherit;">
每隔一个条形图上都在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;">if</font></a></font><code dir="auto">calcBarIndex()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构
范围内
调用，导致历史输出与</font><font style="vertical-align: inherit;">系列不一致。每两个条形图调用一次函数时，内部引用的先前值</font><font style="vertical-align: inherit;">
会获取两个条形图之前的值，即执行函数的最后一个条形图。此行为导致值为</font><font style="vertical-align: inherit;">内置的一半</font><font style="vertical-align: inherit;">。</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">bar_index</code><font style="vertical-align: inherit;"></font><code dir="auto">index</code><font style="vertical-align: inherit;"></font><code dir="auto">customIndex</code><font style="vertical-align: inherit;"></font><code dir="auto">bar_index</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使</font></font><code dir="auto">calcBarIndex()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出与 对齐</font></font><code dir="auto">bar_index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以将函数调用移至脚本的全局范围。这样，函数将在每个条形上执行，从而允许记录和引用其整个历史记录，而不仅仅是每个其他条形的结果。在下面的代码中，我们</font></font><code dir="auto">globalScopeBarIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在全局范围内定义了一个变量并将其分配给从 的返回，</font></font><code dir="auto">calcBarIndex()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是在本地调用该函数。脚本</font><font style="vertical-align: inherit;">在 发生时将 设置</font></font><code dir="auto">customIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 的值</font><font style="vertical-align: inherit;">：</font></font><code dir="auto">globalScopeBarIndex</code><font style="vertical-align: inherit;"></font><code dir="auto">condition</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Function_historical_context_2.DMU4JJfT_ZCks6f.webp" alt="图像" width="1712" height="836" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3w9"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;script"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Calculates&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;current&nbsp;bar&nbsp;by&nbsp;adding</span><span class="mtk9">&nbsp;1&nbsp;to&nbsp;its&nbsp;own&nbsp;value&nbsp;from&nbsp;the&nbsp;previous&nbsp;bar.</span></span><br><span><span class="mtk9">//&nbsp;The&nbsp;first&nbsp;bar&nbsp;will&nbsp;have&nbsp;an&nbsp;index&nbsp;of&nbsp;0.</span></span><br><span><span class="mtk15">calcBarIndex</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">index</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">index</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">index</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">replacement</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`true`&nbsp;on&nbsp;every&nbsp;second&nbsp;bar.</span></span><br><span><span class="mtk33">condition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk33">globalScopeBarIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">calcBarIndex</span><span class="mtk13">()</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">customIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Assign&nbsp;`customIndex`&nbsp;to&nbsp;`globalScopeBarIndex`&nbsp;w</span><span class="mtk9">hen&nbsp;the&nbsp;`condition`&nbsp;is&nbsp;`true`.&nbsp;This&nbsp;won't&nbsp;produce&nbsp;</span><span class="mtk9">a&nbsp;warning.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">customIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalScopeBarIndex</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Bar&nbsp;index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">customIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_cross</span><span class="mtk13">)</span></span><br></code></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种行为还会对内部引用历史记录的内置函数产生重大影响。例如，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dsma"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ta.sma()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数“在幕后”引用其过去的值。如果脚本有条件地而不是在每个条上调用此函数，则计算中的值可能会发生显著变化。我们可以通过将
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dsma"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ta.sma()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分配
给全局范围内的变量并根据需要引用该变量的历史记录来确保计算的一致性。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例计算三个 SMA 系列：</font></font><code dir="auto">controlSMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、
</font></font><code dir="auto">localSMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code dir="auto">globalSMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。该脚本在</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;">if</font></a></font><code dir="auto">controlSMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构的全局范围和</font></font><code dir="auto">localSMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">局部范围内
进行计算</font><font style="vertical-align: inherit;">
。在
</font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;">if</font></a><font style="vertical-align: inherit;">结构中，它还使用
值</font><font style="vertical-align: inherit;">
更新的值</font><font style="vertical-align: inherit;">。我们可以看到，</font><font style="vertical-align: inherit;">和
</font><font style="vertical-align: inherit;">系列的值一致，而系列</font><font style="vertical-align: inherit;">与其他两个系列不同，因为它使用不完整的历史记录，这会影响其计算：</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code dir="auto">globalSMA</code><font style="vertical-align: inherit;"></font><code dir="auto">controlSMA</code><font style="vertical-align: inherit;"></font><code dir="auto">globalSMA</code><font style="vertical-align: inherit;"></font><code dir="auto">controlSMA</code><font style="vertical-align: inherit;"></font><code dir="auto">localSMA</code><font style="vertical-align: inherit;"></font></p>
<p><img src="/pine-script-docs/_astro/Function_historical_context_3.B-yx15UY_1PfdyK.webp" alt="图像" width="1712" height="836" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1wv"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs/en/v5/Introduction.html" target="_blank" rel="noopener"><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pine Script™</font></font></span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已复制</font></font></div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;script"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Returns&nbsp;`true`&nbsp;on&nbsp;every&nbsp;second&nbsp;bar.</span></span><br><span><span class="mtk33">condition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk33">controlSMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalSMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">localSMA</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Update&nbsp;`globalSMA`&nbsp;and&nbsp;`localSMA`&nbsp;when&nbsp;`conditi</span><span class="mtk9">on`&nbsp;is&nbsp;`true`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">globalSMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">controlSMA</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;No&nbsp;warning.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">localSMA</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk9">//&nbsp;Raises&nbsp;warning.&nbsp;This&nbsp;function&nbsp;depends&nbsp;on&nbsp;its&nbsp;hi</span><span class="mtk9">story&nbsp;to&nbsp;work&nbsp;as&nbsp;intended.</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">controlSMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Control&nbsp;SMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">globalSMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"Global&nbsp;SMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_cross</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">localSMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Local&nbsp;SMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_cross</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="why-this-behavior" class="md-heading"><a href="#why-this-behavior"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么会有这种</font></font><span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行为？</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种行为是必需的，因为强制在每个条形图上执行函数会导致那些产生副作用的函数（即除了返回值之外还执行其他操作的函数）产生意外结果。例如，label.new
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数会在图表上创建一个标签，因此强制在每个条形图上调用它（即使它在
</font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结构内）会创建逻辑上不应该出现的标签。</font></font></p>
<h3 id="exceptions" class="md-heading"><a href="#exceptions"> <span class="fancy-wrap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外</font></font><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并非所有内置函数都在计算中使用其先前的值，这意味着并非所有函数都需要在每个柱上执行。例如，
 </font></font><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math%7Bdot%7Dmax"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">math.max()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会比较传递给它的所有参数以返回最大值。这些函数不会以任何方式与其历史记录交互，因此不需要特殊处理。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果在条件块中使用函数不会引起编译器警告，则可以安全使用而不会影响计算。否则，请将函数调用移至全局范围以强制一致执行。尽管出现警告，但仍在条件块内保留函数调用时，至少要确保输出正确，以避免出现意外结果。</font></font></p>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <span data-astro-cid-xgirumru=""></span> <a href="/pine-script-docs/language/time-series" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  时间序列</font></font><svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本页</font></font></h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#execution-model" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行模型</font></font></li></a><a href="#calculation-based-on-historical-bars" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据历史柱计算</font></font></li></a><a href="#calculation-based-on-realtime-bars" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据实时柱线计算</font></font></li></a><a href="#events-triggering-the-execution-of-a-script" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发脚本执行的事件</font></font></li></a><a href="#more-information" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多信息</font></font></li></a><a href="#historical-values-of-functions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的历史值</font></font></li></a><a href="#why-this-behavior" class="document-toc-link" data-astro-cid-oor6cujd="" aria-current="true"><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么会有这种行为？</font></font></li></a><a href="#exceptions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外</font></font></li></a></ul><a class="back-top" href="#top" data-astro-cid-oor6cujd=""><svg width="16" height="16" viewBox="0 0 16 16" data-astro-cid-oor6cujd="" data-icon="theme/back-top">  <symbol id="ai:local:theme/back-top"><path fill="currentColor" fill-rule="evenodd" d="M6.25 12.5A2.75 2.75 0 0 0 9 9.75V4.56L6.78 6.78a.75.75 0 0 1-1.06-1.06l3.5-3.5a.75.75 0 0 1 1.06 0l3.5 3.5a.75.75 0 0 1-1.06 1.06L10.5 4.56v5.19a4.25 4.25 0 0 1-8.5 0v-1a.75.75 0 0 1 1.5 0v1a2.75 2.75 0 0 0 2.75 2.75Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/back-top"></use>  </svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回到顶部
</font></font></a></section></aside></div> </main> </div>            <script data-astro-rerun="" src="/pine-script-docs/static/pine-highlighter-v06.js" data-astro-exec=""></script><div id="goog-gt-tt" class="VIpgJd-yAWNEb-L7lbkb skiptranslate" style="border-radius: 12px; margin: 0 0 0 -23px; padding: 0; font-family: 'Google Sans', Arial, sans-serif;" data-id=""><div id="goog-gt-vt" class="VIpgJd-yAWNEb-hvhgNd"><div class=" VIpgJd-yAWNEb-hvhgNd-l4eHX-i3jM8c"><img src="https://fonts.gstatic.com/s/i/productlogos/translate/v14/24px.svg" width="24" height="24" alt=""></div><div class=" VIpgJd-yAWNEb-hvhgNd-k77Iif-i3jM8c"><div class="VIpgJd-yAWNEb-hvhgNd-IuizWc" dir="ltr">Original text</div><div id="goog-gt-original-text" class="VIpgJd-yAWNEb-nVMfcd-fmcmS VIpgJd-yAWNEb-hvhgNd-axAV1"></div></div><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid ltr"><div class="VIpgJd-yAWNEb-hvhgNd-N7Eqid-B7I4Od ltr" dir="ltr"><div class="VIpgJd-yAWNEb-hvhgNd-UTujCb">Rate this translation</div><div class="VIpgJd-yAWNEb-hvhgNd-eO9mKe">Your feedback will be used to help improve Google Translate</div></div><div class="VIpgJd-yAWNEb-hvhgNd-xgov5 ltr"><button id="goog-gt-thumbUpButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Good translation" aria-label="Good translation" aria-pressed="false"><span id="goog-gt-thumbUpIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7H2v13h16c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM7 18H4V9h3v9zm14-7l-3 7H9V8l4.34-4.34L12 9h9v2z"></path></svg></span><span id="goog-gt-thumbUpIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M21 7h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 0S7.08 6.85 7 7v13h11c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V9c0-1.1-.9-2-2-2zM5 7H1v13h4V7z"></path></svg></span></button><button id="goog-gt-thumbDownButton" type="button" class="VIpgJd-yAWNEb-hvhgNd-bgm6sf" title="Poor translation" aria-label="Poor translation" aria-pressed="false"><span id="goog-gt-thumbDownIcon"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7h5V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zM17 6h3v9h-3V6zM3 13l3-7h9v10l-4.34 4.34L12 15H3v-2z"></path></svg></span><span id="goog-gt-thumbDownIconFilled"><svg width="24" height="24" viewBox="0 0 24 24" focusable="false" class="VIpgJd-yAWNEb-hvhgNd-THI6Vb NMm5M"><path d="M3 17h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 24s7.09-6.85 7.17-7V4H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2zm16 0h4V4h-4v13z"></path></svg></span></button></div></div><div id="goog-gt-votingHiddenPane" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><form id="goog-gt-votingForm" action="//translate.googleapis.com/translate_voting?client=te_lib" method="post" target="votingFrame" class="VIpgJd-yAWNEb-hvhgNd-aXYTce"><input type="text" name="sl" id="goog-gt-votingInputSrcLang"><input type="text" name="tl" id="goog-gt-votingInputTrgLang"><input type="text" name="query" id="goog-gt-votingInputSrcText"><input type="text" name="gtrans" id="goog-gt-votingInputTrgText"><input type="text" name="vote" id="goog-gt-votingInputVote"></form><iframe name="votingFrame" frameborder="0"></iframe></div></div></div> </body></html>